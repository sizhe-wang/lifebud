{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/wsz/lifebud/version2/lifebud/src/mastra/tools/index.ts"],"sourcesContent":["import { createTool } from \"@mastra/core/tools\";\nimport { z } from \"zod\";\n\ninterface GeocodingResponse {\n  results: {\n    latitude: number;\n    longitude: number;\n    name: string;\n  }[];\n}\ninterface WeatherResponse {\n  current: {\n    time: string;\n    temperature_2m: number;\n    apparent_temperature: number;\n    relative_humidity_2m: number;\n    wind_speed_10m: number;\n    wind_gusts_10m: number;\n    weather_code: number;\n  };\n}\n\nexport type WeatherToolResult = z.infer<typeof WeatherToolResultSchema>;\n\nconst WeatherToolResultSchema = z.object({\n  temperature: z.number(),\n  feelsLike: z.number(),\n  humidity: z.number(),\n  windSpeed: z.number(),\n  windGust: z.number(),\n  conditions: z.string(),\n  location: z.string(),\n});\n\nexport const weatherTool = createTool({\n  id: \"get-weather\",\n  description: \"Get current weather for a location\",\n  inputSchema: z.object({\n    location: z.string().describe(\"City name\"),\n  }),\n  outputSchema: WeatherToolResultSchema,\n  execute: async (inputData) => {\n    return await getWeather(inputData.location);\n  },\n});\n\nconst getWeather = async (location: string) => {\n  const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(location)}&count=1`;\n  const geocodingResponse = await fetch(geocodingUrl);\n  const geocodingData = (await geocodingResponse.json()) as GeocodingResponse;\n\n  if (!geocodingData.results?.[0]) {\n    throw new Error(`Location '${location}' not found`);\n  }\n\n  const { latitude, longitude, name } = geocodingData.results[0];\n\n  const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,apparent_temperature,relative_humidity_2m,wind_speed_10m,wind_gusts_10m,weather_code`;\n\n  const response = await fetch(weatherUrl);\n  const data = (await response.json()) as WeatherResponse;\n\n  return {\n    temperature: data.current.temperature_2m,\n    feelsLike: data.current.apparent_temperature,\n    humidity: data.current.relative_humidity_2m,\n    windSpeed: data.current.wind_speed_10m,\n    windGust: data.current.wind_gusts_10m,\n    conditions: getWeatherCondition(data.current.weather_code),\n    location: name,\n  };\n};\n\nfunction getWeatherCondition(code: number): string {\n  const conditions: Record<number, string> = {\n    0: \"Clear sky\",\n    1: \"Mainly clear\",\n    2: \"Partly cloudy\",\n    3: \"Overcast\",\n    45: \"Foggy\",\n    48: \"Depositing rime fog\",\n    51: \"Light drizzle\",\n    53: \"Moderate drizzle\",\n    55: \"Dense drizzle\",\n    56: \"Light freezing drizzle\",\n    57: \"Dense freezing drizzle\",\n    61: \"Slight rain\",\n    63: \"Moderate rain\",\n    65: \"Heavy rain\",\n    66: \"Light freezing rain\",\n    67: \"Heavy freezing rain\",\n    71: \"Slight snow fall\",\n    73: \"Moderate snow fall\",\n    75: \"Heavy snow fall\",\n    77: \"Snow grains\",\n    80: \"Slight rain showers\",\n    81: \"Moderate rain showers\",\n    82: \"Violent rain showers\",\n    85: \"Slight snow showers\",\n    86: \"Heavy snow showers\",\n    95: \"Thunderstorm\",\n    96: \"Thunderstorm with slight hail\",\n    99: \"Thunderstorm with heavy hail\",\n  };\n  return conditions[code] || \"Unknown\";\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAuBA,MAAM,0BAA0B,yKAAC,CAAC,MAAM,CAAC;IACvC,aAAa,yKAAC,CAAC,MAAM;IACrB,WAAW,yKAAC,CAAC,MAAM;IACnB,UAAU,yKAAC,CAAC,MAAM;IAClB,WAAW,yKAAC,CAAC,MAAM;IACnB,UAAU,yKAAC,CAAC,MAAM;IAClB,YAAY,yKAAC,CAAC,MAAM;IACpB,UAAU,yKAAC,CAAC,MAAM;AACpB;AAEO,MAAM,cAAc,IAAA,6KAAU,EAAC;IACpC,IAAI;IACJ,aAAa;IACb,aAAa,yKAAC,CAAC,MAAM,CAAC;QACpB,UAAU,yKAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAChC;IACA,cAAc;IACd,SAAS,OAAO;QACd,OAAO,MAAM,WAAW,UAAU,QAAQ;IAC5C;AACF;AAEA,MAAM,aAAa,OAAO;IACxB,MAAM,eAAe,CAAC,oDAAoD,EAAE,mBAAmB,UAAU,QAAQ,CAAC;IAClH,MAAM,oBAAoB,MAAM,MAAM;IACtC,MAAM,gBAAiB,MAAM,kBAAkB,IAAI;IAEnD,IAAI,CAAC,cAAc,OAAO,EAAE,CAAC,EAAE,EAAE;QAC/B,MAAM,IAAI,MAAM,CAAC,UAAU,EAAE,SAAS,WAAW,CAAC;IACpD;IAEA,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,cAAc,OAAO,CAAC,EAAE;IAE9D,MAAM,aAAa,CAAC,gDAAgD,EAAE,SAAS,WAAW,EAAE,UAAU,4GAA4G,CAAC;IAEnN,MAAM,WAAW,MAAM,MAAM;IAC7B,MAAM,OAAQ,MAAM,SAAS,IAAI;IAEjC,OAAO;QACL,aAAa,KAAK,OAAO,CAAC,cAAc;QACxC,WAAW,KAAK,OAAO,CAAC,oBAAoB;QAC5C,UAAU,KAAK,OAAO,CAAC,oBAAoB;QAC3C,WAAW,KAAK,OAAO,CAAC,cAAc;QACtC,UAAU,KAAK,OAAO,CAAC,cAAc;QACrC,YAAY,oBAAoB,KAAK,OAAO,CAAC,YAAY;QACzD,UAAU;IACZ;AACF;AAEA,SAAS,oBAAoB,IAAY;IACvC,MAAM,aAAqC;QACzC,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;QACH,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;IACN;IACA,OAAO,UAAU,CAAC,KAAK,IAAI;AAC7B"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///Users/wsz/lifebud/version2/lifebud/src/mastra/agents/story-agent.ts"],"sourcesContent":["import { Agent } from \"@mastra/core/agent\";\nimport { LibSQLStore } from \"@mastra/libsql\";\nimport { z } from \"zod\";\nimport { Memory } from \"@mastra/memory\";\n\nexport const StoryAgentState = z.object({\n  genre: z.string().default(\"fantasy\"),\n  tone: z.string().default(\"whimsical\"),\n});\n\nexport const storyAgent = new Agent({\n  id: \"story-agent\",\n  name: \"Story Agent\",\n  model: 'iflowcn/glm-4.6',\n  instructions: `\n  你是一个现实约束型剧情生成 Agent，负责在一款关于生育与养育真相的文字冒险游戏中生成剧情事件。\n  **核心职责**：\n  根据用户的人物背景、核心属性值、当前所处的阶段以及当前阶段会面对的事件，生成符合游戏设定的剧情事件。\n  **执行步骤**：\n  1.**获取用户人物背景**:从 localstorage 中获取人物背景(\"user_background\")。\n  2.**获取用户当前状态**:从 localstorage 中获取当前状态(\"user_state\")。\n  3.**获取用户已经发生的事件**:从 localstorage 中获取已经发生的事件(\"user_events\")。\n  4.**获取根据当前阶段会面对的事件**：\n  5.**生成剧情**:根据用户的背景和当前属性状态，从当前阶段可能面对的事件中选择一个，生成具有一定挑战性但不过于困难的剧情。如果某项属性过低，可以生成相关的剧情。\n\n  **内容要求**：\n  1.**剧情描述**：剧情符合当前阶段和用户状态，事件需要真实、有教育意义，并且能够引起玩家的情感共鸣。事件要真实反映生育养育过程中可能遇到的各种情况。\n\n  2.**选项设计规则**：每个事件必须提供2个不同的选择，所有选项都是现实中常见反应，每个选项都有代价。\n\n  3.**核心属性变化**：\n  - **数值约束**：除了财富以外的数值的范围是 0～100，财富最小值是 0，没有最大值。数值的变化是由剧情的发生而导致的，应该在合理的范围内。\n  - 示例：对于第一次孕前检查事件，选择公立三甲医院：财富-500，身体状况+5，精神状况-3；选择私立高端医院：财富-2000，身体状况+8，精神状况+5。\n  4.**语言风格**：\n    - 克制、具体、不过度抒情\n    - 多用细节，少用判断\n    - 不总结、不升华、不说教\n  **注意事项**：\n    - 每个事件必须提供2个不同的选择，每个选择都应该有明确的影响方向\n    - 属性变化范围：-15 到 15 之间，累计影响要合理\n    - 事件要真实反映生育养育过程中可能遇到的各种情况\n    - 要体现社会的真实困境，不要美化或过度美化现实\n  **返回格式**:\n  请严格按照以下 JSON 格式输出，不要添加任何额外的文字说明：\n\n{\n  \"title\": \"事件标题（简洁有力，10字以内）\",\n  \"description\": \"事件详细描述（50-100字，描述具体情境）\",\n  \"choices\": [\n    {\n      \"text\": \"选项1的具体内容（20-30字）\",\n      \"effects\": {\n        \"wealth\": 数字,\n        \"mentalHealth\": 数字,\n        \"physicalHealth\": 数字,\n        \"babyHealth\": 数字,\n      }\n    }\n  ]\n}\n`,\n    memory: new Memory({\n    storage: new LibSQLStore({\n      id: \"story-agent-memory\",\n      url: \"file::memory:\",\n    }),\n    // options: {\n    //   workingMemory: {\n    //     enabled: true,\n    //     schema: StoryAgentState,\n    //   },\n    // },\n  }),\n});\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEO,MAAM,kBAAkB,yKAAC,CAAC,MAAM,CAAC;IACtC,OAAO,yKAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IAC1B,MAAM,yKAAC,CAAC,MAAM,GAAG,OAAO,CAAC;AAC3B;AAEO,MAAM,aAAa,IAAI,wKAAK,CAAC;IAClC,IAAI;IACJ,MAAM;IACN,OAAO;IACP,cAAc,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CjB,CAAC;IACG,QAAQ,IAAI,+KAAM,CAAC;QACnB,SAAS,IAAI,oKAAW,CAAC;YACvB,IAAI;YACJ,KAAK;QACP;IAOF;AACF"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///Users/wsz/lifebud/version2/lifebud/src/mastra/agents/user-background-agent.ts"],"sourcesContent":["import { Agent } from \"@mastra/core/agent\";\nimport { LibSQLStore } from \"@mastra/libsql\";\nimport { Memory } from \"@mastra/memory\";\n\nexport const userBackgroundAgent = new Agent({\n  id: \"user-background-agent\",\n  name: \"User Background Agent\",\n  model: 'iflowcn/glm-4.6',\n  instructions: `\n  你是一个负责生成用户初始背景属性的 Agent。\n  根据用户提供的输入参数（年龄、城市、工作强度、伴侣状态），生成用户的初始核心属性值。\n\n  **输入参数说明**：\n  - 年龄：用户的年龄\n  - 城市：用户所在的城市（如一线城市、二线城市等，影响财富和生活压力）\n  - 工作强度：如 996、965、自由职业等（影响健康、心情和财富）\n  - 伴侣状态：如单身、恋爱中、已婚等（影响婚姻值和心情）\n\n  **输出属性说明**：\n  1. **健康 (health)**: 范围 0-100。受年龄和工作强度影响较大。\n  2. **心情 (mood)**: 范围 0-100。受工作强度、伴侣状态和城市生活压力影响。\n  3. **婚姻 (marriage)**: 范围 0-100。反映伴侣关系的质量。如果是单身，该值可能较低或为特定初始值（如 0 或 50，视游戏设定而定，这里建议单身设为 0 或不适用，但要求输出 0-100，建议单身设为 0，有伴侣根据情况设定）。\n  4. **财富 (wealth)**: 初始资产。受年龄、城市和工作强度影响。无上限，最小为 0。\n\n  **逻辑参考**：\n  - 年龄越大，财富通常越多，但健康可能略有下降。\n  - 一线城市财富基础高，但生活成本高（隐含），心情可能受压抑。\n  - 高工作强度（996）显著增加财富，但显著降低健康和心情。\n  - 伴侣状态为“已婚”或“恋爱”通常会有较高的婚姻初始值（如 60-90），单身则为 0。\n\n  **返回格式**:\n  请严格按照以下 JSON 格式输出，不要添加任何额外的文字说明：\n  {\n    \"health\": 80,\n    \"mood\": 75,\n    \"marriage\": 60,\n    \"wealth\": 50000\n  }\n  `\n});\n"],"names":[],"mappings":";;;;AAAA;;AAIO,MAAM,sBAAsB,IAAI,wKAAK,CAAC;IAC3C,IAAI;IACJ,MAAM;IACN,OAAO;IACP,cAAc,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EA8Bf,CAAC;AACH"}},
    {"offset": {"line": 303, "column": 0}, "map": {"version":3,"sources":["file:///Users/wsz/lifebud/version2/lifebud/src/mastra/agents/index.ts"],"sourcesContent":["import { openai } from \"@ai-sdk/openai\";\nimport { Agent } from \"@mastra/core/agent\";\nimport { weatherTool } from \"@/mastra/tools\";\nimport { LibSQLStore } from \"@mastra/libsql\";\nimport { z } from \"zod\";\nimport { Memory } from \"@mastra/memory\";\n\nexport const AgentState = z.object({\n  proverbs: z.array(z.string()).default([]),\n});\n\nexport const weatherAgent = new Agent({\n  id: \"weather-agent\",\n  name: \"Weather Agent\",\n  tools: { weatherTool },\n  model: 'iflowcn/glm-4.6',\n  instructions: \"You are a helpful assistant.\",\n  memory: new Memory({\n    storage: new LibSQLStore({\n      id: \"weather-agent-memory\",\n      url: \"file::memory:\",\n    }),\n    options: {\n      workingMemory: {\n        enabled: true,\n        schema: AgentState,\n      },\n    },\n  }),\n});\n\nexport * from \"./story-agent\";\nexport * from \"./user-background-agent\";\n\n"],"names":[],"mappings":";;;;;;AACA;AACA;AACA;AACA;AACA;AA0BA;AACA;;;;;;;;;;;AAzBO,MAAM,aAAa,yKAAC,CAAC,MAAM,CAAC;IACjC,UAAU,yKAAC,CAAC,KAAK,CAAC,yKAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE;AAC1C;AAEO,MAAM,eAAe,IAAI,wKAAK,CAAC;IACpC,IAAI;IACJ,MAAM;IACN,OAAO;QAAE,aAAA,gJAAW;IAAC;IACrB,OAAO;IACP,cAAc;IACd,QAAQ,IAAI,+KAAM,CAAC;QACjB,SAAS,IAAI,oKAAW,CAAC;YACvB,IAAI;YACJ,KAAK;QACP;QACA,SAAS;YACP,eAAe;gBACb,SAAS;gBACT,QAAQ;YACV;QACF;IACF;AACF"}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///Users/wsz/lifebud/version2/lifebud/src/mastra/index.ts"],"sourcesContent":["import { Mastra } from \"@mastra/core/mastra\";\nimport { LibSQLStore } from \"@mastra/libsql\";\nimport { weatherAgent, storyAgent, userBackgroundAgent } from \"./agents\";\nimport { ConsoleLogger, LogLevel } from \"@mastra/core/logger\";\n\nconst LOG_LEVEL = (process.env.LOG_LEVEL as LogLevel) || \"info\";\n\nexport const mastra = new Mastra({\n  agents: {\n    weatherAgent,\n    storyAgent,\n    userBackgroundAgent,\n  },\n  storage: new LibSQLStore({\n    id: \"mastra-storage\",\n    url: \":memory:\",\n  }),\n  logger: new ConsoleLogger({\n    level: LOG_LEVEL,\n  }),\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AAAA;AACA;;;;;;;;;;;AAEA,MAAM,YAAY,AAAC,QAAQ,GAAG,CAAC,SAAS,IAAiB;AAElD,MAAM,SAAS,IAAI,yKAAM,CAAC;IAC/B,QAAQ;QACN,cAAA,kKAAY;QACZ,YAAA,yJAAU;QACV,qBAAA,+KAAmB;IACrB;IACA,SAAS,IAAI,oKAAW,CAAC;QACvB,IAAI;QACJ,KAAK;IACP;IACA,QAAQ,IAAI,gLAAa,CAAC;QACxB,OAAO;IACT;AACF"}},
    {"offset": {"line": 401, "column": 0}, "map": {"version":3,"sources":["file:///Users/wsz/lifebud/version2/lifebud/src/app/api/copilotkit/route.ts"],"sourcesContent":["import {\n  CopilotRuntime,\n  ExperimentalEmptyAdapter,\n  copilotRuntimeNextJSAppRouterEndpoint,\n} from \"@copilotkit/runtime\";\nimport { MastraAgent } from \"@ag-ui/mastra\";\nimport { NextRequest } from \"next/server\";\nimport { mastra } from \"@/mastra\";\n\n// 1. You can use any service adapter here for multi-agent support.\nconst serviceAdapter = new ExperimentalEmptyAdapter();\n\n// 2. Build a Next.js API route that handles the CopilotKit runtime requests.\nexport const POST = async (req: NextRequest) => {\n  // 3. Create the CopilotRuntime instance and utilize the Mastra AG-UI\n  //    integration to get the remote agents. Cache this for performance.\n  const runtime = new CopilotRuntime({\n    // @ts-expect-error - ignore for now, typing error\n    agents: MastraAgent.getLocalAgents({ mastra }),\n  });\n\n  const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({\n    runtime,\n    serviceAdapter,\n    endpoint: \"/api/copilotkit\",\n  });\n\n  return handleRequest(req);\n};\n"],"names":[],"mappings":";;;;AAAA;AAKA;AAEA;;;;;;;;;AAEA,mEAAmE;AACnE,MAAM,iBAAiB,IAAI,wOAAwB;AAG5C,MAAM,OAAO,OAAO;IACzB,qEAAqE;IACrE,uEAAuE;IACvE,MAAM,UAAU,IAAI,8NAAc,CAAC;QACjC,kDAAkD;QAClD,QAAQ,uKAAW,CAAC,cAAc,CAAC;YAAE,QAAA,kIAAM;QAAC;IAC9C;IAEA,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,qPAAqC,EAAC;QAC9D;QACA;QACA,UAAU;IACZ;IAEA,OAAO,cAAc;AACvB"}}]
}