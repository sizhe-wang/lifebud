{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-Y22QMA7S.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/request-context/index.ts"],"sourcesContent":["type RecordToTuple<T> = {\n  [K in keyof T]: [K, T[K]];\n}[keyof T][];\n\n/**\n * Reserved key for setting resourceId from middleware.\n * When set in RequestContext, this takes precedence over client-provided values\n * for security (prevents attackers from hijacking another user's memory).\n *\n * @example\n * ```typescript\n * // In your auth middleware:\n * const requestContext = c.get('requestContext');\n * requestContext.set(MASTRA_RESOURCE_ID_KEY, authenticatedUser.id);\n * ```\n */\nexport const MASTRA_RESOURCE_ID_KEY = 'mastra__resourceId';\n\n/**\n * Reserved key for setting threadId from middleware.\n * When set in RequestContext, this takes precedence over client-provided values\n * for security (prevents attackers from hijacking another user's memory).\n *\n * @example\n * ```typescript\n * // In your auth middleware:\n * const requestContext = c.get('requestContext');\n * requestContext.set(MASTRA_THREAD_ID_KEY, threadId);\n * ```\n */\nexport const MASTRA_THREAD_ID_KEY = 'mastra__threadId';\n\nexport class RequestContext<Values extends Record<string, any> | unknown = unknown> {\n  private registry = new Map<string, unknown>();\n\n  constructor(\n    iterable?: Values extends Record<string, any>\n      ? RecordToTuple<Partial<Values>>\n      : Iterable<readonly [string, unknown]>,\n  ) {\n    this.registry = new Map(iterable);\n  }\n\n  /**\n   * set a value with strict typing if `Values` is a Record and the key exists in it.\n   */\n  public set<K extends Values extends Record<string, any> ? keyof Values : string>(\n    key: K,\n    value: Values extends Record<string, any> ? (K extends keyof Values ? Values[K] : never) : unknown,\n  ): void {\n    // The type assertion `key as string` is safe because K always extends string ultimately.\n    this.registry.set(key as string, value);\n  }\n\n  /**\n   * Get a value with its type\n   */\n  public get<\n    K extends Values extends Record<string, any> ? keyof Values : string,\n    R = Values extends Record<string, any> ? (K extends keyof Values ? Values[K] : never) : unknown,\n  >(key: K): R {\n    return this.registry.get(key as string) as R;\n  }\n\n  /**\n   * Check if a key exists in the container\n   */\n  public has<K extends Values extends Record<string, any> ? keyof Values : string>(key: K): boolean {\n    return this.registry.has(key);\n  }\n\n  /**\n   * Delete a value by key\n   */\n  public delete<K extends Values extends Record<string, any> ? keyof Values : string>(key: K): boolean {\n    return this.registry.delete(key);\n  }\n\n  /**\n   * Clear all values from the container\n   */\n  public clear(): void {\n    this.registry.clear();\n  }\n\n  /**\n   * Get all keys in the container\n   */\n  public keys(): IterableIterator<Values extends Record<string, any> ? keyof Values : string> {\n    return this.registry.keys() as IterableIterator<Values extends Record<string, any> ? keyof Values : string>;\n  }\n\n  /**\n   * Get all values in the container\n   */\n  public values(): IterableIterator<Values extends Record<string, any> ? Values[keyof Values] : unknown> {\n    return this.registry.values() as IterableIterator<\n      Values extends Record<string, any> ? Values[keyof Values] : unknown\n    >;\n  }\n\n  /**\n   * Get all entries in the container.\n   * Returns a discriminated union of tuples for proper type narrowing when iterating.\n   */\n  public entries(): IterableIterator<\n    Values extends Record<string, any> ? { [K in keyof Values]: [K, Values[K]] }[keyof Values] : [string, unknown]\n  > {\n    return this.registry.entries() as IterableIterator<\n      Values extends Record<string, any> ? { [K in keyof Values]: [K, Values[K]] }[keyof Values] : [string, unknown]\n    >;\n  }\n\n  /**\n   * Get the size of the container\n   */\n  public size(): number {\n    return this.registry.size;\n  }\n\n  /**\n   * Execute a function for each entry in the container.\n   * The callback receives properly typed key-value pairs.\n   */\n  public forEach<K extends Values extends Record<string, any> ? keyof Values : string>(\n    callbackfn: (\n      value: Values extends Record<string, any> ? (K extends keyof Values ? Values[K] : unknown) : unknown,\n      key: K,\n      map: Map<string, unknown>,\n    ) => void,\n  ): void {\n    this.registry.forEach(callbackfn as (value: unknown, key: string, map: Map<string, unknown>) => void);\n  }\n\n  /**\n   * Custom JSON serialization method\n   * Converts the internal Map to a plain object for proper JSON serialization\n   */\n  public toJSON(): Record<string, any> {\n    return Object.fromEntries(this.registry);\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;AAgBO,IAAM,sBAAA,GAAyB;AAc/B,IAAM,oBAAA,GAAuB;AAE7B,IAAM,iBAAN,MAA6E;IAC1E,QAAA,GAAA,aAAA,GAAA,IAAe,GAAA,EAAqB,CAAA;IAE5C,YACE,QAAA,CAGA;QACA,IAAA,CAAK,QAAA,GAAW,IAAI,GAAA,CAAI,QAAQ,CAAA;IAClC;IAAA;;GAAA,GAKO,GAAA,CACL,GAAA,EACA,KAAA,EACM;QAEN,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,GAAA,EAAe,KAAK,CAAA;IACxC;IAAA;;GAAA,GAKO,IAGL,GAAA,EAAW;QACX,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,GAAa,CAAA;IACxC;IAAA;;GAAA,GAKO,IAA0E,GAAA,EAAiB;QAChG,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,GAAG,CAAA;IAC9B;IAAA;;GAAA,GAKO,OAA6E,GAAA,EAAiB;QACnG,OAAO,IAAA,CAAK,QAAA,CAAS,MAAA,CAAO,GAAG,CAAA;IACjC;IAAA;;GAAA,GAKO,KAAA,GAAc;QACnB,IAAA,CAAK,QAAA,CAAS,KAAA,EAAM;IACtB;IAAA;;GAAA,GAKO,IAAA,GAAqF;QAC1F,OAAO,IAAA,CAAK,QAAA,CAAS,IAAA,EAAK;IAC5B;IAAA;;GAAA,GAKO,MAAA,GAAgG;QACrG,OAAO,IAAA,CAAK,QAAA,CAAS,MAAA,EAAO;IAG9B;IAAA;;;GAAA,GAMO,OAAA,GAEL;QACA,OAAO,IAAA,CAAK,QAAA,CAAS,OAAA,EAAQ;IAG/B;IAAA;;GAAA,GAKO,IAAA,GAAe;QACpB,OAAO,IAAA,CAAK,QAAA,CAAS,IAAA;IACvB;IAAA;;;GAAA,GAMO,QACL,UAAA,EAKM;QACN,IAAA,CAAK,QAAA,CAAS,OAAA,CAAQ,UAA8E,CAAA;IACtG;IAAA;;;GAAA,GAMO,MAAA,GAA8B;QACnC,OAAO,MAAA,CAAO,WAAA,CAAY,IAAA,CAAK,QAAQ,CAAA;IACzC;AACF"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-7D4SUZUM.js","sources":[],"sourcesContent":[],"names":[],"mappings":""}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-D22XABFZ.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/_vendored/ai_v5/dist/chunk-7D4SUZUM.js","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40vercel%2Boidc%403.0.5/node_modules/%40vercel/oidc/dist/token-error.js"],"sourcesContent":["var __create = Object.create;\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getProtoOf = Object.getPrototypeOf;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __require = /* @__PURE__ */ ((x) => typeof require !== \"undefined\" ? require : typeof Proxy !== \"undefined\" ? new Proxy(x, {\n  get: (a, b) => (typeof require !== \"undefined\" ? require : a)[b]\n}) : x)(function(x) {\n  if (typeof require !== \"undefined\") return require.apply(this, arguments);\n  throw Error('Dynamic require of \"' + x + '\" is not supported');\n});\nvar __commonJS = (cb, mod) => function __require2() {\n  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\n  // If the importer is in node compatibility mode or this is not an ESM\n  // file that has been converted to a CommonJS file using a Babel-\n  // compatible transform (i.e. \"__esModule\" has not been set), then set\n  // \"default\" to the CommonJS \"module.exports\" for node compatibility.\n  isNodeMode || !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\n  mod\n));\n\nexport { __commonJS, __require, __toESM };\n//# sourceMappingURL=chunk-7D4SUZUM.js.map\n//# sourceMappingURL=chunk-7D4SUZUM.js.map","\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_error_exports = {};\n__export(token_error_exports, {\n  VercelOidcTokenError: () => VercelOidcTokenError\n});\nmodule.exports = __toCommonJS(token_error_exports);\nclass VercelOidcTokenError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"VercelOidcTokenError\";\n    this.cause = cause;\n  }\n  toString() {\n    if (this.cause) {\n      return `${this.name}: ${this.message}: ${this.cause}`;\n    }\n    return `${this.name}: ${this.message}`;\n  }\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  VercelOidcTokenError\n});\n"],"names":["__require","__require2","__defProp","__getOwnPropDesc","__getOwnPropNames","__hasOwnProp","__copyProps"],"mappings":"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"}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-CPLRD2VP.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider%402.0.0/node_modules/%40ai-sdk/provider/src/errors/ai-sdk-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider%402.0.0/node_modules/%40ai-sdk/provider/src/errors/api-call-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider%402.0.0/node_modules/%40ai-sdk/provider/src/errors/empty-response-body-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider%402.0.0/node_modules/%40ai-sdk/provider/src/errors/get-error-message.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider%402.0.0/node_modules/%40ai-sdk/provider/src/errors/invalid-argument-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider%402.0.0/node_modules/%40ai-sdk/provider/src/errors/json-parse-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider%402.0.0/node_modules/%40ai-sdk/provider/src/errors/type-validation-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/eventsource-parser%403.0.6/node_modules/eventsource-parser/src/errors.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/eventsource-parser%403.0.6/node_modules/eventsource-parser/src/parse.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/eventsource-parser%403.0.6/node_modules/eventsource-parser/src/stream.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/combine-headers.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/delay.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/extract-response-headers.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/generate-id.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/get-error-message.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/is-abort-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/handle-fetch-error.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/get-runtime-environment-user-agent.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/normalize-headers.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/with-user-agent-suffix.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/version.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/get-from-api.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/load-optional-setting.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/secure-json-parse.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/validator.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/validate-types.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/parse-json.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/parse-json-event-stream.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/post-to-api.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/types/tool.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/resolve.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/response-handler.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/get-relative-path.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/options.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/any.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/array.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/bigint.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/boolean.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/branded.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/catch.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/date.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/default.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/effects.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/enum.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/intersection.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/literal.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/string.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/record.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/map.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/native-enum.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/never.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/null.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/union.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/nullable.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/number.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/object.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/optional.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/pipeline.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/promise.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/set.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/tuple.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/undefined.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/unknown.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parsers/readonly.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/select-parser.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/parse-def.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/refs.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/zod-to-json-schema.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-to-json-schema/index.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/zod-schema.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/schema.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/uint8-utils.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40ai-sdk%2Bprovider-utils%403.0.17_zod%403.25.76/node_modules/%40ai-sdk/provider-utils/src/without-trailing-slash.ts"],"sourcesContent":["/**\n * Symbol used for identifying AI SDK Error instances.\n * Enables checking if an error is an instance of AISDKError across package versions.\n */\nconst marker = 'vercel.ai.error';\nconst symbol = Symbol.for(marker);\n\n/**\n * Custom error class for AI SDK related errors.\n * @extends Error\n */\nexport class AISDKError extends Error {\n  private readonly [symbol] = true; // used in isInstance\n\n  /**\n   * The underlying cause of the error, if any.\n   */\n  readonly cause?: unknown;\n\n  /**\n   * Creates an AI SDK Error.\n   *\n   * @param {Object} params - The parameters for creating the error.\n   * @param {string} params.name - The name of the error.\n   * @param {string} params.message - The error message.\n   * @param {unknown} [params.cause] - The underlying cause of the error.\n   */\n  constructor({\n    name,\n    message,\n    cause,\n  }: {\n    name: string;\n    message: string;\n    cause?: unknown;\n  }) {\n    super(message);\n\n    this.name = name;\n    this.cause = cause;\n  }\n\n  /**\n   * Checks if the given error is an AI SDK Error.\n   * @param {unknown} error - The error to check.\n   * @returns {boolean} True if the error is an AI SDK Error, false otherwise.\n   */\n  static isInstance(error: unknown): error is AISDKError {\n    return AISDKError.hasMarker(error, marker);\n  }\n\n  protected static hasMarker(error: unknown, marker: string): boolean {\n    const markerSymbol = Symbol.for(marker);\n    return (\n      error != null &&\n      typeof error === 'object' &&\n      markerSymbol in error &&\n      typeof error[markerSymbol] === 'boolean' &&\n      error[markerSymbol] === true\n    );\n  }\n}\n","import { AISDKError } from './ai-sdk-error';\n\nconst name = 'AI_APICallError';\nconst marker = `vercel.ai.error.${name}`;\nconst symbol = Symbol.for(marker);\n\nexport class APICallError extends AISDKError {\n  private readonly [symbol] = true; // used in isInstance\n\n  readonly url: string;\n  readonly requestBodyValues: unknown;\n  readonly statusCode?: number;\n\n  readonly responseHeaders?: Record<string, string>;\n  readonly responseBody?: string;\n\n  readonly isRetryable: boolean;\n  readonly data?: unknown;\n\n  constructor({\n    message,\n    url,\n    requestBodyValues,\n    statusCode,\n    responseHeaders,\n    responseBody,\n    cause,\n    isRetryable = statusCode != null &&\n      (statusCode === 408 || // request timeout\n        statusCode === 409 || // conflict\n        statusCode === 429 || // too many requests\n        statusCode >= 500), // server error\n    data,\n  }: {\n    message: string;\n    url: string;\n    requestBodyValues: unknown;\n    statusCode?: number;\n    responseHeaders?: Record<string, string>;\n    responseBody?: string;\n    cause?: unknown;\n    isRetryable?: boolean;\n    data?: unknown;\n  }) {\n    super({ name, message, cause });\n\n    this.url = url;\n    this.requestBodyValues = requestBodyValues;\n    this.statusCode = statusCode;\n    this.responseHeaders = responseHeaders;\n    this.responseBody = responseBody;\n    this.isRetryable = isRetryable;\n    this.data = data;\n  }\n\n  static isInstance(error: unknown): error is APICallError {\n    return AISDKError.hasMarker(error, marker);\n  }\n}\n","import { AISDKError } from './ai-sdk-error';\n\nconst name = 'AI_EmptyResponseBodyError';\nconst marker = `vercel.ai.error.${name}`;\nconst symbol = Symbol.for(marker);\n\nexport class EmptyResponseBodyError extends AISDKError {\n  private readonly [symbol] = true; // used in isInstance\n\n  constructor({ message = 'Empty response body' }: { message?: string } = {}) {\n    super({ name, message });\n  }\n\n  static isInstance(error: unknown): error is EmptyResponseBodyError {\n    return AISDKError.hasMarker(error, marker);\n  }\n}\n","export function getErrorMessage(error: unknown | undefined) {\n  if (error == null) {\n    return 'unknown error';\n  }\n\n  if (typeof error === 'string') {\n    return error;\n  }\n\n  if (error instanceof Error) {\n    return error.message;\n  }\n\n  return JSON.stringify(error);\n}\n","import { AISDKError } from './ai-sdk-error';\n\nconst name = 'AI_InvalidArgumentError';\nconst marker = `vercel.ai.error.${name}`;\nconst symbol = Symbol.for(marker);\n\n/**\n * A function argument is invalid.\n */\nexport class InvalidArgumentError extends AISDKError {\n  private readonly [symbol] = true; // used in isInstance\n\n  readonly argument: string;\n\n  constructor({\n    message,\n    cause,\n    argument,\n  }: {\n    argument: string;\n    message: string;\n    cause?: unknown;\n  }) {\n    super({ name, message, cause });\n\n    this.argument = argument;\n  }\n\n  static isInstance(error: unknown): error is InvalidArgumentError {\n    return AISDKError.hasMarker(error, marker);\n  }\n}\n","import { AISDKError } from './ai-sdk-error';\nimport { getErrorMessage } from './get-error-message';\n\nconst name = 'AI_JSONParseError';\nconst marker = `vercel.ai.error.${name}`;\nconst symbol = Symbol.for(marker);\n\n// TODO v5: rename to ParseError\nexport class JSONParseError extends AISDKError {\n  private readonly [symbol] = true; // used in isInstance\n\n  readonly text: string;\n\n  constructor({ text, cause }: { text: string; cause: unknown }) {\n    super({\n      name,\n      message:\n        `JSON parsing failed: ` +\n        `Text: ${text}.\\n` +\n        `Error message: ${getErrorMessage(cause)}`,\n      cause,\n    });\n\n    this.text = text;\n  }\n\n  static isInstance(error: unknown): error is JSONParseError {\n    return AISDKError.hasMarker(error, marker);\n  }\n}\n","import { AISDKError } from './ai-sdk-error';\nimport { getErrorMessage } from './get-error-message';\n\nconst name = 'AI_TypeValidationError';\nconst marker = `vercel.ai.error.${name}`;\nconst symbol = Symbol.for(marker);\n\nexport class TypeValidationError extends AISDKError {\n  private readonly [symbol] = true; // used in isInstance\n\n  readonly value: unknown;\n\n  constructor({ value, cause }: { value: unknown; cause: unknown }) {\n    super({\n      name,\n      message:\n        `Type validation failed: ` +\n        `Value: ${JSON.stringify(value)}.\\n` +\n        `Error message: ${getErrorMessage(cause)}`,\n      cause,\n    });\n\n    this.value = value;\n  }\n\n  static isInstance(error: unknown): error is TypeValidationError {\n    return AISDKError.hasMarker(error, marker);\n  }\n\n  /**\n   * Wraps an error into a TypeValidationError.\n   * If the cause is already a TypeValidationError with the same value, it returns the cause.\n   * Otherwise, it creates a new TypeValidationError.\n   *\n   * @param {Object} params - The parameters for wrapping the error.\n   * @param {unknown} params.value - The value that failed validation.\n   * @param {unknown} params.cause - The original error or cause of the validation failure.\n   * @returns {TypeValidationError} A TypeValidationError instance.\n   */\n  static wrap({\n    value,\n    cause,\n  }: {\n    value: unknown;\n    cause: unknown;\n  }): TypeValidationError {\n    return TypeValidationError.isInstance(cause) && cause.value === value\n      ? cause\n      : new TypeValidationError({ value, cause });\n  }\n}\n","/**\n * The type of error that occurred.\n * @public\n */\nexport type ErrorType = 'invalid-retry' | 'unknown-field'\n\n/**\n * Error thrown when encountering an issue during parsing.\n *\n * @public\n */\nexport class ParseError extends Error {\n  /**\n   * The type of error that occurred.\n   */\n  type: ErrorType\n\n  /**\n   * In the case of an unknown field encountered in the stream, this will be the field name.\n   */\n  field?: string | undefined\n\n  /**\n   * In the case of an unknown field encountered in the stream, this will be the value of the field.\n   */\n  value?: string | undefined\n\n  /**\n   * The line that caused the error, if available.\n   */\n  line?: string | undefined\n\n  constructor(\n    message: string,\n    options: {type: ErrorType; field?: string; value?: string; line?: string},\n  ) {\n    super(message)\n    this.name = 'ParseError'\n    this.type = options.type\n    this.field = options.field\n    this.value = options.value\n    this.line = options.line\n  }\n}\n","/**\n * EventSource/Server-Sent Events parser\n * @see https://html.spec.whatwg.org/multipage/server-sent-events.html\n */\nimport {ParseError} from './errors.ts'\nimport type {EventSourceParser, ParserCallbacks} from './types.ts'\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction noop(_arg: unknown) {\n  // intentional noop\n}\n\n/**\n * Creates a new EventSource parser.\n *\n * @param callbacks - Callbacks to invoke on different parsing events:\n *   - `onEvent` when a new event is parsed\n *   - `onError` when an error occurs\n *   - `onRetry` when a new reconnection interval has been sent from the server\n *   - `onComment` when a comment is encountered in the stream\n *\n * @returns A new EventSource parser, with `parse` and `reset` methods.\n * @public\n */\nexport function createParser(callbacks: ParserCallbacks): EventSourceParser {\n  if (typeof callbacks === 'function') {\n    throw new TypeError(\n      '`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?',\n    )\n  }\n\n  const {onEvent = noop, onError = noop, onRetry = noop, onComment} = callbacks\n\n  let incompleteLine = ''\n\n  let isFirstChunk = true\n  let id: string | undefined\n  let data = ''\n  let eventType = ''\n\n  function feed(newChunk: string) {\n    // Strip any UTF8 byte order mark (BOM) at the start of the stream\n    const chunk = isFirstChunk ? newChunk.replace(/^\\xEF\\xBB\\xBF/, '') : newChunk\n\n    // If there was a previous incomplete line, append it to the new chunk,\n    // so we may process it together as a new (hopefully complete) chunk.\n    const [complete, incomplete] = splitLines(`${incompleteLine}${chunk}`)\n\n    for (const line of complete) {\n      parseLine(line)\n    }\n\n    incompleteLine = incomplete\n    isFirstChunk = false\n  }\n\n  function parseLine(line: string) {\n    // If the line is empty (a blank line), dispatch the event\n    if (line === '') {\n      dispatchEvent()\n      return\n    }\n\n    // If the line starts with a U+003A COLON character (:), ignore the line.\n    if (line.startsWith(':')) {\n      if (onComment) {\n        onComment(line.slice(line.startsWith(': ') ? 2 : 1))\n      }\n      return\n    }\n\n    // If the line contains a U+003A COLON character (:)\n    const fieldSeparatorIndex = line.indexOf(':')\n    if (fieldSeparatorIndex !== -1) {\n      // Collect the characters on the line before the first U+003A COLON character (:),\n      // and let `field` be that string.\n      const field = line.slice(0, fieldSeparatorIndex)\n\n      // Collect the characters on the line after the first U+003A COLON character (:),\n      // and let `value` be that string. If value starts with a U+0020 SPACE character,\n      // remove it from value.\n      const offset = line[fieldSeparatorIndex + 1] === ' ' ? 2 : 1\n      const value = line.slice(fieldSeparatorIndex + offset)\n\n      processField(field, value, line)\n      return\n    }\n\n    // Otherwise, the string is not empty but does not contain a U+003A COLON character (:)\n    // Process the field using the whole line as the field name, and an empty string as the field value.\n    // ðŸ‘† This is according to spec. That means that a line that has the value `data` will result in\n    // a newline being added to the current `data` buffer, for instance.\n    processField(line, '', line)\n  }\n\n  function processField(field: string, value: string, line: string) {\n    // Field names must be compared literally, with no case folding performed.\n    switch (field) {\n      case 'event':\n        // Set the `event type` buffer to field value\n        eventType = value\n        break\n      case 'data':\n        // Append the field value to the `data` buffer, then append a single U+000A LINE FEED(LF)\n        // character to the `data` buffer.\n        data = `${data}${value}\\n`\n        break\n      case 'id':\n        // If the field value does not contain U+0000 NULL, then set the `ID` buffer to\n        // the field value. Otherwise, ignore the field.\n        id = value.includes('\\0') ? undefined : value\n        break\n      case 'retry':\n        // If the field value consists of only ASCII digits, then interpret the field value as an\n        // integer in base ten, and set the event stream's reconnection time to that integer.\n        // Otherwise, ignore the field.\n        if (/^\\d+$/.test(value)) {\n          onRetry(parseInt(value, 10))\n        } else {\n          onError(\n            new ParseError(`Invalid \\`retry\\` value: \"${value}\"`, {\n              type: 'invalid-retry',\n              value,\n              line,\n            }),\n          )\n        }\n        break\n      default:\n        // Otherwise, the field is ignored.\n        onError(\n          new ParseError(\n            `Unknown field \"${field.length > 20 ? `${field.slice(0, 20)}â€¦` : field}\"`,\n            {type: 'unknown-field', field, value, line},\n          ),\n        )\n        break\n    }\n  }\n\n  function dispatchEvent() {\n    const shouldDispatch = data.length > 0\n    if (shouldDispatch) {\n      onEvent({\n        id,\n        event: eventType || undefined,\n        // If the data buffer's last character is a U+000A LINE FEED (LF) character,\n        // then remove the last character from the data buffer.\n        data: data.endsWith('\\n') ? data.slice(0, -1) : data,\n      })\n    }\n\n    // Reset for the next event\n    id = undefined\n    data = ''\n    eventType = ''\n  }\n\n  function reset(options: {consume?: boolean} = {}) {\n    if (incompleteLine && options.consume) {\n      parseLine(incompleteLine)\n    }\n\n    isFirstChunk = true\n    id = undefined\n    data = ''\n    eventType = ''\n    incompleteLine = ''\n  }\n\n  return {feed, reset}\n}\n\n/**\n * For the given `chunk`, split it into lines according to spec, and return any remaining incomplete line.\n *\n * @param chunk - The chunk to split into lines\n * @returns A tuple containing an array of complete lines, and any remaining incomplete line\n * @internal\n */\nfunction splitLines(chunk: string): [complete: Array<string>, incomplete: string] {\n  /**\n   * According to the spec, a line is terminated by either:\n   * - U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pair\n   * - a single U+000A LINE FEED(LF) character not preceded by a U+000D CARRIAGE RETURN(CR) character\n   * - a single U+000D CARRIAGE RETURN(CR) character not followed by a U+000A LINE FEED(LF) character\n   */\n  const lines: Array<string> = []\n  let incompleteLine = ''\n  let searchIndex = 0\n\n  while (searchIndex < chunk.length) {\n    // Find next line terminator\n    const crIndex = chunk.indexOf('\\r', searchIndex)\n    const lfIndex = chunk.indexOf('\\n', searchIndex)\n\n    // Determine line end\n    let lineEnd = -1\n    if (crIndex !== -1 && lfIndex !== -1) {\n      // CRLF case\n      lineEnd = Math.min(crIndex, lfIndex)\n    } else if (crIndex !== -1) {\n      // CR at the end of a chunk might be part of a CRLF sequence that spans chunks,\n      // so we shouldn't treat it as a line terminator (yet)\n      if (crIndex === chunk.length - 1) {\n        lineEnd = -1\n      } else {\n        lineEnd = crIndex\n      }\n    } else if (lfIndex !== -1) {\n      lineEnd = lfIndex\n    }\n\n    // Extract line if terminator found\n    if (lineEnd === -1) {\n      // No terminator found, rest is incomplete\n      incompleteLine = chunk.slice(searchIndex)\n      break\n    } else {\n      const line = chunk.slice(searchIndex, lineEnd)\n      lines.push(line)\n\n      // Move past line terminator\n      searchIndex = lineEnd + 1\n      if (chunk[searchIndex - 1] === '\\r' && chunk[searchIndex] === '\\n') {\n        searchIndex++\n      }\n    }\n  }\n\n  return [lines, incompleteLine]\n}\n","import {createParser} from './parse.ts'\nimport type {EventSourceMessage, EventSourceParser} from './types.ts'\n\n/**\n * Options for the EventSourceParserStream.\n *\n * @public\n */\nexport interface StreamOptions {\n  /**\n   * Behavior when a parsing error occurs.\n   *\n   * - A custom function can be provided to handle the error.\n   * - `'terminate'` will error the stream and stop parsing.\n   * - Any other value will ignore the error and continue parsing.\n   *\n   * @defaultValue `undefined`\n   */\n  onError?: ('terminate' | ((error: Error) => void)) | undefined\n\n  /**\n   * Callback for when a reconnection interval is sent from the server.\n   *\n   * @param retry - The number of milliseconds to wait before reconnecting.\n   */\n  onRetry?: ((retry: number) => void) | undefined\n\n  /**\n   * Callback for when a comment is encountered in the stream.\n   *\n   * @param comment - The comment encountered in the stream.\n   */\n  onComment?: ((comment: string) => void) | undefined\n}\n\n/**\n * A TransformStream that ingests a stream of strings and produces a stream of `EventSourceMessage`.\n *\n * @example Basic usage\n * ```\n * const eventStream =\n *   response.body\n *     .pipeThrough(new TextDecoderStream())\n *     .pipeThrough(new EventSourceParserStream())\n * ```\n *\n * @example Terminate stream on parsing errors\n * ```\n * const eventStream =\n *  response.body\n *   .pipeThrough(new TextDecoderStream())\n *   .pipeThrough(new EventSourceParserStream({terminateOnError: true}))\n * ```\n *\n * @public\n */\nexport class EventSourceParserStream extends TransformStream<string, EventSourceMessage> {\n  constructor({onError, onRetry, onComment}: StreamOptions = {}) {\n    let parser!: EventSourceParser\n\n    super({\n      start(controller) {\n        parser = createParser({\n          onEvent: (event) => {\n            controller.enqueue(event)\n          },\n          onError(error) {\n            if (onError === 'terminate') {\n              controller.error(error)\n            } else if (typeof onError === 'function') {\n              onError(error)\n            }\n\n            // Ignore by default\n          },\n          onRetry,\n          onComment,\n        })\n      },\n      transform(chunk) {\n        parser.feed(chunk)\n      },\n    })\n  }\n}\n\nexport {type ErrorType, ParseError} from './errors.ts'\nexport type {EventSourceMessage} from './types.ts'\n","export function combineHeaders(\n  ...headers: Array<Record<string, string | undefined> | undefined>\n): Record<string, string | undefined> {\n  return headers.reduce(\n    (combinedHeaders, currentHeaders) => ({\n      ...combinedHeaders,\n      ...(currentHeaders ?? {}),\n    }),\n    {},\n  ) as Record<string, string | undefined>;\n}\n","/**\n * Creates a Promise that resolves after a specified delay\n * @param delayInMs - The delay duration in milliseconds. If null or undefined, resolves immediately.\n * @param signal - Optional AbortSignal to cancel the delay\n * @returns A Promise that resolves after the specified delay\n * @throws {DOMException} When the signal is aborted\n */\nexport async function delay(\n  delayInMs?: number | null,\n  options?: {\n    abortSignal?: AbortSignal;\n  },\n): Promise<void> {\n  if (delayInMs == null) {\n    return Promise.resolve();\n  }\n\n  const signal = options?.abortSignal;\n\n  return new Promise<void>((resolve, reject) => {\n    if (signal?.aborted) {\n      reject(createAbortError());\n      return;\n    }\n\n    const timeoutId = setTimeout(() => {\n      cleanup();\n      resolve();\n    }, delayInMs);\n\n    const cleanup = () => {\n      clearTimeout(timeoutId);\n      signal?.removeEventListener('abort', onAbort);\n    };\n\n    const onAbort = () => {\n      cleanup();\n      reject(createAbortError());\n    };\n\n    signal?.addEventListener('abort', onAbort);\n  });\n}\n\nfunction createAbortError(): DOMException {\n  return new DOMException('Delay was aborted', 'AbortError');\n}\n","/**\nExtracts the headers from a response object and returns them as a key-value object.\n\n@param response - The response object to extract headers from.\n@returns The headers as a key-value object.\n*/\nexport function extractResponseHeaders(response: Response) {\n  return Object.fromEntries<string>([...response.headers]);\n}\n","import { InvalidArgumentError } from '@ai-sdk/provider';\n\n/**\nCreates an ID generator.\nThe total length of the ID is the sum of the prefix, separator, and random part length.\nNot cryptographically secure.\n\n@param alphabet - The alphabet to use for the ID. Default: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.\n@param prefix - The prefix of the ID to generate. Optional.\n@param separator - The separator between the prefix and the random part of the ID. Default: '-'.\n@param size - The size of the random part of the ID to generate. Default: 16.\n */\nexport const createIdGenerator = ({\n  prefix,\n  size = 16,\n  alphabet = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',\n  separator = '-',\n}: {\n  prefix?: string;\n  separator?: string;\n  size?: number;\n  alphabet?: string;\n} = {}): IdGenerator => {\n  const generator = () => {\n    const alphabetLength = alphabet.length;\n    const chars = new Array(size);\n    for (let i = 0; i < size; i++) {\n      chars[i] = alphabet[(Math.random() * alphabetLength) | 0];\n    }\n    return chars.join('');\n  };\n\n  if (prefix == null) {\n    return generator;\n  }\n\n  // check that the prefix is not part of the alphabet (otherwise prefix checking can fail randomly)\n  if (alphabet.includes(separator)) {\n    throw new InvalidArgumentError({\n      argument: 'separator',\n      message: `The separator \"${separator}\" must not be part of the alphabet \"${alphabet}\".`,\n    });\n  }\n\n  return () => `${prefix}${separator}${generator()}`;\n};\n\n/**\nA function that generates an ID.\n */\nexport type IdGenerator = () => string;\n\n/**\nGenerates a 16-character random string to use for IDs.\nNot cryptographically secure.\n */\nexport const generateId = createIdGenerator();\n","export function getErrorMessage(error: unknown | undefined) {\n  if (error == null) {\n    return 'unknown error';\n  }\n\n  if (typeof error === 'string') {\n    return error;\n  }\n\n  if (error instanceof Error) {\n    return error.message;\n  }\n\n  return JSON.stringify(error);\n}\n","export function isAbortError(error: unknown): error is Error {\n  return (\n    (error instanceof Error || error instanceof DOMException) &&\n    (error.name === 'AbortError' ||\n      error.name === 'ResponseAborted' || // Next.js\n      error.name === 'TimeoutError')\n  );\n}\n","import { APICallError } from '@ai-sdk/provider';\nimport { isAbortError } from './is-abort-error';\n\nconst FETCH_FAILED_ERROR_MESSAGES = ['fetch failed', 'failed to fetch'];\n\nexport function handleFetchError({\n  error,\n  url,\n  requestBodyValues,\n}: {\n  error: unknown;\n  url: string;\n  requestBodyValues: unknown;\n}) {\n  if (isAbortError(error)) {\n    return error;\n  }\n\n  // unwrap original error when fetch failed (for easier debugging):\n  if (\n    error instanceof TypeError &&\n    FETCH_FAILED_ERROR_MESSAGES.includes(error.message.toLowerCase())\n  ) {\n    const cause = (error as any).cause;\n\n    if (cause != null) {\n      // Failed to connect to server:\n      return new APICallError({\n        message: `Cannot connect to API: ${cause.message}`,\n        cause,\n        url,\n        requestBodyValues,\n        isRetryable: true, // retry when network error\n      });\n    }\n  }\n\n  return error;\n}\n","export function getRuntimeEnvironmentUserAgent(\n  globalThisAny: any = globalThis as any,\n): string {\n  // Browsers\n  if (globalThisAny.window) {\n    return `runtime/browser`;\n  }\n\n  // Cloudflare Workers / Deno / Bun / Node.js >= 21.1\n  if (globalThisAny.navigator?.userAgent) {\n    return `runtime/${globalThisAny.navigator.userAgent.toLowerCase()}`;\n  }\n\n  // Nodes.js < 21.1\n  if (globalThisAny.process?.versions?.node) {\n    return `runtime/node.js/${globalThisAny.process.version.substring(0)}`;\n  }\n\n  if (globalThisAny.EdgeRuntime) {\n    return `runtime/vercel-edge`;\n  }\n\n  return 'runtime/unknown';\n}\n","/**\n * Normalizes different header inputs into a plain record with lower-case keys.\n * Entries with `undefined` or `null` values are removed.\n *\n * @param headers - Input headers (`Headers`, tuples array, plain record) to normalize.\n * @returns A record containing the normalized header entries.\n */\nexport function normalizeHeaders(\n  headers:\n    | HeadersInit\n    | Record<string, string | undefined>\n    | Array<[string, string | undefined]>\n    | undefined,\n): Record<string, string> {\n  if (headers == null) {\n    return {};\n  }\n\n  const normalized: Record<string, string> = {};\n\n  if (headers instanceof Headers) {\n    headers.forEach((value, key) => {\n      normalized[key.toLowerCase()] = value;\n    });\n  } else {\n    if (!Array.isArray(headers)) {\n      headers = Object.entries(headers);\n    }\n\n    for (const [key, value] of headers) {\n      if (value != null) {\n        normalized[key.toLowerCase()] = value;\n      }\n    }\n  }\n\n  return normalized;\n}\n","import { normalizeHeaders } from './normalize-headers';\n\n/**\n * Appends suffix parts to the `user-agent` header.\n * If a `user-agent` header already exists, the suffix parts are appended to it.\n * If no `user-agent` header exists, a new one is created with the suffix parts.\n * Automatically removes undefined entries from the headers.\n *\n * @param headers - The original headers.\n * @param userAgentSuffixParts - The parts to append to the `user-agent` header.\n * @returns The new headers with the `user-agent` header set or updated.\n */\nexport function withUserAgentSuffix(\n  headers: HeadersInit | Record<string, string | undefined> | undefined,\n  ...userAgentSuffixParts: string[]\n): Record<string, string> {\n  const normalizedHeaders = new Headers(normalizeHeaders(headers));\n\n  const currentUserAgentHeader = normalizedHeaders.get('user-agent') || '';\n\n  normalizedHeaders.set(\n    'user-agent',\n    [currentUserAgentHeader, ...userAgentSuffixParts].filter(Boolean).join(' '),\n  );\n\n  return Object.fromEntries(normalizedHeaders.entries());\n}\n","// Version string of this package injected at build time.\ndeclare const __PACKAGE_VERSION__: string | undefined;\nexport const VERSION: string =\n  typeof __PACKAGE_VERSION__ !== 'undefined'\n    ? __PACKAGE_VERSION__\n    : '0.0.0-test';\n","import { APICallError } from '@ai-sdk/provider';\nimport { extractResponseHeaders } from './extract-response-headers';\nimport { FetchFunction } from './fetch-function';\nimport { handleFetchError } from './handle-fetch-error';\nimport { isAbortError } from './is-abort-error';\nimport { ResponseHandler } from './response-handler';\nimport { getRuntimeEnvironmentUserAgent } from './get-runtime-environment-user-agent';\nimport { withUserAgentSuffix } from './with-user-agent-suffix';\nimport { VERSION } from './version';\n\n// use function to allow for mocking in tests:\nconst getOriginalFetch = () => globalThis.fetch;\n\nexport const getFromApi = async <T>({\n  url,\n  headers = {},\n  successfulResponseHandler,\n  failedResponseHandler,\n  abortSignal,\n  fetch = getOriginalFetch(),\n}: {\n  url: string;\n  headers?: Record<string, string | undefined>;\n  failedResponseHandler: ResponseHandler<Error>;\n  successfulResponseHandler: ResponseHandler<T>;\n  abortSignal?: AbortSignal;\n  fetch?: FetchFunction;\n}) => {\n  try {\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: withUserAgentSuffix(\n        headers,\n        `ai-sdk/provider-utils/${VERSION}`,\n        getRuntimeEnvironmentUserAgent(),\n      ),\n      signal: abortSignal,\n    });\n\n    const responseHeaders = extractResponseHeaders(response);\n\n    if (!response.ok) {\n      let errorInformation: {\n        value: Error;\n        responseHeaders?: Record<string, string> | undefined;\n      };\n\n      try {\n        errorInformation = await failedResponseHandler({\n          response,\n          url,\n          requestBodyValues: {},\n        });\n      } catch (error) {\n        if (isAbortError(error) || APICallError.isInstance(error)) {\n          throw error;\n        }\n\n        throw new APICallError({\n          message: 'Failed to process error response',\n          cause: error,\n          statusCode: response.status,\n          url,\n          responseHeaders,\n          requestBodyValues: {},\n        });\n      }\n\n      throw errorInformation.value;\n    }\n\n    try {\n      return await successfulResponseHandler({\n        response,\n        url,\n        requestBodyValues: {},\n      });\n    } catch (error) {\n      if (error instanceof Error) {\n        if (isAbortError(error) || APICallError.isInstance(error)) {\n          throw error;\n        }\n      }\n\n      throw new APICallError({\n        message: 'Failed to process successful response',\n        cause: error,\n        statusCode: response.status,\n        url,\n        responseHeaders,\n        requestBodyValues: {},\n      });\n    }\n  } catch (error) {\n    throw handleFetchError({ error, url, requestBodyValues: {} });\n  }\n};\n","/**\n * Loads an optional `string` setting from the environment or a parameter.\n *\n * @param settingValue - The setting value.\n * @param environmentVariableName - The environment variable name.\n * @returns The setting value.\n */\nexport function loadOptionalSetting({\n  settingValue,\n  environmentVariableName,\n}: {\n  settingValue: string | undefined;\n  environmentVariableName: string;\n}): string | undefined {\n  if (typeof settingValue === 'string') {\n    return settingValue;\n  }\n\n  if (settingValue != null || typeof process === 'undefined') {\n    return undefined;\n  }\n\n  settingValue = process.env[environmentVariableName];\n\n  if (settingValue == null || typeof settingValue !== 'string') {\n    return undefined;\n  }\n\n  return settingValue;\n}\n","// Licensed under BSD-3-Clause (this file only)\n// Code adapted from https://github.com/fastify/secure-json-parse/blob/783fcb1b5434709466759847cec974381939673a/index.js\n//\n// Copyright (c) Vercel, Inc. (https://vercel.com)\n// Copyright (c) 2019 The Fastify Team\n// Copyright (c) 2019, Sideway Inc, and project contributors\n// All rights reserved.\n//\n// The complete list of contributors can be found at:\n// - https://github.com/hapijs/bourne/graphs/contributors\n// - https://github.com/fastify/secure-json-parse/graphs/contributors\n// - https://github.com/vercel/ai/commits/main/packages/provider-utils/src/secure-parse-json.ts\n//\n// Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n//\n// 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n//\n// 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n//\n// 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nconst suspectProtoRx = /\"__proto__\"\\s*:/;\nconst suspectConstructorRx = /\"constructor\"\\s*:/;\n\nfunction _parse(text: string) {\n  // Parse normally\n  const obj = JSON.parse(text);\n\n  // Ignore null and non-objects\n  if (obj === null || typeof obj !== 'object') {\n    return obj;\n  }\n\n  if (\n    suspectProtoRx.test(text) === false &&\n    suspectConstructorRx.test(text) === false\n  ) {\n    return obj;\n  }\n\n  // Scan result for proto keys\n  return filter(obj);\n}\n\nfunction filter(obj: any) {\n  let next = [obj];\n\n  while (next.length) {\n    const nodes = next;\n    next = [];\n\n    for (const node of nodes) {\n      if (Object.prototype.hasOwnProperty.call(node, '__proto__')) {\n        throw new SyntaxError('Object contains forbidden prototype property');\n      }\n\n      if (\n        Object.prototype.hasOwnProperty.call(node, 'constructor') &&\n        Object.prototype.hasOwnProperty.call(node.constructor, 'prototype')\n      ) {\n        throw new SyntaxError('Object contains forbidden prototype property');\n      }\n\n      for (const key in node) {\n        const value = node[key];\n        if (value && typeof value === 'object') {\n          next.push(value);\n        }\n      }\n    }\n  }\n  return obj;\n}\n\nexport function secureJsonParse(text: string) {\n  const { stackTraceLimit } = Error;\n  try {\n    // Performance optimization, see https://github.com/fastify/secure-json-parse/pull/90\n    Error.stackTraceLimit = 0;\n  } catch (e) {\n    // Fallback in case Error is immutable (v8 readonly)\n    return _parse(text);\n  }\n\n  try {\n    return _parse(text);\n  } finally {\n    Error.stackTraceLimit = stackTraceLimit;\n  }\n}\n","import { TypeValidationError } from '@ai-sdk/provider';\nimport { StandardSchemaV1 } from '@standard-schema/spec';\n\n/**\n * Used to mark validator functions so we can support both Zod and custom schemas.\n */\nexport const validatorSymbol = Symbol.for('vercel.ai.validator');\n\nexport type ValidationResult<OBJECT> =\n  | { success: true; value: OBJECT }\n  | { success: false; error: Error };\n\nexport type Validator<OBJECT = unknown> = {\n  /**\n   * Used to mark validator functions so we can support both Zod and custom schemas.\n   */\n  [validatorSymbol]: true;\n\n  /**\n   * Optional. Validates that the structure of a value matches this schema,\n   * and returns a typed version of the value if it does.\n   */\n  readonly validate?: (\n    value: unknown,\n  ) => ValidationResult<OBJECT> | PromiseLike<ValidationResult<OBJECT>>;\n};\n\n/**\n * Create a validator.\n *\n * @param validate A validation function for the schema.\n */\nexport function validator<OBJECT>(\n  validate?:\n    | undefined\n    | ((\n        value: unknown,\n      ) => ValidationResult<OBJECT> | PromiseLike<ValidationResult<OBJECT>>),\n): Validator<OBJECT> {\n  return { [validatorSymbol]: true, validate };\n}\n\nexport function isValidator(value: unknown): value is Validator {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    validatorSymbol in value &&\n    value[validatorSymbol] === true &&\n    'validate' in value\n  );\n}\n\n/**\n * Creates a validator with deferred creation.\n * This is important to reduce the startup time of the library\n * and to avoid initializing unused validators.\n *\n * @param createValidator A function that creates a validator.\n * @returns A function that returns a validator.\n */\nexport function lazyValidator<OBJECT>(\n  createValidator: () => Validator<OBJECT>,\n): LazyValidator<OBJECT> {\n  // cache the validator to avoid initializing it multiple times\n  let validator: Validator<OBJECT> | undefined;\n  return () => {\n    if (validator == null) {\n      validator = createValidator();\n    }\n    return validator;\n  };\n}\n\nexport type LazyValidator<OBJECT> = () => Validator<OBJECT>;\n\nexport type FlexibleValidator<OBJECT> =\n  | Validator<OBJECT>\n  | LazyValidator<OBJECT>\n  | StandardSchemaV1<unknown, OBJECT>;\n\nexport type InferValidator<SCHEMA> =\n  SCHEMA extends StandardSchemaV1<unknown, infer T>\n    ? T\n    : SCHEMA extends LazyValidator<infer T>\n      ? T\n      : SCHEMA extends Validator<infer T>\n        ? T\n        : never;\n\nexport function asValidator<OBJECT>(\n  value: FlexibleValidator<OBJECT>,\n): Validator<OBJECT> {\n  return isValidator(value)\n    ? value\n    : typeof value === 'function'\n      ? value()\n      : standardSchemaValidator(value);\n}\n\nexport function standardSchemaValidator<OBJECT>(\n  standardSchema: StandardSchemaV1<unknown, OBJECT>,\n): Validator<OBJECT> {\n  return validator(async value => {\n    const result = await standardSchema['~standard'].validate(value);\n\n    return result.issues == null\n      ? { success: true, value: result.value }\n      : {\n          success: false,\n          error: new TypeValidationError({\n            value,\n            cause: result.issues,\n          }),\n        };\n  });\n}\n","import { TypeValidationError } from '@ai-sdk/provider';\nimport { FlexibleValidator, asValidator } from './validator';\n\n/**\n * Validates the types of an unknown object using a schema and\n * return a strongly-typed object.\n *\n * @template T - The type of the object to validate.\n * @param {string} options.value - The object to validate.\n * @param {Validator<T>} options.schema - The schema to use for validating the JSON.\n * @returns {Promise<T>} - The typed object.\n */\nexport async function validateTypes<OBJECT>({\n  value,\n  schema,\n}: {\n  value: unknown;\n  schema: FlexibleValidator<OBJECT>;\n}): Promise<OBJECT> {\n  const result = await safeValidateTypes({ value, schema });\n\n  if (!result.success) {\n    throw TypeValidationError.wrap({ value, cause: result.error });\n  }\n\n  return result.value;\n}\n\n/**\n * Safely validates the types of an unknown object using a schema and\n * return a strongly-typed object.\n *\n * @template T - The type of the object to validate.\n * @param {string} options.value - The JSON object to validate.\n * @param {Validator<T>} options.schema - The schema to use for validating the JSON.\n * @returns An object with either a `success` flag and the parsed and typed data, or a `success` flag and an error object.\n */\nexport async function safeValidateTypes<OBJECT>({\n  value,\n  schema,\n}: {\n  value: unknown;\n  schema: FlexibleValidator<OBJECT>;\n}): Promise<\n  | {\n      success: true;\n      value: OBJECT;\n      rawValue: unknown;\n    }\n  | {\n      success: false;\n      error: TypeValidationError;\n      rawValue: unknown;\n    }\n> {\n  const validator = asValidator(schema);\n\n  try {\n    if (validator.validate == null) {\n      return { success: true, value: value as OBJECT, rawValue: value };\n    }\n\n    const result = await validator.validate(value);\n\n    if (result.success) {\n      return { success: true, value: result.value, rawValue: value };\n    }\n\n    return {\n      success: false,\n      error: TypeValidationError.wrap({ value, cause: result.error }),\n      rawValue: value,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: TypeValidationError.wrap({ value, cause: error }),\n      rawValue: value,\n    };\n  }\n}\n","import {\n  JSONParseError,\n  JSONValue,\n  TypeValidationError,\n} from '@ai-sdk/provider';\nimport { secureJsonParse } from './secure-json-parse';\nimport { safeValidateTypes, validateTypes } from './validate-types';\nimport { FlexibleValidator, Validator } from './validator';\n\n/**\n * Parses a JSON string into an unknown object.\n *\n * @param text - The JSON string to parse.\n * @returns {JSONValue} - The parsed JSON object.\n */\nexport async function parseJSON(options: {\n  text: string;\n  schema?: undefined;\n}): Promise<JSONValue>;\n/**\n * Parses a JSON string into a strongly-typed object using the provided schema.\n *\n * @template T - The type of the object to parse the JSON into.\n * @param {string} text - The JSON string to parse.\n * @param {Validator<T>} schema - The schema to use for parsing the JSON.\n * @returns {Promise<T>} - The parsed object.\n */\nexport async function parseJSON<T>(options: {\n  text: string;\n  schema: FlexibleValidator<T>;\n}): Promise<T>;\nexport async function parseJSON<T>({\n  text,\n  schema,\n}: {\n  text: string;\n  schema?: FlexibleValidator<T>;\n}): Promise<T> {\n  try {\n    const value = secureJsonParse(text);\n\n    if (schema == null) {\n      return value;\n    }\n\n    return validateTypes<T>({ value, schema });\n  } catch (error) {\n    if (\n      JSONParseError.isInstance(error) ||\n      TypeValidationError.isInstance(error)\n    ) {\n      throw error;\n    }\n\n    throw new JSONParseError({ text, cause: error });\n  }\n}\n\nexport type ParseResult<T> =\n  | { success: true; value: T; rawValue: unknown }\n  | {\n      success: false;\n      error: JSONParseError | TypeValidationError;\n      rawValue: unknown;\n    };\n\n/**\n * Safely parses a JSON string and returns the result as an object of type `unknown`.\n *\n * @param text - The JSON string to parse.\n * @returns {Promise<object>} Either an object with `success: true` and the parsed data, or an object with `success: false` and the error that occurred.\n */\nexport async function safeParseJSON(options: {\n  text: string;\n  schema?: undefined;\n}): Promise<ParseResult<JSONValue>>;\n/**\n * Safely parses a JSON string into a strongly-typed object, using a provided schema to validate the object.\n *\n * @template T - The type of the object to parse the JSON into.\n * @param {string} text - The JSON string to parse.\n * @param {Validator<T>} schema - The schema to use for parsing the JSON.\n * @returns An object with either a `success` flag and the parsed and typed data, or a `success` flag and an error object.\n */\nexport async function safeParseJSON<T>(options: {\n  text: string;\n  schema: FlexibleValidator<T>;\n}): Promise<ParseResult<T>>;\nexport async function safeParseJSON<T>({\n  text,\n  schema,\n}: {\n  text: string;\n  schema?: FlexibleValidator<T>;\n}): Promise<ParseResult<T>> {\n  try {\n    const value = secureJsonParse(text);\n\n    if (schema == null) {\n      return { success: true, value: value as T, rawValue: value };\n    }\n\n    return await safeValidateTypes<T>({ value, schema });\n  } catch (error) {\n    return {\n      success: false,\n      error: JSONParseError.isInstance(error)\n        ? error\n        : new JSONParseError({ text, cause: error }),\n      rawValue: undefined,\n    };\n  }\n}\n\nexport function isParsableJson(input: string): boolean {\n  try {\n    secureJsonParse(input);\n    return true;\n  } catch {\n    return false;\n  }\n}\n","import {\n  EventSourceMessage,\n  EventSourceParserStream,\n} from 'eventsource-parser/stream';\nimport { ParseResult, safeParseJSON } from './parse-json';\nimport { FlexibleValidator } from './validator';\n\n/**\n * Parses a JSON event stream into a stream of parsed JSON objects.\n */\nexport function parseJsonEventStream<T>({\n  stream,\n  schema,\n}: {\n  stream: ReadableStream<Uint8Array>;\n  schema: FlexibleValidator<T>;\n}): ReadableStream<ParseResult<T>> {\n  return stream\n    .pipeThrough(new TextDecoderStream())\n    .pipeThrough(new EventSourceParserStream())\n    .pipeThrough(\n      new TransformStream<EventSourceMessage, ParseResult<T>>({\n        async transform({ data }, controller) {\n          // ignore the 'DONE' event that e.g. OpenAI sends:\n          if (data === '[DONE]') {\n            return;\n          }\n\n          controller.enqueue(await safeParseJSON({ text: data, schema }));\n        },\n      }),\n    );\n}\n","import { APICallError } from '@ai-sdk/provider';\nimport { extractResponseHeaders } from './extract-response-headers';\nimport { FetchFunction } from './fetch-function';\nimport { handleFetchError } from './handle-fetch-error';\nimport { isAbortError } from './is-abort-error';\nimport { ResponseHandler } from './response-handler';\nimport { getRuntimeEnvironmentUserAgent } from './get-runtime-environment-user-agent';\nimport { withUserAgentSuffix } from './with-user-agent-suffix';\nimport { VERSION } from './version';\n\n// use function to allow for mocking in tests:\nconst getOriginalFetch = () => globalThis.fetch;\n\nexport const postJsonToApi = async <T>({\n  url,\n  headers,\n  body,\n  failedResponseHandler,\n  successfulResponseHandler,\n  abortSignal,\n  fetch,\n}: {\n  url: string;\n  headers?: Record<string, string | undefined>;\n  body: unknown;\n  failedResponseHandler: ResponseHandler<APICallError>;\n  successfulResponseHandler: ResponseHandler<T>;\n  abortSignal?: AbortSignal;\n  fetch?: FetchFunction;\n}) =>\n  postToApi({\n    url,\n    headers: {\n      'Content-Type': 'application/json',\n      ...headers,\n    },\n    body: {\n      content: JSON.stringify(body),\n      values: body,\n    },\n    failedResponseHandler,\n    successfulResponseHandler,\n    abortSignal,\n    fetch,\n  });\n\nexport const postFormDataToApi = async <T>({\n  url,\n  headers,\n  formData,\n  failedResponseHandler,\n  successfulResponseHandler,\n  abortSignal,\n  fetch,\n}: {\n  url: string;\n  headers?: Record<string, string | undefined>;\n  formData: FormData;\n  failedResponseHandler: ResponseHandler<APICallError>;\n  successfulResponseHandler: ResponseHandler<T>;\n  abortSignal?: AbortSignal;\n  fetch?: FetchFunction;\n}) =>\n  postToApi({\n    url,\n    headers,\n    body: {\n      content: formData,\n      values: Object.fromEntries((formData as any).entries()),\n    },\n    failedResponseHandler,\n    successfulResponseHandler,\n    abortSignal,\n    fetch,\n  });\n\nexport const postToApi = async <T>({\n  url,\n  headers = {},\n  body,\n  successfulResponseHandler,\n  failedResponseHandler,\n  abortSignal,\n  fetch = getOriginalFetch(),\n}: {\n  url: string;\n  headers?: Record<string, string | undefined>;\n  body: {\n    content: string | FormData | Uint8Array;\n    values: unknown;\n  };\n  failedResponseHandler: ResponseHandler<Error>;\n  successfulResponseHandler: ResponseHandler<T>;\n  abortSignal?: AbortSignal;\n  fetch?: FetchFunction;\n}) => {\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: withUserAgentSuffix(\n        headers,\n        `ai-sdk/provider-utils/${VERSION}`,\n        getRuntimeEnvironmentUserAgent(),\n      ),\n      body: body.content,\n      signal: abortSignal,\n    });\n\n    const responseHeaders = extractResponseHeaders(response);\n\n    if (!response.ok) {\n      let errorInformation: {\n        value: Error;\n        responseHeaders?: Record<string, string> | undefined;\n      };\n\n      try {\n        errorInformation = await failedResponseHandler({\n          response,\n          url,\n          requestBodyValues: body.values,\n        });\n      } catch (error) {\n        if (isAbortError(error) || APICallError.isInstance(error)) {\n          throw error;\n        }\n\n        throw new APICallError({\n          message: 'Failed to process error response',\n          cause: error,\n          statusCode: response.status,\n          url,\n          responseHeaders,\n          requestBodyValues: body.values,\n        });\n      }\n\n      throw errorInformation.value;\n    }\n\n    try {\n      return await successfulResponseHandler({\n        response,\n        url,\n        requestBodyValues: body.values,\n      });\n    } catch (error) {\n      if (error instanceof Error) {\n        if (isAbortError(error) || APICallError.isInstance(error)) {\n          throw error;\n        }\n      }\n\n      throw new APICallError({\n        message: 'Failed to process successful response',\n        cause: error,\n        statusCode: response.status,\n        url,\n        responseHeaders,\n        requestBodyValues: body.values,\n      });\n    }\n  } catch (error) {\n    throw handleFetchError({ error, url, requestBodyValues: body.values });\n  }\n};\n","import { JSONValue, LanguageModelV2ToolResultPart } from '@ai-sdk/provider';\nimport { FlexibleSchema } from '../schema';\nimport { ModelMessage } from './model-message';\nimport { ProviderOptions } from './provider-options';\n\n/**\n * Additional options that are sent into each tool call.\n */\n// TODO AI SDK 6: rename to ToolExecutionOptions\nexport interface ToolCallOptions {\n  /**\n   * The ID of the tool call. You can use it e.g. when sending tool-call related information with stream data.\n   */\n  toolCallId: string;\n\n  /**\n   * Messages that were sent to the language model to initiate the response that contained the tool call.\n   * The messages **do not** include the system prompt nor the assistant response that contained the tool call.\n   */\n  messages: ModelMessage[];\n\n  /**\n   * An optional abort signal that indicates that the overall operation should be aborted.\n   */\n  abortSignal?: AbortSignal;\n\n  /**\n   * Additional context.\n   *\n   * Experimental (can break in patch releases).\n   */\n  experimental_context?: unknown;\n}\n\nexport type ToolExecuteFunction<INPUT, OUTPUT> = (\n  input: INPUT,\n  options: ToolCallOptions,\n) => AsyncIterable<OUTPUT> | PromiseLike<OUTPUT> | OUTPUT;\n\n// 0 extends 1 & N checks for any\n// [N] extends [never] checks for never\ntype NeverOptional<N, T> = 0 extends 1 & N\n  ? Partial<T>\n  : [N] extends [never]\n    ? Partial<Record<keyof T, undefined>>\n    : T;\n\ntype ToolOutputProperties<INPUT, OUTPUT> = NeverOptional<\n  OUTPUT,\n  | {\n      /**\nAn async function that is called with the arguments from the tool call and produces a result.\nIf not provided, the tool will not be executed automatically.\n\n@args is the input of the tool call.\n@options.abortSignal is a signal that can be used to abort the tool call.\n    */\n      execute: ToolExecuteFunction<INPUT, OUTPUT>;\n\n      outputSchema?: FlexibleSchema<OUTPUT>;\n    }\n  | {\n      outputSchema: FlexibleSchema<OUTPUT>;\n\n      execute?: never;\n    }\n>;\n\n/**\nA tool contains the description and the schema of the input that the tool expects.\nThis enables the language model to generate the input.\n\nThe tool can also contain an optional execute function for the actual execution function of the tool.\n */\nexport type Tool<\n  INPUT extends JSONValue | unknown | never = any,\n  OUTPUT extends JSONValue | unknown | never = any,\n> = {\n  /**\nAn optional description of what the tool does.\nWill be used by the language model to decide whether to use the tool.\nNot used for provider-defined tools.\n   */\n  description?: string;\n\n  /**\nAdditional provider-specific metadata. They are passed through\nto the provider from the AI SDK and enable provider-specific\nfunctionality that can be fully encapsulated in the provider.\n   */\n  providerOptions?: ProviderOptions;\n\n  /**\nThe schema of the input that the tool expects. The language model will use this to generate the input.\nIt is also used to validate the output of the language model.\nUse descriptions to make the input understandable for the language model.\n   */\n  inputSchema: FlexibleSchema<INPUT>;\n\n  /**\n   * Optional function that is called when the argument streaming starts.\n   * Only called when the tool is used in a streaming context.\n   */\n  onInputStart?: (options: ToolCallOptions) => void | PromiseLike<void>;\n\n  /**\n   * Optional function that is called when an argument streaming delta is available.\n   * Only called when the tool is used in a streaming context.\n   */\n  onInputDelta?: (\n    options: { inputTextDelta: string } & ToolCallOptions,\n  ) => void | PromiseLike<void>;\n\n  /**\n   * Optional function that is called when a tool call can be started,\n   * even if the execute function is not provided.\n   */\n  onInputAvailable?: (\n    options: {\n      input: [INPUT] extends [never] ? undefined : INPUT;\n    } & ToolCallOptions,\n  ) => void | PromiseLike<void>;\n} & ToolOutputProperties<INPUT, OUTPUT> & {\n    /**\nOptional conversion function that maps the tool result to an output that can be used by the language model.\n\nIf not provided, the tool result will be sent as a JSON object.\n  */\n    toModelOutput?: (\n      output: 0 extends 1 & OUTPUT\n        ? any\n        : [OUTPUT] extends [never]\n          ? any\n          : NoInfer<OUTPUT>,\n    ) => LanguageModelV2ToolResultPart['output'];\n  } & (\n    | {\n        /**\nTool with user-defined input and output schemas.\n     */\n        type?: undefined | 'function';\n      }\n    | {\n        /**\nTool that is defined at runtime (e.g. an MCP tool).\nThe types of input and output are not known at development time.\n       */\n        type: 'dynamic';\n      }\n    | {\n        /**\nTool with provider-defined input and output schemas.\n     */\n        type: 'provider-defined';\n\n        /**\nThe ID of the tool. Should follow the format `<provider-name>.<unique-tool-name>`.\n   */\n        id: `${string}.${string}`;\n\n        /**\nThe name of the tool that the user must use in the tool set.\n */\n        name: string;\n\n        /**\nThe arguments for configuring the tool. Must match the expected arguments defined by the provider for this tool.\n     */\n        args: Record<string, unknown>;\n      }\n  );\n\n/**\n * Infer the input type of a tool.\n */\nexport type InferToolInput<TOOL extends Tool> =\n  TOOL extends Tool<infer INPUT, any> ? INPUT : never;\n\n/**\n * Infer the output type of a tool.\n */\nexport type InferToolOutput<TOOL extends Tool> =\n  TOOL extends Tool<any, infer OUTPUT> ? OUTPUT : never;\n\n/**\nHelper function for inferring the execute args of a tool.\n */\n// Note: overload order is important for auto-completion\nexport function tool<INPUT, OUTPUT>(\n  tool: Tool<INPUT, OUTPUT>,\n): Tool<INPUT, OUTPUT>;\nexport function tool<INPUT>(tool: Tool<INPUT, never>): Tool<INPUT, never>;\nexport function tool<OUTPUT>(tool: Tool<never, OUTPUT>): Tool<never, OUTPUT>;\nexport function tool(tool: Tool<never, never>): Tool<never, never>;\nexport function tool(tool: any): any {\n  return tool;\n}\n\n/**\nHelper function for defining a dynamic tool.\n */\nexport function dynamicTool(tool: {\n  description?: string;\n  providerOptions?: ProviderOptions;\n  inputSchema: FlexibleSchema<unknown>;\n  execute: ToolExecuteFunction<unknown, unknown>;\n  toModelOutput?: (output: unknown) => LanguageModelV2ToolResultPart['output'];\n}): Tool<unknown, unknown> & {\n  type: 'dynamic';\n} {\n  return { ...tool, type: 'dynamic' };\n}\n","export type Resolvable<T> =\n  | T // Raw value\n  | Promise<T> // Promise of value\n  | (() => T) // Function returning value\n  | (() => Promise<T>); // Function returning promise of value\n\n/**\n * Resolves a value that could be a raw value, a Promise, a function returning a value,\n * or a function returning a Promise.\n */\nexport async function resolve<T>(value: Resolvable<T>): Promise<T> {\n  // If it's a function, call it to get the value/promise\n  if (typeof value === 'function') {\n    value = (value as Function)();\n  }\n\n  // Otherwise just resolve whatever we got (value or promise)\n  return Promise.resolve(value as T);\n}\n","import { APICallError, EmptyResponseBodyError } from '@ai-sdk/provider';\nimport { ZodType } from 'zod/v4';\nimport { extractResponseHeaders } from './extract-response-headers';\nimport { parseJSON, ParseResult, safeParseJSON } from './parse-json';\nimport { parseJsonEventStream } from './parse-json-event-stream';\nimport { FlexibleValidator } from './validator';\n\nexport type ResponseHandler<RETURN_TYPE> = (options: {\n  url: string;\n  requestBodyValues: unknown;\n  response: Response;\n}) => PromiseLike<{\n  value: RETURN_TYPE;\n  rawValue?: unknown;\n  responseHeaders?: Record<string, string>;\n}>;\n\nexport const createJsonErrorResponseHandler =\n  <T>({\n    errorSchema,\n    errorToMessage,\n    isRetryable,\n  }: {\n    errorSchema: FlexibleValidator<T>;\n    errorToMessage: (error: T) => string;\n    isRetryable?: (response: Response, error?: T) => boolean;\n  }): ResponseHandler<APICallError> =>\n  async ({ response, url, requestBodyValues }) => {\n    const responseBody = await response.text();\n    const responseHeaders = extractResponseHeaders(response);\n\n    // Some providers return an empty response body for some errors:\n    if (responseBody.trim() === '') {\n      return {\n        responseHeaders,\n        value: new APICallError({\n          message: response.statusText,\n          url,\n          requestBodyValues,\n          statusCode: response.status,\n          responseHeaders,\n          responseBody,\n          isRetryable: isRetryable?.(response),\n        }),\n      };\n    }\n\n    // resilient parsing in case the response is not JSON or does not match the schema:\n    try {\n      const parsedError = await parseJSON({\n        text: responseBody,\n        schema: errorSchema,\n      });\n\n      return {\n        responseHeaders,\n        value: new APICallError({\n          message: errorToMessage(parsedError),\n          url,\n          requestBodyValues,\n          statusCode: response.status,\n          responseHeaders,\n          responseBody,\n          data: parsedError,\n          isRetryable: isRetryable?.(response, parsedError),\n        }),\n      };\n    } catch (parseError) {\n      return {\n        responseHeaders,\n        value: new APICallError({\n          message: response.statusText,\n          url,\n          requestBodyValues,\n          statusCode: response.status,\n          responseHeaders,\n          responseBody,\n          isRetryable: isRetryable?.(response),\n        }),\n      };\n    }\n  };\n\nexport const createEventSourceResponseHandler =\n  <T>(\n    chunkSchema: FlexibleValidator<T>,\n  ): ResponseHandler<ReadableStream<ParseResult<T>>> =>\n  async ({ response }: { response: Response }) => {\n    const responseHeaders = extractResponseHeaders(response);\n\n    if (response.body == null) {\n      throw new EmptyResponseBodyError({});\n    }\n\n    return {\n      responseHeaders,\n      value: parseJsonEventStream({\n        stream: response.body,\n        schema: chunkSchema,\n      }),\n    };\n  };\n\nexport const createJsonStreamResponseHandler =\n  <T>(\n    chunkSchema: ZodType<T>,\n  ): ResponseHandler<ReadableStream<ParseResult<T>>> =>\n  async ({ response }: { response: Response }) => {\n    const responseHeaders = extractResponseHeaders(response);\n\n    if (response.body == null) {\n      throw new EmptyResponseBodyError({});\n    }\n\n    let buffer = '';\n\n    return {\n      responseHeaders,\n      value: response.body.pipeThrough(new TextDecoderStream()).pipeThrough(\n        new TransformStream<string, ParseResult<T>>({\n          async transform(chunkText, controller) {\n            if (chunkText.endsWith('\\n')) {\n              controller.enqueue(\n                await safeParseJSON({\n                  text: buffer + chunkText,\n                  schema: chunkSchema,\n                }),\n              );\n              buffer = '';\n            } else {\n              buffer += chunkText;\n            }\n          },\n        }),\n      ),\n    };\n  };\n\nexport const createJsonResponseHandler =\n  <T>(responseSchema: FlexibleValidator<T>): ResponseHandler<T> =>\n  async ({ response, url, requestBodyValues }) => {\n    const responseBody = await response.text();\n\n    const parsedResult = await safeParseJSON({\n      text: responseBody,\n      schema: responseSchema,\n    });\n\n    const responseHeaders = extractResponseHeaders(response);\n\n    if (!parsedResult.success) {\n      throw new APICallError({\n        message: 'Invalid JSON response',\n        cause: parsedResult.error,\n        statusCode: response.status,\n        responseHeaders,\n        responseBody,\n        url,\n        requestBodyValues,\n      });\n    }\n\n    return {\n      responseHeaders,\n      value: parsedResult.value,\n      rawValue: parsedResult.rawValue,\n    };\n  };\n\nexport const createBinaryResponseHandler =\n  (): ResponseHandler<Uint8Array> =>\n  async ({ response, url, requestBodyValues }) => {\n    const responseHeaders = extractResponseHeaders(response);\n\n    if (!response.body) {\n      throw new APICallError({\n        message: 'Response body is empty',\n        url,\n        requestBodyValues,\n        statusCode: response.status,\n        responseHeaders,\n        responseBody: undefined,\n      });\n    }\n\n    try {\n      const buffer = await response.arrayBuffer();\n      return {\n        responseHeaders,\n        value: new Uint8Array(buffer),\n      };\n    } catch (error) {\n      throw new APICallError({\n        message: 'Failed to read response as array buffer',\n        url,\n        requestBodyValues,\n        statusCode: response.status,\n        responseHeaders,\n        responseBody: undefined,\n        cause: error,\n      });\n    }\n  };\n\nexport const createStatusCodeErrorResponseHandler =\n  (): ResponseHandler<APICallError> =>\n  async ({ response, url, requestBodyValues }) => {\n    const responseHeaders = extractResponseHeaders(response);\n    const responseBody = await response.text();\n\n    return {\n      responseHeaders,\n      value: new APICallError({\n        message: response.statusText,\n        url,\n        requestBodyValues: requestBodyValues as Record<string, unknown>,\n        statusCode: response.status,\n        responseHeaders,\n        responseBody,\n      }),\n    };\n  };\n","export const getRelativePath = (pathA: string[], pathB: string[]) => {\n  let i = 0;\n  for (; i < pathA.length && i < pathB.length; i++) {\n    if (pathA[i] !== pathB[i]) break;\n  }\n  return [(pathA.length - i).toString(), ...pathB.slice(i)].join('/');\n};\n","import { ZodSchema, ZodTypeDef } from 'zod/v3';\nimport { Refs, Seen } from './refs';\nimport { JsonSchema7Type } from './parse-types';\n\nexport type DateStrategy =\n  | 'format:date-time'\n  | 'format:date'\n  | 'string'\n  | 'integer';\n\nexport const ignoreOverride = Symbol(\n  'Let zodToJsonSchema decide on which parser to use',\n);\n\nexport type OverrideCallback = (\n  def: ZodTypeDef,\n  refs: Refs,\n  seen: Seen | undefined,\n  forceResolution?: boolean,\n) => JsonSchema7Type | undefined | typeof ignoreOverride;\n\nexport type PostProcessCallback = (\n  jsonSchema: JsonSchema7Type | undefined,\n  def: ZodTypeDef,\n  refs: Refs,\n) => JsonSchema7Type | undefined;\n\nexport const jsonDescription: PostProcessCallback = (jsonSchema, def) => {\n  if (def.description) {\n    try {\n      return {\n        ...jsonSchema,\n        ...JSON.parse(def.description),\n      };\n    } catch {}\n  }\n\n  return jsonSchema;\n};\n\nexport type Options = {\n  name: string | undefined;\n  $refStrategy: 'root' | 'relative' | 'none' | 'seen';\n  basePath: string[];\n  effectStrategy: 'input' | 'any';\n  pipeStrategy: 'input' | 'output' | 'all';\n  dateStrategy: DateStrategy | DateStrategy[];\n  mapStrategy: 'entries' | 'record';\n  removeAdditionalStrategy: 'passthrough' | 'strict';\n  allowedAdditionalProperties: true | undefined;\n  rejectedAdditionalProperties: false | undefined;\n  strictUnions: boolean;\n  definitionPath: string;\n  definitions: Record<string, ZodSchema>;\n  errorMessages: boolean;\n  patternStrategy: 'escape' | 'preserve';\n  applyRegexFlags: boolean;\n  emailStrategy: 'format:email' | 'format:idn-email' | 'pattern:zod';\n  base64Strategy: 'format:binary' | 'contentEncoding:base64' | 'pattern:zod';\n  nameStrategy: 'ref' | 'title';\n  override?: OverrideCallback;\n  postProcess?: PostProcessCallback;\n};\n\nexport const defaultOptions: Options = {\n  name: undefined,\n  $refStrategy: 'root',\n  basePath: ['#'],\n  effectStrategy: 'input',\n  pipeStrategy: 'all',\n  dateStrategy: 'format:date-time',\n  mapStrategy: 'entries',\n  removeAdditionalStrategy: 'passthrough',\n  allowedAdditionalProperties: true,\n  rejectedAdditionalProperties: false,\n  definitionPath: 'definitions',\n  strictUnions: false,\n  definitions: {},\n  errorMessages: false,\n  patternStrategy: 'escape',\n  applyRegexFlags: false,\n  emailStrategy: 'format:email',\n  base64Strategy: 'contentEncoding:base64',\n  nameStrategy: 'ref',\n};\n\nexport const getDefaultOptions = (\n  options: Partial<Options> | string | undefined,\n) =>\n  (typeof options === 'string'\n    ? {\n        ...defaultOptions,\n        name: options,\n      }\n    : {\n        ...defaultOptions,\n        ...options,\n      }) as Options;\n","export type JsonSchema7AnyType = { $ref?: string };\n\nexport function parseAnyDef(): JsonSchema7AnyType {\n  return {};\n}\n","import { ZodArrayDef, ZodFirstPartyTypeKind } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\n\nexport type JsonSchema7ArrayType = {\n  type: 'array';\n  items?: JsonSchema7Type;\n  minItems?: number;\n  maxItems?: number;\n};\n\nexport function parseArrayDef(def: ZodArrayDef, refs: Refs) {\n  const res: JsonSchema7ArrayType = {\n    type: 'array',\n  };\n  if (\n    def.type?._def &&\n    def.type?._def?.typeName !== ZodFirstPartyTypeKind.ZodAny\n  ) {\n    res.items = parseDef(def.type._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'items'],\n    });\n  }\n\n  if (def.minLength) {\n    res.minItems = def.minLength.value;\n  }\n  if (def.maxLength) {\n    res.maxItems = def.maxLength.value;\n  }\n  if (def.exactLength) {\n    res.minItems = def.exactLength.value;\n    res.maxItems = def.exactLength.value;\n  }\n  return res;\n}\n","import { ZodBigIntDef } from 'zod/v3';\n\nexport type JsonSchema7BigintType = {\n  type: 'integer';\n  format: 'int64';\n  minimum?: BigInt;\n  exclusiveMinimum?: BigInt;\n  maximum?: BigInt;\n  exclusiveMaximum?: BigInt;\n  multipleOf?: BigInt;\n};\n\nexport function parseBigintDef(def: ZodBigIntDef): JsonSchema7BigintType {\n  const res: JsonSchema7BigintType = {\n    type: 'integer',\n    format: 'int64',\n  };\n\n  if (!def.checks) return res;\n\n  for (const check of def.checks) {\n    switch (check.kind) {\n      case 'min':\n        if (check.inclusive) {\n          res.minimum = check.value;\n        } else {\n          res.exclusiveMinimum = check.value;\n        }\n        break;\n      case 'max':\n        if (check.inclusive) {\n          res.maximum = check.value;\n        } else {\n          res.exclusiveMaximum = check.value;\n        }\n\n        break;\n      case 'multipleOf':\n        res.multipleOf = check.value;\n        break;\n    }\n  }\n  return res;\n}\n","export type JsonSchema7BooleanType = {\n  type: 'boolean';\n};\n\nexport function parseBooleanDef(): JsonSchema7BooleanType {\n  return { type: 'boolean' };\n}\n","import { ZodBrandedDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { Refs } from '../refs';\n\nexport function parseBrandedDef(_def: ZodBrandedDef<any>, refs: Refs) {\n  return parseDef(_def.type._def, refs);\n}\n","import { ZodCatchDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { Refs } from '../refs';\n\nexport const parseCatchDef = (def: ZodCatchDef<any>, refs: Refs) => {\n  return parseDef(def.innerType._def, refs);\n};\n","import { ZodDateDef } from 'zod/v3';\nimport { Refs } from '../refs';\nimport { DateStrategy } from '../options';\n\nexport type JsonSchema7DateType =\n  | {\n      type: 'integer' | 'string';\n      format: 'unix-time' | 'date-time' | 'date';\n      minimum?: number;\n      maximum?: number;\n    }\n  | {\n      anyOf: JsonSchema7DateType[];\n    };\n\nexport function parseDateDef(\n  def: ZodDateDef,\n  refs: Refs,\n  overrideDateStrategy?: DateStrategy,\n): JsonSchema7DateType {\n  const strategy = overrideDateStrategy ?? refs.dateStrategy;\n\n  if (Array.isArray(strategy)) {\n    return {\n      anyOf: strategy.map((item, i) => parseDateDef(def, refs, item)),\n    };\n  }\n\n  switch (strategy) {\n    case 'string':\n    case 'format:date-time':\n      return {\n        type: 'string',\n        format: 'date-time',\n      };\n    case 'format:date':\n      return {\n        type: 'string',\n        format: 'date',\n      };\n    case 'integer':\n      return integerDateParser(def);\n  }\n}\n\nconst integerDateParser = (def: ZodDateDef) => {\n  const res: JsonSchema7DateType = {\n    type: 'integer',\n    format: 'unix-time',\n  };\n\n  for (const check of def.checks) {\n    switch (check.kind) {\n      case 'min':\n        res.minimum = check.value;\n        break;\n      case 'max':\n        res.maximum = check.value;\n        break;\n    }\n  }\n\n  return res;\n};\n","import { ZodDefaultDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\n\nexport function parseDefaultDef(\n  _def: ZodDefaultDef,\n  refs: Refs,\n): JsonSchema7Type & { default: any } {\n  return {\n    ...parseDef(_def.innerType._def, refs),\n    default: _def.defaultValue(),\n  };\n}\n","import { ZodEffectsDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\nimport { parseAnyDef } from './any';\n\nexport function parseEffectsDef(\n  _def: ZodEffectsDef,\n  refs: Refs,\n): JsonSchema7Type | undefined {\n  return refs.effectStrategy === 'input'\n    ? parseDef(_def.schema._def, refs)\n    : parseAnyDef();\n}\n","import { ZodEnumDef } from 'zod/v3';\n\nexport type JsonSchema7EnumType = {\n  type: 'string';\n  enum: string[];\n};\n\nexport function parseEnumDef(def: ZodEnumDef): JsonSchema7EnumType {\n  return {\n    type: 'string',\n    enum: Array.from(def.values),\n  };\n}\n","import { ZodIntersectionDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\nimport { JsonSchema7StringType } from './string';\n\nexport type JsonSchema7AllOfType = {\n  allOf: JsonSchema7Type[];\n  unevaluatedProperties?: boolean;\n};\n\nconst isJsonSchema7AllOfType = (\n  type: JsonSchema7Type | JsonSchema7StringType,\n): type is JsonSchema7AllOfType => {\n  if ('type' in type && type.type === 'string') return false;\n  return 'allOf' in type;\n};\n\nexport function parseIntersectionDef(\n  def: ZodIntersectionDef,\n  refs: Refs,\n): JsonSchema7AllOfType | JsonSchema7Type | undefined {\n  const allOf = [\n    parseDef(def.left._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'allOf', '0'],\n    }),\n    parseDef(def.right._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'allOf', '1'],\n    }),\n  ].filter((x): x is JsonSchema7Type => !!x);\n\n  const mergedAllOf: JsonSchema7Type[] = [];\n  // If either of the schemas is an allOf, merge them into a single allOf\n  allOf.forEach(schema => {\n    if (isJsonSchema7AllOfType(schema)) {\n      mergedAllOf.push(...schema.allOf);\n    } else {\n      let nestedSchema: JsonSchema7Type = schema;\n      if (\n        'additionalProperties' in schema &&\n        schema.additionalProperties === false\n      ) {\n        const { additionalProperties, ...rest } = schema;\n        nestedSchema = rest;\n      }\n      mergedAllOf.push(nestedSchema);\n    }\n  });\n  return mergedAllOf.length ? { allOf: mergedAllOf } : undefined;\n}\n","import { ZodLiteralDef } from 'zod/v3';\n\nexport type JsonSchema7LiteralType =\n  | {\n      type: 'string' | 'number' | 'integer' | 'boolean';\n      const: string | number | boolean;\n    }\n  | {\n      type: 'object' | 'array';\n    };\n\nexport function parseLiteralDef(def: ZodLiteralDef): JsonSchema7LiteralType {\n  const parsedType = typeof def.value;\n  if (\n    parsedType !== 'bigint' &&\n    parsedType !== 'number' &&\n    parsedType !== 'boolean' &&\n    parsedType !== 'string'\n  ) {\n    return {\n      type: Array.isArray(def.value) ? 'array' : 'object',\n    };\n  }\n\n  return {\n    type: parsedType === 'bigint' ? 'integer' : parsedType,\n    const: def.value,\n  };\n}\n","import { ZodStringDef } from 'zod/v3';\nimport { Refs } from '../refs';\n\nlet emojiRegex: RegExp | undefined = undefined;\n\n/**\n * Generated from the regular expressions found here as of 2024-05-22:\n * https://github.com/colinhacks/zod/blob/master/src/types.ts.\n *\n * Expressions with /i flag have been changed accordingly.\n */\nexport const zodPatterns = {\n  /**\n   * `c` was changed to `[cC]` to replicate /i flag\n   */\n  cuid: /^[cC][^\\s-]{8,}$/,\n  cuid2: /^[0-9a-z]+$/,\n  ulid: /^[0-9A-HJKMNP-TV-Z]{26}$/,\n  /**\n   * `a-z` was added to replicate /i flag\n   */\n  email:\n    /^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_'+\\-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$/,\n  /**\n   * Constructed a valid Unicode RegExp\n   *\n   * Lazily instantiate since this type of regex isn't supported\n   * in all envs (e.g. React Native).\n   *\n   * See:\n   * https://github.com/colinhacks/zod/issues/2433\n   * Fix in Zod:\n   * https://github.com/colinhacks/zod/commit/9340fd51e48576a75adc919bff65dbc4a5d4c99b\n   */\n  emoji: () => {\n    if (emojiRegex === undefined) {\n      emojiRegex = RegExp(\n        '^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$',\n        'u',\n      );\n    }\n    return emojiRegex;\n  },\n  /**\n   * Unused\n   */\n  uuid: /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/,\n  /**\n   * Unused\n   */\n  ipv4: /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,\n  ipv4Cidr:\n    /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/,\n  /**\n   * Unused\n   */\n  ipv6: /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,\n  ipv6Cidr:\n    /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,\n  base64: /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,\n  base64url:\n    /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,\n  nanoid: /^[a-zA-Z0-9_-]{21}$/,\n  jwt: /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/,\n} as const;\n\nexport type JsonSchema7StringType = {\n  type: 'string';\n  minLength?: number;\n  maxLength?: number;\n  format?:\n    | 'email'\n    | 'idn-email'\n    | 'uri'\n    | 'uuid'\n    | 'date-time'\n    | 'ipv4'\n    | 'ipv6'\n    | 'date'\n    | 'time'\n    | 'duration';\n  pattern?: string;\n  allOf?: {\n    pattern: string;\n  }[];\n  anyOf?: {\n    format: string;\n  }[];\n  contentEncoding?: string;\n};\n\nexport function parseStringDef(\n  def: ZodStringDef,\n  refs: Refs,\n): JsonSchema7StringType {\n  const res: JsonSchema7StringType = {\n    type: 'string',\n  };\n\n  if (def.checks) {\n    for (const check of def.checks) {\n      switch (check.kind) {\n        case 'min':\n          res.minLength =\n            typeof res.minLength === 'number'\n              ? Math.max(res.minLength, check.value)\n              : check.value;\n          break;\n        case 'max':\n          res.maxLength =\n            typeof res.maxLength === 'number'\n              ? Math.min(res.maxLength, check.value)\n              : check.value;\n\n          break;\n        case 'email':\n          switch (refs.emailStrategy) {\n            case 'format:email':\n              addFormat(res, 'email', check.message, refs);\n              break;\n            case 'format:idn-email':\n              addFormat(res, 'idn-email', check.message, refs);\n              break;\n            case 'pattern:zod':\n              addPattern(res, zodPatterns.email, check.message, refs);\n              break;\n          }\n\n          break;\n        case 'url':\n          addFormat(res, 'uri', check.message, refs);\n          break;\n        case 'uuid':\n          addFormat(res, 'uuid', check.message, refs);\n          break;\n        case 'regex':\n          addPattern(res, check.regex, check.message, refs);\n          break;\n        case 'cuid':\n          addPattern(res, zodPatterns.cuid, check.message, refs);\n          break;\n        case 'cuid2':\n          addPattern(res, zodPatterns.cuid2, check.message, refs);\n          break;\n        case 'startsWith':\n          addPattern(\n            res,\n            RegExp(`^${escapeLiteralCheckValue(check.value, refs)}`),\n            check.message,\n            refs,\n          );\n          break;\n        case 'endsWith':\n          addPattern(\n            res,\n            RegExp(`${escapeLiteralCheckValue(check.value, refs)}$`),\n            check.message,\n            refs,\n          );\n          break;\n        case 'datetime':\n          addFormat(res, 'date-time', check.message, refs);\n          break;\n        case 'date':\n          addFormat(res, 'date', check.message, refs);\n          break;\n        case 'time':\n          addFormat(res, 'time', check.message, refs);\n          break;\n        case 'duration':\n          addFormat(res, 'duration', check.message, refs);\n          break;\n        case 'length':\n          res.minLength =\n            typeof res.minLength === 'number'\n              ? Math.max(res.minLength, check.value)\n              : check.value;\n          res.maxLength =\n            typeof res.maxLength === 'number'\n              ? Math.min(res.maxLength, check.value)\n              : check.value;\n          break;\n        case 'includes': {\n          addPattern(\n            res,\n            RegExp(escapeLiteralCheckValue(check.value, refs)),\n            check.message,\n            refs,\n          );\n          break;\n        }\n        case 'ip': {\n          if (check.version !== 'v6') {\n            addFormat(res, 'ipv4', check.message, refs);\n          }\n          if (check.version !== 'v4') {\n            addFormat(res, 'ipv6', check.message, refs);\n          }\n          break;\n        }\n        case 'base64url':\n          addPattern(res, zodPatterns.base64url, check.message, refs);\n          break;\n        case 'jwt':\n          addPattern(res, zodPatterns.jwt, check.message, refs);\n          break;\n        case 'cidr': {\n          if (check.version !== 'v6') {\n            addPattern(res, zodPatterns.ipv4Cidr, check.message, refs);\n          }\n          if (check.version !== 'v4') {\n            addPattern(res, zodPatterns.ipv6Cidr, check.message, refs);\n          }\n          break;\n        }\n        case 'emoji':\n          addPattern(res, zodPatterns.emoji(), check.message, refs);\n          break;\n        case 'ulid': {\n          addPattern(res, zodPatterns.ulid, check.message, refs);\n          break;\n        }\n        case 'base64': {\n          switch (refs.base64Strategy) {\n            case 'format:binary': {\n              addFormat(res, 'binary' as any, check.message, refs);\n              break;\n            }\n\n            case 'contentEncoding:base64': {\n              res.contentEncoding = 'base64';\n              break;\n            }\n\n            case 'pattern:zod': {\n              addPattern(res, zodPatterns.base64, check.message, refs);\n              break;\n            }\n          }\n          break;\n        }\n        case 'nanoid': {\n          addPattern(res, zodPatterns.nanoid, check.message, refs);\n        }\n        case 'toLowerCase':\n        case 'toUpperCase':\n        case 'trim':\n          break;\n        default:\n          /* c8 ignore next */\n          ((_: never) => {})(check);\n      }\n    }\n  }\n\n  return res;\n}\n\nfunction escapeLiteralCheckValue(literal: string, refs: Refs): string {\n  return refs.patternStrategy === 'escape'\n    ? escapeNonAlphaNumeric(literal)\n    : literal;\n}\n\nconst ALPHA_NUMERIC = new Set(\n  'ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789',\n);\n\nfunction escapeNonAlphaNumeric(source: string) {\n  let result = '';\n\n  for (let i = 0; i < source.length; i++) {\n    if (!ALPHA_NUMERIC.has(source[i])) {\n      result += '\\\\';\n    }\n\n    result += source[i];\n  }\n\n  return result;\n}\n\n// Adds a \"format\" keyword to the schema. If a format exists, both formats will be joined in an allOf-node, along with subsequent ones.\nfunction addFormat(\n  schema: JsonSchema7StringType,\n  value: Required<JsonSchema7StringType>['format'],\n  message: string | undefined,\n  refs: Refs,\n) {\n  if (schema.format || schema.anyOf?.some(x => x.format)) {\n    if (!schema.anyOf) {\n      schema.anyOf = [];\n    }\n\n    if (schema.format) {\n      schema.anyOf!.push({\n        format: schema.format,\n      });\n      delete schema.format;\n    }\n\n    schema.anyOf!.push({\n      format: value,\n      ...(message &&\n        refs.errorMessages && { errorMessage: { format: message } }),\n    });\n  } else {\n    schema.format = value;\n  }\n}\n\n// Adds a \"pattern\" keyword to the schema. If a pattern exists, both patterns will be joined in an allOf-node, along with subsequent ones.\nfunction addPattern(\n  schema: JsonSchema7StringType,\n  regex: RegExp,\n  message: string | undefined,\n  refs: Refs,\n) {\n  if (schema.pattern || schema.allOf?.some(x => x.pattern)) {\n    if (!schema.allOf) {\n      schema.allOf = [];\n    }\n\n    if (schema.pattern) {\n      schema.allOf!.push({\n        pattern: schema.pattern,\n      });\n      delete schema.pattern;\n    }\n\n    schema.allOf!.push({\n      pattern: stringifyRegExpWithFlags(regex, refs),\n      ...(message &&\n        refs.errorMessages && { errorMessage: { pattern: message } }),\n    });\n  } else {\n    schema.pattern = stringifyRegExpWithFlags(regex, refs);\n  }\n}\n\n// Mutate z.string.regex() in a best attempt to accommodate for regex flags when applyRegexFlags is true\nfunction stringifyRegExpWithFlags(regex: RegExp, refs: Refs): string {\n  if (!refs.applyRegexFlags || !regex.flags) {\n    return regex.source;\n  }\n\n  // Currently handled flags\n  const flags = {\n    i: regex.flags.includes('i'), // Case-insensitive\n    m: regex.flags.includes('m'), // `^` and `$` matches adjacent to newline characters\n    s: regex.flags.includes('s'), // `.` matches newlines\n  };\n\n  // The general principle here is to step through each character, one at a time, applying mutations as flags require. We keep track when the current character is escaped, and when it's inside a group /like [this]/ or (also) a range like /[a-z]/. The following is fairly brittle imperative code; edit at your peril!\n  const source = flags.i ? regex.source.toLowerCase() : regex.source;\n  let pattern = '';\n  let isEscaped = false;\n  let inCharGroup = false;\n  let inCharRange = false;\n\n  for (let i = 0; i < source.length; i++) {\n    if (isEscaped) {\n      pattern += source[i];\n      isEscaped = false;\n      continue;\n    }\n\n    if (flags.i) {\n      if (inCharGroup) {\n        if (source[i].match(/[a-z]/)) {\n          if (inCharRange) {\n            pattern += source[i];\n            pattern += `${source[i - 2]}-${source[i]}`.toUpperCase();\n            inCharRange = false;\n          } else if (source[i + 1] === '-' && source[i + 2]?.match(/[a-z]/)) {\n            pattern += source[i];\n            inCharRange = true;\n          } else {\n            pattern += `${source[i]}${source[i].toUpperCase()}`;\n          }\n          continue;\n        }\n      } else if (source[i].match(/[a-z]/)) {\n        pattern += `[${source[i]}${source[i].toUpperCase()}]`;\n        continue;\n      }\n    }\n\n    if (flags.m) {\n      if (source[i] === '^') {\n        pattern += `(^|(?<=[\\r\\n]))`;\n        continue;\n      } else if (source[i] === '$') {\n        pattern += `($|(?=[\\r\\n]))`;\n        continue;\n      }\n    }\n\n    if (flags.s && source[i] === '.') {\n      pattern += inCharGroup ? `${source[i]}\\r\\n` : `[${source[i]}\\r\\n]`;\n      continue;\n    }\n\n    pattern += source[i];\n    if (source[i] === '\\\\') {\n      isEscaped = true;\n    } else if (inCharGroup && source[i] === ']') {\n      inCharGroup = false;\n    } else if (!inCharGroup && source[i] === '[') {\n      inCharGroup = true;\n    }\n  }\n\n  try {\n    new RegExp(pattern);\n  } catch {\n    console.warn(\n      `Could not convert regex pattern at ${refs.currentPath.join(\n        '/',\n      )} to a flag-independent form! Falling back to the flag-ignorant source`,\n    );\n    return regex.source;\n  }\n\n  return pattern;\n}\n","import {\n  ZodFirstPartyTypeKind,\n  ZodMapDef,\n  ZodRecordDef,\n  ZodTypeAny,\n} from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\nimport { parseBrandedDef } from './branded';\nimport { JsonSchema7EnumType } from './enum';\nimport { JsonSchema7StringType, parseStringDef } from './string';\n\ntype JsonSchema7RecordPropertyNamesType =\n  | Omit<JsonSchema7StringType, 'type'>\n  | Omit<JsonSchema7EnumType, 'type'>;\n\nexport type JsonSchema7RecordType = {\n  type: 'object';\n  additionalProperties?: JsonSchema7Type | true;\n  propertyNames?: JsonSchema7RecordPropertyNamesType;\n};\n\nexport function parseRecordDef(\n  def: ZodRecordDef<ZodTypeAny, ZodTypeAny> | ZodMapDef,\n  refs: Refs,\n): JsonSchema7RecordType {\n  const schema: JsonSchema7RecordType = {\n    type: 'object',\n    additionalProperties:\n      parseDef(def.valueType._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, 'additionalProperties'],\n      }) ?? refs.allowedAdditionalProperties,\n  };\n\n  if (\n    def.keyType?._def.typeName === ZodFirstPartyTypeKind.ZodString &&\n    def.keyType._def.checks?.length\n  ) {\n    const { type, ...keyType } = parseStringDef(def.keyType._def, refs);\n\n    return {\n      ...schema,\n      propertyNames: keyType,\n    };\n  } else if (def.keyType?._def.typeName === ZodFirstPartyTypeKind.ZodEnum) {\n    return {\n      ...schema,\n      propertyNames: {\n        enum: def.keyType._def.values,\n      },\n    };\n  } else if (\n    def.keyType?._def.typeName === ZodFirstPartyTypeKind.ZodBranded &&\n    def.keyType._def.type._def.typeName === ZodFirstPartyTypeKind.ZodString &&\n    def.keyType._def.type._def.checks?.length\n  ) {\n    const { type, ...keyType } = parseBrandedDef(\n      def.keyType._def,\n      refs,\n    ) as JsonSchema7StringType;\n\n    return {\n      ...schema,\n      propertyNames: keyType,\n    };\n  }\n\n  return schema;\n}\n","import { ZodMapDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\nimport { parseAnyDef } from './any';\nimport { JsonSchema7RecordType, parseRecordDef } from './record';\n\nexport type JsonSchema7MapType = {\n  type: 'array';\n  maxItems: 125;\n  items: {\n    type: 'array';\n    items: [JsonSchema7Type, JsonSchema7Type];\n    minItems: 2;\n    maxItems: 2;\n  };\n};\n\nexport function parseMapDef(\n  def: ZodMapDef,\n  refs: Refs,\n): JsonSchema7MapType | JsonSchema7RecordType {\n  if (refs.mapStrategy === 'record') {\n    return parseRecordDef(def, refs);\n  }\n\n  const keys =\n    parseDef(def.keyType._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'items', 'items', '0'],\n    }) || parseAnyDef();\n  const values =\n    parseDef(def.valueType._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'items', 'items', '1'],\n    }) || parseAnyDef();\n  return {\n    type: 'array',\n    maxItems: 125,\n    items: {\n      type: 'array',\n      items: [keys, values],\n      minItems: 2,\n      maxItems: 2,\n    },\n  };\n}\n","import { ZodNativeEnumDef } from 'zod/v3';\n\nexport type JsonSchema7NativeEnumType = {\n  type: 'string' | 'number' | ['string', 'number'];\n  enum: (string | number)[];\n};\n\nexport function parseNativeEnumDef(\n  def: ZodNativeEnumDef,\n): JsonSchema7NativeEnumType {\n  const object = def.values;\n  const actualKeys = Object.keys(def.values).filter((key: string) => {\n    return typeof object[object[key]] !== 'number';\n  });\n\n  const actualValues = actualKeys.map((key: string) => object[key]);\n\n  const parsedTypes = Array.from(\n    new Set(actualValues.map((values: string | number) => typeof values)),\n  );\n\n  return {\n    type:\n      parsedTypes.length === 1\n        ? parsedTypes[0] === 'string'\n          ? 'string'\n          : 'number'\n        : ['string', 'number'],\n    enum: actualValues,\n  };\n}\n","import { JsonSchema7AnyType, parseAnyDef } from './any';\n\nexport type JsonSchema7NeverType = {\n  not: JsonSchema7AnyType;\n};\n\nexport function parseNeverDef(): JsonSchema7NeverType | undefined {\n  return { not: parseAnyDef() };\n}\n","export type JsonSchema7NullType = {\n  type: 'null';\n};\n\nexport function parseNullDef(): JsonSchema7NullType {\n  return {\n    type: 'null',\n  };\n}\n","import {\n  ZodDiscriminatedUnionDef,\n  ZodLiteralDef,\n  ZodTypeAny,\n  ZodUnionDef,\n} from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\n\nexport const primitiveMappings = {\n  ZodString: 'string',\n  ZodNumber: 'number',\n  ZodBigInt: 'integer',\n  ZodBoolean: 'boolean',\n  ZodNull: 'null',\n} as const;\ntype ZodPrimitive = keyof typeof primitiveMappings;\ntype JsonSchema7Primitive =\n  (typeof primitiveMappings)[keyof typeof primitiveMappings];\n\nexport type JsonSchema7UnionType =\n  | JsonSchema7PrimitiveUnionType\n  | JsonSchema7AnyOfType;\n\ntype JsonSchema7PrimitiveUnionType =\n  | {\n      type: JsonSchema7Primitive | JsonSchema7Primitive[];\n    }\n  | {\n      type: JsonSchema7Primitive | JsonSchema7Primitive[];\n      enum: (string | number | bigint | boolean | null)[];\n    };\n\ntype JsonSchema7AnyOfType = {\n  anyOf: JsonSchema7Type[];\n};\n\nexport function parseUnionDef(\n  def: ZodUnionDef | ZodDiscriminatedUnionDef<any, any>,\n  refs: Refs,\n): JsonSchema7PrimitiveUnionType | JsonSchema7AnyOfType | undefined {\n  const options: readonly ZodTypeAny[] =\n    def.options instanceof Map ? Array.from(def.options.values()) : def.options;\n\n  // This blocks tries to look ahead a bit to produce nicer looking schemas with type array instead of anyOf.\n  if (\n    options.every(\n      x =>\n        x._def.typeName in primitiveMappings &&\n        (!x._def.checks || !x._def.checks.length),\n    )\n  ) {\n    // all types in union are primitive and lack checks, so might as well squash into {type: [...]}\n\n    const types = options.reduce((types: JsonSchema7Primitive[], x) => {\n      const type = primitiveMappings[x._def.typeName as ZodPrimitive]; //Can be safely casted due to row 43\n      return type && !types.includes(type) ? [...types, type] : types;\n    }, []);\n\n    return {\n      type: types.length > 1 ? types : types[0],\n    };\n  } else if (\n    options.every(x => x._def.typeName === 'ZodLiteral' && !x.description)\n  ) {\n    // all options literals\n\n    const types = options.reduce(\n      (acc: JsonSchema7Primitive[], x: { _def: ZodLiteralDef }) => {\n        const type = typeof x._def.value;\n        switch (type) {\n          case 'string':\n          case 'number':\n          case 'boolean':\n            return [...acc, type];\n          case 'bigint':\n            return [...acc, 'integer' as const];\n          case 'object':\n            if (x._def.value === null) return [...acc, 'null' as const];\n          case 'symbol':\n          case 'undefined':\n          case 'function':\n          default:\n            return acc;\n        }\n      },\n      [],\n    );\n\n    if (types.length === options.length) {\n      // all the literals are primitive, as far as null can be considered primitive\n\n      const uniqueTypes = types.filter((x, i, a) => a.indexOf(x) === i);\n      return {\n        type: uniqueTypes.length > 1 ? uniqueTypes : uniqueTypes[0],\n        enum: options.reduce(\n          (acc, x) => {\n            return acc.includes(x._def.value) ? acc : [...acc, x._def.value];\n          },\n          [] as (string | number | bigint | boolean | null)[],\n        ),\n      };\n    }\n  } else if (options.every(x => x._def.typeName === 'ZodEnum')) {\n    return {\n      type: 'string',\n      enum: options.reduce(\n        (acc: string[], x) => [\n          ...acc,\n          ...x._def.values.filter((x: string) => !acc.includes(x)),\n        ],\n        [],\n      ),\n    };\n  }\n\n  return asAnyOf(def, refs);\n}\n\nconst asAnyOf = (\n  def: ZodUnionDef | ZodDiscriminatedUnionDef<any, any>,\n  refs: Refs,\n): JsonSchema7PrimitiveUnionType | JsonSchema7AnyOfType | undefined => {\n  const anyOf = (\n    (def.options instanceof Map\n      ? Array.from(def.options.values())\n      : def.options) as any[]\n  )\n    .map((x, i) =>\n      parseDef(x._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, 'anyOf', `${i}`],\n      }),\n    )\n    .filter(\n      (x): x is JsonSchema7Type =>\n        !!x &&\n        (!refs.strictUnions ||\n          (typeof x === 'object' && Object.keys(x).length > 0)),\n    );\n\n  return anyOf.length ? { anyOf } : undefined;\n};\n","import { ZodNullableDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\nimport { JsonSchema7NullType } from './null';\nimport { primitiveMappings } from './union';\n\nexport type JsonSchema7NullableType =\n  | {\n      anyOf: [JsonSchema7Type, JsonSchema7NullType];\n    }\n  | {\n      type: [string, 'null'];\n    };\n\nexport function parseNullableDef(\n  def: ZodNullableDef,\n  refs: Refs,\n): JsonSchema7NullableType | undefined {\n  if (\n    ['ZodString', 'ZodNumber', 'ZodBigInt', 'ZodBoolean', 'ZodNull'].includes(\n      def.innerType._def.typeName,\n    ) &&\n    (!def.innerType._def.checks || !def.innerType._def.checks.length)\n  ) {\n    return {\n      type: [\n        primitiveMappings[\n          def.innerType._def.typeName as keyof typeof primitiveMappings\n        ],\n        'null',\n      ],\n    };\n  }\n\n  const base = parseDef(def.innerType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, 'anyOf', '0'],\n  });\n\n  return base && { anyOf: [base, { type: 'null' }] };\n}\n","import { ZodNumberDef } from 'zod/v3';\n\nexport type JsonSchema7NumberType = {\n  type: 'number' | 'integer';\n  minimum?: number;\n  exclusiveMinimum?: number;\n  maximum?: number;\n  exclusiveMaximum?: number;\n  multipleOf?: number;\n};\n\nexport function parseNumberDef(def: ZodNumberDef): JsonSchema7NumberType {\n  const res: JsonSchema7NumberType = {\n    type: 'number',\n  };\n\n  if (!def.checks) return res;\n\n  for (const check of def.checks) {\n    switch (check.kind) {\n      case 'int':\n        res.type = 'integer';\n        break;\n      case 'min':\n        if (check.inclusive) {\n          res.minimum = check.value;\n        } else {\n          res.exclusiveMinimum = check.value;\n        }\n        break;\n      case 'max':\n        if (check.inclusive) {\n          res.maximum = check.value;\n        } else {\n          res.exclusiveMaximum = check.value;\n        }\n        break;\n      case 'multipleOf':\n        res.multipleOf = check.value;\n        break;\n    }\n  }\n  return res;\n}\n","import { ZodObjectDef, ZodTypeAny } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\n\nexport type JsonSchema7ObjectType = {\n  type: 'object';\n  properties: Record<string, JsonSchema7Type>;\n  additionalProperties?: boolean | JsonSchema7Type;\n  required?: string[];\n};\n\nexport function parseObjectDef(def: ZodObjectDef, refs: Refs) {\n  const result: JsonSchema7ObjectType = {\n    type: 'object',\n    properties: {},\n  };\n\n  const required: string[] = [];\n\n  const shape = def.shape();\n\n  for (const propName in shape) {\n    let propDef = shape[propName];\n\n    if (propDef === undefined || propDef._def === undefined) {\n      continue;\n    }\n\n    const propOptional = safeIsOptional(propDef);\n\n    const parsedDef = parseDef(propDef._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'properties', propName],\n      propertyPath: [...refs.currentPath, 'properties', propName],\n    });\n\n    if (parsedDef === undefined) {\n      continue;\n    }\n\n    result.properties[propName] = parsedDef;\n\n    if (!propOptional) {\n      required.push(propName);\n    }\n  }\n\n  if (required.length) {\n    result.required = required;\n  }\n\n  const additionalProperties = decideAdditionalProperties(def, refs);\n\n  if (additionalProperties !== undefined) {\n    result.additionalProperties = additionalProperties;\n  }\n\n  return result;\n}\n\nfunction decideAdditionalProperties(def: ZodObjectDef, refs: Refs) {\n  if (def.catchall._def.typeName !== 'ZodNever') {\n    return parseDef(def.catchall._def, {\n      ...refs,\n      currentPath: [...refs.currentPath, 'additionalProperties'],\n    });\n  }\n\n  switch (def.unknownKeys) {\n    case 'passthrough':\n      return refs.allowedAdditionalProperties;\n    case 'strict':\n      return refs.rejectedAdditionalProperties;\n    case 'strip':\n      return refs.removeAdditionalStrategy === 'strict'\n        ? refs.allowedAdditionalProperties\n        : refs.rejectedAdditionalProperties;\n  }\n}\n\nfunction safeIsOptional(schema: ZodTypeAny): boolean {\n  try {\n    return schema.isOptional();\n  } catch {\n    return true;\n  }\n}\n","import { ZodOptionalDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\nimport { parseAnyDef } from './any';\n\nexport const parseOptionalDef = (\n  def: ZodOptionalDef,\n  refs: Refs,\n): JsonSchema7Type | undefined => {\n  if (refs.currentPath.toString() === refs.propertyPath?.toString()) {\n    return parseDef(def.innerType._def, refs);\n  }\n\n  const innerSchema = parseDef(def.innerType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, 'anyOf', '1'],\n  });\n\n  return innerSchema\n    ? { anyOf: [{ not: parseAnyDef() }, innerSchema] }\n    : parseAnyDef();\n};\n","import { ZodPipelineDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\nimport { JsonSchema7AllOfType } from './intersection';\n\nexport const parsePipelineDef = (\n  def: ZodPipelineDef<any, any>,\n  refs: Refs,\n): JsonSchema7AllOfType | JsonSchema7Type | undefined => {\n  if (refs.pipeStrategy === 'input') {\n    return parseDef(def.in._def, refs);\n  } else if (refs.pipeStrategy === 'output') {\n    return parseDef(def.out._def, refs);\n  }\n\n  const a = parseDef(def.in._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, 'allOf', '0'],\n  });\n  const b = parseDef(def.out._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, 'allOf', a ? '1' : '0'],\n  });\n\n  return {\n    allOf: [a, b].filter((x): x is JsonSchema7Type => x !== undefined),\n  };\n};\n","import { ZodPromiseDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\n\nexport function parsePromiseDef(\n  def: ZodPromiseDef,\n  refs: Refs,\n): JsonSchema7Type | undefined {\n  return parseDef(def.type._def, refs);\n}\n","import { ZodSetDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\n\nexport type JsonSchema7SetType = {\n  type: 'array';\n  uniqueItems: true;\n  items?: JsonSchema7Type;\n  minItems?: number;\n  maxItems?: number;\n};\n\nexport function parseSetDef(def: ZodSetDef, refs: Refs): JsonSchema7SetType {\n  const items = parseDef(def.valueType._def, {\n    ...refs,\n    currentPath: [...refs.currentPath, 'items'],\n  });\n\n  const schema: JsonSchema7SetType = {\n    type: 'array',\n    uniqueItems: true,\n    items,\n  };\n\n  if (def.minSize) {\n    schema.minItems = def.minSize.value;\n  }\n\n  if (def.maxSize) {\n    schema.maxItems = def.maxSize.value;\n  }\n\n  return schema;\n}\n","import { ZodTupleDef, ZodTupleItems, ZodTypeAny } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { JsonSchema7Type } from '../parse-types';\nimport { Refs } from '../refs';\n\nexport type JsonSchema7TupleType = {\n  type: 'array';\n  minItems: number;\n  items: JsonSchema7Type[];\n} & (\n  | {\n      maxItems: number;\n    }\n  | {\n      additionalItems?: JsonSchema7Type;\n    }\n);\n\nexport function parseTupleDef(\n  def: ZodTupleDef<ZodTupleItems | [], ZodTypeAny | null>,\n  refs: Refs,\n): JsonSchema7TupleType {\n  if (def.rest) {\n    return {\n      type: 'array',\n      minItems: def.items.length,\n      items: def.items\n        .map((x, i) =>\n          parseDef(x._def, {\n            ...refs,\n            currentPath: [...refs.currentPath, 'items', `${i}`],\n          }),\n        )\n        .reduce(\n          (acc: JsonSchema7Type[], x) => (x === undefined ? acc : [...acc, x]),\n          [],\n        ),\n      additionalItems: parseDef(def.rest._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, 'additionalItems'],\n      }),\n    };\n  } else {\n    return {\n      type: 'array',\n      minItems: def.items.length,\n      maxItems: def.items.length,\n      items: def.items\n        .map((x, i) =>\n          parseDef(x._def, {\n            ...refs,\n            currentPath: [...refs.currentPath, 'items', `${i}`],\n          }),\n        )\n        .reduce(\n          (acc: JsonSchema7Type[], x) => (x === undefined ? acc : [...acc, x]),\n          [],\n        ),\n    };\n  }\n}\n","import { JsonSchema7AnyType, parseAnyDef } from './any';\n\nexport type JsonSchema7UndefinedType = {\n  not: JsonSchema7AnyType;\n};\n\nexport function parseUndefinedDef(): JsonSchema7UndefinedType {\n  return {\n    not: parseAnyDef(),\n  };\n}\n","import { JsonSchema7AnyType, parseAnyDef } from './any';\n\nexport type JsonSchema7UnknownType = JsonSchema7AnyType;\n\nexport function parseUnknownDef(): JsonSchema7UnknownType {\n  return parseAnyDef();\n}\n","import { ZodReadonlyDef } from 'zod/v3';\nimport { parseDef } from '../parse-def';\nimport { Refs } from '../refs';\n\nexport const parseReadonlyDef = (def: ZodReadonlyDef<any>, refs: Refs) => {\n  return parseDef(def.innerType._def, refs);\n};\n","import { ZodFirstPartyTypeKind } from 'zod/v3';\nimport { parseAnyDef } from './parsers/any';\nimport { parseArrayDef } from './parsers/array';\nimport { parseBigintDef } from './parsers/bigint';\nimport { parseBooleanDef } from './parsers/boolean';\nimport { parseBrandedDef } from './parsers/branded';\nimport { parseCatchDef } from './parsers/catch';\nimport { parseDateDef } from './parsers/date';\nimport { parseDefaultDef } from './parsers/default';\nimport { parseEffectsDef } from './parsers/effects';\nimport { parseEnumDef } from './parsers/enum';\nimport { parseIntersectionDef } from './parsers/intersection';\nimport { parseLiteralDef } from './parsers/literal';\nimport { parseMapDef } from './parsers/map';\nimport { parseNativeEnumDef } from './parsers/native-enum';\nimport { parseNeverDef } from './parsers/never';\nimport { parseNullDef } from './parsers/null';\nimport { parseNullableDef } from './parsers/nullable';\nimport { parseNumberDef } from './parsers/number';\nimport { parseObjectDef } from './parsers/object';\nimport { parseOptionalDef } from './parsers/optional';\nimport { parsePipelineDef } from './parsers/pipeline';\nimport { parsePromiseDef } from './parsers/promise';\nimport { parseRecordDef } from './parsers/record';\nimport { parseSetDef } from './parsers/set';\nimport { parseStringDef } from './parsers/string';\nimport { parseTupleDef } from './parsers/tuple';\nimport { parseUndefinedDef } from './parsers/undefined';\nimport { parseUnionDef } from './parsers/union';\nimport { parseUnknownDef } from './parsers/unknown';\nimport { Refs } from './refs';\nimport { parseReadonlyDef } from './parsers/readonly';\nimport { JsonSchema7Type } from './parse-types';\n\nexport type InnerDefGetter = () => any;\n\nexport const selectParser = (\n  def: any,\n  typeName: ZodFirstPartyTypeKind,\n  refs: Refs,\n): JsonSchema7Type | undefined | InnerDefGetter => {\n  switch (typeName) {\n    case ZodFirstPartyTypeKind.ZodString:\n      return parseStringDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodNumber:\n      return parseNumberDef(def);\n    case ZodFirstPartyTypeKind.ZodObject:\n      return parseObjectDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodBigInt:\n      return parseBigintDef(def);\n    case ZodFirstPartyTypeKind.ZodBoolean:\n      return parseBooleanDef();\n    case ZodFirstPartyTypeKind.ZodDate:\n      return parseDateDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodUndefined:\n      return parseUndefinedDef();\n    case ZodFirstPartyTypeKind.ZodNull:\n      return parseNullDef();\n    case ZodFirstPartyTypeKind.ZodArray:\n      return parseArrayDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodUnion:\n    case ZodFirstPartyTypeKind.ZodDiscriminatedUnion:\n      return parseUnionDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodIntersection:\n      return parseIntersectionDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodTuple:\n      return parseTupleDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodRecord:\n      return parseRecordDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodLiteral:\n      return parseLiteralDef(def);\n    case ZodFirstPartyTypeKind.ZodEnum:\n      return parseEnumDef(def);\n    case ZodFirstPartyTypeKind.ZodNativeEnum:\n      return parseNativeEnumDef(def);\n    case ZodFirstPartyTypeKind.ZodNullable:\n      return parseNullableDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodOptional:\n      return parseOptionalDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodMap:\n      return parseMapDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodSet:\n      return parseSetDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodLazy:\n      return () => (def as any).getter()._def;\n    case ZodFirstPartyTypeKind.ZodPromise:\n      return parsePromiseDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodNaN:\n    case ZodFirstPartyTypeKind.ZodNever:\n      return parseNeverDef();\n    case ZodFirstPartyTypeKind.ZodEffects:\n      return parseEffectsDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodAny:\n      return parseAnyDef();\n    case ZodFirstPartyTypeKind.ZodUnknown:\n      return parseUnknownDef();\n    case ZodFirstPartyTypeKind.ZodDefault:\n      return parseDefaultDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodBranded:\n      return parseBrandedDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodReadonly:\n      return parseReadonlyDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodCatch:\n      return parseCatchDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodPipeline:\n      return parsePipelineDef(def, refs);\n    case ZodFirstPartyTypeKind.ZodFunction:\n    case ZodFirstPartyTypeKind.ZodVoid:\n    case ZodFirstPartyTypeKind.ZodSymbol:\n      return undefined;\n    default:\n      /* c8 ignore next */\n      return ((_: never) => undefined)(typeName);\n  }\n};\n","import { ZodTypeDef } from 'zod/v3';\nimport { Refs, Seen } from './refs';\nimport { ignoreOverride } from './options';\nimport { JsonSchema7Type } from './parse-types';\nimport { selectParser } from './select-parser';\nimport { getRelativePath } from './get-relative-path';\nimport { parseAnyDef } from './parsers/any';\n\nexport function parseDef(\n  def: ZodTypeDef,\n  refs: Refs,\n  forceResolution = false, // Forces a new schema to be instantiated even though its def has been seen. Used for improving refs in definitions. See https://github.com/StefanTerdell/zod-to-json-schema/pull/61.\n): JsonSchema7Type | undefined {\n  const seenItem = refs.seen.get(def);\n\n  if (refs.override) {\n    const overrideResult = refs.override?.(\n      def,\n      refs,\n      seenItem,\n      forceResolution,\n    );\n\n    if (overrideResult !== ignoreOverride) {\n      return overrideResult;\n    }\n  }\n\n  if (seenItem && !forceResolution) {\n    const seenSchema = get$ref(seenItem, refs);\n\n    if (seenSchema !== undefined) {\n      return seenSchema;\n    }\n  }\n\n  const newItem: Seen = { def, path: refs.currentPath, jsonSchema: undefined };\n\n  refs.seen.set(def, newItem);\n\n  const jsonSchemaOrGetter = selectParser(def, (def as any).typeName, refs);\n\n  // If the return was a function, then the inner definition needs to be extracted before a call to parseDef (recursive)\n  const jsonSchema =\n    typeof jsonSchemaOrGetter === 'function'\n      ? parseDef(jsonSchemaOrGetter(), refs)\n      : jsonSchemaOrGetter;\n\n  if (jsonSchema) {\n    addMeta(def, refs, jsonSchema);\n  }\n\n  if (refs.postProcess) {\n    const postProcessResult = refs.postProcess(jsonSchema, def, refs);\n\n    newItem.jsonSchema = jsonSchema;\n\n    return postProcessResult;\n  }\n\n  newItem.jsonSchema = jsonSchema;\n\n  return jsonSchema;\n}\n\nconst get$ref = (\n  item: Seen,\n  refs: Refs,\n):\n  | {\n      $ref: string;\n    }\n  | {}\n  | undefined => {\n  switch (refs.$refStrategy) {\n    case 'root':\n      return { $ref: item.path.join('/') };\n    case 'relative':\n      return { $ref: getRelativePath(refs.currentPath, item.path) };\n    case 'none':\n    case 'seen': {\n      if (\n        item.path.length < refs.currentPath.length &&\n        item.path.every((value, index) => refs.currentPath[index] === value)\n      ) {\n        console.warn(\n          `Recursive reference detected at ${refs.currentPath.join(\n            '/',\n          )}! Defaulting to any`,\n        );\n\n        return parseAnyDef();\n      }\n\n      return refs.$refStrategy === 'seen' ? parseAnyDef() : undefined;\n    }\n  }\n};\n\nconst addMeta = (\n  def: ZodTypeDef,\n  refs: Refs,\n  jsonSchema: JsonSchema7Type,\n): JsonSchema7Type => {\n  if (def.description) {\n    jsonSchema.description = def.description;\n  }\n  return jsonSchema;\n};\n","import { ZodTypeDef } from 'zod/v3';\nimport { getDefaultOptions, Options } from './options';\nimport { JsonSchema7Type } from './parse-types';\n\nexport type Refs = {\n  seen: Map<ZodTypeDef, Seen>;\n  currentPath: string[];\n  propertyPath: string[] | undefined;\n} & Options;\n\nexport type Seen = {\n  def: ZodTypeDef;\n  path: string[];\n  jsonSchema: JsonSchema7Type | undefined;\n};\n\nexport const getRefs = (options?: string | Partial<Options>): Refs => {\n  const _options = getDefaultOptions(options);\n  const currentPath =\n    _options.name !== undefined\n      ? [..._options.basePath, _options.definitionPath, _options.name]\n      : _options.basePath;\n  return {\n    ..._options,\n    currentPath: currentPath,\n    propertyPath: undefined,\n    seen: new Map(\n      Object.entries(_options.definitions).map(([name, def]) => [\n        def._def,\n        {\n          def: def._def,\n          path: [..._options.basePath, _options.definitionPath, name],\n          // Resolution of references will be forced even though seen, so it's ok that the schema is undefined here for now.\n          jsonSchema: undefined,\n        },\n      ]),\n    ),\n  };\n};\n","import { ZodSchema } from 'zod/v3';\nimport { Options } from './options';\nimport { parseDef } from './parse-def';\nimport { JsonSchema7Type } from './parse-types';\nimport { getRefs } from './refs';\nimport { parseAnyDef } from './parsers/any';\n\nconst zodToJsonSchema = (\n  schema: ZodSchema<any>,\n  options?: Partial<Options> | string,\n): JsonSchema7Type & {\n  $schema?: string;\n  definitions?: {\n    [key: string]: JsonSchema7Type;\n  };\n} => {\n  const refs = getRefs(options);\n\n  let definitions =\n    typeof options === 'object' && options.definitions\n      ? Object.entries(options.definitions).reduce(\n          (acc: { [key: string]: JsonSchema7Type }, [name, schema]) => ({\n            ...acc,\n            [name]:\n              parseDef(\n                schema._def,\n                {\n                  ...refs,\n                  currentPath: [...refs.basePath, refs.definitionPath, name],\n                },\n                true,\n              ) ?? parseAnyDef(),\n          }),\n          {},\n        )\n      : undefined;\n\n  const name =\n    typeof options === 'string'\n      ? options\n      : options?.nameStrategy === 'title'\n        ? undefined\n        : options?.name;\n\n  const main =\n    parseDef(\n      schema._def,\n      name === undefined\n        ? refs\n        : {\n            ...refs,\n            currentPath: [...refs.basePath, refs.definitionPath, name],\n          },\n      false,\n    ) ?? (parseAnyDef() as JsonSchema7Type);\n\n  const title =\n    typeof options === 'object' &&\n    options.name !== undefined &&\n    options.nameStrategy === 'title'\n      ? options.name\n      : undefined;\n\n  if (title !== undefined) {\n    main.title = title;\n  }\n\n  const combined: ReturnType<typeof zodToJsonSchema> =\n    name === undefined\n      ? definitions\n        ? {\n            ...main,\n            [refs.definitionPath]: definitions,\n          }\n        : main\n      : {\n          $ref: [\n            ...(refs.$refStrategy === 'relative' ? [] : refs.basePath),\n            refs.definitionPath,\n            name,\n          ].join('/'),\n          [refs.definitionPath]: {\n            ...definitions,\n            [name]: main,\n          },\n        };\n\n  combined.$schema = 'http://json-schema.org/draft-07/schema#';\n\n  return combined;\n};\n\nexport { zodToJsonSchema };\n","export * from './get-relative-path';\nexport * from './options';\nexport * from './parse-def';\nexport * from './parse-types';\nexport * from './parsers/any';\nexport * from './parsers/array';\nexport * from './parsers/bigint';\nexport * from './parsers/boolean';\nexport * from './parsers/branded';\nexport * from './parsers/catch';\nexport * from './parsers/date';\nexport * from './parsers/default';\nexport * from './parsers/effects';\nexport * from './parsers/enum';\nexport * from './parsers/intersection';\nexport * from './parsers/literal';\nexport * from './parsers/map';\nexport * from './parsers/native-enum';\nexport * from './parsers/never';\nexport * from './parsers/null';\nexport * from './parsers/nullable';\nexport * from './parsers/number';\nexport * from './parsers/object';\nexport * from './parsers/optional';\nexport * from './parsers/pipeline';\nexport * from './parsers/promise';\nexport * from './parsers/readonly';\nexport * from './parsers/record';\nexport * from './parsers/set';\nexport * from './parsers/string';\nexport * from './parsers/tuple';\nexport * from './parsers/undefined';\nexport * from './parsers/union';\nexport * from './parsers/unknown';\nexport * from './refs';\nexport * from './select-parser';\nexport * from './zod-to-json-schema';\nimport { zodToJsonSchema } from './zod-to-json-schema';\nexport default zodToJsonSchema;\n","import { JSONSchema7 } from '@ai-sdk/provider';\nimport * as z3 from 'zod/v3';\nimport * as z4 from 'zod/v4';\nimport zodToJsonSchema from './zod-to-json-schema';\nimport { jsonSchema, Schema } from './schema';\n\nexport function zod3Schema<OBJECT>(\n  zodSchema: z3.Schema<OBJECT, z3.ZodTypeDef, any>,\n  options?: {\n    /**\n     * Enables support for references in the schema.\n     * This is required for recursive schemas, e.g. with `z.lazy`.\n     * However, not all language models and providers support such references.\n     * Defaults to `false`.\n     */\n    useReferences?: boolean;\n  },\n): Schema<OBJECT> {\n  // default to no references (to support openapi conversion for google)\n  const useReferences = options?.useReferences ?? false;\n\n  return jsonSchema(\n    // defer json schema creation to avoid unnecessary computation when only validation is needed\n    () =>\n      zodToJsonSchema(zodSchema, {\n        $refStrategy: useReferences ? 'root' : 'none',\n      }) as JSONSchema7,\n    {\n      validate: async value => {\n        const result = await zodSchema.safeParseAsync(value);\n        return result.success\n          ? { success: true, value: result.data }\n          : { success: false, error: result.error };\n      },\n    },\n  );\n}\n\nexport function zod4Schema<OBJECT>(\n  zodSchema: z4.core.$ZodType<OBJECT, any>,\n  options?: {\n    /**\n     * Enables support for references in the schema.\n     * This is required for recursive schemas, e.g. with `z.lazy`.\n     * However, not all language models and providers support such references.\n     * Defaults to `false`.\n     */\n    useReferences?: boolean;\n  },\n): Schema<OBJECT> {\n  // default to no references (to support openapi conversion for google)\n  const useReferences = options?.useReferences ?? false;\n\n  return jsonSchema(\n    // defer json schema creation to avoid unnecessary computation when only validation is needed\n    () =>\n      z4.toJSONSchema(zodSchema, {\n        target: 'draft-7',\n        io: 'output',\n        reused: useReferences ? 'ref' : 'inline',\n      }) as JSONSchema7,\n    {\n      validate: async value => {\n        const result = await z4.safeParseAsync(zodSchema, value);\n        return result.success\n          ? { success: true, value: result.data }\n          : { success: false, error: result.error };\n      },\n    },\n  );\n}\n\nexport function isZod4Schema(\n  zodSchema: z4.core.$ZodType<any, any> | z3.Schema<any, z3.ZodTypeDef, any>,\n): zodSchema is z4.core.$ZodType<any, any> {\n  // https://zod.dev/library-authors?id=how-to-support-zod-3-and-zod-4-simultaneously\n  return '_zod' in zodSchema;\n}\n\nexport function zodSchema<OBJECT>(\n  zodSchema:\n    | z4.core.$ZodType<OBJECT, any>\n    | z3.Schema<OBJECT, z3.ZodTypeDef, any>,\n  options?: {\n    /**\n     * Enables support for references in the schema.\n     * This is required for recursive schemas, e.g. with `z.lazy`.\n     * However, not all language models and providers support such references.\n     * Defaults to `false`.\n     */\n    useReferences?: boolean;\n  },\n): Schema<OBJECT> {\n  if (isZod4Schema(zodSchema)) {\n    return zod4Schema(zodSchema, options);\n  } else {\n    return zod3Schema(zodSchema, options);\n  }\n}\n","import { JSONSchema7 } from '@ai-sdk/provider';\nimport * as z3 from 'zod/v3';\nimport * as z4 from 'zod/v4';\nimport { Validator, validatorSymbol, type ValidationResult } from './validator';\nimport { zodSchema } from './zod-schema';\n\n/**\n * Used to mark schemas so we can support both Zod and custom schemas.\n */\nconst schemaSymbol = Symbol.for('vercel.ai.schema');\n\nexport type Schema<OBJECT = unknown> = Validator<OBJECT> & {\n  /**\n   * Used to mark schemas so we can support both Zod and custom schemas.\n   */\n  [schemaSymbol]: true;\n\n  /**\n   * Schema type for inference.\n   */\n  _type: OBJECT;\n\n  /**\n   * The JSON Schema for the schema. It is passed to the providers.\n   */\n  readonly jsonSchema: JSONSchema7;\n};\n\n/**\n * Creates a schema with deferred creation.\n * This is important to reduce the startup time of the library\n * and to avoid initializing unused validators.\n *\n * @param createValidator A function that creates a schema.\n * @returns A function that returns a schema.\n */\nexport function lazySchema<SCHEMA>(\n  createSchema: () => Schema<SCHEMA>,\n): LazySchema<SCHEMA> {\n  // cache the validator to avoid initializing it multiple times\n  let schema: Schema<SCHEMA> | undefined;\n  return () => {\n    if (schema == null) {\n      schema = createSchema();\n    }\n    return schema;\n  };\n}\n\nexport type LazySchema<SCHEMA> = () => Schema<SCHEMA>;\n\n// Note: Zod types here exactly match the types in zod-schema.ts\n// to prevent type errors when using zod schemas with flexible schemas.\nexport type FlexibleSchema<SCHEMA> =\n  | z4.core.$ZodType<SCHEMA, any>\n  | z3.Schema<SCHEMA, z3.ZodTypeDef, any>\n  | Schema<SCHEMA>\n  | LazySchema<SCHEMA>;\n\nexport type InferSchema<SCHEMA> = SCHEMA extends z3.Schema\n  ? z3.infer<SCHEMA>\n  : SCHEMA extends z4.core.$ZodType\n    ? z4.infer<SCHEMA>\n    : SCHEMA extends LazySchema<infer T>\n      ? T\n      : SCHEMA extends Schema<infer T>\n        ? T\n        : never;\n\n/**\n * Create a schema using a JSON Schema.\n *\n * @param jsonSchema The JSON Schema for the schema.\n * @param options.validate Optional. A validation function for the schema.\n */\nexport function jsonSchema<OBJECT = unknown>(\n  jsonSchema: JSONSchema7 | (() => JSONSchema7),\n  {\n    validate,\n  }: {\n    validate?: (\n      value: unknown,\n    ) => ValidationResult<OBJECT> | PromiseLike<ValidationResult<OBJECT>>;\n  } = {},\n): Schema<OBJECT> {\n  return {\n    [schemaSymbol]: true,\n    _type: undefined as OBJECT, // should never be used directly\n    [validatorSymbol]: true,\n    get jsonSchema() {\n      if (typeof jsonSchema === 'function') {\n        jsonSchema = jsonSchema(); // cache the function results\n      }\n      return jsonSchema;\n    },\n    validate,\n  };\n}\n\nfunction isSchema(value: unknown): value is Schema {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    schemaSymbol in value &&\n    value[schemaSymbol] === true &&\n    'jsonSchema' in value &&\n    'validate' in value\n  );\n}\n\nexport function asSchema<OBJECT>(\n  schema: FlexibleSchema<OBJECT> | undefined,\n): Schema<OBJECT> {\n  return schema == null\n    ? jsonSchema({\n        properties: {},\n        additionalProperties: false,\n      })\n    : isSchema(schema)\n      ? schema\n      : typeof schema === 'function'\n        ? schema()\n        : zodSchema(schema);\n}\n","// btoa and atob need to be invoked as a function call, not as a method call.\n// Otherwise CloudFlare will throw a\n// \"TypeError: Illegal invocation: function called with incorrect this reference\"\nconst { btoa, atob } = globalThis;\n\nexport function convertBase64ToUint8Array(base64String: string) {\n  const base64Url = base64String.replace(/-/g, '+').replace(/_/g, '/');\n  const latin1string = atob(base64Url);\n  return Uint8Array.from(latin1string, byte => byte.codePointAt(0)!);\n}\n\nexport function convertUint8ArrayToBase64(array: Uint8Array): string {\n  let latin1string = '';\n\n  // Note: regular for loop to support older JavaScript versions that\n  // do not support for..of on Uint8Array\n  for (let i = 0; i < array.length; i++) {\n    latin1string += String.fromCodePoint(array[i]);\n  }\n\n  return btoa(latin1string);\n}\n\nexport function convertToBase64(value: string | Uint8Array): string {\n  return value instanceof Uint8Array ? convertUint8ArrayToBase64(value) : value;\n}\n","export function withoutTrailingSlash(url: string | undefined) {\n  return url?.replace(/\\/$/, '');\n}\n"],"names":["_AISDKError","name","marker","symbol","_a","_TypeValidationError","resolve","getErrorMessage","APICallError","validator","TypeValidationError","getOriginalFetch","tool","ZodFirstPartyTypeKind","types","x","jsonSchema","schema","zodSchema"],"mappings":"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"}},
    {"offset": {"line": 2441, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-FJEVLHJT.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/error/utils.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/error/index.ts"],"sourcesContent":["/**\n * Safely converts an object to a string representation.\n * Uses JSON.stringify first, but falls back to String() if:\n * - JSON.stringify fails (e.g., circular references)\n * - JSON.stringify returns \"{}\" (e.g., Error objects with no enumerable properties)\n */\nexport function safeParseErrorObject(obj: unknown): string {\n  if (typeof obj !== 'object' || obj === null) {\n    return String(obj);\n  }\n\n  try {\n    const stringified = JSON.stringify(obj);\n    // If JSON.stringify returns \"{}\", fall back to String() for better representation\n    if (stringified === '{}') {\n      return String(obj);\n    }\n    return stringified;\n  } catch {\n    // Fallback to String() if JSON.stringify fails (e.g., circular references)\n    return String(obj);\n  }\n}\n\n/**\n * Represents a serialized error structure for JSON output.\n */\nexport type SerializedError = {\n  name: string;\n  message: string;\n  stack?: string;\n  cause?: SerializedError | unknown;\n} & Record<string, any>;\n\n/**\n * An Error instance with a toJSON method for proper serialization.\n */\nexport type SerializableError = Error & {\n  toJSON: () => SerializedError;\n};\n\n/**\n * Safely converts an unknown error to an Error instance.\n */\nexport function getErrorFromUnknown<SERIALIZABLE extends boolean = true>(\n  unknown: unknown,\n  options: {\n    /**\n     * The fallback error message to use if the unknown error cannot be parsed.\n     */\n    fallbackMessage?: string;\n    /**\n     * The maximum depth to parse the cause of the error.\n     */\n    maxDepth?: number;\n    /**\n     * Whether to add .toJSON() method to the error instance to support serialization. (JSON.stringify)\n     * @example\n     * const error = getErrorFromUnknown(new Error('test'), { supportSerialization: true });\n     * JSON.stringify(error) // { message: 'test', name: 'Error', stack: 'Error: test\\n    at ...' }\n     */\n    supportSerialization?: SERIALIZABLE;\n    /**\n     * Whether to include the stack in JSON serialization.\n     * The stack is always preserved on the Error instance for debugging.\n     * This option only controls whether it appears in toJSON() output.\n     * @default true\n     */\n    serializeStack?: boolean;\n  } = {},\n): SERIALIZABLE extends true ? SerializableError : Error {\n  const defaultOptions = {\n    fallbackMessage: 'Unknown error',\n    maxDepth: 5,\n    supportSerialization: true,\n    serializeStack: true,\n  };\n  const mergedOptions = options ? { ...defaultOptions, ...options } : defaultOptions;\n  const { fallbackMessage, maxDepth, supportSerialization, serializeStack } = mergedOptions;\n\n  if (unknown && unknown instanceof Error) {\n    // Stack is always preserved on the instance for debugging\n    // serializeStack only controls whether it appears in toJSON() output\n    if (supportSerialization) {\n      addErrorToJSON(unknown, serializeStack, { maxDepth });\n    }\n    return unknown as SERIALIZABLE extends true ? SerializableError : Error;\n  }\n\n  let error: Error | undefined;\n\n  if (unknown && typeof unknown === 'object') {\n    const errorMessage =\n      unknown && 'message' in unknown && typeof unknown.message === 'string'\n        ? unknown.message\n        : safeParseErrorObject(unknown);\n\n    const errorCause =\n      'cause' in unknown && unknown.cause !== undefined\n        ? unknown.cause instanceof Error\n          ? unknown.cause\n          : maxDepth > 0 // Only process cause if we haven't exceeded max depth\n            ? getErrorFromUnknown(unknown.cause, { ...mergedOptions, maxDepth: maxDepth - 1 })\n            : undefined\n        : undefined;\n\n    error = new Error(errorMessage, errorCause ? { cause: errorCause } : undefined);\n\n    Object.assign(error as Error, unknown);\n    error.stack = 'stack' in unknown && typeof unknown.stack === 'string' ? unknown.stack : undefined;\n  } else if (unknown && typeof unknown === 'string') {\n    error = new Error(unknown);\n    error.stack = undefined;\n  } else {\n    error = new Error(fallbackMessage);\n  }\n\n  if (supportSerialization) {\n    addErrorToJSON(error, serializeStack, { maxDepth });\n  }\n  return error as SERIALIZABLE extends true ? SerializableError : Error;\n}\n\nconst DEFAULT_MAX_DEPTH = 5;\n\n/**\n * Adds a toJSON method to an Error instance for proper serialization.\n * Ensures that message, name, cause, and custom properties are all serialized.\n * Stack is only included in JSON output if serializeStack is true.\n * Recursively adds toJSON to the cause chain for proper nested error serialization.\n */\nfunction addErrorToJSON(\n  error: Error,\n  serializeStack: boolean = true,\n  options?: { maxDepth?: number; currentDepth?: number },\n): void {\n  const maxDepth = options?.maxDepth ?? DEFAULT_MAX_DEPTH;\n  const currentDepth = options?.currentDepth ?? 0;\n\n  // Skip if error already has toJSON - preserves custom implementations\n  // and avoids re-processing (first call's options win)\n  if ((error as SerializableError).toJSON) {\n    return;\n  }\n\n  // Recursively add toJSON to cause chain (with depth protection)\n  if (error.cause instanceof Error && currentDepth < maxDepth) {\n    addErrorToJSON(error.cause, serializeStack, { maxDepth, currentDepth: currentDepth + 1 });\n  }\n\n  // Define toJSON as non-enumerable to avoid interfering with object comparisons\n  Object.defineProperty(error, 'toJSON', {\n    value: function (this: Error) {\n      const json: SerializedError = {\n        message: this.message,\n        name: this.name,\n      };\n      // Only include stack in JSON if serializeStack is true\n      if (serializeStack && this.stack !== undefined) {\n        json.stack = this.stack;\n      }\n\n      // Serialize cause if it's an Error and has a toJSON method, else include as is\n      if (this.cause !== undefined) {\n        if (this.cause instanceof Error && 'toJSON' in this.cause && typeof this.cause.toJSON === 'function') {\n          json.cause = this.cause.toJSON();\n        } else {\n          json.cause = this.cause;\n        }\n      }\n\n      // Include all enumerable custom properties\n      const errorAsAny = this as any;\n      for (const key in errorAsAny) {\n        if (errorAsAny.hasOwnProperty(key) && !(key in json) && key !== 'toJSON') {\n          json[key] = errorAsAny[key];\n        }\n      }\n\n      return json;\n    },\n    enumerable: false,\n    writable: true,\n    configurable: true,\n  });\n}\n","import { getErrorFromUnknown } from './utils.js';\nimport type { SerializableError, SerializedError } from './utils.js';\n\nexport { getErrorFromUnknown };\nexport type { SerializableError, SerializedError };\n\nexport enum ErrorDomain {\n  TOOL = 'TOOL',\n  AGENT = 'AGENT',\n  MCP = 'MCP',\n  AGENT_NETWORK = 'AGENT_NETWORK',\n  MASTRA_SERVER = 'MASTRA_SERVER',\n  MASTRA_OBSERVABILITY = 'MASTRA_OBSERVABILITY',\n  MASTRA_WORKFLOW = 'MASTRA_WORKFLOW',\n  MASTRA_VOICE = 'MASTRA_VOICE',\n  MASTRA_VECTOR = 'MASTRA_VECTOR',\n  MASTRA_MEMORY = 'MASTRA_MEMORY',\n  LLM = 'LLM',\n  EVAL = 'EVAL',\n  SCORER = 'SCORER',\n  A2A = 'A2A',\n  MASTRA_INSTANCE = 'MASTRA_INSTANCE',\n  MASTRA = 'MASTRA',\n  DEPLOYER = 'DEPLOYER',\n  STORAGE = 'STORAGE',\n  MODEL_ROUTER = 'MODEL_ROUTER',\n}\n\nexport enum ErrorCategory {\n  UNKNOWN = 'UNKNOWN',\n  USER = 'USER',\n  SYSTEM = 'SYSTEM',\n  THIRD_PARTY = 'THIRD_PARTY',\n}\n\ntype Scalar = null | boolean | number | string;\n\ntype Json<T> = [T] extends [Scalar | undefined]\n  ? Scalar\n  : [T] extends [{ [x: number]: unknown }]\n    ? { [K in keyof T]: Json<T[K]> }\n    : never;\n\n/**\n * Defines the structure for an error's metadata.\n * This is used to create instances of MastraError.\n */\nexport interface IErrorDefinition<DOMAIN, CATEGORY> {\n  /** Unique identifier for the error. */\n  id: Uppercase<string>;\n  /**\n   * Optional custom error message that overrides the original error message.\n   * If not provided, the original error message will be used, or 'Unknown error' if no error is provided.\n   */\n  text?: string;\n  /**\n   * Functional domain of the error (e.g., CONFIG, BUILD, API).\n   */\n  domain: DOMAIN;\n  /** Broad category of the error (e.g., USER, SYSTEM, THIRD_PARTY). */\n  category: CATEGORY;\n\n  details?: Record<string, Json<Scalar>>;\n}\n\n/**\n * JSON representation of a MastraError for serialization\n */\nexport interface MastraErrorJSON<DOMAIN = string, CATEGORY = string> {\n  message: string;\n  code: Uppercase<string>;\n  category: CATEGORY;\n  domain: DOMAIN;\n  details?: Record<string, Json<Scalar>>;\n  cause?: ReturnType<SerializableError['toJSON']>;\n}\n\n/**\n * Base error class for the Mastra ecosystem.\n * It standardizes error reporting and can be extended for more specific error types.\n */\nexport class MastraBaseError<DOMAIN, CATEGORY> extends Error {\n  public readonly id: Uppercase<string>;\n  public readonly domain: DOMAIN;\n  public readonly category: CATEGORY;\n  public readonly details?: Record<string, Json<Scalar>> = {};\n  public readonly message: string;\n  public cause?: SerializableError;\n\n  constructor(\n    errorDefinition: IErrorDefinition<DOMAIN, CATEGORY>,\n    originalError?: string | Error | MastraBaseError<DOMAIN, CATEGORY> | unknown,\n  ) {\n    const error = originalError\n      ? getErrorFromUnknown(originalError, {\n          serializeStack: false,\n          fallbackMessage: 'Unknown error',\n        })\n      : undefined;\n\n    const message = errorDefinition.text ?? error?.message ?? 'Unknown error';\n\n    super(message, { cause: error });\n    this.id = errorDefinition.id;\n    this.domain = errorDefinition.domain;\n    this.category = errorDefinition.category;\n    this.details = errorDefinition.details ?? {};\n    this.message = message;\n    this.cause = error;\n\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  /**\n   * Returns a structured representation of the error, useful for logging or API responses.\n   */\n  public toJSONDetails() {\n    return {\n      message: this.message,\n      domain: this.domain,\n      category: this.category,\n      details: this.details,\n    };\n  }\n\n  public toJSON(): MastraErrorJSON<DOMAIN, CATEGORY> {\n    return {\n      message: this.message,\n      domain: this.domain,\n      category: this.category,\n      code: this.id,\n      details: this.details,\n      cause: this.cause?.toJSON?.(),\n    };\n  }\n\n  public toString() {\n    return JSON.stringify(this.toJSON());\n  }\n}\n\nexport class MastraError extends MastraBaseError<`${ErrorDomain}`, `${ErrorCategory}`> {}\n"],"names":["ErrorDomain","ErrorCategory"],"mappings":"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"}},
    {"offset": {"line": 2642, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-NRUZYMHE.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/logger/constants.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/logger/logger.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/logger/default-logger.ts"],"sourcesContent":["// Constants and Types (keeping from original implementation)\nexport const RegisteredLogger = {\n  AGENT: 'AGENT',\n  OBSERVABILITY: 'OBSERVABILITY',\n  AUTH: 'AUTH',\n  NETWORK: 'NETWORK',\n  WORKFLOW: 'WORKFLOW',\n  LLM: 'LLM',\n  TTS: 'TTS',\n  VOICE: 'VOICE',\n  VECTOR: 'VECTOR',\n  BUNDLER: 'BUNDLER',\n  DEPLOYER: 'DEPLOYER',\n  MEMORY: 'MEMORY',\n  STORAGE: 'STORAGE',\n  EMBEDDINGS: 'EMBEDDINGS',\n  MCP_SERVER: 'MCP_SERVER',\n  SERVER_CACHE: 'SERVER_CACHE',\n  SERVER: 'SERVER',\n} as const;\n\nexport type RegisteredLogger = (typeof RegisteredLogger)[keyof typeof RegisteredLogger];\n\nexport const LogLevel = {\n  DEBUG: 'debug',\n  INFO: 'info',\n  WARN: 'warn',\n  ERROR: 'error',\n  NONE: 'silent',\n} as const;\n\nexport type LogLevel = (typeof LogLevel)[keyof typeof LogLevel];\n","import type { MastraError } from '../error';\nimport { LogLevel } from './constants';\nimport type { BaseLogMessage, LoggerTransport } from './transport';\n\nexport interface IMastraLogger {\n  debug(message: string, ...args: any[]): void;\n  info(message: string, ...args: any[]): void;\n  warn(message: string, ...args: any[]): void;\n  error(message: string, ...args: any[]): void;\n  trackException(error: MastraError): void;\n\n  getTransports(): Map<string, LoggerTransport>;\n  listLogs(\n    _transportId: string,\n    _params?: {\n      fromDate?: Date;\n      toDate?: Date;\n      logLevel?: LogLevel;\n      filters?: Record<string, any>;\n      page?: number;\n      perPage?: number;\n    },\n  ): Promise<{ logs: BaseLogMessage[]; total: number; page: number; perPage: number; hasMore: boolean }>;\n  listLogsByRunId(_args: {\n    transportId: string;\n    runId: string;\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    page?: number;\n    perPage?: number;\n  }): Promise<{ logs: BaseLogMessage[]; total: number; page: number; perPage: number; hasMore: boolean }>;\n}\n\nexport abstract class MastraLogger implements IMastraLogger {\n  protected name: string;\n  protected level: LogLevel;\n  protected transports: Map<string, LoggerTransport>;\n\n  constructor(\n    options: {\n      name?: string;\n      level?: LogLevel;\n      transports?: Record<string, LoggerTransport>;\n    } = {},\n  ) {\n    this.name = options.name || 'Mastra';\n    this.level = options.level || LogLevel.ERROR;\n    this.transports = new Map(Object.entries(options.transports || {}));\n  }\n\n  abstract debug(message: string, ...args: any[]): void;\n  abstract info(message: string, ...args: any[]): void;\n  abstract warn(message: string, ...args: any[]): void;\n  abstract error(message: string, ...args: any[]): void;\n\n  getTransports() {\n    return this.transports;\n  }\n\n  trackException(_error: MastraError) {}\n\n  async listLogs(\n    transportId: string,\n    params?: {\n      fromDate?: Date;\n      toDate?: Date;\n      logLevel?: LogLevel;\n      filters?: Record<string, any>;\n      page?: number;\n      perPage?: number;\n    },\n  ) {\n    if (!transportId || !this.transports.has(transportId)) {\n      return { logs: [], total: 0, page: params?.page ?? 1, perPage: params?.perPage ?? 100, hasMore: false };\n    }\n\n    return (\n      this.transports.get(transportId)!.listLogs(params) ?? {\n        logs: [],\n        total: 0,\n        page: params?.page ?? 1,\n        perPage: params?.perPage ?? 100,\n        hasMore: false,\n      }\n    );\n  }\n\n  async listLogsByRunId({\n    transportId,\n    runId,\n    fromDate,\n    toDate,\n    logLevel,\n    filters,\n    page,\n    perPage,\n  }: {\n    transportId: string;\n    runId: string;\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    page?: number;\n    perPage?: number;\n  }) {\n    if (!transportId || !this.transports.has(transportId) || !runId) {\n      return { logs: [], total: 0, page: page ?? 1, perPage: perPage ?? 100, hasMore: false };\n    }\n\n    return (\n      this.transports\n        .get(transportId)!\n        .listLogsByRunId({ runId, fromDate, toDate, logLevel, filters, page, perPage }) ?? {\n        logs: [],\n        total: 0,\n        page: page ?? 1,\n        perPage: perPage ?? 100,\n        hasMore: false,\n      }\n    );\n  }\n}\n","import { LogLevel } from './constants';\nimport { MastraLogger } from './logger';\nimport type { LoggerTransport } from './transport';\n\nexport const createLogger = (options: {\n  name?: string;\n  level?: LogLevel;\n  transports?: Record<string, LoggerTransport>;\n}) => {\n  const logger = new ConsoleLogger(options);\n\n  logger.warn(`createLogger is deprecated. Please use \"new ConsoleLogger()\" from \"@mastra/core/logger\" instead.`);\n\n  return logger;\n};\n\nexport class ConsoleLogger extends MastraLogger {\n  constructor(\n    options: {\n      name?: string;\n      level?: LogLevel;\n    } = {},\n  ) {\n    super(options);\n  }\n\n  debug(message: string, ...args: any[]): void {\n    if (this.level === LogLevel.DEBUG) {\n      console.info(message, ...args);\n    }\n  }\n\n  info(message: string, ...args: any[]): void {\n    if (this.level === LogLevel.INFO || this.level === LogLevel.DEBUG) {\n      console.info(message, ...args);\n    }\n  }\n\n  warn(message: string, ...args: any[]): void {\n    if (this.level === LogLevel.WARN || this.level === LogLevel.INFO || this.level === LogLevel.DEBUG) {\n      console.info(message, ...args);\n    }\n  }\n\n  error(message: string, ...args: any[]): void {\n    if (\n      this.level === LogLevel.ERROR ||\n      this.level === LogLevel.WARN ||\n      this.level === LogLevel.INFO ||\n      this.level === LogLevel.DEBUG\n    ) {\n      console.error(message, ...args);\n    }\n  }\n\n  async listLogs(\n    _transportId: string,\n    _params?: {\n      fromDate?: Date;\n      toDate?: Date;\n      logLevel?: LogLevel;\n      filters?: Record<string, any>;\n      page?: number;\n      perPage?: number;\n    },\n  ) {\n    return { logs: [], total: 0, page: _params?.page ?? 1, perPage: _params?.perPage ?? 100, hasMore: false };\n  }\n\n  async listLogsByRunId(_args: {\n    transportId: string;\n    runId: string;\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    page?: number;\n    perPage?: number;\n  }) {\n    return { logs: [], total: 0, page: _args.page ?? 1, perPage: _args.perPage ?? 100, hasMore: false };\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2796, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-LSHPJWM5.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/base.ts"],"sourcesContent":["import type { IMastraLogger } from './logger';\nimport { RegisteredLogger } from './logger/constants';\nimport { ConsoleLogger } from './logger/default-logger';\n\nexport class MastraBase {\n  component: RegisteredLogger = RegisteredLogger.LLM;\n  protected logger: IMastraLogger;\n  name?: string;\n\n  constructor({ component, name }: { component?: RegisteredLogger; name?: string }) {\n    this.component = component || RegisteredLogger.LLM;\n    this.name = name;\n    this.logger = new ConsoleLogger({ name: `${this.component} - ${this.name}` });\n  }\n\n  /**\n   * Set the logger for the agent\n   * @param logger\n   */\n  __setLogger(logger: IMastraLogger) {\n    this.logger = logger;\n\n    if (this.component !== RegisteredLogger.LLM) {\n      this.logger.debug(`Logger updated [component=${this.component}] [name=${this.name}]`);\n    }\n  }\n}\n\nexport * from './types';\n"],"names":[],"mappings":";;;;;;;AAIO,IAAM,aAAN,MAAiB;IACtB,YAA8B,mLAAA,CAAiB,GAAA,CAAA;IACrC,MAAA,CAAA;IACV,IAAA,CAAA;IAEA,WAAA,CAAY,EAAE,SAAA,EAAW,IAAA,EAAK,CAAoD;QAChF,IAAA,CAAK,SAAA,GAAY,aAAa,mLAAA,CAAiB,GAAA;QAC/C,IAAA,CAAK,IAAA,GAAO,IAAA;QACZ,IAAA,CAAK,MAAA,GAAS,IAAI,gLAAA,CAAc;YAAE,IAAA,EAAM,CAAA,EAAG,IAAA,CAAK,SAAS,CAAA,GAAA,EAAM,IAAA,CAAK,IAAI,CAAA,CAAA;QAAA,CAAI,CAAA;IAC9E;IAAA;;;GAAA,GAMA,YAAY,MAAA,EAAuB;QACjC,IAAA,CAAK,MAAA,GAAS,MAAA;QAEd,IAAI,IAAA,CAAK,SAAA,KAAc,mLAAA,CAAiB,GAAA,EAAK;YAC3C,IAAA,CAAK,MAAA,CAAO,KAAA,CAAM,CAAA,0BAAA,EAA6B,IAAA,CAAK,SAAS,CAAA,QAAA,EAAW,IAAA,CAAK,IAAI,CAAA,CAAA,CAAG,CAAA;QACtF;IACF;AACF"}},
    {"offset": {"line": 2831, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-TX5GUG5Q.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/voice/voice.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/voice/aisdk/speech.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/voice/aisdk/transcription.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/voice/composite-voice.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/voice/default-voice.ts"],"sourcesContent":["import type { ToolsInput } from '../agent';\nimport { MastraBase } from '../base';\n\nexport type VoiceEventType = 'speaking' | 'writing' | 'error' | string;\n\nexport interface VoiceEventMap {\n  speaker: NodeJS.ReadableStream;\n  speaking: { audio?: string };\n  writing: { text: string; role: 'assistant' | 'user' };\n  error: { message: string; code?: string; details?: unknown };\n  [key: string]: unknown;\n}\n\ninterface BuiltInModelConfig {\n  name: string;\n  apiKey?: string;\n}\n\nexport interface VoiceConfig<T = unknown> {\n  listeningModel?: BuiltInModelConfig;\n  speechModel?: BuiltInModelConfig;\n  speaker?: string;\n  name?: string;\n  realtimeConfig?: {\n    model?: string;\n    apiKey?: string;\n    options?: T;\n  };\n}\n\nexport abstract class MastraVoice<\n  TOptions = unknown,\n  TSpeakOptions = unknown,\n  TListenOptions = unknown,\n  TTools extends ToolsInput = ToolsInput,\n  TEventArgs extends VoiceEventMap = VoiceEventMap,\n  TSpeakerMetadata = unknown,\n> extends MastraBase {\n  protected listeningModel?: BuiltInModelConfig;\n  protected speechModel?: BuiltInModelConfig;\n  protected speaker?: string;\n  protected realtimeConfig?: {\n    model?: string;\n    apiKey?: string;\n    options?: TOptions;\n  };\n\n  constructor({ listeningModel, speechModel, speaker, realtimeConfig, name }: VoiceConfig<TOptions> = {}) {\n    super({\n      component: 'VOICE',\n      name,\n    });\n    this.listeningModel = listeningModel;\n    this.speechModel = speechModel;\n    this.speaker = speaker;\n    this.realtimeConfig = realtimeConfig;\n  }\n\n  /**\n   * Convert text to speech\n   * @param input Text or text stream to convert to speech\n   * @param options Speech options including speaker and provider-specific options\n   * @returns Audio stream\n   */\n  /**\n   * Convert text to speech\n   * @param input Text or text stream to convert to speech\n   * @param options Speech options including speaker and provider-specific options\n   * @returns Audio stream or void if in chat mode\n   */\n  abstract speak(\n    input: string | NodeJS.ReadableStream,\n    options?: {\n      speaker?: string;\n    } & TSpeakOptions,\n  ): Promise<NodeJS.ReadableStream | void>;\n\n  /**\n   * Convert speech to text\n   * @param audioStream Audio stream to transcribe\n   * @param options Provider-specific transcription options\n   * @returns Text or text stream\n   */\n  /**\n   * Convert speech to text\n   * @param audioStream Audio stream to transcribe\n   * @param options Provider-specific transcription options\n   * @returns Text, text stream, or void if in chat mode\n   */\n  abstract listen(\n    audioStream: NodeJS.ReadableStream | unknown, // Allow other audio input types for OpenAI realtime API\n    options?: TListenOptions,\n  ): Promise<string | NodeJS.ReadableStream | void>;\n\n  updateConfig(_options: Record<string, unknown>): void {\n    this.logger.warn('updateConfig not implemented by this voice provider');\n  }\n\n  /**\n   * Initializes a WebSocket or WebRTC connection for real-time communication\n   * @returns Promise that resolves when the connection is established\n   */\n  connect(_options?: Record<string, unknown>): Promise<void> {\n    // Default implementation - voice providers can override if they support this feature\n    this.logger.warn('connect not implemented by this voice provider');\n    return Promise.resolve();\n  }\n\n  /**\n   * Relay audio data to the voice provider for real-time processing\n   * @param audioData Audio data to relay\n   */\n  send(_audioData: NodeJS.ReadableStream | Int16Array): Promise<void> {\n    // Default implementation - voice providers can override if they support this feature\n    this.logger.warn('relay not implemented by this voice provider');\n    return Promise.resolve();\n  }\n\n  /**\n   * Trigger voice providers to respond\n   */\n  answer(_options?: Record<string, unknown>): Promise<void> {\n    this.logger.warn('answer not implemented by this voice provider');\n    return Promise.resolve();\n  }\n\n  /**\n   * Equip the voice provider with instructions\n   * @param instructions Instructions to add\n   */\n  addInstructions(_instructions?: string): void {\n    // Default implementation - voice providers can override if they support this feature\n  }\n\n  /**\n   * Equip the voice provider with tools\n   * @param tools Array of tools to add\n   */\n  addTools(_tools: TTools): void {\n    // Default implementation - voice providers can override if they support this feature\n  }\n\n  /**\n   * Disconnect from the WebSocket or WebRTC connection\n   */\n  close(): void {\n    // Default implementation - voice providers can override if they support this feature\n    this.logger.warn('close not implemented by this voice provider');\n  }\n\n  /**\n   * Register an event listener\n   * @param event Event name (e.g., 'speaking', 'writing', 'error')\n   * @param callback Callback function that receives event data\n   */\n  on<E extends VoiceEventType>(\n    _event: E,\n    _callback: (data: E extends keyof TEventArgs ? TEventArgs[E] : unknown) => void,\n  ): void {\n    // Default implementation - voice providers can override if they support this feature\n    this.logger.warn('on not implemented by this voice provider');\n  }\n\n  /**\n   * Remove an event listener\n   * @param event Event name (e.g., 'speaking', 'writing', 'error')\n   * @param callback Callback function to remove\n   */\n  off<E extends VoiceEventType>(\n    _event: E,\n    _callback: (data: E extends keyof TEventArgs ? TEventArgs[E] : unknown) => void,\n  ): void {\n    // Default implementation - voice providers can override if they support this feature\n    this.logger.warn('off not implemented by this voice provider');\n  }\n\n  /**\n   * Get available speakers/voices\n   * @returns Array of available voice IDs and their metadata\n   */\n  getSpeakers(): Promise<\n    Array<\n      {\n        voiceId: string;\n      } & TSpeakerMetadata\n    >\n  > {\n    // Default implementation - voice providers can override if they support this feature\n    this.logger.warn('getSpeakers not implemented by this voice provider');\n    return Promise.resolve([]);\n  }\n\n  /**\n   * Get available speakers/voices\n   * @returns Array of available voice IDs and their metadata\n   */\n  getListener(): Promise<{ enabled: boolean }> {\n    // Default implementation - voice providers can override if they support this feature\n    this.logger.warn('getListener not implemented by this voice provider');\n    return Promise.resolve({ enabled: false });\n  }\n}\n","import { PassThrough } from 'node:stream';\nimport { experimental_generateSpeech } from '@internal/ai-sdk-v5';\nimport type { SpeechModel } from '@internal/ai-sdk-v5';\nimport { MastraVoice } from '../voice';\n\nexport class AISDKSpeech extends MastraVoice {\n  private model: SpeechModel;\n  private defaultVoice?: string;\n\n  constructor(model: SpeechModel, options?: { voice?: string }) {\n    super({ name: 'ai-sdk-speech' });\n    this.model = model;\n    this.defaultVoice = options?.voice;\n  }\n\n  async speak(\n    input: string | NodeJS.ReadableStream,\n    options?: {\n      speaker?: string;\n      language?: string;\n      providerOptions?: Record<string, any>;\n      abortSignal?: AbortSignal;\n      headers?: Record<string, string>;\n    },\n  ): Promise<NodeJS.ReadableStream> {\n    // Convert stream to text if needed\n    const text = typeof input === 'string' ? input : await this.streamToText(input);\n\n    const result = await experimental_generateSpeech({\n      model: this.model,\n      text,\n      voice: options?.speaker || this.defaultVoice, // Map speaker to AI SDK's voice parameter\n      language: options?.language,\n      providerOptions: options?.providerOptions,\n      abortSignal: options?.abortSignal,\n      headers: options?.headers,\n    });\n\n    // Convert Uint8Array to Node stream\n    const stream = new PassThrough();\n    stream.end(Buffer.from(result.audio.uint8Array));\n    return stream;\n  }\n\n  async listen(): Promise<string> {\n    throw new Error('AI SDK speech models do not support transcription. Use AISDKTranscription instead.');\n  }\n\n  async getSpeakers() {\n    // Return empty array - voice must be specified in speak() options\n    return [];\n  }\n\n  async getListener() {\n    return { enabled: false };\n  }\n\n  private async streamToText(stream: NodeJS.ReadableStream): Promise<string> {\n    const chunks: Buffer[] = [];\n    for await (const chunk of stream) {\n      chunks.push(Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk));\n    }\n    return Buffer.concat(chunks).toString('utf-8');\n  }\n}\n","import { experimental_transcribe } from '@internal/ai-sdk-v5';\nimport type { TranscriptionModel } from '@internal/ai-sdk-v5';\nimport { MastraVoice } from '../voice';\n\nexport class AISDKTranscription extends MastraVoice {\n  private model: TranscriptionModel;\n\n  constructor(model: TranscriptionModel) {\n    super({ name: 'ai-sdk-transcription' });\n    this.model = model;\n  }\n\n  async speak(): Promise<NodeJS.ReadableStream> {\n    throw new Error('AI SDK transcription models do not support text-to-speech. Use AISDKSpeech instead.');\n  }\n\n  async getSpeakers() {\n    return [];\n  }\n\n  async getListener() {\n    return { enabled: true };\n  }\n\n  /**\n   * Transcribe audio to text\n   * For enhanced metadata (segments, language, duration), use AI SDK's transcribe() directly\n   */\n  async listen(\n    audioStream: NodeJS.ReadableStream,\n    options?: {\n      providerOptions?: Record<string, any>;\n      abortSignal?: AbortSignal;\n      headers?: Record<string, string>;\n    },\n  ): Promise<string> {\n    const audioBuffer = await this.convertToBuffer(audioStream);\n\n    const result = await experimental_transcribe({\n      model: this.model,\n      audio: audioBuffer,\n      providerOptions: options?.providerOptions,\n      abortSignal: options?.abortSignal,\n      headers: options?.headers,\n    });\n\n    return result.text;\n  }\n\n  private async convertToBuffer(audio: NodeJS.ReadableStream | Buffer | Uint8Array | string): Promise<Buffer> {\n    if (Buffer.isBuffer(audio)) return audio;\n    if (audio instanceof Uint8Array) return Buffer.from(audio);\n    if (typeof audio === 'string') return Buffer.from(audio, 'base64');\n\n    const chunks: Buffer[] = [];\n    for await (const chunk of audio) {\n      chunks.push(Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk));\n    }\n    return Buffer.concat(chunks);\n  }\n}\n","import type { TranscriptionModel, SpeechModel } from '@internal/ai-sdk-v5';\n\nimport type { ToolsInput } from '../agent';\nimport { MastraError, ErrorDomain, ErrorCategory } from '../error';\n\nimport { AISDKSpeech } from './aisdk/speech';\nimport { AISDKTranscription } from './aisdk/transcription';\nimport { MastraVoice } from './voice';\nimport type { VoiceEventType, VoiceEventMap } from '.';\n\nconst supportedSpecificationVersions = ['v2', 'v3'];\n\n// Helper to check if something is an AI SDK model\nfunction isTranscriptionModel(obj: any): obj is TranscriptionModel {\n  return (\n    obj && typeof obj === 'object' && obj.modelId && supportedSpecificationVersions.includes(obj.specificationVersion)\n  );\n}\n\nfunction isSpeechModel(obj: any): obj is SpeechModel {\n  return (\n    obj && typeof obj === 'object' && obj.modelId && supportedSpecificationVersions.includes(obj.specificationVersion)\n  );\n}\n\nexport class CompositeVoice extends MastraVoice<unknown, unknown, unknown, ToolsInput, VoiceEventMap> {\n  protected speakProvider?: MastraVoice;\n  protected listenProvider?: MastraVoice;\n  protected realtimeProvider?: MastraVoice;\n\n  constructor({\n    input,\n    output,\n    realtime,\n  }: {\n    input?: MastraVoice | TranscriptionModel;\n    output?: MastraVoice | SpeechModel;\n    realtime?: MastraVoice;\n  }) {\n    super();\n\n    // Auto-wrap AI SDK models\n    if (input) {\n      this.listenProvider = isTranscriptionModel(input) ? new AISDKTranscription(input) : input;\n    }\n\n    if (output) {\n      this.speakProvider = isSpeechModel(output) ? new AISDKSpeech(output) : output;\n    }\n\n    this.realtimeProvider = realtime;\n  }\n\n  /**\n   * Convert text to speech using the configured provider\n   * @param input Text or text stream to convert to speech\n   * @param options Speech options including speaker and provider-specific options\n   * @returns Audio stream or void if in realtime mode\n   */\n  async speak(\n    input: string | NodeJS.ReadableStream,\n    options?: { speaker?: string } & any,\n  ): Promise<NodeJS.ReadableStream | void> {\n    if (this.realtimeProvider) {\n      return this.realtimeProvider.speak(input, options);\n    } else if (this.speakProvider) {\n      return this.speakProvider.speak(input, options);\n    }\n\n    throw new MastraError({\n      id: 'VOICE_COMPOSITE_NO_SPEAK_PROVIDER',\n      text: 'No speak provider or realtime provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n\n  async listen(audioStream: NodeJS.ReadableStream, options?: any) {\n    if (this.realtimeProvider) {\n      return await this.realtimeProvider.listen(audioStream, options);\n    } else if (this.listenProvider) {\n      return await this.listenProvider.listen(audioStream, options);\n    }\n\n    throw new MastraError({\n      id: 'VOICE_COMPOSITE_NO_LISTEN_PROVIDER',\n      text: 'No listen provider or realtime provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n\n  async getSpeakers() {\n    if (this.realtimeProvider) {\n      return this.realtimeProvider.getSpeakers();\n    } else if (this.speakProvider) {\n      return this.speakProvider.getSpeakers();\n    }\n\n    throw new MastraError({\n      id: 'VOICE_COMPOSITE_NO_SPEAKERS_PROVIDER',\n      text: 'No speak provider or realtime provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n\n  async getListener() {\n    if (this.realtimeProvider) {\n      return this.realtimeProvider.getListener();\n    } else if (this.listenProvider) {\n      return this.listenProvider.getListener();\n    }\n\n    throw new MastraError({\n      id: 'VOICE_COMPOSITE_NO_LISTENER_PROVIDER',\n      text: 'No listener provider or realtime provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n\n  updateConfig(options: Record<string, unknown>): void {\n    if (!this.realtimeProvider) {\n      return;\n    }\n    this.realtimeProvider.updateConfig(options);\n  }\n\n  /**\n   * Initializes a WebSocket or WebRTC connection for real-time communication\n   * @returns Promise that resolves when the connection is established\n   */\n  connect(options?: Record<string, unknown>): Promise<void> {\n    if (!this.realtimeProvider) {\n      throw new MastraError({\n        id: 'VOICE_COMPOSITE_NO_REALTIME_PROVIDER_CONNECT',\n        text: 'No realtime provider configured',\n        domain: ErrorDomain.MASTRA_VOICE,\n        category: ErrorCategory.USER,\n      });\n    }\n    return this.realtimeProvider.connect(options);\n  }\n\n  /**\n   * Relay audio data to the voice provider for real-time processing\n   * @param audioData Audio data to send\n   */\n  send(audioData: NodeJS.ReadableStream | Int16Array): Promise<void> {\n    if (!this.realtimeProvider) {\n      throw new MastraError({\n        id: 'VOICE_COMPOSITE_NO_REALTIME_PROVIDER_SEND',\n        text: 'No realtime provider configured',\n        domain: ErrorDomain.MASTRA_VOICE,\n        category: ErrorCategory.USER,\n      });\n    }\n    return this.realtimeProvider.send(audioData);\n  }\n\n  /**\n   * Trigger voice providers to respond\n   */\n  answer(options?: Record<string, unknown>): Promise<void> {\n    if (!this.realtimeProvider) {\n      throw new MastraError({\n        id: 'VOICE_COMPOSITE_NO_REALTIME_PROVIDER_ANSWER',\n        text: 'No realtime provider configured',\n        domain: ErrorDomain.MASTRA_VOICE,\n        category: ErrorCategory.USER,\n      });\n    }\n    return this.realtimeProvider.answer(options);\n  }\n\n  /**\n   * Equip the voice provider with instructions\n   * @param instructions Instructions to add\n   */\n  addInstructions(instructions: string): void {\n    if (!this.realtimeProvider) {\n      return;\n    }\n    this.realtimeProvider.addInstructions(instructions);\n  }\n\n  /**\n   * Equip the voice provider with tools\n   * @param tools Array of tools to add\n   */\n  addTools(tools: ToolsInput): void {\n    if (!this.realtimeProvider) {\n      return;\n    }\n    this.realtimeProvider.addTools(tools);\n  }\n\n  /**\n   * Disconnect from the WebSocket or WebRTC connection\n   */\n  close(): void {\n    if (!this.realtimeProvider) {\n      throw new MastraError({\n        id: 'VOICE_COMPOSITE_NO_REALTIME_PROVIDER_CLOSE',\n        text: 'No realtime provider configured',\n        domain: ErrorDomain.MASTRA_VOICE,\n        category: ErrorCategory.USER,\n      });\n    }\n    this.realtimeProvider.close();\n  }\n\n  /**\n   * Register an event listener\n   * @param event Event name (e.g., 'speaking', 'writing', 'error')\n   * @param callback Callback function that receives event data\n   */\n  on<E extends VoiceEventType>(\n    event: E,\n    callback: (data: E extends keyof VoiceEventMap ? VoiceEventMap[E] : unknown) => void,\n  ): void {\n    if (!this.realtimeProvider) {\n      throw new MastraError({\n        id: 'VOICE_COMPOSITE_NO_REALTIME_PROVIDER_ON',\n        text: 'No realtime provider configured',\n        domain: ErrorDomain.MASTRA_VOICE,\n        category: ErrorCategory.USER,\n      });\n    }\n    this.realtimeProvider.on(event, callback);\n  }\n\n  /**\n   * Remove an event listener\n   * @param event Event name (e.g., 'speaking', 'writing', 'error')\n   * @param callback Callback function to remove\n   */\n  off<E extends VoiceEventType>(\n    event: E,\n    callback: (data: E extends keyof VoiceEventMap ? VoiceEventMap[E] : unknown) => void,\n  ): void {\n    if (!this.realtimeProvider) {\n      throw new MastraError({\n        id: 'VOICE_COMPOSITE_NO_REALTIME_PROVIDER_OFF',\n        text: 'No realtime provider configured',\n        domain: ErrorDomain.MASTRA_VOICE,\n        category: ErrorCategory.USER,\n      });\n    }\n    this.realtimeProvider.off(event, callback);\n  }\n}\n","import { MastraError, ErrorDomain, ErrorCategory } from '../error';\nimport { MastraVoice } from '.';\n\nexport class DefaultVoice extends MastraVoice {\n  constructor() {\n    super();\n  }\n\n  async speak(_input: string | NodeJS.ReadableStream): Promise<NodeJS.ReadableStream> {\n    throw new MastraError({\n      id: 'VOICE_DEFAULT_NO_SPEAK_PROVIDER',\n      text: 'No voice provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n\n  async listen(_input: string | NodeJS.ReadableStream): Promise<string> {\n    throw new MastraError({\n      id: 'VOICE_DEFAULT_NO_LISTEN_PROVIDER',\n      text: 'No voice provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n\n  async getSpeakers(): Promise<{ voiceId: string }[]> {\n    throw new MastraError({\n      id: 'VOICE_DEFAULT_NO_SPEAKERS_PROVIDER',\n      text: 'No voice provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n\n  async getListener(): Promise<{ enabled: boolean }> {\n    throw new MastraError({\n      id: 'VOICE_DEFAULT_NO_LISTENER_PROVIDER',\n      text: 'No voice provider configured',\n      domain: ErrorDomain.MASTRA_VOICE,\n      category: ErrorCategory.USER,\n    });\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3260, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-YEQB4VUA.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/workflows/constants.ts"],"sourcesContent":["// symbol is used to not leak pubsub to the user\nexport const PUBSUB_SYMBOL = Symbol('pubsub');\nexport const STREAM_FORMAT_SYMBOL = Symbol('stream_format');\n"],"names":[],"mappings":";;;;;;;AACO,IAAM,aAAA,GAAA,aAAA,GAAA,OAAuB,QAAQ;AACrC,IAAM,oBAAA,GAAA,aAAA,GAAA,OAA8B,eAAe"}},
    {"offset": {"line": 3276, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-XKBYPAOY.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/observability/types/tracing.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/observability/no-op.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/observability/utils.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/observability/context.ts"],"sourcesContent":["/**\n * Tracing interfaces\n */\nimport type { MastraError } from '../../error';\nimport type { IMastraLogger } from '../../logger';\nimport type { Mastra } from '../../mastra';\nimport type { RequestContext } from '../../request-context';\nimport type { LanguageModelUsage, ProviderMetadata, StepStartPayload } from '../../stream/types';\nimport type { WorkflowRunStatus, WorkflowStepStatus } from '../../workflows';\n\n// ============================================================================\n// Span Types\n// ============================================================================\n\n/**\n * AI-specific span types with their associated metadata\n */\nexport enum SpanType {\n  /** Agent run - root span for agent processes */\n  AGENT_RUN = 'agent_run',\n  /** Generic span for custom operations */\n  GENERIC = 'generic',\n  /** Model generation with model calls, token usage, prompts, completions */\n  MODEL_GENERATION = 'model_generation',\n  /** Single model execution step within a generation (one API call) */\n  MODEL_STEP = 'model_step',\n  /** Individual model streaming chunk/event */\n  MODEL_CHUNK = 'model_chunk',\n  /** MCP (Model Context Protocol) tool execution */\n  MCP_TOOL_CALL = 'mcp_tool_call',\n  /** Input or Output Processor execution */\n  PROCESSOR_RUN = 'processor_run',\n  /** Function/tool execution with inputs, outputs, errors */\n  TOOL_CALL = 'tool_call',\n  /** Workflow run - root span for workflow processes */\n  WORKFLOW_RUN = 'workflow_run',\n  /** Workflow step execution with step status, data flow */\n  WORKFLOW_STEP = 'workflow_step',\n  /** Workflow conditional execution with condition evaluation */\n  WORKFLOW_CONDITIONAL = 'workflow_conditional',\n  /** Individual condition evaluation within conditional */\n  WORKFLOW_CONDITIONAL_EVAL = 'workflow_conditional_eval',\n  /** Workflow parallel execution */\n  WORKFLOW_PARALLEL = 'workflow_parallel',\n  /** Workflow loop execution */\n  WORKFLOW_LOOP = 'workflow_loop',\n  /** Workflow sleep operation */\n  WORKFLOW_SLEEP = 'workflow_sleep',\n  /** Workflow wait for event operation */\n  WORKFLOW_WAIT_EVENT = 'workflow_wait_event',\n}\n\nexport enum EntityType {\n  /** Agent/Model execution */\n  AGENT = 'agent',\n  /** Eval */\n  EVAL = 'eval',\n  /** Input Processor */\n  INPUT_PROCESSOR = 'input_processor',\n  /** Input Step Processor */\n  INPUT_STEP_PROCESSOR = 'input_step_processor',\n  /** Output Processor */\n  OUTPUT_PROCESSOR = 'output_processor',\n  /** Output Step Processor */\n  OUTPUT_STEP_PROCESSOR = 'output_step_processor',\n  /** Workflow Step */\n  WORKFLOW_STEP = 'workflow_step',\n  /** Tool */\n  TOOL = 'tool',\n  /** Workflow */\n  WORKFLOW_RUN = 'workflow_run',\n}\n\n// ============================================================================\n// Type-Specific Attributes Interfaces\n// ============================================================================\n\n/**\n * Base attributes that all spans can have\n */\nexport interface AIBaseAttributes {}\n\n/**\n * Agent Run attributes\n */\nexport interface AgentRunAttributes extends AIBaseAttributes {\n  /** Conversation/thread/session identifier for multi-turn interactions */\n  conversationId?: string;\n  /** Agent Instructions **/\n  instructions?: string;\n  /** Agent Prompt **/\n  prompt?: string;\n  /** Available tools for this execution */\n  availableTools?: string[];\n  /** Maximum steps allowed */\n  maxSteps?: number;\n}\n\n/**\n * Detailed breakdown of input token usage by type.\n * Based on OpenInference semantic conventions.\n */\nexport interface InputTokenDetails {\n  /** Regular text tokens (non-cached, non-audio, non-image) */\n  text?: number;\n  /** Tokens served from cache (cache hit/read) */\n  cacheRead?: number;\n  /** Tokens written to cache (cache creation - Anthropic only) */\n  cacheWrite?: number;\n  /** Audio input tokens */\n  audio?: number;\n  /** Image input tokens (includes PDF pages) */\n  image?: number;\n}\n\n/**\n * Detailed breakdown of output token usage by type.\n * Based on OpenInference semantic conventions.\n */\nexport interface OutputTokenDetails {\n  /** Regular text output tokens */\n  text?: number;\n  /** Reasoning/thinking tokens (o1, Claude thinking, Gemini thoughts) */\n  reasoning?: number;\n  /** Audio output tokens */\n  audio?: number;\n  /** Image output tokens (DALL-E, etc.) */\n  image?: number;\n}\n\n/** Token usage statistics */\nexport interface UsageStats {\n  /** Total input tokens (sum of all input details) */\n  inputTokens?: number;\n  /** Total output tokens (sum of all output details) */\n  outputTokens?: number;\n  /** Detailed breakdown of input token usage */\n  inputDetails?: InputTokenDetails;\n  /** Detailed breakdown of output token usage */\n  outputDetails?: OutputTokenDetails;\n}\n\n/**\n * Model Generation attributes\n */\nexport interface ModelGenerationAttributes extends AIBaseAttributes {\n  /** Model name (e.g., 'gpt-4', 'claude-3') */\n  model?: string;\n  /** Model provider (e.g., 'openai', 'anthropic') */\n  provider?: string;\n  /** Type of result/output this LLM call produced */\n  resultType?: 'tool_selection' | 'response_generation' | 'reasoning' | 'planning';\n  /** Token usage statistics */\n  usage?: UsageStats;\n  /** Model parameters */\n  parameters?: {\n    maxOutputTokens?: number;\n    temperature?: number;\n    topP?: number;\n    topK?: number;\n    presencePenalty?: number;\n    frequencyPenalty?: number;\n    stopSequences?: string[];\n    seed?: number;\n    maxRetries?: number;\n    abortSignal?: any;\n    headers?: Record<string, string | undefined>;\n  };\n  /** Whether this was a streaming response */\n  streaming?: boolean;\n  /** Reason the generation finished */\n  finishReason?: string;\n  /**\n   * When the first token/chunk of the completion was received.\n   * Used to calculate time-to-first-token (TTFT) metrics.\n   * Only applicable for streaming responses.\n   */\n  completionStartTime?: Date;\n  /** Actual model used in the response (may differ from request model) */\n  responseModel?: string;\n  /** Unique identifier for the response */\n  responseId?: string;\n  /** Server address for the model endpoint */\n  serverAddress?: string;\n  /** Server port for the model endpoint */\n  serverPort?: number;\n}\n\n/**\n * Model Step attributes - for a single model execution within a generation\n */\nexport interface ModelStepAttributes extends AIBaseAttributes {\n  /** Index of this step in the generation (0, 1, 2, ...) */\n  stepIndex?: number;\n  /** Token usage statistics */\n  usage?: UsageStats;\n  /** Reason this step finished (stop, tool-calls, length, etc.) */\n  finishReason?: string;\n  /** Should execution continue */\n  isContinued?: boolean;\n  /** Result warnings */\n  warnings?: Record<string, any>;\n}\n\n/**\n * Model Chunk attributes - for individual streaming chunks/events\n */\nexport interface ModelChunkAttributes extends AIBaseAttributes {\n  /** Type of chunk (text-delta, reasoning-delta, tool-call, etc.) */\n  chunkType?: string;\n  /** Sequence number of this chunk in the stream */\n  sequenceNumber?: number;\n}\n\n/**\n * Tool Call attributes\n */\nexport interface ToolCallAttributes extends AIBaseAttributes {\n  toolType?: string;\n  toolDescription?: string;\n  success?: boolean;\n}\n\n/**\n * MCP Tool Call attributes\n */\nexport interface MCPToolCallAttributes extends AIBaseAttributes {\n  /** MCP server identifier */\n  mcpServer: string;\n  /** MCP server version */\n  serverVersion?: string;\n  /** Whether tool execution was successful */\n  success?: boolean;\n}\n\n/**\n * Processor attributes\n */\nexport interface ProcessorRunAttributes extends AIBaseAttributes {\n  /** Processor executor type (workflow or legacy) */\n  processorExecutor?: 'workflow' | 'legacy';\n  /** Processor index in the agent */\n  processorIndex?: number;\n  /** MessageList mutations performed by this processor */\n  messageListMutations?: Array<{\n    type: 'add' | 'addSystem' | 'removeByIds' | 'clear';\n    source?: string;\n    count?: number;\n    ids?: string[];\n    text?: string;\n    tag?: string;\n    message?: any;\n  }>;\n}\n\n/**\n * Workflow Run attributes\n */\nexport interface WorkflowRunAttributes extends AIBaseAttributes {\n  /** Workflow status */\n  status?: WorkflowRunStatus;\n}\n\n/**\n * Workflow Step attributes\n */\nexport interface WorkflowStepAttributes extends AIBaseAttributes {\n  /** Step status */\n  status?: WorkflowStepStatus;\n}\n\n/**\n * Workflow Conditional attributes\n */\nexport interface WorkflowConditionalAttributes extends AIBaseAttributes {\n  /** Number of conditions evaluated */\n  conditionCount: number;\n  /** Which condition indexes evaluated to true */\n  truthyIndexes?: number[];\n  /** Which steps will be executed */\n  selectedSteps?: string[];\n}\n\n/**\n * Workflow Conditional Evaluation attributes\n */\nexport interface WorkflowConditionalEvalAttributes extends AIBaseAttributes {\n  /** Index of this condition in the conditional */\n  conditionIndex: number;\n  /** Result of condition evaluation */\n  result?: boolean;\n}\n\n/**\n * Workflow Parallel attributes\n */\nexport interface WorkflowParallelAttributes extends AIBaseAttributes {\n  /** Number of parallel branches */\n  branchCount: number;\n  /** Step IDs being executed in parallel */\n  parallelSteps?: string[];\n}\n\n/**\n * Workflow Loop attributes\n */\nexport interface WorkflowLoopAttributes extends AIBaseAttributes {\n  /** Type of loop (foreach, dowhile, dountil) */\n  loopType?: 'foreach' | 'dowhile' | 'dountil';\n  /** Current iteration number (for individual iterations) */\n  iteration?: number;\n  /** Total iterations (if known) */\n  totalIterations?: number;\n  /** Number of steps to run concurrently in foreach loop */\n  concurrency?: number;\n}\n\n/**\n * Workflow Sleep attributes\n */\nexport interface WorkflowSleepAttributes extends AIBaseAttributes {\n  /** Sleep duration in milliseconds */\n  durationMs?: number;\n  /** Sleep until date */\n  untilDate?: Date;\n  /** Sleep type */\n  sleepType?: 'fixed' | 'dynamic';\n}\n\n/**\n * Workflow Wait Event attributes\n */\nexport interface WorkflowWaitEventAttributes extends AIBaseAttributes {\n  /** Event name being waited for */\n  eventName?: string;\n  /** Timeout in milliseconds */\n  timeoutMs?: number;\n  /** Whether event was received or timed out */\n  eventReceived?: boolean;\n  /** Wait duration in milliseconds */\n  waitDurationMs?: number;\n}\n\n/**\n * AI-specific span types mapped to their attributes\n */\nexport interface SpanTypeMap {\n  [SpanType.AGENT_RUN]: AgentRunAttributes;\n  [SpanType.WORKFLOW_RUN]: WorkflowRunAttributes;\n  [SpanType.MODEL_GENERATION]: ModelGenerationAttributes;\n  [SpanType.MODEL_STEP]: ModelStepAttributes;\n  [SpanType.MODEL_CHUNK]: ModelChunkAttributes;\n  [SpanType.TOOL_CALL]: ToolCallAttributes;\n  [SpanType.MCP_TOOL_CALL]: MCPToolCallAttributes;\n  [SpanType.PROCESSOR_RUN]: ProcessorRunAttributes;\n  [SpanType.WORKFLOW_STEP]: WorkflowStepAttributes;\n  [SpanType.WORKFLOW_CONDITIONAL]: WorkflowConditionalAttributes;\n  [SpanType.WORKFLOW_CONDITIONAL_EVAL]: WorkflowConditionalEvalAttributes;\n  [SpanType.WORKFLOW_PARALLEL]: WorkflowParallelAttributes;\n  [SpanType.WORKFLOW_LOOP]: WorkflowLoopAttributes;\n  [SpanType.WORKFLOW_SLEEP]: WorkflowSleepAttributes;\n  [SpanType.WORKFLOW_WAIT_EVENT]: WorkflowWaitEventAttributes;\n  [SpanType.GENERIC]: AIBaseAttributes;\n}\n\n/**\n * Union type for cases that need to handle any span type\n */\nexport type AnySpanAttributes = SpanTypeMap[keyof SpanTypeMap];\n\n// ============================================================================\n// Span Interfaces\n// ============================================================================\n\nexport interface SpanErrorInfo {\n  message: string;\n  id?: string;\n  domain?: string;\n  category?: string;\n  details?: Record<string, any>;\n}\n\n/**\n * Base Span interface\n */\ninterface BaseSpan<TType extends SpanType> {\n  /** Unique span identifier */\n  id: string;\n  /** OpenTelemetry-compatible trace ID (32 hex chars) - present on all spans */\n  traceId: string;\n  /** Name of the span */\n  name: string;\n  /** Type of the span */\n  type: TType;\n  /** Entity type that created the span */\n  entityType?: EntityType;\n  /** Entity id that created the span */\n  entityId?: string;\n  /** Entity name that created the span */\n  entityName?: string;\n  /** When span started */\n  startTime: Date;\n  /** When span ended */\n  endTime?: Date;\n  /** Span-type specific attributes */\n  attributes?: SpanTypeMap[TType];\n  /** User-defined metadata */\n  metadata?: Record<string, any>;\n  /** Labels used to categorize and filter traces. Only valid on root spans. */\n  tags?: string[];\n  /** Input passed at the start of the span */\n  input?: any;\n  /** Output generated at the end of the span */\n  output?: any;\n  /** Error information if span failed */\n  errorInfo?: SpanErrorInfo;\n  /** Is an event span? (event occurs at startTime, has no endTime) */\n  isEvent: boolean;\n}\n\n/**\n * Span interface, used internally for tracing\n */\nexport interface Span<TType extends SpanType> extends BaseSpan<TType> {\n  /** Is an internal span? (spans internal to the operation of mastra) */\n  isInternal: boolean;\n  /** Parent span reference (undefined for root spans) */\n  parent?: AnySpan;\n  /** Pointer to the ObservabilityInstance instance */\n  observabilityInstance: ObservabilityInstance;\n  /** Trace-level state shared across all spans in this trace */\n  traceState?: TraceState;\n\n  // Methods for span lifecycle\n  /** End the span */\n  end(options?: EndSpanOptions<TType>): void;\n\n  /** Record an error for the span, optionally end the span as well */\n  error(options: ErrorSpanOptions<TType>): void;\n\n  /** Update span attributes */\n  update(options: UpdateSpanOptions<TType>): void;\n\n  /** Create child span - can be any span type independent of parent */\n  createChildSpan(options: ChildSpanOptions<SpanType.MODEL_GENERATION>): AIModelGenerationSpan;\n  createChildSpan<TChildType extends SpanType>(options: ChildSpanOptions<TChildType>): Span<TChildType>;\n\n  /** Create event span - can be any span type independent of parent */\n  createEventSpan<TChildType extends SpanType>(options: ChildEventOptions<TChildType>): Span<TChildType>;\n\n  /** Returns `TRUE` if the span is the root span of a trace */\n  get isRootSpan(): boolean;\n\n  /** Returns `TRUE` if the span is a valid span (not a NO-OP Span) */\n  get isValid(): boolean;\n\n  /** Get the closest parent spanId that isn't an internal span */\n  getParentSpanId(includeInternalSpans?: boolean): string | undefined;\n\n  /** Find the closest parent span of a specific type by walking up the parent chain */\n  findParent<T extends SpanType>(spanType: T): Span<T> | undefined;\n\n  /** Returns a lightweight span ready for export */\n  exportSpan(includeInternalSpans?: boolean): ExportedSpan<TType> | undefined;\n\n  /** Returns the traceId on span, unless NoOpSpan, then undefined */\n  get externalTraceId(): string | undefined;\n\n  /**\n   * Execute an async function within this span's tracing context.\n   *\n   * When a bridge is configured, this enables auto-instrumented operations\n   * (HTTP requests, database queries, etc.) to be properly nested under this\n   * span in the external tracing system.\n   *\n   * @param fn - The async function to execute within the span context\n   * @returns The result of the function execution\n   *\n   * @example\n   * ```typescript\n   * const result = await modelSpan.executeInContext(async () => {\n   *   return model.generateText(...);\n   * });\n   * ```\n   */\n  executeInContext<T>(fn: () => Promise<T>): Promise<T>;\n\n  /**\n   * Execute a synchronous function within this span's tracing context.\n   *\n   * When a bridge is configured, this enables auto-instrumented operations\n   * (HTTP requests, database queries, etc.) to be properly nested under this\n   * span in the external tracing system.\n   *\n   * @param fn - The synchronous function to execute within the span context\n   * @returns The result of the function execution\n   *\n   * @example\n   * ```typescript\n   * const result = modelSpan.executeInContextSync(() => {\n   *   return model.streamText(...);\n   * });\n   * ```\n   */\n  executeInContextSync<T>(fn: () => T): T;\n}\n\nexport interface BridgeSpanContext {\n  /**\n   * Execute an async function within this span's tracing context.\n   *\n   * When a bridge is configured, this enables auto-instrumented operations\n   * (HTTP requests, database queries, etc.) to be properly nested under this\n   * span in the external tracing system.\n   *\n   * @param fn - The async function to execute within the span context\n   * @returns The result of the function execution\n   *\n   * @example\n   * ```typescript\n   * const result = await modelSpan.executeInContext(async () => {\n   *   return model.generateText(...);\n   * });\n   * ```\n   */\n  executeInContext<T>(fn: () => Promise<T>): Promise<T>;\n\n  /**\n   * Execute a synchronous function within this span's tracing context.\n   *\n   * When a bridge is configured, this enables auto-instrumented operations\n   * (HTTP requests, database queries, etc.) to be properly nested under this\n   * span in the external tracing system.\n   *\n   * @param fn - The synchronous function to execute within the span context\n   * @returns The result of the function execution\n   *\n   * @example\n   * ```typescript\n   * const result = modelSpan.executeInContextSync(() => {\n   *   return model.streamText(...);\n   * });\n   * ```\n   */\n  executeInContextSync<T>(fn: () => T): T;\n}\n\n/**\n * Specialized span interface for MODEL_GENERATION spans\n * Provides access to creating a ModelSpanTracker for tracking MODEL_STEP and MODEL_CHUNK spans\n */\nexport interface AIModelGenerationSpan extends Span<SpanType.MODEL_GENERATION> {\n  /** Create a ModelSpanTracker for tracking model execution steps and chunks */\n  createTracker(): IModelSpanTracker | undefined;\n}\n\n/**\n * Exported Span interface, used for tracing exporters\n */\nexport interface ExportedSpan<TType extends SpanType> extends BaseSpan<TType> {\n  /** Parent span id reference (undefined for root spans) */\n  parentSpanId?: string;\n  /** `TRUE` if the span is the root span of a trace */\n  isRootSpan: boolean;\n  /**\n   * Tags for this trace (only present on root spans).\n   * Tags are string labels used to categorize and filter traces.\n   */\n  tags?: string[];\n}\n\n/**\n * Options for ending a model generation span\n */\nexport interface EndGenerationOptions extends EndSpanOptions<SpanType.MODEL_GENERATION> {\n  /** Raw usage data from AI SDK - will be converted to UsageStats with cache token details */\n  usage?: LanguageModelUsage;\n  /** Provider-specific metadata for extracting cache tokens */\n  providerMetadata?: ProviderMetadata;\n}\n\nexport interface IModelSpanTracker {\n  getTracingContext(): TracingContext;\n  reportGenerationError(options: ErrorSpanOptions<SpanType.MODEL_GENERATION>): void;\n  endGeneration(options?: EndGenerationOptions): void;\n  wrapStream<T extends { pipeThrough: Function }>(stream: T): T;\n  startStep(payload?: StepStartPayload): void;\n}\n\n/**\n * Union type for cases that need to handle any span\n */\nexport type AnySpan = Span<keyof SpanTypeMap>;\n\n/**\n * Union type for cases that need to handle any exported span\n */\nexport type AnyExportedSpan = ExportedSpan<keyof SpanTypeMap>;\n\n// ============================================================================\n// Tracing Interfaces\n// ============================================================================\n\n/**\n * Primary interface for Observability\n */\nexport interface ObservabilityInstance {\n  /**\n   * Get current configuration\n   */\n  getConfig(): Readonly<ObservabilityInstanceConfig>;\n\n  /**\n   * Get all exporters\n   */\n  getExporters(): readonly ObservabilityExporter[];\n\n  /**\n   * Get all span output processors\n   */\n  getSpanOutputProcessors(): readonly SpanOutputProcessor[];\n\n  /**\n   * Get the logger instance (for exporters and other components)\n   */\n  getLogger(): IMastraLogger;\n\n  /**\n   * Get the bridge instance if configured\n   */\n  getBridge(): ObservabilityBridge | undefined;\n\n  /**\n   * Start a new span of a specific SpanType\n   */\n  startSpan<TType extends SpanType>(options: StartSpanOptions<TType>): Span<TType>;\n\n  /**\n   * Rebuild a span from exported data for lifecycle operations.\n   * Used by durable execution engines (e.g., Inngest) to end/update spans\n   * that were created in a previous durable operation.\n   *\n   * @param cached - The exported span data to rebuild from\n   * @returns A span that can have end()/update()/error() called on it\n   */\n  rebuildSpan<TType extends SpanType>(cached: ExportedSpan<TType>): Span<TType>;\n\n  /**\n   * Shutdown tracing and clean up resources\n   */\n  shutdown(): Promise<void>;\n\n  /**\n   * Override setLogger to add tracing specific initialization log\n   */\n  __setLogger(logger: IMastraLogger): void;\n}\n\n// ============================================================================\n// Span Create/Update/Error Option Types\n// ============================================================================\n\ninterface CreateBaseOptions<TType extends SpanType> {\n  /** Span attributes */\n  attributes?: SpanTypeMap[TType];\n  /** Span metadata */\n  metadata?: Record<string, any>;\n  /** Span name */\n  name: string;\n  /** Span type */\n  type: TType;\n  /** Entity type that created the span */\n  entityType?: EntityType;\n  /** Entity id that created the span */\n  entityId?: string;\n  /** Entity name that created the span */\n  entityName?: string;\n  /** Policy-level tracing configuration */\n  tracingPolicy?: TracingPolicy;\n  /** Request Context for metadata extraction */\n  requestContext?: RequestContext;\n}\n\n/**\n * Options for creating new spans\n */\nexport interface CreateSpanOptions<TType extends SpanType> extends CreateBaseOptions<TType> {\n  /** Input data */\n  input?: any;\n  /** Output data (for event spans) */\n  output?: any;\n  /** Labels used to categorize and filter traces. Only valid on root spans. */\n  tags?: string[];\n  /** Parent span */\n  parent?: AnySpan;\n  /** Is an event span? */\n  isEvent?: boolean;\n  /**\n   * Trace ID to use for this span (1-32 hexadecimal characters).\n   * Only used for root spans without a parent.\n   */\n  traceId?: string;\n  /**\n   * Span ID to use for this span (1-16 hexadecimal characters).\n   * Only used when rebuilding a span from cached data.\n   */\n  spanId?: string;\n  /**\n   * Parent span ID to use for this span (1-16 hexadecimal characters).\n   * Only used for root spans without a parent.\n   */\n  parentSpanId?: string;\n  /**\n   * Start time for this span.\n   * Only used when rebuilding a span from cached data.\n   */\n  startTime?: Date;\n  /** Trace-level state shared across all spans in this trace */\n  traceState?: TraceState;\n}\n\n/**\n * Options for starting new spans\n */\nexport interface StartSpanOptions<TType extends SpanType> extends CreateSpanOptions<TType> {\n  /**\n   * Options passed when using a custom sampler strategy\n   */\n  customSamplerOptions?: CustomSamplerOptions;\n  /** Tracing options for this execution */\n  tracingOptions?: TracingOptions;\n}\n\n/**\n * Options for new child spans\n */\nexport interface ChildSpanOptions<TType extends SpanType> extends CreateBaseOptions<TType> {\n  /** Input data */\n  input?: any;\n}\n\n/**\n * Options for new child events\n * Event spans have no input, and no endTime\n */\nexport interface ChildEventOptions<TType extends SpanType> extends CreateBaseOptions<TType> {\n  /** Output data */\n  output?: any;\n}\n\ninterface UpdateBaseOptions<TType extends SpanType> {\n  /** Span attributes */\n  attributes?: Partial<SpanTypeMap[TType]>;\n  /** Span metadata */\n  metadata?: Record<string, any>;\n}\n\nexport interface EndSpanOptions<TType extends SpanType> extends UpdateBaseOptions<TType> {\n  /** Output data */\n  output?: any;\n}\n\nexport interface UpdateSpanOptions<TType extends SpanType> extends UpdateBaseOptions<TType> {\n  /** Input data */\n  input?: any;\n  /** Output data */\n  output?: any;\n}\n\nexport interface ErrorSpanOptions<TType extends SpanType> extends UpdateBaseOptions<TType> {\n  /** The error associated with the issue */\n  error: MastraError | Error;\n  /** End the span when true */\n  endSpan?: boolean;\n}\n\nexport interface GetOrCreateSpanOptions<TType extends SpanType> {\n  type: TType;\n  name: string;\n  entityType?: EntityType;\n  entityId?: string;\n  entityName?: string;\n  input?: any;\n  attributes?: SpanTypeMap[TType];\n  metadata?: Record<string, any>;\n  tracingPolicy?: TracingPolicy;\n  tracingOptions?: TracingOptions;\n  tracingContext?: TracingContext;\n  requestContext?: RequestContext;\n  mastra?: Mastra;\n}\n\n// ============================================================================\n// Lifecycle Types\n// ============================================================================\n\nexport interface ObservabilityEntrypoint {\n  shutdown(): Promise<void>;\n\n  setMastraContext(options: { mastra: Mastra }): void;\n\n  setLogger(options: { logger: IMastraLogger }): void;\n\n  getSelectedInstance(options: ConfigSelectorOptions): ObservabilityInstance | undefined;\n\n  // Registry management methods\n  registerInstance(name: string, instance: ObservabilityInstance, isDefault?: boolean): void;\n  getInstance(name: string): ObservabilityInstance | undefined;\n  getDefaultInstance(): ObservabilityInstance | undefined;\n  listInstances(): ReadonlyMap<string, ObservabilityInstance>;\n  unregisterInstance(name: string): boolean;\n  hasInstance(name: string): boolean;\n  setConfigSelector(selector: ConfigSelector): void;\n  clear(): void;\n}\n\n/**\n * Bitwise options to set different types of spans as internal in\n * a workflow or agent execution.\n */\nexport enum InternalSpans {\n  /** No spans are marked internal */\n  NONE = 0,\n  /** Workflow spans are marked internal */\n  WORKFLOW = 1 << 0, // 0001\n  /** Agent spans are marked internal */\n  AGENT = 1 << 1, // 0010\n  /** Tool spans are marked internal */\n  TOOL = 1 << 2, // 0100\n  /** Model spans are marked internal */\n  MODEL = 1 << 3, // 1000\n\n  /** All spans are marked internal */\n  ALL = (1 << 4) - 1, // 1111 (all bits set up to 3)\n}\n\n/**\n * Policy-level tracing configuration applied when creating\n * a workflow or agent. Unlike TracingOptions, which are\n * provided at execution time, policies define persistent rules\n * for how spans are treated across all executions of the\n * workflow/agent.\n */\nexport interface TracingPolicy {\n  /**\n   * Bitwise options to set different types of spans as Internal in\n   * a workflow or agent execution. Internal spans are hidden by\n   * default in exported traces.\n   */\n  internal?: InternalSpans;\n}\n\n/**\n * Trace-level state computed once at the start of a trace\n * and shared by all spans within that trace.\n */\nexport interface TraceState {\n  /**\n   * RequestContext keys to extract as metadata for all spans in this trace.\n   * Computed by merging the tracing config's requestContextKeys\n   * with the per-request requestContextKeys.\n   */\n  requestContextKeys: string[];\n  /**\n   * When true, input data will be hidden from all spans in this trace.\n   */\n  hideInput?: boolean;\n  /**\n   * When true, output data will be hidden from all spans in this trace.\n   */\n  hideOutput?: boolean;\n}\n\n/**\n * Options passed when starting a new agent or workflow execution\n */\nexport interface TracingOptions {\n  /** Metadata to add to the root trace span */\n  metadata?: Record<string, any>;\n  /**\n   * Additional RequestContext keys to extract as metadata for this trace.\n   * These keys are added to the requestContextKeys config.\n   * Supports dot notation for nested values (e.g., 'user.id', 'session.data.experimentId').\n   */\n  requestContextKeys?: string[];\n  /**\n   * Trace ID to use for this execution (1-32 hexadecimal characters).\n   * If provided, this trace will be part of the specified trace rather than starting a new one.\n   */\n  traceId?: string;\n  /**\n   * Parent span ID to use for this execution (1-16 hexadecimal characters).\n   * If provided, the root span will be created as a child of this span.\n   */\n  parentSpanId?: string;\n  /**\n   * Tags to apply to this trace.\n   * Tags are string labels that can be used to categorize and filter traces\n   * Note: Tags are only applied to the root span of a trace.\n   */\n  tags?: string[];\n  /**\n   * When true, input data will be hidden from all spans in this trace.\n   * Useful for protecting sensitive data from being logged.\n   */\n  hideInput?: boolean;\n  /**\n   * When true, output data will be hidden from all spans in this trace.\n   * Useful for protecting sensitive data from being logged.\n   */\n  hideOutput?: boolean;\n}\n\nexport interface SpanIds {\n  traceId: string;\n  spanId: string;\n  parentSpanId?: string;\n}\n\n/**\n * Context for tracing that flows through workflow and agent execution\n */\nexport interface TracingContext {\n  /** Current Span for creating child spans and adding metadata */\n  currentSpan?: AnySpan;\n}\n\n/**\n * Properties returned to the user for working with traces externally.\n */\nexport type TracingProperties = {\n  /** Trace ID used on the execution (if the execution was traced). */\n  traceId?: string;\n};\n\n// ============================================================================\n// Registry Config Interfaces\n// ============================================================================\n\n/**\n * Options for controlling serialization of span data.\n * These options control how input, output, and attributes are cleaned before export.\n */\nexport interface SerializationOptions {\n  /**\n   * Maximum length for string values\n   * @default 1024\n   */\n  maxStringLength?: number;\n  /**\n   * Maximum depth for nested objects\n   * @default 6\n   */\n  maxDepth?: number;\n  /**\n   * Maximum number of items in arrays\n   * @default 50\n   */\n  maxArrayLength?: number;\n  /**\n   * Maximum number of keys in objects\n   * @default 50\n   */\n  maxObjectKeys?: number;\n}\n\n/**\n * Configuration for a single observability instance\n */\nexport interface ObservabilityInstanceConfig {\n  /** Unique identifier for this config in the observability registry */\n  name: string;\n  /** Service name for observability */\n  serviceName: string;\n  /** Sampling strategy - controls whether tracing is collected (defaults to ALWAYS) */\n  sampling?: SamplingStrategy;\n  /** Custom exporters */\n  exporters?: ObservabilityExporter[];\n  /** Custom processors */\n  spanOutputProcessors?: SpanOutputProcessor[];\n  /** OpenTelemetry bridge for integration with existing OTEL infrastructure */\n  bridge?: ObservabilityBridge;\n  /** Set to `true` if you want to see spans internal to the operation of mastra */\n  includeInternalSpans?: boolean;\n  /**\n   * RequestContext keys to automatically extract as metadata for all spans\n   * created with this observability configuration.\n   * Supports dot notation for nested values.\n   */\n  requestContextKeys?: string[];\n  /**\n   * Options for controlling serialization of span data (input/output/attributes).\n   * Use these to customize truncation limits for large payloads.\n   */\n  serializationOptions?: SerializationOptions;\n}\n\n/**\n * Complete Observability registry configuration\n */\nexport interface ObservabilityRegistryConfig {\n  /** Enables default exporters, with sampling: always, and sensitive data filtering */\n  default?: {\n    enabled?: boolean;\n  };\n  /** Map of tracing instance names to their configurations or pre-instantiated instances */\n  configs?: Record<string, Omit<ObservabilityInstanceConfig, 'name'> | ObservabilityInstance>;\n  /** Optional selector function to choose which tracing instance to use */\n  configSelector?: ConfigSelector;\n}\n\n// ============================================================================\n// Sampling Strategy Interfaces\n// ============================================================================\n\n/**\n * Sampling strategy types\n */\nexport enum SamplingStrategyType {\n  ALWAYS = 'always',\n  NEVER = 'never',\n  RATIO = 'ratio',\n  CUSTOM = 'custom',\n}\n\n/**\n * Sampling strategy configuration\n */\nexport type SamplingStrategy =\n  | { type: SamplingStrategyType.ALWAYS }\n  | { type: SamplingStrategyType.NEVER }\n  | { type: SamplingStrategyType.RATIO; probability: number }\n  | { type: SamplingStrategyType.CUSTOM; sampler: (options?: CustomSamplerOptions) => boolean };\n\n/**\n * Options passed when using a custom sampler strategy\n */\nexport interface CustomSamplerOptions {\n  requestContext?: RequestContext;\n  metadata?: Record<string, any>;\n}\n\n// ============================================================================\n// Exporter and Processor Interfaces\n// ============================================================================\n\n/**\n * Tracing event types\n */\nexport enum TracingEventType {\n  SPAN_STARTED = 'span_started',\n  SPAN_UPDATED = 'span_updated',\n  SPAN_ENDED = 'span_ended',\n}\n\n/**\n * Tracing events that can be exported\n */\nexport type TracingEvent =\n  | { type: TracingEventType.SPAN_STARTED; exportedSpan: AnyExportedSpan }\n  | { type: TracingEventType.SPAN_UPDATED; exportedSpan: AnyExportedSpan }\n  | { type: TracingEventType.SPAN_ENDED; exportedSpan: AnyExportedSpan };\n\nexport interface InitExporterOptions {\n  mastra?: Mastra;\n  config?: ObservabilityInstanceConfig;\n}\n\nexport interface InitBridgeOptions {\n  mastra?: Mastra;\n  config?: ObservabilityInstanceConfig;\n}\n\n/**\n * Interface for tracing exporters\n */\nexport interface ObservabilityExporter {\n  /** Exporter name */\n  name: string;\n\n  /** Initialize exporter with tracing configuration and/or access to Mastra */\n  init?(options: InitExporterOptions): void;\n\n  /** Sets logger instance on the exporter.  */\n  __setLogger?(logger: IMastraLogger): void;\n\n  /** Export tracing events */\n  exportTracingEvent(event: TracingEvent): Promise<void>;\n\n  addScoreToTrace?({\n    traceId,\n    spanId,\n    score,\n    reason,\n    scorerName,\n    metadata,\n  }: {\n    traceId: string;\n    spanId?: string;\n    score: number;\n    reason?: string;\n    scorerName: string;\n    metadata?: Record<string, any>;\n  }): Promise<void>;\n\n  /** Shutdown exporter */\n  shutdown(): Promise<void>;\n}\n\n/**\n * Interface for observability bridges\n */\nexport interface ObservabilityBridge {\n  /** Bridge name */\n  name: string;\n\n  /** Initialize bridge with observability configuration and/or access to Mastra */\n  init?(options: InitBridgeOptions): void;\n\n  /** Sets logger instance on the bridge  */\n  __setLogger?(logger: IMastraLogger): void;\n\n  /**\n   * Export Mastra tracing events to OTEL infrastructure\n   * Called for SPAN_STARTED, SPAN_UPDATED, SPAN_ENDED events\n   *\n   * @param event - Tracing event with exported span\n   */\n  exportTracingEvent(event: TracingEvent): Promise<void>;\n\n  /**\n   * Execute an async function within the tracing context of a Mastra span.\n   * This enables auto-instrumented operations (HTTP, DB) to have correct parent spans\n   * in the external tracing system (e.g., OpenTelemetry, DataDog, etc.).\n   *\n   * @param spanId - The ID of the Mastra span to use as context\n   * @param fn - The async function to execute within the span context\n   * @returns The result of the function execution\n   */\n  executeInContext?<T>(spanId: string, fn: () => Promise<T>): Promise<T>;\n\n  /**\n   * Execute a synchronous function within the tracing context of a Mastra span.\n   * This enables auto-instrumented operations (HTTP, DB) to have correct parent spans\n   * in the external tracing system (e.g., OpenTelemetry, DataDog, etc.).\n   *\n   * @param spanId - The ID of the Mastra span to use as context\n   * @param fn - The synchronous function to execute within the span context\n   * @returns The result of the function execution\n   */\n  executeInContextSync?<T>(spanId: string, fn: () => T): T;\n\n  /**\n   * Create a span in the bridge's tracing system.\n   * Called during Mastra span construction to get bridge-generated identifiers.\n   *\n   * @param options - Span creation options from Mastra\n   * @returns Span identifiers (spanId, traceId, parentSpanId) from bridge, or undefined if creation fails\n   */\n  createSpan(options: CreateSpanOptions<SpanType>): SpanIds | undefined;\n\n  /** Shutdown bridge and cleanup resources */\n  shutdown(): Promise<void>;\n}\n\n/**\n * Interface for span processors\n */\nexport interface SpanOutputProcessor {\n  /** Processor name */\n  name: string;\n  /** Process span before export */\n  process(span?: AnySpan): AnySpan | undefined;\n  /** Shutdown processor */\n  shutdown(): Promise<void>;\n}\n\n/**\n * Function type for formatting exported spans at the exporter level.\n *\n * This allows customization of how spans appear in vendor-specific observability platforms\n * (e.g., Langfuse, Braintrust). Unlike SpanOutputProcessor which operates on the internal\n * Span object before export, this formatter operates on the ExportedSpan data structure\n * after the span has been prepared for export.\n *\n * Formatters can be synchronous or asynchronous, enabling use cases like:\n * - Extract plain text from structured AI SDK messages for better readability\n * - Transform input/output format for specific vendor requirements\n * - Add or remove fields based on the target platform\n * - Redact or transform sensitive data in a vendor-specific way\n * - Enrich spans with data from external APIs (async)\n * - Perform database lookups to add context (async)\n *\n * @param span - The exported span to format\n * @returns The formatted span (sync) or a Promise resolving to the formatted span (async)\n *\n * @example\n * ```typescript\n * // Synchronous formatter that extracts plain text from AI messages\n * const plainTextFormatter: CustomSpanFormatter = (span) => {\n *   if (span.type === SpanType.AGENT_RUN && Array.isArray(span.input)) {\n *     const userMessage = span.input.find(m => m.role === 'user');\n *     return {\n *       ...span,\n *       input: userMessage?.content ?? span.input,\n *     };\n *   }\n *   return span;\n * };\n *\n * // Async formatter that enriches spans with external data\n * const enrichmentFormatter: CustomSpanFormatter = async (span) => {\n *   const userData = await fetchUserData(span.metadata?.userId);\n *   return {\n *     ...span,\n *     metadata: { ...span.metadata, userName: userData.name },\n *   };\n * };\n *\n * // Use with an exporter\n * new BraintrustExporter({\n *   customSpanFormatter: plainTextFormatter,\n * });\n * ```\n */\nexport type CustomSpanFormatter = (span: AnyExportedSpan) => AnyExportedSpan | Promise<AnyExportedSpan>;\n\n// ============================================================================\n// Tracing Config Selector Interfaces\n// ============================================================================\n\n/**\n *  Options passed when using a custom tracing config selector\n */\nexport interface ConfigSelectorOptions {\n  /** Request Context */\n  requestContext?: RequestContext;\n}\n\n/**\n * Function to select which tracing instance to use for a given span\n * Returns the name of the tracing instance, or undefined to use default\n */\nexport type ConfigSelector = (\n  options: ConfigSelectorOptions,\n  availableConfigs: ReadonlyMap<string, ObservabilityInstance>,\n) => string | undefined;\n","import type { Mastra } from '..';\nimport type { IMastraLogger } from '../logger';\nimport type { ObservabilityInstance, ConfigSelectorOptions, ObservabilityEntrypoint, ConfigSelector } from './types';\n\nexport class NoOpObservability implements ObservabilityEntrypoint {\n  setMastraContext(_options: { mastra: Mastra }): void {\n    return;\n  }\n\n  setLogger(_options: { logger: IMastraLogger }): void {\n    return;\n  }\n\n  getSelectedInstance(_options: ConfigSelectorOptions): ObservabilityInstance | undefined {\n    return;\n  }\n\n  registerInstance(_name: string, _instance: ObservabilityInstance, _isDefault = false): void {\n    return;\n  }\n\n  getInstance(_name: string): ObservabilityInstance | undefined {\n    return;\n  }\n\n  getDefaultInstance(): ObservabilityInstance | undefined {\n    return;\n  }\n\n  listInstances(): ReadonlyMap<string, ObservabilityInstance> {\n    return new Map();\n  }\n\n  unregisterInstance(_name: string): boolean {\n    return false;\n  }\n\n  hasInstance(_name: string): boolean {\n    return false;\n  }\n\n  setConfigSelector(_selector: ConfigSelector): void {\n    return;\n  }\n\n  clear(): void {\n    return;\n  }\n\n  async shutdown(): Promise<void> {\n    return;\n  }\n}\n","import type { Span, SpanType, GetOrCreateSpanOptions, AnySpan } from './types';\n\n/**\n * Creates or gets a child span from existing tracing context or starts a new trace.\n * This helper consolidates the common pattern of creating spans that can either be:\n * 1. Children of an existing span (when tracingContext.currentSpan exists)\n * 2. New root spans (when no current span exists)\n *\n * @param options - Configuration object for span creation\n * @returns The created Span or undefined if tracing is disabled\n */\nexport function getOrCreateSpan<T extends SpanType>(options: GetOrCreateSpanOptions<T>): Span<T> | undefined {\n  const { type, attributes, tracingContext, requestContext, tracingOptions, ...rest } = options;\n\n  const metadata = {\n    ...(rest.metadata ?? {}),\n    ...(tracingOptions?.metadata ?? {}),\n  };\n\n  // If we have a current span, create a child span\n  if (tracingContext?.currentSpan) {\n    return tracingContext.currentSpan.createChildSpan({\n      type,\n      attributes,\n      ...rest,\n      metadata,\n    });\n  }\n\n  // Otherwise, try to create a new root span\n  const instance = options.mastra?.observability?.getSelectedInstance({ requestContext });\n\n  return instance?.startSpan<T>({\n    type,\n    attributes,\n    ...rest,\n    metadata,\n    requestContext,\n    tracingOptions,\n    traceId: tracingOptions?.traceId,\n    parentSpanId: tracingOptions?.parentSpanId,\n    customSamplerOptions: {\n      requestContext,\n      metadata,\n    },\n  });\n}\n\n/**\n * Execute an async function within the span's tracing context if available.\n * Falls back to direct execution if no span exists.\n *\n * When a bridge is configured, this enables auto-instrumented operations\n * (HTTP requests, database queries, etc.) to be properly nested under the\n * current span in the external tracing system.\n *\n * @param span - The span to use as context (or undefined to execute without context)\n * @param fn - The async function to execute\n * @returns The result of the function execution\n *\n * @example\n * ```typescript\n * const result = await executeWithContext(llmSpan, async () =>\n *   model.generateText(args)\n * );\n * ```\n */\nexport async function executeWithContext<T>(params: { span?: AnySpan; fn: () => Promise<T> }): Promise<T> {\n  const { span, fn } = params;\n\n  if (span?.executeInContext) {\n    return span.executeInContext(fn);\n  }\n\n  return fn();\n}\n\n/**\n * Execute a synchronous function within the span's tracing context if available.\n * Falls back to direct execution if no span exists.\n *\n * When a bridge is configured, this enables auto-instrumented operations\n * (HTTP requests, database queries, etc.) to be properly nested under the\n * current span in the external tracing system.\n *\n * @param span - The span to use as context (or undefined to execute without context)\n * @param fn - The synchronous function to execute\n * @returns The result of the function execution\n *\n * @example\n * ```typescript\n * const result = executeWithContextSync(llmSpan, () =>\n *   model.streamText(args)\n * );\n * ```\n */\nexport function executeWithContextSync<T>(params: { span?: AnySpan; fn: () => T }): T {\n  const { span, fn } = params;\n\n  if (span?.executeInContextSync) {\n    return span.executeInContextSync(fn);\n  }\n\n  return fn();\n}\n","/**\n * Tracing Context Integration\n *\n * This module provides automatic tracing context propagation throughout Mastra's execution contexts.\n * It uses JavaScript Proxies to transparently wrap Mastra, Agent, and Workflow instances so that\n * tracing context is automatically injected without requiring manual passing by users.\n */\n\nimport type { MastraPrimitives } from '../action';\nimport type { Agent } from '../agent';\nimport type { Mastra } from '../mastra';\nimport type { Workflow } from '../workflows';\nimport type { TracingContext, AnySpan } from './types';\n\nconst AGENT_GETTERS = ['getAgent', 'getAgentById'];\nconst AGENT_METHODS_TO_WRAP = ['generate', 'stream', 'generateLegacy', 'streamLegacy'];\n\nconst WORKFLOW_GETTERS = ['getWorkflow', 'getWorkflowById'];\nconst WORKFLOW_METHODS_TO_WRAP = ['execute', 'createRun', 'createRun'];\n\n/**\n * Helper function to detect NoOp spans to avoid unnecessary wrapping\n */\nfunction isNoOpSpan(span: AnySpan): boolean {\n  // Check if this is a NoOp span implementation\n  return span.constructor.name === 'NoOpSpan' || (span as any).__isNoOp === true;\n}\n\n/**\n * Checks to see if a passed object is an actual instance of Mastra\n * (for the purposes of wrapping it for Tracing)\n */\nexport function isMastra<T extends Mastra | (Mastra & MastraPrimitives) | MastraPrimitives>(mastra: T): boolean {\n  const hasAgentGetters = AGENT_GETTERS.every(method => typeof (mastra as any)?.[method] === 'function');\n  const hasWorkflowGetters = WORKFLOW_GETTERS.every(method => typeof (mastra as any)?.[method] === 'function');\n\n  return hasAgentGetters && hasWorkflowGetters;\n}\n\n/**\n * Creates a tracing-aware Mastra proxy that automatically injects\n * tracing context into agent and workflow method calls\n */\nexport function wrapMastra<T extends Mastra | (Mastra & MastraPrimitives) | MastraPrimitives>(\n  mastra: T,\n  tracingContext: TracingContext,\n): T {\n  // Don't wrap if no current span or if using NoOp span\n  if (!tracingContext.currentSpan || isNoOpSpan(tracingContext.currentSpan)) {\n    return mastra;\n  }\n\n  // Check if this object has the methods we want to wrap - if not, return as is\n  if (!isMastra(mastra)) {\n    return mastra;\n  }\n\n  try {\n    return new Proxy(mastra, {\n      get(target, prop) {\n        try {\n          if (AGENT_GETTERS.includes(prop as string)) {\n            return (...args: any[]) => {\n              const agent = (target as any)[prop](...args);\n              return wrapAgent(agent, tracingContext);\n            };\n          }\n\n          // Wrap workflow getters\n          if (WORKFLOW_GETTERS.includes(prop as string)) {\n            return (...args: any[]) => {\n              const workflow = (target as any)[prop](...args);\n              return wrapWorkflow(workflow, tracingContext);\n            };\n          }\n\n          // Pass through all other methods unchanged - bind functions to preserve 'this' context\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        } catch (error) {\n          console.warn('Tracing: Failed to wrap method, falling back to original', error);\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        }\n      },\n    });\n  } catch (error) {\n    console.warn('Tracing: Failed to create proxy, using original Mastra instance', error);\n    return mastra;\n  }\n}\n\n/**\n * Creates a tracing-aware Agent proxy that automatically injects\n * tracing context into generation method calls\n */\nfunction wrapAgent<T extends Agent>(agent: T, tracingContext: TracingContext): T {\n  // Don't wrap if no current span or if using NoOp span\n  if (!tracingContext.currentSpan || isNoOpSpan(tracingContext.currentSpan)) {\n    return agent;\n  }\n\n  try {\n    return new Proxy(agent, {\n      get(target, prop) {\n        try {\n          if (AGENT_METHODS_TO_WRAP.includes(prop as string)) {\n            return (input: any, options: any = {}) => {\n              return (target as any)[prop](input, {\n                ...options,\n                tracingContext,\n              });\n            };\n          }\n\n          // Bind functions to preserve 'this' context for private member access\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        } catch (error) {\n          console.warn('Tracing: Failed to wrap agent method, falling back to original', error);\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        }\n      },\n    });\n  } catch (error) {\n    console.warn('Tracing: Failed to create agent proxy, using original instance', error);\n    return agent;\n  }\n}\n\n/**\n * Creates a tracing-aware Workflow proxy that automatically injects\n * tracing context into execution method calls\n */\nfunction wrapWorkflow<T extends Workflow>(workflow: T, tracingContext: TracingContext): T {\n  // Don't wrap if no current span or if using NoOp span\n  if (!tracingContext.currentSpan || isNoOpSpan(tracingContext.currentSpan)) {\n    return workflow;\n  }\n\n  try {\n    return new Proxy(workflow, {\n      get(target, prop) {\n        try {\n          // Wrap workflow execution methods with tracing context\n          if (WORKFLOW_METHODS_TO_WRAP.includes(prop as string)) {\n            // Handle createRun and createRun methods differently\n            if (prop === 'createRun' || prop === 'createRun') {\n              return async (options: any = {}) => {\n                const run = await (target as any)[prop](options);\n                return run ? wrapRun(run, tracingContext) : run;\n              };\n            }\n\n            // Handle other methods like execute\n            return (input: any, options: any = {}) => {\n              return (target as any)[prop](input, {\n                ...options,\n                tracingContext,\n              });\n            };\n          }\n\n          // Bind functions to preserve 'this' context for private member access\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        } catch (error) {\n          console.warn('Tracing: Failed to wrap workflow method, falling back to original', error);\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        }\n      },\n    });\n  } catch (error) {\n    console.warn('Tracing: Failed to create workflow proxy, using original instance', error);\n    return workflow;\n  }\n}\n\n/**\n * Creates a tracing-aware Run proxy that automatically injects\n * tracing context into start method calls\n */\nfunction wrapRun<T extends object>(run: T, tracingContext: TracingContext): T {\n  // Don't wrap if no current span or if using NoOp span\n  if (!tracingContext.currentSpan || isNoOpSpan(tracingContext.currentSpan)) {\n    return run;\n  }\n\n  try {\n    return new Proxy(run, {\n      get(target, prop) {\n        try {\n          if (prop === 'start') {\n            return (startOptions: any = {}) => {\n              return (target as any).start({\n                ...startOptions,\n                tracingContext: startOptions.tracingContext ?? tracingContext,\n              });\n            };\n          }\n\n          // Pass through all other properties and methods unchanged\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        } catch (error) {\n          console.warn('Tracing: Failed to wrap run method, falling back to original', error);\n          const value = (target as any)[prop];\n          return typeof value === 'function' ? value.bind(target) : value;\n        }\n      },\n    });\n  } catch (error) {\n    console.warn('Tracing: Failed to create run proxy, using original instance', error);\n    return run;\n  }\n}\n"],"names":["SpanType","EntityType","InternalSpans","SamplingStrategyType","TracingEventType"],"mappings":"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"}},
    {"offset": {"line": 3606, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-AIJLACR2.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/utils/zod-utils.ts"],"sourcesContent":["import type { z } from 'zod';\n\n/**\n * Checks if a value is a Zod type\n * @param value - The value to check\n * @returns True if the value is a Zod type, false otherwise\n */\nexport function isZodType(value: unknown): value is z.ZodType {\n  // Check if it's a Zod schema by looking for common Zod properties and methods\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    '_def' in value &&\n    'parse' in value &&\n    typeof (value as any).parse === 'function' &&\n    'safeParse' in value &&\n    typeof (value as any).safeParse === 'function'\n  );\n}\n\n/**\n * Get the Zod typeName from a schema, compatible with both Zod 3 and Zod 4.\n * Uses string-based typeName instead of instanceof to avoid dual-package hazard\n * where multiple Zod instances can cause instanceof checks to fail.\n *\n * Zod 3 uses `_def.typeName` with values like \"ZodString\", \"ZodOptional\", etc.\n * Zod 4 uses `_def.type` with lowercase values like \"string\", \"optional\", etc.\n *\n * This function normalizes to Zod 3 format (e.g., \"ZodString\") for compatibility.\n *\n * @param schema - The Zod schema to get the type name from\n * @returns The Zod type name string (e.g., \"ZodString\", \"ZodOptional\") or undefined\n */\nexport function getZodTypeName(schema: z.ZodTypeAny): string | undefined {\n  const schemaAny = schema as any;\n\n  // Zod 3 structure: _def.typeName = \"ZodString\", \"ZodOptional\", etc.\n  if (schemaAny._def?.typeName) {\n    return schemaAny._def.typeName;\n  }\n\n  // Zod 4 structure: _def.type = \"string\", \"optional\", etc. (lowercase, no prefix)\n  const zod4Type = schemaAny._def?.type;\n  if (typeof zod4Type === 'string' && zod4Type) {\n    // Normalize to Zod 3 format: \"string\" -> \"ZodString\", \"optional\" -> \"ZodOptional\"\n    return 'Zod' + zod4Type.charAt(0).toUpperCase() + zod4Type.slice(1);\n  }\n\n  return undefined;\n}\n\n/**\n * Check if a value is a ZodArray type\n * @param value - The value to check (can be any type)\n * @returns True if the value is a ZodArray\n */\nexport function isZodArray(value: unknown): value is z.ZodArray<z.ZodTypeAny> {\n  if (!isZodType(value)) return false;\n  return getZodTypeName(value as z.ZodTypeAny) === 'ZodArray';\n}\n\n/**\n * Check if a value is a ZodObject type\n * @param value - The value to check (can be any type)\n * @returns True if the value is a ZodObject\n */\nexport function isZodObject(value: unknown): value is z.ZodObject<any> {\n  if (!isZodType(value)) return false;\n  return getZodTypeName(value as z.ZodTypeAny) === 'ZodObject';\n}\n\n/**\n * Get the def object from a Zod schema, compatible with both Zod 3 and Zod 4.\n * @param schema - The Zod schema\n * @returns The def object\n */\nexport function getZodDef(schema: z.ZodTypeAny): any {\n  const schemaAny = schema as any;\n  return schemaAny._zod?.def ?? schemaAny._def;\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAOO,SAAS,UAAU,KAAA,EAAoC;IAE5D,OACE,OAAO,KAAA,KAAU,QAAA,IACjB,KAAA,KAAU,IAAA,IACV,UAAU,KAAA,IACV,OAAA,IAAW,KAAA,IACX,OAAQ,MAAc,KAAA,KAAU,UAAA,IAChC,eAAe,KAAA,IACf,OAAQ,MAAc,SAAA,KAAc,UAAA;AAExC;AAeO,SAAS,eAAe,MAAA,EAA0C;IACvE,MAAM,SAAA,GAAY,MAAA;IAGlB,IAAI,SAAA,CAAU,IAAA,EAAM,QAAA,EAAU;QAC5B,OAAO,UAAU,IAAA,CAAK,QAAA;IACxB;IAGA,MAAM,QAAA,GAAW,UAAU,IAAA,EAAM,IAAA;IACjC,IAAI,OAAO,QAAA,KAAa,QAAA,IAAY,QAAA,EAAU;QAE5C,OAAO,KAAA,GAAQ,SAAS,MAAA,CAAO,CAAC,EAAE,WAAA,EAAY,GAAI,QAAA,CAAS,KAAA,CAAM,CAAC,CAAA;IACpE;IAEA,OAAO,KAAA,CAAA;AACT;AAOO,SAAS,WAAW,KAAA,EAAmD;IAC5E,IAAI,CAAC,SAAA,CAAU,KAAK,CAAA,EAAG,OAAO,KAAA;IAC9B,OAAO,cAAA,CAAe,KAAqB,CAAA,KAAM,UAAA;AACnD;AAOO,SAAS,YAAY,KAAA,EAA2C;IACrE,IAAI,CAAC,SAAA,CAAU,KAAK,CAAA,EAAG,OAAO,KAAA;IAC9B,OAAO,cAAA,CAAe,KAAqB,CAAA,KAAM,WAAA;AACnD;AAOO,SAAS,UAAU,MAAA,EAA2B;IACnD,MAAM,SAAA,GAAY,MAAA;IAClB,OAAO,SAAA,CAAU,IAAA,EAAM,GAAA,IAAO,SAAA,CAAU,IAAA;AAC1C"}},
    {"offset": {"line": 3650, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-65QFXXAD.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/shared.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/evals/types.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/observability/types.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/types.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/constants.ts"],"sourcesContent":["import { z } from 'zod';\nimport { EntityType } from '../../observability';\n\n/**\n * Common DB fields\n */\nexport const createdAtField = z.date().describe('Database record creation time');\n\nexport const updatedAtField = z.date().describe('Database record last update time');\n\nexport const dbTimestamps = {\n  createdAt: createdAtField,\n  updatedAt: updatedAtField.nullable(),\n} as const satisfies z.ZodRawShape;\n\n/**\n * Pagination arguments for list queries (page and perPage only)\n * Uses z.coerce to handle string â†’ number conversion from query params\n */\nexport const paginationArgsSchema = z\n  .object({\n    page: z.coerce.number().int().min(0).optional().default(0).describe('Zero-indexed page number'),\n    perPage: z.coerce.number().int().min(1).max(100).optional().default(10).describe('Number of items per page'),\n  })\n  .describe('Pagination options for list queries');\n\nexport type PaginationArgs = z.input<typeof paginationArgsSchema>;\n\n/**\n * Pagination response info\n * Used across all paginated endpoints\n */\nexport const paginationInfoSchema = z.object({\n  total: z.number().describe('Total number of items available'),\n  page: z.number().describe('Current page'),\n  perPage: z\n    .union([z.number(), z.literal(false)])\n    .describe('Number of items per page, or false if pagination is disabled'),\n  hasMore: z.boolean().describe('True if more pages are available'),\n});\n\n/**\n * Date range for filtering by time\n * Uses z.coerce to handle ISO string â†’ Date conversion from query params\n */\nexport const dateRangeSchema = z\n  .object({\n    start: z.coerce.date().optional().describe('Start of date range (inclusive by default)'),\n    end: z.coerce.date().optional().describe('End of date range (inclusive by default)'),\n    startExclusive: z\n      .boolean()\n      .optional()\n      .describe('When true, excludes the start date from results (uses > instead of >=)'),\n    endExclusive: z\n      .boolean()\n      .optional()\n      .describe('When true, excludes the end date from results (uses < instead of <=)'),\n  })\n  .describe('Date range filter for timestamps');\n\nexport type DateRange = z.infer<typeof dateRangeSchema>;\n\nexport const sortDirectionSchema = z.enum(['ASC', 'DESC']).describe(\"Sort direction: 'ASC' | 'DESC'\");\n\nexport const entityTypeField = z\n  .nativeEnum(EntityType)\n  .describe(`Entity type (e.g., 'agent' | 'processor' | 'tool' | 'workflow')`);\n\nexport const entityIdField = z.string().describe('ID of the entity (e.g., \"weatherAgent\", \"orderWorkflow\")');\n\nexport const entityNameField = z.string().describe('Name of the entity');\n\nexport const userIdField = z.string().describe('Human end-user who triggered execution');\n\nexport const organizationIdField = z.string().describe('Multi-tenant organization/account');\n\nexport const resourceIdField = z.string().describe('Broader resource context (Mastra memory compatibility)');\n\nexport const runIdField = z.string().describe('Unique execution run identifier');\n\nexport const sessionIdField = z.string().describe('Session identifier for grouping traces');\n\nexport const threadIdField = z.string().describe('Conversation thread identifier');\n\nexport const requestIdField = z.string().describe('HTTP request ID for log correlation');\n\nexport const environmentField = z.string().describe(`Environment (e.g., \"production\" | \"staging\" | \"development\")`);\n\nexport const sourceField = z.string().describe(`Source of execution (e.g., \"local\" | \"cloud\" | \"ci\")`);\n\nexport const serviceNameField = z.string().describe('Name of the service');\n","import type { CoreMessage, CoreSystemMessage } from '@internal/ai-sdk-v4';\nimport { z } from 'zod';\nimport type { MastraDBMessage } from '../agent';\nimport { SpanType } from '../observability';\nimport type { TracingContext } from '../observability';\nimport { dbTimestamps, paginationInfoSchema } from '../storage/domains/shared';\n\n// ============================================================================\n// Sampling Config\n// ============================================================================\n\nexport type ScoringSamplingConfig = { type: 'none' } | { type: 'ratio'; rate: number };\n\n// ============================================================================\n// Scoring Source & Entity Type\n// ============================================================================\n\nexport const scoringSourceSchema = z.enum(['LIVE', 'TEST']);\n\nexport type ScoringSource = z.infer<typeof scoringSourceSchema>;\n\nexport const scoringEntityTypeSchema = z.enum(['AGENT', 'WORKFLOW', ...Object.values(SpanType)] as [\n  string,\n  string,\n  ...string[],\n]);\n\nexport type ScoringEntityType = z.infer<typeof scoringEntityTypeSchema>;\n\n// ============================================================================\n// Scoring Prompts\n// ============================================================================\n\nexport const scoringPromptsSchema = z.object({\n  description: z.string(),\n  prompt: z.string(),\n});\n\nexport type ScoringPrompts = z.infer<typeof scoringPromptsSchema>;\n\n// ============================================================================\n// Shared Record Schemas\n// ============================================================================\n\n/** Reusable schema for required record fields (e.g., scorer, entity) */\nconst recordSchema = z.record(z.string(), z.unknown());\n\n/** Reusable schema for optional record fields (e.g., metadata, additionalContext) */\nconst optionalRecordSchema = recordSchema.optional();\n\n// ============================================================================\n// Base Scoring Input (used for scorer functions)\n// ============================================================================\n\nexport const scoringInputSchema = z.object({\n  runId: z.string().optional(),\n  input: z.unknown().optional(),\n  output: z.unknown(),\n  additionalContext: optionalRecordSchema,\n  requestContext: optionalRecordSchema,\n  // Note: tracingContext is not serializable, so we don't include it in the schema\n  // It's added at runtime when needed\n});\n\nexport type ScoringInput = z.infer<typeof scoringInputSchema> & {\n  tracingContext?: TracingContext;\n};\n\n// ============================================================================\n// Scoring Hook Input\n// ============================================================================\n\nexport const scoringHookInputSchema = z.object({\n  runId: z.string().optional(),\n  scorer: recordSchema,\n  input: z.unknown(),\n  output: z.unknown(),\n  metadata: optionalRecordSchema,\n  additionalContext: optionalRecordSchema,\n  source: scoringSourceSchema,\n  entity: recordSchema,\n  entityType: scoringEntityTypeSchema,\n  requestContext: optionalRecordSchema,\n  structuredOutput: z.boolean().optional(),\n  traceId: z.string().optional(),\n  spanId: z.string().optional(),\n  resourceId: z.string().optional(),\n  threadId: z.string().optional(),\n  // Note: tracingContext is not serializable, so we don't include it in the schema\n});\n\nexport type ScoringHookInput = z.infer<typeof scoringHookInputSchema> & {\n  tracingContext?: TracingContext;\n};\n\n// ============================================================================\n// Extract Step Result\n// ============================================================================\n\nexport const scoringExtractStepResultSchema = optionalRecordSchema;\n\nexport type ScoringExtractStepResult = z.infer<typeof scoringExtractStepResultSchema>;\n\n// ============================================================================\n// Analyze Step Result (Score Result)\n// ============================================================================\n\nexport const scoringValueSchema = z.number();\n\nexport const scoreResultSchema = z.object({\n  result: optionalRecordSchema,\n  score: scoringValueSchema,\n  prompt: z.string().optional(),\n});\n\nexport type ScoringAnalyzeStepResult = z.infer<typeof scoreResultSchema>;\n\n// ============================================================================\n// Composite Input Types (for scorer step functions)\n// ============================================================================\n\nexport const scoringInputWithExtractStepResultSchema = scoringInputSchema.extend({\n  runId: z.string(), // Required in this context\n  extractStepResult: optionalRecordSchema,\n  extractPrompt: z.string().optional(),\n});\n\nexport type ScoringInputWithExtractStepResult<TExtract = any> = Omit<\n  z.infer<typeof scoringInputWithExtractStepResultSchema>,\n  'extractStepResult'\n> & {\n  extractStepResult?: TExtract;\n  tracingContext?: TracingContext;\n};\n\nexport const scoringInputWithExtractStepResultAndAnalyzeStepResultSchema =\n  scoringInputWithExtractStepResultSchema.extend({\n    score: z.number(),\n    analyzeStepResult: optionalRecordSchema,\n    analyzePrompt: z.string().optional(),\n  });\n\nexport type ScoringInputWithExtractStepResultAndAnalyzeStepResult<TExtract = any, TScore = any> = Omit<\n  z.infer<typeof scoringInputWithExtractStepResultAndAnalyzeStepResultSchema>,\n  'extractStepResult' | 'analyzeStepResult'\n> & {\n  extractStepResult?: TExtract;\n  analyzeStepResult?: TScore;\n  tracingContext?: TracingContext;\n};\n\nexport const scoringInputWithExtractStepResultAndScoreAndReasonSchema =\n  scoringInputWithExtractStepResultAndAnalyzeStepResultSchema.extend({\n    reason: z.string().optional(),\n    reasonPrompt: z.string().optional(),\n  });\n\nexport type ScoringInputWithExtractStepResultAndScoreAndReason = z.infer<\n  typeof scoringInputWithExtractStepResultAndScoreAndReasonSchema\n> & {\n  tracingContext?: TracingContext;\n};\n\n// ============================================================================\n// Score Row Data (stored in DB)\n// ============================================================================\n\nexport const scoreRowDataSchema = z.object({\n  id: z.string(),\n  scorerId: z.string(),\n  entityId: z.string(),\n\n  // From ScoringInputWithExtractStepResultAndScoreAndReason\n  runId: z.string(),\n  input: z.unknown().optional(),\n  output: z.unknown(),\n  additionalContext: optionalRecordSchema,\n  requestContext: optionalRecordSchema,\n  extractStepResult: optionalRecordSchema,\n  extractPrompt: z.string().optional(),\n  score: z.number(),\n  analyzeStepResult: optionalRecordSchema,\n  analyzePrompt: z.string().optional(),\n  reason: z.string().optional(),\n  reasonPrompt: z.string().optional(),\n\n  // From ScoringHookInput\n  scorer: recordSchema,\n  metadata: optionalRecordSchema,\n  source: scoringSourceSchema,\n  entity: recordSchema,\n  entityType: scoringEntityTypeSchema.optional(),\n  structuredOutput: z.boolean().optional(),\n  traceId: z.string().optional(),\n  spanId: z.string().optional(),\n  resourceId: z.string().optional(),\n  threadId: z.string().optional(),\n\n  // Additional ScoreRowData fields\n  preprocessStepResult: optionalRecordSchema,\n  preprocessPrompt: z.string().optional(),\n  generateScorePrompt: z.string().optional(),\n  generateReasonPrompt: z.string().optional(),\n\n  // Timestamps\n  ...dbTimestamps,\n});\n\nexport type ScoreRowData = z.infer<typeof scoreRowDataSchema>;\n\n// ============================================================================\n// Save Score Payload (for creating new scores)\n// ============================================================================\n\nexport const saveScorePayloadSchema = scoreRowDataSchema.omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type SaveScorePayload = z.infer<typeof saveScorePayloadSchema>;\n\n// ============================================================================\n// List Scores Response\n// ============================================================================\n\nexport const listScoresResponseSchema = z.object({\n  pagination: paginationInfoSchema,\n  scores: z.array(scoreRowDataSchema),\n});\n\nexport type ListScoresResponse = z.infer<typeof listScoresResponseSchema>;\n\nexport type ExtractionStepFn = (input: ScoringInput) => Promise<Record<string, any>>;\n\nexport type AnalyzeStepFn = (input: ScoringInputWithExtractStepResult) => Promise<ScoringAnalyzeStepResult>;\n\nexport type ReasonStepFn = (\n  input: ScoringInputWithExtractStepResultAndAnalyzeStepResult,\n) => Promise<{ reason: string; reasonPrompt?: string } | null>;\n\nexport type ScorerOptions = {\n  name: string;\n  description: string;\n  extract?: ExtractionStepFn;\n  analyze: AnalyzeStepFn;\n  reason?: ReasonStepFn;\n  metadata?: Record<string, any>;\n  isLLMScorer?: boolean;\n};\n\nexport type ScorerRunInputForAgent = {\n  inputMessages: MastraDBMessage[];\n  rememberedMessages: MastraDBMessage[];\n  systemMessages: CoreMessage[];\n  taggedSystemMessages: Record<string, CoreSystemMessage[]>;\n};\n\nexport type ScorerRunOutputForAgent = MastraDBMessage[];\n","import { z } from 'zod';\nimport { scoreRowDataSchema } from '../../../evals/types';\nimport { SpanType } from '../../../observability/types';\nimport {\n  dateRangeSchema,\n  dbTimestamps,\n  entityIdField,\n  entityNameField,\n  entityTypeField,\n  environmentField,\n  organizationIdField,\n  paginationArgsSchema,\n  paginationInfoSchema,\n  requestIdField,\n  resourceIdField,\n  runIdField,\n  serviceNameField,\n  sessionIdField,\n  sortDirectionSchema,\n  sourceField,\n  threadIdField,\n  userIdField,\n} from '../shared';\n\n/** Strategy for how tracing data is persisted to storage */\nexport type TracingStorageStrategy = 'realtime' | 'batch-with-updates' | 'insert-only';\n\n// ============================================================================\n// Helper utilities for creating omit key objects from schema shapes\n// ============================================================================\n\n/**\n * Creates an omit key object from a Zod schema shape.\n * This allows dynamically deriving omit keys from existing schema definitions.\n */\nconst createOmitKeys = <T extends z.ZodRawShape>(shape: T): { [K in keyof T]: true } =>\n  Object.fromEntries(Object.keys(shape).map(k => [k, true])) as { [K in keyof T]: true };\n\n// ============================================================================\n// Primitive Field Definitions\n// ============================================================================\n\n/** Zod schema for trace ID field */\nexport const traceIdField = z.string().describe('Unique trace identifier');\n\n/** Zod schema for span ID field */\nexport const spanIdField = z.string().describe('Unique span identifier within a trace');\n\nconst spanNameField = z.string().describe('Human-readable span name');\nconst parentSpanIdField = z.string().describe('Parent span reference (null = root span)');\nconst spanTypeField = z.nativeEnum(SpanType).describe('Span type (e.g., WORKFLOW_RUN, AGENT_RUN, TOOL_CALL, etc.)');\nconst attributesField = z.record(z.unknown()).describe('Span-type specific attributes (e.g., model, tokens, tools)');\nconst metadataField = z.record(z.unknown()).describe('User-defined metadata for custom filtering');\nconst tagsField = z.array(z.string()).describe('Labels for filtering traces (only on the root span)');\nconst scopeField = z\n  .record(z.unknown())\n  .describe('Arbitrary package/app version info (e.g., {\"core\": \"1.0.0\", \"memory\": \"1.0.0\", \"gitSha\": \"abcd1234\"})');\nconst linksField = z.array(z.unknown()).describe('References to related spans in other traces');\nconst inputField = z.unknown().describe('Input data passed to the span');\nconst outputField = z.unknown().describe('Output data returned from the span');\nconst errorField = z.unknown().describe('Error info - presence indicates failure (status derived from this)');\nconst isEventField = z.boolean().describe('Whether this is an event (point-in-time) vs a span (duration)');\nconst startedAtField = z.date().describe('When the span started');\nconst endedAtField = z.date().describe('When the span ended (null = running, status derived from this)');\n\n/** Status of a trace derived from the root span's state */\nexport enum TraceStatus {\n  SUCCESS = 'success',\n  ERROR = 'error',\n  RUNNING = 'running',\n}\n\nconst traceStatusField = z.nativeEnum(TraceStatus).describe('Current status of the trace');\n\nconst hasChildErrorField = z\n  .preprocess(v => {\n    // Handle string \"true\"/\"false\" from query params correctly\n    // z.coerce.boolean() would convert \"false\" to true (Boolean(\"false\") === true)\n    if (v === 'true') return true;\n    if (v === 'false') return false;\n    return v;\n  }, z.boolean())\n  .describe('True if any span in the trace encountered an error');\n\n// ============================================================================\n// Shared Fields (used by both spanRecordSchema and tracesFilterSchema)\n// ============================================================================\n\n/**\n * All optional fields shared between span records and trace filters.\n * Note: When filtering traces, these fields are matched against the root span.\n */\nconst sharedFields = {\n  // Entity identification - first-class fields for filtering (e.g., agent, workflow, tool)\n  entityType: entityTypeField.nullish(),\n  entityId: entityIdField.nullish(),\n  entityName: entityNameField.nullish(),\n\n  // Identity & tenancy - for multi-tenant applications\n  userId: userIdField.nullish(),\n  organizationId: organizationIdField.nullish(),\n  resourceId: resourceIdField.nullish(),\n\n  // Correlation IDs - for linking related operations\n  runId: runIdField.nullish(),\n  sessionId: sessionIdField.nullish(),\n  threadId: threadIdField.nullish(),\n  requestId: requestIdField.nullish(),\n\n  // Deployment context - these fields only exist on the root span\n  environment: environmentField.nullish(),\n  source: sourceField.nullish(),\n  serviceName: serviceNameField.nullish(),\n  scope: scopeField.nullish(),\n\n  // Filterable data - user-defined metadata and tags (tags only on root span)\n  metadata: metadataField.nullish(),\n  tags: tagsField.nullish(),\n} as const;\n\n// ============================================================================\n// Span Record Schema (for storage)\n// ============================================================================\n\n/** Shape containing trace and span identifier fields */\nexport const spanIds = {\n  traceId: traceIdField,\n  spanId: spanIdField,\n} as const satisfies z.ZodRawShape;\n\n/** Schema for span identifiers (traceId and spanId) */\nexport const spanIdsSchema = z.object({\n  ...spanIds,\n});\n\n/** Span identifier pair (traceId and spanId) */\nexport type SpanIds = z.infer<typeof spanIdsSchema>;\n\n// Omit key objects derived from schema shapes for use with .omit()\nconst omitDbTimestamps = createOmitKeys(dbTimestamps);\nconst omitSpanIds = createOmitKeys(spanIds);\n\n/** Schema for a complete span record as stored in the database */\nexport const spanRecordSchema = z\n  .object({\n    // Required identifiers\n    ...spanIds,\n    name: spanNameField,\n    spanType: spanTypeField,\n    isEvent: isEventField,\n    startedAt: startedAtField,\n\n    // Shared fields\n    parentSpanId: parentSpanIdField.nullish(),\n    ...sharedFields,\n\n    // Additional span-specific nullish fields\n    attributes: attributesField.nullish(),\n    links: linksField.nullish(),\n    input: inputField.nullish(),\n    output: outputField.nullish(),\n    error: errorField.nullish(),\n    endedAt: endedAtField.nullish(),\n\n    // Database timestamps\n    ...dbTimestamps,\n  })\n  .describe('Span record data');\n\n/** Complete span record as stored in the database */\nexport type SpanRecord = z.infer<typeof spanRecordSchema>;\n\n// ============================================================================\n// Storage Operation Schemas\n// ============================================================================\n\n/**\n * Schema for creating a span (without db timestamps)\n */\nexport const createSpanRecordSchema = spanRecordSchema.omit(omitDbTimestamps);\n\n/** Span record for creation (excludes db timestamps) */\nexport type CreateSpanRecord = z.infer<typeof createSpanRecordSchema>;\n\n/**\n * Schema for createSpan operation arguments\n */\nexport const createSpanArgsSchema = z\n  .object({\n    span: createSpanRecordSchema,\n  })\n  .describe('Arguments for creating a single span');\n\n/** Arguments for creating a single span */\nexport type CreateSpanArgs = z.infer<typeof createSpanArgsSchema>;\n\n/**\n * Schema for batchCreateSpans operation arguments\n */\nexport const batchCreateSpansArgsSchema = z\n  .object({\n    records: z.array(createSpanRecordSchema),\n  })\n  .describe('Arguments for batch creating spans');\n\n/** Arguments for batch creating multiple spans */\nexport type BatchCreateSpansArgs = z.infer<typeof batchCreateSpansArgsSchema>;\n\n/**\n * Schema for getSpan operation arguments\n */\nexport const getSpanArgsSchema = z\n  .object({\n    traceId: traceIdField.min(1),\n    spanId: spanIdField.min(1),\n  })\n  .describe('Arguments for getting a single span');\n\n/** Arguments for retrieving a single span */\nexport type GetSpanArgs = z.infer<typeof getSpanArgsSchema>;\n\n/**\n * Response schema for getSpan operation\n */\nexport const getSpanResponseSchema = z.object({\n  span: spanRecordSchema,\n});\n\n/** Response containing a single span */\nexport type GetSpanResponse = z.infer<typeof getSpanResponseSchema>;\n\n/**\n * Schema for getRootSpan operation arguments\n */\nexport const getRootSpanArgsSchema = z\n  .object({\n    traceId: traceIdField.min(1),\n  })\n  .describe('Arguments for getting a root span');\n\n/** Arguments for retrieving a root span */\nexport type GetRootSpanArgs = z.infer<typeof getRootSpanArgsSchema>;\n\n/**\n * Response schema for getRootSpan operation\n */\nexport const getRootSpanResponseSchema = z.object({\n  span: spanRecordSchema,\n});\n\n/** Response containing a single root span */\nexport type GetRootSpanResponse = z.infer<typeof getRootSpanResponseSchema>;\n\n/**\n * Schema for getTrace operation arguments\n */\nexport const getTraceArgsSchema = z\n  .object({\n    traceId: traceIdField.min(1),\n  })\n  .describe('Arguments for getting a single trace');\n\n/** Arguments for retrieving a single trace */\nexport type GetTraceArgs = z.infer<typeof getTraceArgsSchema>;\n\n/**\n * Response schema for getTrace operation\n */\nexport const getTraceResponseSchema = z.object({\n  traceId: traceIdField,\n  spans: z.array(spanRecordSchema),\n});\n\n/** Response containing a trace with all its spans */\nexport type GetTraceResponse = z.infer<typeof getTraceResponseSchema>;\n\nexport type TraceRecord = GetTraceResponse;\n\n/** Schema for filtering traces in list queries */\nexport const tracesFilterSchema = z\n  .object({\n    // Date range filters\n    startedAt: dateRangeSchema.optional().describe('Filter by span start time range'),\n    endedAt: dateRangeSchema.optional().describe('Filter by span end time range'),\n\n    // Span type filter\n    spanType: spanTypeField.optional(),\n\n    // Shared fields\n    ...sharedFields,\n\n    // Filter-specific derived status fields\n    status: traceStatusField.optional(),\n    hasChildError: hasChildErrorField.optional(),\n  })\n  .describe('Filters for querying traces');\n\n/**\n * Fields available for ordering trace results\n */\nexport const tracesOrderByFieldSchema = z\n  .enum(['startedAt', 'endedAt'])\n  .describe(\"Field to order by: 'startedAt' | 'endedAt'\");\n\n/**\n * Order by configuration for trace queries\n * Follows the existing StorageOrderBy pattern\n * Defaults to startedAt desc (newest first)\n */\nexport const tracesOrderBySchema = z\n  .object({\n    field: tracesOrderByFieldSchema.default('startedAt').describe('Field to order by'),\n    direction: sortDirectionSchema.default('DESC').describe('Sort direction'),\n  })\n  .describe('Order by configuration');\n\n/**\n * Arguments for listing traces\n */\nexport const listTracesArgsSchema = z\n  .object({\n    filters: tracesFilterSchema.optional().describe('Optional filters to apply'),\n    pagination: paginationArgsSchema.default({}).describe('Pagination settings'),\n    orderBy: tracesOrderBySchema.default({}).describe('Ordering configuration (defaults to startedAt desc)'),\n  })\n  .describe('Arguments for listing traces');\n\n/** Arguments for listing traces with optional filters, pagination, and ordering */\nexport type ListTracesArgs = z.input<typeof listTracesArgsSchema>;\n\n/** Schema for listTraces operation response */\nexport const listTracesResponseSchema = z.object({\n  pagination: paginationInfoSchema,\n  spans: z.array(spanRecordSchema),\n});\n\n/** Response containing paginated root spans for trace listing */\nexport type ListTracesResponse = z.infer<typeof listTracesResponseSchema>;\n\n/**\n * Schema for updating a span (without db timestamps and span IDs)\n */\nexport const updateSpanRecordSchema = createSpanRecordSchema.omit(omitSpanIds);\n\n/** Partial span data for updates (excludes db timestamps and span IDs) */\nexport type UpdateSpanRecord = z.infer<typeof updateSpanRecordSchema>;\n\n/**\n * Schema for updateSpan operation arguments\n */\nexport const updateSpanArgsSchema = z\n  .object({\n    spanId: spanIdField,\n    traceId: traceIdField,\n    updates: updateSpanRecordSchema.partial(),\n  })\n  .describe('Arguments for updating a single span');\n\n/** Arguments for updating a single span */\nexport type UpdateSpanArgs = z.infer<typeof updateSpanArgsSchema>;\n\n/**\n * Schema for batchUpdateSpans operation arguments\n */\nexport const batchUpdateSpansArgsSchema = z\n  .object({\n    records: z.array(\n      z.object({\n        traceId: traceIdField,\n        spanId: spanIdField,\n        updates: updateSpanRecordSchema.partial(),\n      }),\n    ),\n  })\n  .describe('Arguments for batch updating spans');\n\n/** Arguments for batch updating multiple spans */\nexport type BatchUpdateSpansArgs = z.infer<typeof batchUpdateSpansArgsSchema>;\n\n/**\n * Schema for batchDeleteTraces operation arguments\n */\nexport const batchDeleteTracesArgsSchema = z\n  .object({\n    traceIds: z.array(traceIdField),\n  })\n  .describe('Arguments for batch deleting traces');\n\n/** Arguments for batch deleting multiple traces */\nexport type BatchDeleteTracesArgs = z.infer<typeof batchDeleteTracesArgsSchema>;\n\n// ============================================================================\n// Scoring related schemas\n// ============================================================================\n\n/** Schema for listScoresBySpan operation response */\nexport const listScoresBySpanResponseSchema = z.object({\n  pagination: paginationInfoSchema,\n  scores: z.array(scoreRowDataSchema),\n});\n\n/** Schema for scoreTraces operation request */\nexport const scoreTracesRequestSchema = z.object({\n  scorerName: z.string().min(1),\n  targets: z\n    .array(\n      z.object({\n        traceId: traceIdField,\n        spanId: spanIdField.optional(),\n      }),\n    )\n    .min(1),\n});\n\n/** Request to score traces using a specific scorer */\nexport type ScoreTracesRequest = z.infer<typeof scoreTracesRequestSchema>;\n\n/** Schema for scoreTraces operation response */\nexport const scoreTracesResponseSchema = z.object({\n  status: z.string(),\n  message: z.string(),\n  traceCount: z.number(),\n});\n\n/** Response from scoring traces */\nexport type ScoreTracesResponse = z.infer<typeof scoreTracesResponseSchema>;\n","import type { z } from 'zod';\nimport type { SerializedError } from '../error';\nimport type { MastraDBMessage, StorageThreadType } from '../memory/types';\nimport { getZodTypeName } from '../utils/zod-utils';\nimport type { StepResult, WorkflowRunState, WorkflowRunStatus } from '../workflows';\n\nexport type StoragePagination = {\n  page: number;\n  perPage: number | false;\n};\n\nexport type StorageColumnType = 'text' | 'timestamp' | 'uuid' | 'jsonb' | 'integer' | 'float' | 'bigint' | 'boolean';\n\nexport interface StorageColumn {\n  type: StorageColumnType;\n  primaryKey?: boolean;\n  nullable?: boolean;\n  references?: {\n    table: string;\n    column: string;\n  };\n}\nexport interface WorkflowRuns {\n  runs: WorkflowRun[];\n  total: number;\n}\n\nexport interface StorageWorkflowRun {\n  workflow_name: string;\n  run_id: string;\n  resourceId?: string;\n  snapshot: WorkflowRunState | string;\n  createdAt: Date;\n  updatedAt: Date;\n}\nexport interface WorkflowRun {\n  workflowName: string;\n  runId: string;\n  snapshot: WorkflowRunState | string;\n  createdAt: Date;\n  updatedAt: Date;\n  resourceId?: string;\n}\n\nexport type PaginationInfo = {\n  total: number;\n  page: number;\n  /**\n   * Number of items per page, or `false` to fetch all records without pagination limit.\n   * When `false`, all matching records are returned in a single response.\n   */\n  perPage: number | false;\n  hasMore: boolean;\n};\n\nexport type MastraMessageFormat = 'v1' | 'v2';\n\nexport type StorageListMessagesInput = {\n  threadId: string | string[];\n  resourceId?: string;\n  include?: {\n    id: string;\n    threadId?: string;\n    withPreviousMessages?: number;\n    withNextMessages?: number;\n  }[];\n  /**\n   * Number of items per page, or `false` to fetch all records without pagination limit.\n   * Defaults to 40 if not specified.\n   */\n  perPage?: number | false;\n  /**\n   * Zero-indexed page number for pagination.\n   * Defaults to 0 if not specified.\n   */\n  page?: number;\n  filter?: {\n    dateRange?: {\n      start?: Date;\n      end?: Date;\n      /**\n       * When true, excludes the start date from results (uses > instead of >=).\n       * Useful for cursor-based pagination to avoid duplicates.\n       * @default false\n       */\n      startExclusive?: boolean;\n      /**\n       * When true, excludes the end date from results (uses < instead of <=).\n       * Useful for cursor-based pagination to avoid duplicates.\n       * @default false\n       */\n      endExclusive?: boolean;\n    };\n  };\n  orderBy?: StorageOrderBy<'createdAt'>;\n};\n\nexport type StorageListMessagesOutput = PaginationInfo & {\n  messages: MastraDBMessage[];\n};\n\nexport type StorageListWorkflowRunsInput = {\n  workflowName?: string;\n  fromDate?: Date;\n  toDate?: Date;\n  /**\n   * Number of items per page, or `false` to fetch all records without pagination limit.\n   * When undefined, returns all workflow runs without pagination.\n   * When both perPage and page are provided, pagination is applied.\n   */\n  perPage?: number | false;\n  /**\n   * Zero-indexed page number for pagination.\n   * When both perPage and page are provided, pagination is applied.\n   * When either is undefined, all results are returned.\n   */\n  page?: number;\n  resourceId?: string;\n  status?: WorkflowRunStatus;\n};\n\nexport type StorageListThreadsByResourceIdInput = {\n  resourceId: string;\n  /**\n   * Number of items per page, or `false` to fetch all records without pagination limit.\n   * Defaults to 100 if not specified.\n   */\n  perPage?: number | false;\n  /**\n   * Zero-indexed page number for pagination.\n   * Defaults to 0 if not specified.\n   */\n  page?: number;\n  orderBy?: StorageOrderBy;\n};\n\nexport type StorageListThreadsByResourceIdOutput = PaginationInfo & {\n  threads: StorageThreadType[];\n};\n\n/**\n * Metadata stored on cloned threads to track their origin\n */\nexport type ThreadCloneMetadata = {\n  /** ID of the thread this was cloned from */\n  sourceThreadId: string;\n  /** Timestamp when the clone was created */\n  clonedAt: Date;\n  /** ID of the last message included in the clone (if messages were copied) */\n  lastMessageId?: string;\n};\n\n/**\n * Input options for cloning a thread\n */\nexport type StorageCloneThreadInput = {\n  /** ID of the thread to clone */\n  sourceThreadId: string;\n  /** ID for the new cloned thread (if not provided, a random UUID will be generated) */\n  newThreadId?: string;\n  /** Resource ID for the new thread (defaults to source thread's resourceId) */\n  resourceId?: string;\n  /** Title for the new cloned thread */\n  title?: string;\n  /** Additional metadata to merge with clone metadata */\n  metadata?: Record<string, unknown>;\n  /** Options for filtering which messages to include */\n  options?: {\n    /** Maximum number of messages to copy (from most recent) */\n    messageLimit?: number;\n    /** Filter messages by date range or specific IDs */\n    messageFilter?: {\n      /** Only include messages created on or after this date */\n      startDate?: Date;\n      /** Only include messages created on or before this date */\n      endDate?: Date;\n      /** Only include messages with these specific IDs */\n      messageIds?: string[];\n    };\n  };\n};\n\n/**\n * Output from cloning a thread\n */\nexport type StorageCloneThreadOutput = {\n  /** The newly created cloned thread */\n  thread: StorageThreadType;\n  /** The messages that were copied to the new thread */\n  clonedMessages: MastraDBMessage[];\n};\n\nexport type StorageResourceType = {\n  id: string;\n  workingMemory?: string;\n  metadata?: Record<string, unknown>;\n  createdAt: Date;\n  updatedAt: Date;\n};\n\nexport type StorageMessageType = {\n  id: string;\n  thread_id: string;\n  content: string;\n  role: string;\n  type: string;\n  createdAt: Date;\n  resourceId: string | null;\n};\n\nexport interface StorageOrderBy<TField extends ThreadOrderBy = ThreadOrderBy> {\n  field?: TField;\n  direction?: ThreadSortDirection;\n}\n\nexport interface ThreadSortOptions {\n  orderBy?: ThreadOrderBy;\n  sortDirection?: ThreadSortDirection;\n}\n\nexport type ThreadOrderBy = 'createdAt' | 'updatedAt';\n\nexport type ThreadSortDirection = 'ASC' | 'DESC';\n\n// Agent Storage Types\n\n/**\n * Scorer reference with optional sampling configuration\n */\nexport interface StorageScorerConfig {\n  /** Sampling configuration for this scorer */\n  sampling?: {\n    type: 'ratio' | 'count';\n    rate?: number;\n    count?: number;\n  };\n}\n\n/**\n * Stored agent configuration type.\n * Primitives (tools, workflows, agents, memory, scorers) are stored as references\n * that get resolved from Mastra's registries at runtime.\n */\nexport interface StorageAgentType {\n  id: string;\n  name: string;\n  description?: string;\n  instructions: string;\n  /** Model configuration (provider, name, etc.) */\n  model: Record<string, unknown>;\n  /** Array of tool keys to resolve from Mastra's tool registry */\n  tools?: string[];\n  /** Default options for generate/stream calls */\n  defaultOptions?: Record<string, unknown>;\n  /** Array of workflow keys to resolve from Mastra's workflow registry */\n  workflows?: string[];\n  /** Array of agent keys to resolve from Mastra's agent registry */\n  agents?: string[];\n  /** Input processor configurations */\n  inputProcessors?: Record<string, unknown>[];\n  /** Output processor configurations */\n  outputProcessors?: Record<string, unknown>[];\n  /** Memory key to resolve from Mastra's memory registry */\n  memory?: string;\n  /** Scorer keys with optional sampling config, to resolve from Mastra's scorer registry */\n  scorers?: Record<string, StorageScorerConfig>;\n  /** Additional metadata for the agent */\n  metadata?: Record<string, unknown>;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport type StorageCreateAgentInput = Omit<StorageAgentType, 'createdAt' | 'updatedAt'>;\n\nexport type StorageUpdateAgentInput = {\n  id: string;\n  name?: string;\n  description?: string;\n  instructions?: string;\n  model?: Record<string, unknown>;\n  /** Array of tool keys to resolve from Mastra's tool registry */\n  tools?: string[];\n  defaultOptions?: Record<string, unknown>;\n  /** Array of workflow keys to resolve from Mastra's workflow registry */\n  workflows?: string[];\n  /** Array of agent keys to resolve from Mastra's agent registry */\n  agents?: string[];\n  inputProcessors?: Record<string, unknown>[];\n  outputProcessors?: Record<string, unknown>[];\n  /** Memory key to resolve from Mastra's memory registry */\n  memory?: string;\n  /** Scorer keys with optional sampling config */\n  scorers?: Record<string, StorageScorerConfig>;\n  metadata?: Record<string, unknown>;\n};\n\nexport type StorageListAgentsInput = {\n  /**\n   * Number of items per page, or `false` to fetch all records without pagination limit.\n   * Defaults to 100 if not specified.\n   */\n  perPage?: number | false;\n  /**\n   * Zero-indexed page number for pagination.\n   * Defaults to 0 if not specified.\n   */\n  page?: number;\n  orderBy?: StorageOrderBy;\n};\n\nexport type StorageListAgentsOutput = PaginationInfo & {\n  agents: StorageAgentType[];\n};\n\n// Basic Index Management Types\nexport interface CreateIndexOptions {\n  name: string;\n  table: string;\n  columns: string[];\n  unique?: boolean;\n  concurrent?: boolean;\n  /**\n   * SQL WHERE clause for creating partial indexes.\n   * @internal Reserved for internal use only. Callers must pre-validate this value.\n   * DDL statements cannot use parameterized queries for WHERE clauses, so this value\n   * is concatenated directly into the SQL. Any user-facing usage must validate input.\n   */\n  where?: string;\n  method?: 'btree' | 'hash' | 'gin' | 'gist' | 'spgist' | 'brin';\n  opclass?: string; // Operator class for GIN/GIST indexes\n  storage?: Record<string, any>; // Storage parameters\n  tablespace?: string; // Tablespace name\n}\n\nexport interface IndexInfo {\n  name: string;\n  table: string;\n  columns: string[];\n  unique: boolean;\n  size: string;\n  definition: string;\n}\n\nexport interface StorageIndexStats extends IndexInfo {\n  scans: number; // Number of index scans\n  tuples_read: number; // Number of tuples read\n  tuples_fetched: number; // Number of tuples fetched\n  last_used?: Date; // Last time index was used\n  method?: string; // Index method (btree, hash, etc)\n}\n\n// Workflow Storage Types\nexport interface UpdateWorkflowStateOptions {\n  status: WorkflowRunStatus;\n  result?: StepResult<any, any, any, any>;\n  error?: SerializedError;\n  suspendedPaths?: Record<string, number[]>;\n  waitingPaths?: Record<string, number[]>;\n}\n\n/**\n * Get the inner type from a wrapper schema (nullable, optional, default, effects, branded).\n * Compatible with both Zod 3 and Zod 4.\n */\nfunction getInnerType(schema: z.ZodTypeAny, typeName: string): z.ZodTypeAny | undefined {\n  const schemaAny = schema as any;\n\n  // For nullable, optional, default - the inner type is at _def.innerType\n  if (typeName === 'ZodNullable' || typeName === 'ZodOptional' || typeName === 'ZodDefault') {\n    return schemaAny._zod?.def?.innerType ?? schemaAny._def?.innerType;\n  }\n\n  // For effects - the inner type is at _def.schema\n  if (typeName === 'ZodEffects') {\n    return schemaAny._zod?.def?.schema ?? schemaAny._def?.schema;\n  }\n\n  // For branded - the inner type is at _def.type\n  if (typeName === 'ZodBranded') {\n    return schemaAny._zod?.def?.type ?? schemaAny._def?.type;\n  }\n\n  return undefined;\n}\n\nfunction unwrapSchema(schema: z.ZodTypeAny): { base: z.ZodTypeAny; nullable: boolean } {\n  let current = schema;\n  let nullable = false;\n\n  while (true) {\n    const typeName = getZodTypeName(current);\n\n    if (typeName === 'ZodNullable') {\n      nullable = true;\n      const inner = getInnerType(current, typeName);\n      if (inner) {\n        current = inner;\n        continue;\n      }\n    }\n\n    if (typeName === 'ZodOptional') {\n      // For DB purposes, we usually treat \"optional\" as \"nullable\"\n      nullable = true;\n      const inner = getInnerType(current, typeName);\n      if (inner) {\n        current = inner;\n        continue;\n      }\n    }\n\n    if (typeName === 'ZodDefault') {\n      const inner = getInnerType(current, typeName);\n      if (inner) {\n        current = inner;\n        continue;\n      }\n    }\n\n    if (typeName === 'ZodEffects') {\n      const inner = getInnerType(current, typeName);\n      if (inner) {\n        current = inner;\n        continue;\n      }\n    }\n\n    if (typeName === 'ZodBranded') {\n      const inner = getInnerType(current, typeName);\n      if (inner) {\n        current = inner;\n        continue;\n      }\n    }\n\n    // If you ever use ZodCatch/ZodPipeline, you can unwrap them here too.\n    break;\n  }\n\n  return { base: current, nullable };\n}\n\n/**\n * Extract checks array from Zod schema, compatible with both Zod 3 and Zod 4.\n * Zod 3 uses _def.checks, Zod 4 uses _zod.def.checks.\n */\nfunction getZodChecks(schema: z.ZodTypeAny): Array<{ kind: string }> {\n  const schemaAny = schema as any;\n  // Zod 4 structure\n  if (schemaAny._zod?.def?.checks) {\n    return schemaAny._zod.def.checks;\n  }\n  // Zod 3 structure\n  if (schemaAny._def?.checks) {\n    return schemaAny._def.checks;\n  }\n  return [];\n}\n\nfunction zodToStorageType(schema: z.ZodTypeAny): StorageColumnType {\n  const typeName = getZodTypeName(schema);\n\n  if (typeName === 'ZodString') {\n    // Check for UUID validation\n    const checks = getZodChecks(schema);\n    if (checks.some(c => c.kind === 'uuid')) {\n      return 'uuid';\n    }\n    return 'text';\n  }\n  if (typeName === 'ZodNativeEnum' || typeName === 'ZodEnum') {\n    return 'text';\n  }\n  if (typeName === 'ZodNumber') {\n    // Check for integer validation\n    const checks = getZodChecks(schema);\n    return checks.some(c => c.kind === 'int') ? 'integer' : 'float';\n  }\n  if (typeName === 'ZodBigInt') {\n    return 'bigint';\n  }\n  if (typeName === 'ZodDate') {\n    return 'timestamp';\n  }\n  if (typeName === 'ZodBoolean') {\n    return 'boolean';\n  }\n  // fall back for objects/records/unknown\n  return 'jsonb';\n}\n\n/**\n * Converts a zod schema into a database schema\n * @param zObject A zod schema object\n * @returns database schema record with StorageColumns\n */\nexport function buildStorageSchema<Shape extends z.ZodRawShape>(\n  zObject: z.ZodObject<Shape>,\n): Record<keyof Shape & string, StorageColumn> {\n  const shape = zObject.shape;\n  const result: Record<string, StorageColumn> = {};\n\n  for (const [key, field] of Object.entries(shape)) {\n    const { base, nullable } = unwrapSchema(field as z.ZodTypeAny);\n    result[key] = {\n      type: zodToStorageType(base),\n      nullable,\n    };\n  }\n\n  return result as Record<keyof Shape & string, StorageColumn>;\n}\n","import { spanRecordSchema } from './domains/observability/types';\nimport { buildStorageSchema } from './types';\nimport type { StorageColumn } from './types';\n\nexport const TABLE_WORKFLOW_SNAPSHOT = 'mastra_workflow_snapshot';\nexport const TABLE_MESSAGES = 'mastra_messages';\nexport const TABLE_THREADS = 'mastra_threads';\nexport const TABLE_TRACES = 'mastra_traces';\nexport const TABLE_RESOURCES = 'mastra_resources';\nexport const TABLE_SCORERS = 'mastra_scorers';\nexport const TABLE_SPANS = 'mastra_ai_spans';\nexport const TABLE_AGENTS = 'mastra_agents';\n\nexport type TABLE_NAMES =\n  | typeof TABLE_WORKFLOW_SNAPSHOT\n  | typeof TABLE_MESSAGES\n  | typeof TABLE_THREADS\n  | typeof TABLE_TRACES\n  | typeof TABLE_RESOURCES\n  | typeof TABLE_SCORERS\n  | typeof TABLE_SPANS\n  | typeof TABLE_AGENTS;\n\nexport const SCORERS_SCHEMA: Record<string, StorageColumn> = {\n  id: { type: 'text', nullable: false, primaryKey: true },\n  scorerId: { type: 'text' },\n  traceId: { type: 'text', nullable: true },\n  spanId: { type: 'text', nullable: true },\n  runId: { type: 'text' },\n  scorer: { type: 'jsonb' },\n  preprocessStepResult: { type: 'jsonb', nullable: true },\n  extractStepResult: { type: 'jsonb', nullable: true },\n  analyzeStepResult: { type: 'jsonb', nullable: true },\n  score: { type: 'float' },\n  reason: { type: 'text', nullable: true },\n  metadata: { type: 'jsonb', nullable: true },\n  preprocessPrompt: { type: 'text', nullable: true },\n  extractPrompt: { type: 'text', nullable: true },\n  generateScorePrompt: { type: 'text', nullable: true },\n  generateReasonPrompt: { type: 'text', nullable: true },\n  analyzePrompt: { type: 'text', nullable: true },\n\n  // Deprecated\n  reasonPrompt: { type: 'text', nullable: true },\n  input: { type: 'jsonb' },\n  output: { type: 'jsonb' }, // MESSAGE OUTPUT\n  additionalContext: { type: 'jsonb', nullable: true }, // DATA FROM THE CONTEXT PARAM ON AN AGENT\n  requestContext: { type: 'jsonb', nullable: true }, // THE EVALUATE Request Context FOR THE RUN\n  /**\n   * Things you can evaluate\n   */\n  entityType: { type: 'text', nullable: true }, // WORKFLOW, AGENT, TOOL, STEP, NETWORK\n  entity: { type: 'jsonb', nullable: true }, // MINIMAL JSON DATA ABOUT WORKFLOW, AGENT, TOOL, STEP, NETWORK\n  entityId: { type: 'text', nullable: true },\n  source: { type: 'text' },\n  resourceId: { type: 'text', nullable: true },\n  threadId: { type: 'text', nullable: true },\n  createdAt: { type: 'timestamp' },\n  updatedAt: { type: 'timestamp' },\n};\n\nexport const SPAN_SCHEMA = buildStorageSchema(spanRecordSchema);\n\n/**\n * @deprecated Use SPAN_SCHEMA instead. This legacy schema is retained only for migration purposes.\n * @internal\n */\nexport const OLD_SPAN_SCHEMA: Record<string, StorageColumn> = {\n  // Composite primary key of traceId and spanId\n  traceId: { type: 'text', nullable: false },\n  spanId: { type: 'text', nullable: false },\n  parentSpanId: { type: 'text', nullable: true },\n  name: { type: 'text', nullable: false },\n  scope: { type: 'jsonb', nullable: true }, // Mastra package info {\"core-version\": \"0.1.0\"}\n  spanType: { type: 'text', nullable: false }, // WORKFLOW_RUN, WORKFLOW_STEP, AGENT_RUN, AGENT_STEP, TOOL_RUN, TOOL_STEP, etc.\n  attributes: { type: 'jsonb', nullable: true },\n  metadata: { type: 'jsonb', nullable: true },\n  links: { type: 'jsonb', nullable: true },\n  input: { type: 'jsonb', nullable: true },\n  output: { type: 'jsonb', nullable: true },\n  error: { type: 'jsonb', nullable: true },\n  startedAt: { type: 'timestamp', nullable: false }, // When the span started\n  endedAt: { type: 'timestamp', nullable: true }, // When the span ended\n  createdAt: { type: 'timestamp', nullable: false }, // The time the database record was created\n  updatedAt: { type: 'timestamp', nullable: true }, // The time the database record was last updated\n  isEvent: { type: 'boolean', nullable: false },\n};\n\nexport const AGENTS_SCHEMA: Record<string, StorageColumn> = {\n  id: { type: 'text', nullable: false, primaryKey: true },\n  name: { type: 'text', nullable: false },\n  description: { type: 'text', nullable: true },\n  instructions: { type: 'text', nullable: false }, // System instructions for the agent\n  model: { type: 'jsonb', nullable: false }, // Model configuration (provider, name, etc.)\n  tools: { type: 'jsonb', nullable: true }, // Serialized tool references/configurations\n  defaultOptions: { type: 'jsonb', nullable: true }, // Default options for generate/stream calls\n  workflows: { type: 'jsonb', nullable: true }, // Workflow references (IDs or configurations)\n  agents: { type: 'jsonb', nullable: true }, // Sub-agent references (IDs or configurations)\n  inputProcessors: { type: 'jsonb', nullable: true }, // Input processor configurations\n  outputProcessors: { type: 'jsonb', nullable: true }, // Output processor configurations\n  memory: { type: 'jsonb', nullable: true }, // Memory configuration\n  scorers: { type: 'jsonb', nullable: true }, // Scorer configurations\n  metadata: { type: 'jsonb', nullable: true }, // Additional metadata for the agent\n  createdAt: { type: 'timestamp', nullable: false },\n  updatedAt: { type: 'timestamp', nullable: false },\n};\n\nexport const TABLE_SCHEMAS: Record<TABLE_NAMES, Record<string, StorageColumn>> = {\n  [TABLE_WORKFLOW_SNAPSHOT]: {\n    workflow_name: {\n      type: 'text',\n    },\n    run_id: {\n      type: 'text',\n    },\n    resourceId: { type: 'text', nullable: true },\n    snapshot: {\n      type: 'jsonb',\n    },\n    createdAt: {\n      type: 'timestamp',\n    },\n    updatedAt: {\n      type: 'timestamp',\n    },\n  },\n  [TABLE_SCORERS]: SCORERS_SCHEMA,\n  [TABLE_THREADS]: {\n    id: { type: 'text', nullable: false, primaryKey: true },\n    resourceId: { type: 'text', nullable: false },\n    title: { type: 'text', nullable: false },\n    metadata: { type: 'jsonb', nullable: true },\n    createdAt: { type: 'timestamp', nullable: false },\n    updatedAt: { type: 'timestamp', nullable: false },\n  },\n  [TABLE_MESSAGES]: {\n    id: { type: 'text', nullable: false, primaryKey: true },\n    thread_id: { type: 'text', nullable: false },\n    content: { type: 'text', nullable: false },\n    role: { type: 'text', nullable: false },\n    type: { type: 'text', nullable: false },\n    createdAt: { type: 'timestamp', nullable: false },\n    resourceId: { type: 'text', nullable: true },\n  },\n  [TABLE_SPANS]: SPAN_SCHEMA,\n  [TABLE_TRACES]: {\n    id: { type: 'text', nullable: false, primaryKey: true },\n    parentSpanId: { type: 'text', nullable: true },\n    name: { type: 'text', nullable: false },\n    traceId: { type: 'text', nullable: false },\n    scope: { type: 'text', nullable: false },\n    kind: { type: 'integer', nullable: false },\n    attributes: { type: 'jsonb', nullable: true },\n    status: { type: 'jsonb', nullable: true },\n    events: { type: 'jsonb', nullable: true },\n    links: { type: 'jsonb', nullable: true },\n    other: { type: 'text', nullable: true },\n    startTime: { type: 'bigint', nullable: false },\n    endTime: { type: 'bigint', nullable: false },\n    createdAt: { type: 'timestamp', nullable: false },\n  },\n  [TABLE_RESOURCES]: {\n    id: { type: 'text', nullable: false, primaryKey: true },\n    workingMemory: { type: 'text', nullable: true },\n    metadata: { type: 'jsonb', nullable: true },\n    createdAt: { type: 'timestamp', nullable: false },\n    updatedAt: { type: 'timestamp', nullable: false },\n  },\n  [TABLE_AGENTS]: AGENTS_SCHEMA,\n};\n"],"names":["z","TraceStatus"],"mappings":"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"}},
    {"offset": {"line": 4702, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-DDH2PEZG.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/agents/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/agents/inmemory.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/inmemory-db.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/utils.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/memory/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/memory/inmemory.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/observability/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/observability/inmemory.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/scores/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/scores/inmemory.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/workflows/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/workflows/inmemory.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/mock.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/operations/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/storage/domains/operations/inmemory.ts"],"sourcesContent":["import { MastraBase } from '../base';\n\nimport type { AgentsStorage, ScoresStorage, WorkflowsStorage, MemoryStorage, ObservabilityStorage } from './domains';\n\nexport type StorageDomains = {\n  workflows: WorkflowsStorage;\n  scores: ScoresStorage;\n  memory: MemoryStorage;\n  observability?: ObservabilityStorage;\n  agents?: AgentsStorage;\n};\n\n/**\n * Normalizes perPage input for pagination queries.\n *\n * @param perPageInput - The raw perPage value from the user\n * @param defaultValue - The default perPage value to use when undefined (typically 40 for messages, 100 for threads)\n * @returns A numeric perPage value suitable for queries (false becomes MAX_SAFE_INTEGER, negative values fall back to default)\n */\nexport function normalizePerPage(perPageInput: number | false | undefined, defaultValue: number): number {\n  if (perPageInput === false) {\n    return Number.MAX_SAFE_INTEGER; // Get all results\n  } else if (perPageInput === 0) {\n    return 0; // Return zero results\n  } else if (typeof perPageInput === 'number' && perPageInput > 0) {\n    return perPageInput; // Valid positive number\n  }\n  // For undefined, negative, or other invalid values, use default\n  return defaultValue;\n}\n\n/**\n * Calculates pagination offset and prepares perPage value for response.\n * When perPage is false (fetch all), offset is always 0 regardless of page.\n *\n * @param page - The page number (0-indexed)\n * @param perPageInput - The original perPage input (number, false for all, or undefined)\n * @param normalizedPerPage - The normalized perPage value (from normalizePerPage)\n * @returns Object with offset for query and perPage for response\n */\nexport function calculatePagination(\n  page: number,\n  perPageInput: number | false | undefined,\n  normalizedPerPage: number,\n): { offset: number; perPage: number | false } {\n  return {\n    offset: perPageInput === false ? 0 : page * normalizedPerPage,\n    perPage: perPageInput === false ? false : normalizedPerPage,\n  };\n}\n\n/**\n * Configuration for individual domain overrides.\n * Each domain can be sourced from a different storage adapter.\n */\nexport type MastraStorageDomains = Partial<StorageDomains>;\n\n/**\n * Configuration options for MastraStorage.\n *\n * Can be used in two ways:\n * 1. By store implementations: `{ id, name, disableInit? }` - stores set `this.stores` directly\n * 2. For composition: `{ id, default?, domains?, disableInit? }` - compose domains from multiple stores\n */\nexport interface MastraStorageConfig {\n  /**\n   * Unique identifier for this storage instance.\n   */\n  id: string;\n\n  /**\n   * Name of the storage adapter (used for logging).\n   * Required for store implementations extending MastraStorage.\n   */\n  name?: string;\n\n  /**\n   * Default storage adapter to use for domains not explicitly specified.\n   * If provided, domains from this storage will be used as fallbacks.\n   */\n  default?: MastraStorage;\n\n  /**\n   * Individual domain overrides. Each domain can come from a different storage adapter.\n   * These take precedence over the default storage.\n   *\n   * @example\n   * ```typescript\n   * domains: {\n   *   memory: pgStore.stores?.memory,\n   *   workflows: libsqlStore.stores?.workflows,\n   * }\n   * ```\n   */\n  domains?: MastraStorageDomains;\n\n  /**\n   * When true, automatic initialization (table creation/migrations) is disabled.\n   * This is useful for CI/CD pipelines where you want to:\n   * 1. Run migrations explicitly during deployment (not at runtime)\n   * 2. Use different credentials for schema changes vs runtime operations\n   *\n   * When disableInit is true:\n   * - The storage will not automatically create/alter tables on first use\n   * - You must call `storage.init()` explicitly in your CI/CD scripts\n   *\n   * @example\n   * // In CI/CD script:\n   * const storage = new PostgresStore({ ...config, disableInit: false });\n   * await storage.init(); // Explicitly run migrations\n   *\n   * // In runtime application:\n   * const storage = new PostgresStore({ ...config, disableInit: true });\n   * // No auto-init, tables must already exist\n   */\n  disableInit?: boolean;\n}\n\n/**\n * Base class for all Mastra storage adapters.\n *\n * Can be used in two ways:\n *\n * 1. **Extended by store implementations** (PostgresStore, LibSQLStore, etc.):\n *    Store implementations extend this class and set `this.stores` with their domain implementations.\n *\n * 2. **Directly instantiated for composition**:\n *    Compose domains from multiple storage backends using `default` and `domains` options.\n *\n * All domain-specific operations should be accessed through `getStore()`:\n *\n * @example\n * ```typescript\n * // Composition: mix domains from different stores\n * const storage = new MastraStorage({\n *   id: 'composite',\n *   default: pgStore,\n *   domains: {\n *     memory: libsqlStore.stores?.memory,\n *   },\n * });\n *\n * // Access domains\n * const memory = await storage.getStore('memory');\n * await memory?.saveThread({ thread });\n * ```\n */\nexport class MastraStorage extends MastraBase {\n  protected hasInitialized: null | Promise<boolean> = null;\n  protected shouldCacheInit = true;\n\n  id: string;\n  stores?: StorageDomains;\n\n  /**\n   * When true, automatic initialization (table creation/migrations) is disabled.\n   */\n  disableInit: boolean = false;\n\n  constructor(config: MastraStorageConfig) {\n    const name = config.name ?? 'MastraStorage';\n\n    if (!config.id || typeof config.id !== 'string' || config.id.trim() === '') {\n      throw new Error(`${name}: id must be provided and cannot be empty.`);\n    }\n\n    super({\n      component: 'STORAGE',\n      name,\n    });\n\n    this.id = config.id;\n    this.disableInit = config.disableInit ?? false;\n\n    // If composition config is provided (default or domains), compose the stores\n    if (config.default || config.domains) {\n      const defaultStores = config.default?.stores;\n      const domainOverrides = config.domains ?? {};\n\n      // Validate that at least one storage source is provided\n      const hasDefaultDomains = defaultStores && Object.values(defaultStores).some(v => v !== undefined);\n      const hasOverrideDomains = Object.values(domainOverrides).some(v => v !== undefined);\n\n      if (!hasDefaultDomains && !hasOverrideDomains) {\n        throw new Error(\n          'MastraStorage requires at least one storage source. Provide either a default storage with domains or domain overrides.',\n        );\n      }\n\n      // Build the composed stores object\n      // Domain overrides take precedence over default storage\n      this.stores = {\n        memory: domainOverrides.memory ?? defaultStores?.memory,\n        workflows: domainOverrides.workflows ?? defaultStores?.workflows,\n        scores: domainOverrides.scores ?? defaultStores?.scores,\n        observability: domainOverrides.observability ?? defaultStores?.observability,\n        agents: domainOverrides.agents ?? defaultStores?.agents,\n      } as StorageDomains;\n    }\n    // Otherwise, subclasses set stores themselves\n  }\n\n  /**\n   * Get a domain-specific storage interface.\n   *\n   * @param storeName - The name of the domain to access ('memory', 'workflows', 'scores', 'observability', 'agents')\n   * @returns The domain storage interface, or undefined if not available\n   *\n   * @example\n   * ```typescript\n   * const memory = await storage.getStore('memory');\n   * if (memory) {\n   *   await memory.saveThread({ thread });\n   * }\n   * ```\n   */\n  async getStore<K extends keyof StorageDomains>(storeName: K): Promise<StorageDomains[K] | undefined> {\n    return this.stores?.[storeName];\n  }\n\n  /**\n   * Initialize all domain stores.\n   * This creates necessary tables, indexes, and performs any required migrations.\n   */\n  async init(): Promise<void> {\n    // to prevent race conditions, await any current init\n    if (this.shouldCacheInit && (await this.hasInitialized)) {\n      return;\n    }\n\n    // Initialize all domain stores\n    const initTasks: Promise<void>[] = [];\n\n    if (this.stores?.memory) {\n      initTasks.push(this.stores.memory.init());\n    }\n\n    if (this.stores?.workflows) {\n      initTasks.push(this.stores.workflows.init());\n    }\n\n    if (this.stores?.scores) {\n      initTasks.push(this.stores.scores.init());\n    }\n\n    if (this.stores?.observability) {\n      initTasks.push(this.stores.observability.init());\n    }\n\n    if (this.stores?.agents) {\n      initTasks.push(this.stores.agents.init());\n    }\n\n    this.hasInitialized = Promise.all(initTasks).then(() => true);\n\n    await this.hasInitialized;\n  }\n}\n","import { MastraBase } from '../../base';\n\n/**\n * Base class for all storage domains.\n * Provides common interface for initialization and data clearing.\n */\nexport abstract class StorageDomain extends MastraBase {\n  /**\n   * Initialize the storage domain.\n   * This should create any necessary tables/collections.\n   * Default implementation is a no-op - override in adapters that need initialization.\n   */\n  async init(): Promise<void> {\n    // Default no-op - adapters override if they need to create tables/collections\n  }\n\n  /**\n   * Clears all data from this storage domain.\n   * This is a destructive operation - use with caution.\n   * Primarily used for testing.\n   */\n  abstract dangerouslyClearAll(): Promise<void>;\n}\n","import type {\n  StorageAgentType,\n  StorageCreateAgentInput,\n  StorageUpdateAgentInput,\n  StorageListAgentsInput,\n  StorageListAgentsOutput,\n  StorageOrderBy,\n  ThreadOrderBy,\n  ThreadSortDirection,\n} from '../../types';\nimport { StorageDomain } from '../base';\n\nexport abstract class AgentsStorage extends StorageDomain {\n  constructor() {\n    super({\n      component: 'STORAGE',\n      name: 'AGENTS',\n    });\n  }\n\n  /**\n   * Retrieves an agent by its unique identifier.\n   * @param id - The unique identifier of the agent\n   * @returns The agent if found, null otherwise\n   */\n  abstract getAgentById({ id }: { id: string }): Promise<StorageAgentType | null>;\n\n  /**\n   * Creates a new agent in storage.\n   * @param agent - The agent data to create\n   * @returns The created agent with timestamps\n   */\n  abstract createAgent({ agent }: { agent: StorageCreateAgentInput }): Promise<StorageAgentType>;\n\n  /**\n   * Updates an existing agent in storage.\n   * @param id - The unique identifier of the agent to update\n   * @param updates - The fields to update\n   * @returns The updated agent\n   */\n  abstract updateAgent({ id, ...updates }: StorageUpdateAgentInput): Promise<StorageAgentType>;\n\n  /**\n   * Deletes an agent from storage.\n   * @param id - The unique identifier of the agent to delete\n   */\n  abstract deleteAgent({ id }: { id: string }): Promise<void>;\n\n  /**\n   * Lists all agents with optional pagination.\n   * @param args - Pagination and ordering options\n   * @returns Paginated list of agents\n   */\n  abstract listAgents(args?: StorageListAgentsInput): Promise<StorageListAgentsOutput>;\n\n  /**\n   * Parses orderBy input for consistent sorting behavior.\n   */\n  protected parseOrderBy(\n    orderBy?: StorageOrderBy,\n    defaultDirection: ThreadSortDirection = 'DESC',\n  ): { field: ThreadOrderBy; direction: ThreadSortDirection } {\n    return {\n      field: orderBy?.field && orderBy.field in AGENT_ORDER_BY_SET ? orderBy.field : 'createdAt',\n      direction:\n        orderBy?.direction && orderBy.direction in AGENT_SORT_DIRECTION_SET ? orderBy.direction : defaultDirection,\n    };\n  }\n}\n\nconst AGENT_ORDER_BY_SET: Record<ThreadOrderBy, true> = {\n  createdAt: true,\n  updatedAt: true,\n};\n\nconst AGENT_SORT_DIRECTION_SET: Record<ThreadSortDirection, true> = {\n  ASC: true,\n  DESC: true,\n};\n","import { normalizePerPage, calculatePagination } from '../../base';\nimport type {\n  StorageAgentType,\n  StorageCreateAgentInput,\n  StorageUpdateAgentInput,\n  StorageListAgentsInput,\n  StorageListAgentsOutput,\n  ThreadOrderBy,\n  ThreadSortDirection,\n} from '../../types';\nimport type { InMemoryDB } from '../inmemory-db';\nimport { AgentsStorage } from './base';\n\nexport class InMemoryAgentsStorage extends AgentsStorage {\n  private db: InMemoryDB;\n\n  constructor({ db }: { db: InMemoryDB }) {\n    super();\n    this.db = db;\n  }\n\n  async dangerouslyClearAll(): Promise<void> {\n    this.db.agents.clear();\n  }\n\n  async getAgentById({ id }: { id: string }): Promise<StorageAgentType | null> {\n    this.logger.debug(`InMemoryAgentsStorage: getAgentById called for ${id}`);\n    const agent = this.db.agents.get(id);\n    return agent\n      ? {\n          ...agent,\n          metadata: agent.metadata ? { ...agent.metadata } : agent.metadata,\n          model: { ...agent.model },\n          tools: agent.tools ? [...agent.tools] : agent.tools,\n          workflows: agent.workflows ? [...agent.workflows] : agent.workflows,\n          agents: agent.agents ? [...agent.agents] : agent.agents,\n          scorers: agent.scorers ? { ...agent.scorers } : agent.scorers,\n        }\n      : null;\n  }\n\n  async createAgent({ agent }: { agent: StorageCreateAgentInput }): Promise<StorageAgentType> {\n    this.logger.debug(`InMemoryAgentsStorage: createAgent called for ${agent.id}`);\n\n    if (this.db.agents.has(agent.id)) {\n      throw new Error(`Agent with id ${agent.id} already exists`);\n    }\n\n    const now = new Date();\n    const newAgent: StorageAgentType = {\n      ...agent,\n      createdAt: now,\n      updatedAt: now,\n    };\n\n    this.db.agents.set(agent.id, newAgent);\n    return { ...newAgent };\n  }\n\n  async updateAgent({ id, ...updates }: StorageUpdateAgentInput): Promise<StorageAgentType> {\n    this.logger.debug(`InMemoryAgentsStorage: updateAgent called for ${id}`);\n\n    const existingAgent = this.db.agents.get(id);\n    if (!existingAgent) {\n      throw new Error(`Agent with id ${id} not found`);\n    }\n\n    const updatedAgent: StorageAgentType = {\n      ...existingAgent,\n      ...(updates.name !== undefined && { name: updates.name }),\n      ...(updates.description !== undefined && { description: updates.description }),\n      ...(updates.instructions !== undefined && { instructions: updates.instructions }),\n      ...(updates.model !== undefined && { model: updates.model }),\n      ...(updates.tools !== undefined && { tools: updates.tools }),\n      ...(updates.defaultOptions !== undefined && {\n        defaultOptions: updates.defaultOptions,\n      }),\n      ...(updates.workflows !== undefined && { workflows: updates.workflows }),\n      ...(updates.agents !== undefined && { agents: updates.agents }),\n      ...(updates.inputProcessors !== undefined && { inputProcessors: updates.inputProcessors }),\n      ...(updates.outputProcessors !== undefined && { outputProcessors: updates.outputProcessors }),\n      ...(updates.memory !== undefined && { memory: updates.memory }),\n      ...(updates.scorers !== undefined && { scorers: updates.scorers }),\n      ...(updates.metadata !== undefined && {\n        metadata: { ...existingAgent.metadata, ...updates.metadata },\n      }),\n      updatedAt: new Date(),\n    };\n\n    this.db.agents.set(id, updatedAgent);\n    return { ...updatedAgent };\n  }\n\n  async deleteAgent({ id }: { id: string }): Promise<void> {\n    this.logger.debug(`InMemoryAgentsStorage: deleteAgent called for ${id}`);\n    // Idempotent delete - no-op if agent doesn't exist\n    this.db.agents.delete(id);\n  }\n\n  async listAgents(args?: StorageListAgentsInput): Promise<StorageListAgentsOutput> {\n    const { page = 0, perPage: perPageInput, orderBy } = args || {};\n    const { field, direction } = this.parseOrderBy(orderBy);\n\n    this.logger.debug(`InMemoryAgentsStorage: listAgents called`);\n\n    // Normalize perPage for query (false â†’ MAX_SAFE_INTEGER, 0 â†’ 0, undefined â†’ 100)\n    const perPage = normalizePerPage(perPageInput, 100);\n\n    if (page < 0) {\n      throw new Error('page must be >= 0');\n    }\n\n    // Prevent unreasonably large page values\n    const maxOffset = Number.MAX_SAFE_INTEGER / 2;\n    if (page * perPage > maxOffset) {\n      throw new Error('page value too large');\n    }\n\n    // Get all agents and sort them\n    const agents = Array.from(this.db.agents.values());\n    const sortedAgents = this.sortAgents(agents, field, direction);\n\n    // Clone agents to avoid mutation\n    const clonedAgents = sortedAgents.map(agent => ({\n      ...agent,\n      metadata: agent.metadata ? { ...agent.metadata } : agent.metadata,\n      model: { ...agent.model },\n      tools: agent.tools ? [...agent.tools] : agent.tools,\n      workflows: agent.workflows ? [...agent.workflows] : agent.workflows,\n      agents: agent.agents ? [...agent.agents] : agent.agents,\n      scorers: agent.scorers ? { ...agent.scorers } : agent.scorers,\n    }));\n\n    const { offset, perPage: perPageForResponse } = calculatePagination(page, perPageInput, perPage);\n\n    return {\n      agents: clonedAgents.slice(offset, offset + perPage),\n      total: clonedAgents.length,\n      page,\n      perPage: perPageForResponse,\n      hasMore: offset + perPage < clonedAgents.length,\n    };\n  }\n\n  private sortAgents(\n    agents: StorageAgentType[],\n    field: ThreadOrderBy,\n    direction: ThreadSortDirection,\n  ): StorageAgentType[] {\n    return agents.sort((a, b) => {\n      const aValue = new Date(a[field]).getTime();\n      const bValue = new Date(b[field]).getTime();\n\n      return direction === 'ASC' ? aValue - bValue : bValue - aValue;\n    });\n  }\n}\n","import type { ScoreRowData } from '../../evals/types';\nimport type { StorageThreadType } from '../../memory/types';\nimport type { StorageAgentType, StorageMessageType, StorageResourceType, StorageWorkflowRun } from '../types';\nimport type { TraceEntry } from './observability';\n\n/**\n * InMemoryDB is a thin database layer for in-memory storage.\n * It holds all the Maps that store data, similar to how a real database\n * connection (pg-promise client, libsql client) is shared across domains.\n *\n * Each domain receives a reference to this db and operates on the relevant Maps.\n */\nexport class InMemoryDB {\n  readonly threads = new Map<string, StorageThreadType>();\n  readonly messages = new Map<string, StorageMessageType>();\n  readonly resources = new Map<string, StorageResourceType>();\n  readonly workflows = new Map<string, StorageWorkflowRun>();\n  readonly scores = new Map<string, ScoreRowData>();\n  readonly traces = new Map<string, TraceEntry>();\n  readonly agents = new Map<string, StorageAgentType>();\n\n  /**\n   * Clears all data from all collections.\n   * Useful for testing.\n   */\n  clear(): void {\n    this.threads.clear();\n    this.messages.clear();\n    this.resources.clear();\n    this.workflows.clear();\n    this.scores.clear();\n    this.traces.clear();\n    this.agents.clear();\n  }\n}\n","import type { ScoreRowData } from '../evals/types';\nimport { TABLE_SCHEMAS, TABLE_SCORERS } from './constants';\nimport type { TABLE_NAMES } from './constants';\nimport type { StorageColumn } from './types';\n\n/**\n * Canonical store names for type safety.\n * Provides autocomplete suggestions while still accepting any string.\n */\nexport type StoreName =\n  | 'PG'\n  | 'MSSQL'\n  | 'LIBSQL'\n  | 'MONGODB'\n  | 'CLICKHOUSE'\n  | 'CLOUDFLARE'\n  | 'CLOUDFLARE_D1'\n  | 'DYNAMODB'\n  | 'LANCE'\n  | 'UPSTASH'\n  | 'ASTRA'\n  | 'CHROMA'\n  | 'COUCHBASE'\n  | 'OPENSEARCH'\n  | 'PINECONE'\n  | 'QDRANT'\n  | 'S3'\n  | 'TURBOPUFFER'\n  | 'VECTORIZE'\n  | (string & {});\n\nexport function safelyParseJSON(input: any): any {\n  // If already an object (and not null), return as-is\n  if (input && typeof input === 'object') return input;\n  if (input == null) return {};\n  // If it's a string, try to parse\n  if (typeof input === 'string') {\n    try {\n      return JSON.parse(input);\n    } catch {\n      return input;\n    }\n  }\n  // For anything else (number, boolean, etc.), return empty object\n  return {};\n}\n\n/**\n * Options for transforming storage rows\n */\nexport interface TransformRowOptions {\n  /**\n   * Preferred source fields for timestamps (e.g., { createdAt: 'createdAtZ' } means use createdAtZ if available, else createdAt)\n   */\n  preferredTimestampFields?: Record<string, string>;\n\n  /**\n   * Convert timestamp strings to Date objects (default: false for backwards compatibility)\n   */\n  convertTimestamps?: boolean;\n\n  /**\n   * Pattern to treat as null (e.g., '_null_' for ClickHouse)\n   */\n  nullValuePattern?: string;\n\n  /**\n   * Custom field mappings from source to target (e.g., { entity: 'entityData' } for DynamoDB)\n   */\n  fieldMappings?: Record<string, string>;\n}\n\n/**\n * Generic schema-driven row transformer.\n * Uses TABLE_SCHEMAS to determine field types and apply appropriate transformations:\n * - 'jsonb' fields: parsed from JSON strings using safelyParseJSON\n * - 'timestamp' fields: optionally converted to Date objects\n *\n * @param row - The raw row from storage\n * @param tableName - The table name to look up schema from TABLE_SCHEMAS\n * @param options - Optional configuration for store-specific behavior\n * @returns Transformed row with proper types\n */\nexport function transformRow<T = Record<string, any>>(\n  row: Record<string, any>,\n  tableName: TABLE_NAMES,\n  options: TransformRowOptions = {},\n): T {\n  const { preferredTimestampFields = {}, convertTimestamps = false, nullValuePattern, fieldMappings = {} } = options;\n\n  const tableSchema = TABLE_SCHEMAS[tableName];\n  const result: Record<string, any> = {};\n\n  for (const [key, columnSchema] of Object.entries(tableSchema)) {\n    // Handle field mappings (e.g., entityData -> entity for DynamoDB)\n    const sourceKey = fieldMappings[key] ?? key;\n    let value = row[sourceKey];\n\n    // Handle preferred timestamp sources (e.g., use createdAtZ if available, else createdAt)\n    if (preferredTimestampFields[key]) {\n      value = row[preferredTimestampFields[key]] ?? value;\n    }\n\n    // Skip null/undefined values\n    if (value === undefined || value === null) {\n      continue;\n    }\n\n    // Skip null pattern values (e.g., ClickHouse's '_null_')\n    if (nullValuePattern && value === nullValuePattern) {\n      continue;\n    }\n\n    // Transform based on column type\n    if (columnSchema.type === 'jsonb') {\n      if (typeof value === 'string') {\n        result[key] = safelyParseJSON(value);\n      } else if (typeof value === 'object') {\n        result[key] = value; // Already parsed\n      } else {\n        result[key] = value;\n      }\n    } else if (columnSchema.type === 'timestamp' && convertTimestamps && typeof value === 'string') {\n      result[key] = new Date(value);\n    } else {\n      result[key] = value;\n    }\n  }\n\n  return result as T;\n}\n\n/**\n * Transform a raw score row from storage to ScoreRowData.\n * Convenience wrapper around transformRow for the scores table (TABLE_SCORERS).\n *\n * @param row - The raw row from storage\n * @param options - Optional configuration for store-specific behavior\n * @returns Transformed ScoreRowData\n */\nexport function transformScoreRow(row: Record<string, any>, options: TransformRowOptions = {}): ScoreRowData {\n  return transformRow<ScoreRowData>(row, TABLE_SCORERS, options);\n}\n\n/**\n * Converts a string to UPPER_SNAKE_CASE, preserving word boundaries from camelCase, PascalCase, kebab-case, etc.\n */\nfunction toUpperSnakeCase(str: string): string {\n  return (\n    str\n      // Insert underscore before uppercase letters that follow lowercase letters (camelCase -> camel_Case)\n      .replace(/([a-z])([A-Z])/g, '$1_$2')\n      // Insert underscore before uppercase letters that are followed by lowercase letters (XMLParser -> XML_Parser)\n      .replace(/([A-Z])([A-Z][a-z])/g, '$1_$2')\n      // Convert to uppercase\n      .toUpperCase()\n      // Replace any non-alphanumeric characters with underscore\n      .replace(/[^A-Z0-9]+/g, '_')\n      // Remove leading/trailing underscores\n      .replace(/^_+|_+$/g, '')\n  );\n}\n\n/**\n * Generates a standardized error ID for storage and vector operations.\n *\n * Formats:\n * - Storage: MASTRA_STORAGE_{STORE}_{OPERATION}_{STATUS}\n * - Vector:  MASTRA_VECTOR_{STORE}_{OPERATION}_{STATUS}\n *\n * This function auto-normalizes inputs to UPPER_SNAKE_CASE for flexibility.\n * The store parameter is type-checked against canonical store names for IDE autocomplete.\n *\n * @param type - The operation type ('storage' or 'vector')\n * @param store - The store adapter name (type-checked canonical names)\n * @param operation - The operation that failed (e.g., 'LIST_THREADS_BY_RESOURCE_ID', 'QUERY')\n * @param status - The status/error type (e.g., 'FAILED', 'INVALID_THREAD_ID', 'DUPLICATE_KEY')\n *\n * @example\n * ```ts\n * // Storage operations\n * createStoreErrorId('storage', 'PG', 'LIST_THREADS_BY_RESOURCE_ID', 'FAILED')\n * // Returns: 'MASTRA_STORAGE_PG_LIST_THREADS_BY_RESOURCE_ID_FAILED'\n *\n * // Vector operations\n * createStoreErrorId('vector', 'CHROMA', 'QUERY', 'FAILED')\n * // Returns: 'MASTRA_VECTOR_CHROMA_QUERY_FAILED'\n *\n * // Auto-normalizes any casing\n * createStoreErrorId('storage', 'PG', 'listMessagesById', 'failed')\n * // Returns: 'MASTRA_STORAGE_PG_LIST_MESSAGES_BY_ID_FAILED'\n * ```\n */\nexport function createStoreErrorId(\n  type: 'storage' | 'vector',\n  store: StoreName,\n  operation: string,\n  status: string,\n): Uppercase<string> {\n  const normalizedStore = toUpperSnakeCase(store);\n  const normalizedOperation = toUpperSnakeCase(operation);\n  const normalizedStatus = toUpperSnakeCase(status);\n  const typePrefix = type === 'storage' ? 'STORAGE' : 'VECTOR';\n\n  return `MASTRA_${typePrefix}_${normalizedStore}_${normalizedOperation}_${normalizedStatus}` as Uppercase<string>;\n}\n\nexport function createStorageErrorId(store: StoreName, operation: string, status: string): Uppercase<string> {\n  return createStoreErrorId('storage', store, operation, status);\n}\n\nexport function createVectorErrorId(store: StoreName, operation: string, status: string): Uppercase<string> {\n  return createStoreErrorId('vector', store, operation, status);\n}\n\nexport function getSqlType(type: StorageColumn['type']): string {\n  switch (type) {\n    case 'text':\n      return 'TEXT';\n    case 'timestamp':\n      return 'TIMESTAMP';\n    case 'float':\n      return 'FLOAT';\n    case 'integer':\n      return 'INTEGER';\n    case 'bigint':\n      return 'BIGINT';\n    case 'jsonb':\n      return 'JSONB';\n    case 'boolean':\n      return 'BOOLEAN';\n    default:\n      return 'TEXT';\n  }\n}\n\nexport function getDefaultValue(type: StorageColumn['type']): string {\n  switch (type) {\n    case 'text':\n    case 'uuid':\n      return \"DEFAULT ''\";\n    case 'timestamp':\n      return \"DEFAULT '1970-01-01 00:00:00'\";\n    case 'integer':\n    case 'bigint':\n    case 'float':\n      return 'DEFAULT 0';\n    case 'jsonb':\n      return \"DEFAULT '{}'\";\n    case 'boolean':\n      return 'DEFAULT FALSE';\n    default:\n      return \"DEFAULT ''\";\n  }\n}\n\nexport function ensureDate(date: Date | string | undefined): Date | undefined {\n  if (!date) return undefined;\n  return date instanceof Date ? date : new Date(date);\n}\n\nexport function serializeDate(date: Date | string | undefined): string | undefined {\n  if (!date) return undefined;\n  const dateObj = ensureDate(date);\n  return dateObj?.toISOString();\n}\n\n/**\n * Date range filter configuration for in-memory filtering operations.\n */\nexport interface DateRangeFilter {\n  start?: Date | string;\n  end?: Date | string;\n  startExclusive?: boolean;\n  endExclusive?: boolean;\n}\n\n/**\n * Filter an array of items by date range. Used by in-memory storage adapters.\n *\n * This provides a consistent implementation of date range filtering with\n * support for inclusive/exclusive bounds across all storage adapters.\n *\n * @param items - Array of items to filter\n * @param getCreatedAt - Function to extract the createdAt date from an item\n * @param dateRange - Optional date range filter configuration\n * @returns Filtered array of items\n *\n * @example\n * ```ts\n * const filtered = filterByDateRange(\n *   messages,\n *   (msg) => new Date(msg.createdAt),\n *   { start: new Date('2024-01-01'), startExclusive: true }\n * );\n * ```\n */\nexport function filterByDateRange<T>(items: T[], getCreatedAt: (item: T) => Date, dateRange?: DateRangeFilter): T[] {\n  if (!dateRange) return items;\n\n  let result = items;\n\n  if (dateRange.start) {\n    const startTime = ensureDate(dateRange.start)!.getTime();\n    result = result.filter(item => {\n      const itemTime = getCreatedAt(item).getTime();\n      return dateRange.startExclusive ? itemTime > startTime : itemTime >= startTime;\n    });\n  }\n\n  if (dateRange.end) {\n    const endTime = ensureDate(dateRange.end)!.getTime();\n    result = result.filter(item => {\n      const itemTime = getCreatedAt(item).getTime();\n      return dateRange.endExclusive ? itemTime < endTime : itemTime <= endTime;\n    });\n  }\n\n  return result;\n}\n","import type { MastraMessageContentV2 } from '../../../agent';\nimport type { MastraDBMessage, StorageThreadType } from '../../../memory/types';\nimport type {\n  StorageResourceType,\n  ThreadOrderBy,\n  ThreadSortDirection,\n  StorageListMessagesInput,\n  StorageListMessagesOutput,\n  StorageListThreadsByResourceIdInput,\n  StorageListThreadsByResourceIdOutput,\n  StorageOrderBy,\n  StorageCloneThreadInput,\n  StorageCloneThreadOutput,\n} from '../../types';\nimport { StorageDomain } from '../base';\n\nexport abstract class MemoryStorage extends StorageDomain {\n  constructor() {\n    super({\n      component: 'STORAGE',\n      name: 'MEMORY',\n    });\n  }\n\n  abstract getThreadById({ threadId }: { threadId: string }): Promise<StorageThreadType | null>;\n\n  abstract saveThread({ thread }: { thread: StorageThreadType }): Promise<StorageThreadType>;\n\n  abstract updateThread({\n    id,\n    title,\n    metadata,\n  }: {\n    id: string;\n    title: string;\n    metadata: Record<string, unknown>;\n  }): Promise<StorageThreadType>;\n\n  abstract deleteThread({ threadId }: { threadId: string }): Promise<void>;\n\n  abstract listMessages(args: StorageListMessagesInput): Promise<StorageListMessagesOutput>;\n\n  abstract listMessagesById({ messageIds }: { messageIds: string[] }): Promise<{ messages: MastraDBMessage[] }>;\n\n  abstract saveMessages(args: { messages: MastraDBMessage[] }): Promise<{ messages: MastraDBMessage[] }>;\n\n  abstract updateMessages(args: {\n    messages: (Partial<Omit<MastraDBMessage, 'createdAt'>> & {\n      id: string;\n      content?: { metadata?: MastraMessageContentV2['metadata']; content?: MastraMessageContentV2['content'] };\n    })[];\n  }): Promise<MastraDBMessage[]>;\n\n  async deleteMessages(_messageIds: string[]): Promise<void> {\n    throw new Error(\n      `Message deletion is not supported by this storage adapter (${this.constructor.name}). ` +\n        `The deleteMessages method needs to be implemented in the storage adapter.`,\n    );\n  }\n\n  abstract listThreadsByResourceId(\n    args: StorageListThreadsByResourceIdInput,\n  ): Promise<StorageListThreadsByResourceIdOutput>;\n\n  /**\n   * Clone a thread and its messages to create a new independent thread.\n   * The cloned thread will have clone metadata stored in its metadata field.\n   *\n   * @param args - Clone configuration options\n   * @returns The newly created thread and the cloned messages\n   */\n  async cloneThread(_args: StorageCloneThreadInput): Promise<StorageCloneThreadOutput> {\n    throw new Error(\n      `Thread cloning is not implemented by this storage adapter (${this.constructor.name}). ` +\n        `The cloneThread method needs to be implemented in the storage adapter.`,\n    );\n  }\n\n  async getResourceById(_: { resourceId: string }): Promise<StorageResourceType | null> {\n    throw new Error(\n      `Resource working memory is not implemented by this storage adapter (${this.constructor.name}). ` +\n        `This is likely a bug - all Mastra storage adapters should implement resource support. ` +\n        `Please report this issue at https://github.com/mastra-ai/mastra/issues`,\n    );\n  }\n\n  async saveResource(_: { resource: StorageResourceType }): Promise<StorageResourceType> {\n    throw new Error(\n      `Resource working memory is not implemented by this storage adapter (${this.constructor.name}). ` +\n        `This is likely a bug - all Mastra storage adapters should implement resource support. ` +\n        `Please report this issue at https://github.com/mastra-ai/mastra/issues`,\n    );\n  }\n\n  async updateResource(_: {\n    resourceId: string;\n    workingMemory?: string;\n    metadata?: Record<string, unknown>;\n  }): Promise<StorageResourceType> {\n    throw new Error(\n      `Resource working memory is not implemented by this storage adapter (${this.constructor.name}). ` +\n        `This is likely a bug - all Mastra storage adapters should implement resource support. ` +\n        `Please report this issue at https://github.com/mastra-ai/mastra/issues`,\n    );\n  }\n\n  protected parseOrderBy(\n    orderBy?: StorageOrderBy,\n    defaultDirection: ThreadSortDirection = 'DESC',\n  ): { field: ThreadOrderBy; direction: ThreadSortDirection } {\n    return {\n      field: orderBy?.field && orderBy.field in THREAD_ORDER_BY_SET ? orderBy.field : 'createdAt',\n      direction:\n        orderBy?.direction && orderBy.direction in THREAD_THREAD_SORT_DIRECTION_SET\n          ? orderBy.direction\n          : defaultDirection,\n    };\n  }\n}\n\nconst THREAD_ORDER_BY_SET: Record<ThreadOrderBy, true> = {\n  createdAt: true,\n  updatedAt: true,\n};\n\nconst THREAD_THREAD_SORT_DIRECTION_SET: Record<ThreadSortDirection, true> = {\n  ASC: true,\n  DESC: true,\n};\n","import { MessageList } from '../../../agent/message-list';\nimport type { MastraDBMessage, StorageThreadType } from '../../../memory/types';\nimport { normalizePerPage, calculatePagination } from '../../base';\nimport type {\n  StorageMessageType,\n  StorageResourceType,\n  ThreadOrderBy,\n  ThreadSortDirection,\n  StorageListMessagesInput,\n  StorageListMessagesOutput,\n  StorageListThreadsByResourceIdInput,\n  StorageListThreadsByResourceIdOutput,\n  StorageCloneThreadInput,\n  StorageCloneThreadOutput,\n  ThreadCloneMetadata,\n} from '../../types';\nimport { filterByDateRange, safelyParseJSON } from '../../utils';\nimport type { InMemoryDB } from '../inmemory-db';\nimport { MemoryStorage } from './base';\n\nexport class InMemoryMemory extends MemoryStorage {\n  private db: InMemoryDB;\n\n  constructor({ db }: { db: InMemoryDB }) {\n    super();\n    this.db = db;\n  }\n\n  async dangerouslyClearAll(): Promise<void> {\n    this.db.threads.clear();\n    this.db.messages.clear();\n    this.db.resources.clear();\n  }\n\n  async getThreadById({ threadId }: { threadId: string }): Promise<StorageThreadType | null> {\n    this.logger.debug(`InMemoryMemory: getThreadById called for ${threadId}`);\n    const thread = this.db.threads.get(threadId);\n    return thread ? { ...thread, metadata: thread.metadata ? { ...thread.metadata } : thread.metadata } : null;\n  }\n\n  async saveThread({ thread }: { thread: StorageThreadType }): Promise<StorageThreadType> {\n    this.logger.debug(`InMemoryMemory: saveThread called for ${thread.id}`);\n    const key = thread.id;\n    this.db.threads.set(key, thread);\n    return thread;\n  }\n\n  async updateThread({\n    id,\n    title,\n    metadata,\n  }: {\n    id: string;\n    title: string;\n    metadata: Record<string, unknown>;\n  }): Promise<StorageThreadType> {\n    this.logger.debug(`InMemoryMemory: updateThread called for ${id}`);\n    const thread = this.db.threads.get(id);\n\n    if (!thread) {\n      throw new Error(`Thread with id ${id} not found`);\n    }\n\n    if (thread) {\n      thread.title = title;\n      thread.metadata = { ...thread.metadata, ...metadata };\n      thread.updatedAt = new Date();\n    }\n    return thread;\n  }\n\n  async deleteThread({ threadId }: { threadId: string }): Promise<void> {\n    this.logger.debug(`InMemoryMemory: deleteThread called for ${threadId}`);\n    this.db.threads.delete(threadId);\n\n    this.db.messages.forEach((msg, key) => {\n      if (msg.thread_id === threadId) {\n        this.db.messages.delete(key);\n      }\n    });\n  }\n\n  async listMessages({\n    threadId,\n    resourceId,\n    include,\n    filter,\n    perPage: perPageInput,\n    page = 0,\n    orderBy,\n  }: StorageListMessagesInput): Promise<StorageListMessagesOutput> {\n    // Normalize threadId to array\n    const threadIds = Array.isArray(threadId) ? threadId : [threadId];\n\n    this.logger.debug(`InMemoryMemory: listMessages called for threads ${threadIds.join(', ')}`);\n\n    if (threadIds.length === 0 || threadIds.some(id => !id.trim())) {\n      throw new Error('threadId must be a non-empty string or array of non-empty strings');\n    }\n\n    const threadIdSet = new Set(threadIds);\n\n    const { field, direction } = this.parseOrderBy(orderBy, 'ASC');\n\n    // Normalize perPage for query (false â†’ MAX_SAFE_INTEGER, 0 â†’ 0, undefined â†’ 40)\n    const perPage = normalizePerPage(perPageInput, 40);\n\n    if (page < 0) {\n      throw new Error('page must be >= 0');\n    }\n\n    // Prevent unreasonably large page values that could cause performance issues\n    const maxOffset = Number.MAX_SAFE_INTEGER / 2;\n    if (page * perPage > maxOffset) {\n      throw new Error('page value too large');\n    }\n\n    // Calculate offset from page\n\n    const { offset, perPage: perPageForResponse } = calculatePagination(page, perPageInput, perPage);\n\n    // Step 1: Get regular paginated messages from the thread(s) first\n    let threadMessages = Array.from(this.db.messages.values()).filter((msg: any) => {\n      if (!threadIdSet.has(msg.thread_id)) return false;\n      if (resourceId && msg.resourceId !== resourceId) return false;\n      return true;\n    });\n\n    // Apply date filtering\n    threadMessages = filterByDateRange(threadMessages, (msg: any) => new Date(msg.createdAt), filter?.dateRange);\n\n    // Sort thread messages before pagination\n    threadMessages.sort((a: any, b: any) => {\n      const isDateField = field === 'createdAt' || field === 'updatedAt';\n      const aValue = isDateField ? new Date(a[field]).getTime() : a[field];\n      const bValue = isDateField ? new Date(b[field]).getTime() : b[field];\n\n      if (typeof aValue === 'number' && typeof bValue === 'number') {\n        return direction === 'ASC' ? aValue - bValue : bValue - aValue;\n      }\n      return direction === 'ASC'\n        ? String(aValue).localeCompare(String(bValue))\n        : String(bValue).localeCompare(String(aValue));\n    });\n\n    // Get total count of thread messages (for pagination metadata)\n    const totalThreadMessages = threadMessages.length;\n\n    // Apply pagination to thread messages\n    const start = offset;\n    const end = start + perPage;\n    const paginatedThreadMessages = threadMessages.slice(start, end);\n\n    // Convert paginated thread messages to MastraDBMessage\n    const messages: MastraDBMessage[] = [];\n    const messageIds = new Set<string>();\n\n    for (const msg of paginatedThreadMessages) {\n      const convertedMessage = this.parseStoredMessage(msg);\n      messages.push(convertedMessage);\n      messageIds.add(msg.id);\n    }\n\n    // Step 2: Add included messages with context (if any), excluding duplicates\n    if (include && include.length > 0) {\n      for (const includeItem of include) {\n        const targetMessage = this.db.messages.get(includeItem.id);\n        if (targetMessage) {\n          // Convert StorageMessageType to MastraDBMessage\n          const convertedMessage = {\n            id: targetMessage.id,\n            threadId: targetMessage.thread_id,\n            content: safelyParseJSON(targetMessage.content),\n            role: targetMessage.role as 'user' | 'assistant' | 'system' | 'tool',\n            type: targetMessage.type,\n            createdAt: targetMessage.createdAt,\n            resourceId: targetMessage.resourceId,\n          } as MastraDBMessage;\n\n          // Only add if not already in messages array (deduplication)\n          if (!messageIds.has(convertedMessage.id)) {\n            messages.push(convertedMessage);\n            messageIds.add(convertedMessage.id);\n          }\n\n          // Add previous messages if requested\n          if (includeItem.withPreviousMessages) {\n            const allThreadMessages = Array.from(this.db.messages.values())\n              .filter((msg: any) => msg.thread_id === (includeItem.threadId || threadId))\n              .sort((a: any, b: any) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n\n            const targetIndex = allThreadMessages.findIndex(msg => msg.id === includeItem.id);\n            if (targetIndex !== -1) {\n              const startIndex = Math.max(0, targetIndex - (includeItem.withPreviousMessages || 0));\n              for (let i = startIndex; i < targetIndex; i++) {\n                const message = allThreadMessages[i];\n                if (message && !messageIds.has(message.id)) {\n                  const convertedPrevMessage = {\n                    id: message.id,\n                    threadId: message.thread_id,\n                    content: safelyParseJSON(message.content),\n                    role: message.role as 'user' | 'assistant' | 'system' | 'tool',\n                    type: message.type,\n                    createdAt: message.createdAt,\n                    resourceId: message.resourceId,\n                  } as MastraDBMessage;\n                  messages.push(convertedPrevMessage);\n                  messageIds.add(message.id);\n                }\n              }\n            }\n          }\n\n          // Add next messages if requested\n          if (includeItem.withNextMessages) {\n            const allThreadMessages = Array.from(this.db.messages.values())\n              .filter((msg: any) => msg.thread_id === (includeItem.threadId || threadId))\n              .sort((a: any, b: any) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n\n            const targetIndex = allThreadMessages.findIndex(msg => msg.id === includeItem.id);\n            if (targetIndex !== -1) {\n              const endIndex = Math.min(\n                allThreadMessages.length,\n                targetIndex + (includeItem.withNextMessages || 0) + 1,\n              );\n              for (let i = targetIndex + 1; i < endIndex; i++) {\n                const message = allThreadMessages[i];\n                if (message && !messageIds.has(message.id)) {\n                  const convertedNextMessage = {\n                    id: message.id,\n                    threadId: message.thread_id,\n                    content: safelyParseJSON(message.content),\n                    role: message.role as 'user' | 'assistant' | 'system' | 'tool',\n                    type: message.type,\n                    createdAt: message.createdAt,\n                    resourceId: message.resourceId,\n                  } as MastraDBMessage;\n                  messages.push(convertedNextMessage);\n                  messageIds.add(message.id);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    // Sort all messages (paginated + included) for final output\n    messages.sort((a: any, b: any) => {\n      const isDateField = field === 'createdAt' || field === 'updatedAt';\n      const aValue = isDateField ? new Date(a[field]).getTime() : a[field];\n      const bValue = isDateField ? new Date(b[field]).getTime() : b[field];\n\n      if (typeof aValue === 'number' && typeof bValue === 'number') {\n        return direction === 'ASC' ? aValue - bValue : bValue - aValue;\n      }\n      return direction === 'ASC'\n        ? String(aValue).localeCompare(String(bValue))\n        : String(bValue).localeCompare(String(aValue));\n    });\n\n    // Calculate hasMore\n    let hasMore;\n    if (include && include.length > 0) {\n      // When using include, check if we've returned all messages from the thread\n      // because include might bring in messages beyond the pagination window\n      const returnedThreadMessageIds = new Set(messages.filter(m => m.threadId === threadId).map(m => m.id));\n      hasMore = returnedThreadMessageIds.size < totalThreadMessages;\n    } else {\n      // Standard pagination: check if there are more pages\n      hasMore = end < totalThreadMessages;\n    }\n\n    return {\n      messages,\n      total: totalThreadMessages,\n      page,\n      perPage: perPageForResponse,\n      hasMore,\n    };\n  }\n\n  protected parseStoredMessage(message: StorageMessageType): MastraDBMessage {\n    const { resourceId, content, role, thread_id, ...rest } = message;\n\n    // Parse content using safelyParseJSON utility\n    let parsedContent = safelyParseJSON(content);\n\n    // If the result is a plain string (V1 format), wrap it in V2 structure\n    if (typeof parsedContent === 'string') {\n      parsedContent = {\n        format: 2,\n        content: parsedContent,\n        parts: [{ type: 'text', text: parsedContent }],\n      };\n    }\n\n    return {\n      ...rest,\n      threadId: thread_id,\n      ...(message.resourceId && { resourceId: message.resourceId }),\n      content: parsedContent,\n      role: role as MastraDBMessage['role'],\n    } satisfies MastraDBMessage;\n  }\n\n  async listMessagesById({ messageIds }: { messageIds: string[] }): Promise<{ messages: MastraDBMessage[] }> {\n    this.logger.debug(`InMemoryMemory: listMessagesById called`);\n\n    const rawMessages = messageIds.map(id => this.db.messages.get(id)).filter(message => !!message);\n\n    const list = new MessageList().add(\n      rawMessages.map(m => this.parseStoredMessage(m)),\n      'memory',\n    );\n    return { messages: list.get.all.db() };\n  }\n\n  async saveMessages(args: { messages: MastraDBMessage[] }): Promise<{ messages: MastraDBMessage[] }> {\n    const { messages } = args;\n    this.logger.debug(`InMemoryMemory: saveMessages called with ${messages.length} messages`);\n    // Simulate error handling for testing - check before saving\n    if (messages.some(msg => msg.id === 'error-message' || msg.resourceId === null)) {\n      throw new Error('Simulated error for testing');\n    }\n\n    // Update thread timestamps for each unique threadId\n    const threadIds = new Set(messages.map(msg => msg.threadId).filter((id): id is string => Boolean(id)));\n    for (const threadId of threadIds) {\n      const thread = this.db.threads.get(threadId);\n      if (thread) {\n        thread.updatedAt = new Date();\n      }\n    }\n\n    for (const message of messages) {\n      const key = message.id;\n      // Convert MastraDBMessage to StorageMessageType\n      const storageMessage: StorageMessageType = {\n        id: message.id,\n        thread_id: message.threadId || '',\n        content: JSON.stringify(message.content),\n        role: message.role || 'user',\n        type: message.type || 'text',\n        createdAt: message.createdAt,\n        resourceId: message.resourceId || null,\n      };\n      this.db.messages.set(key, storageMessage);\n    }\n\n    const list = new MessageList().add(messages, 'memory');\n    return { messages: list.get.all.db() };\n  }\n\n  async updateMessages(args: { messages: (Partial<MastraDBMessage> & { id: string })[] }): Promise<MastraDBMessage[]> {\n    const updatedMessages: MastraDBMessage[] = [];\n    for (const update of args.messages) {\n      const storageMsg = this.db.messages.get(update.id);\n      if (!storageMsg) continue;\n\n      // Track old threadId for possible move\n      const oldThreadId = storageMsg.thread_id;\n      const newThreadId = update.threadId || oldThreadId;\n      let threadIdChanged = false;\n      if (update.threadId && update.threadId !== oldThreadId) {\n        threadIdChanged = true;\n      }\n\n      // Update fields\n      if (update.role !== undefined) storageMsg.role = update.role;\n      if (update.type !== undefined) storageMsg.type = update.type;\n      if (update.createdAt !== undefined) storageMsg.createdAt = update.createdAt;\n      if (update.resourceId !== undefined) storageMsg.resourceId = update.resourceId;\n      // Deep merge content if present\n      if (update.content !== undefined) {\n        let oldContent = safelyParseJSON(storageMsg.content);\n        let newContent = update.content;\n        if (typeof newContent === 'object' && typeof oldContent === 'object') {\n          // Deep merge for metadata/content fields\n          newContent = { ...oldContent, ...newContent };\n          if (oldContent.metadata && newContent.metadata) {\n            newContent.metadata = { ...oldContent.metadata, ...newContent.metadata };\n          }\n        }\n        storageMsg.content = JSON.stringify(newContent);\n      }\n      // Handle threadId change\n      if (threadIdChanged) {\n        storageMsg.thread_id = newThreadId;\n        // Update updatedAt for both threads, ensuring strictly greater and not equal\n        const base = Date.now();\n        let oldThreadNewTime: number | undefined;\n        const oldThread = this.db.threads.get(oldThreadId);\n        if (oldThread) {\n          const prev = new Date(oldThread.updatedAt).getTime();\n          oldThreadNewTime = Math.max(base, prev + 1);\n          oldThread.updatedAt = new Date(oldThreadNewTime);\n        }\n        const newThread = this.db.threads.get(newThreadId);\n        if (newThread) {\n          const prev = new Date(newThread.updatedAt).getTime();\n          let newThreadNewTime = Math.max(base + 1, prev + 1);\n          if (oldThreadNewTime !== undefined && newThreadNewTime <= oldThreadNewTime) {\n            newThreadNewTime = oldThreadNewTime + 1;\n          }\n          newThread.updatedAt = new Date(newThreadNewTime);\n        }\n      } else {\n        // Only update the thread's updatedAt if not a move\n        const thread = this.db.threads.get(oldThreadId);\n        if (thread) {\n          const prev = new Date(thread.updatedAt).getTime();\n          let newTime = Date.now();\n          if (newTime <= prev) newTime = prev + 1;\n          thread.updatedAt = new Date(newTime);\n        }\n      }\n      // Save the updated message\n      this.db.messages.set(update.id, storageMsg);\n      // Return as MastraDBMessage\n      updatedMessages.push({\n        id: storageMsg.id,\n        threadId: storageMsg.thread_id,\n        content: safelyParseJSON(storageMsg.content),\n        role: storageMsg.role === 'user' || storageMsg.role === 'assistant' ? storageMsg.role : 'user',\n        type: storageMsg.type,\n        createdAt: storageMsg.createdAt,\n        resourceId: storageMsg.resourceId === null ? undefined : storageMsg.resourceId,\n      });\n    }\n    return updatedMessages;\n  }\n\n  async deleteMessages(messageIds: string[]): Promise<void> {\n    if (!messageIds || messageIds.length === 0) {\n      return;\n    }\n\n    this.logger.debug(`InMemoryMemory: deleteMessages called for ${messageIds.length} messages`);\n\n    // Collect thread IDs to update\n    const threadIds = new Set<string>();\n\n    for (const messageId of messageIds) {\n      const message = this.db.messages.get(messageId);\n      if (message && message.thread_id) {\n        threadIds.add(message.thread_id);\n      }\n      // Delete the message\n      this.db.messages.delete(messageId);\n    }\n\n    // Update thread timestamps\n    const now = new Date();\n    for (const threadId of threadIds) {\n      const thread = this.db.threads.get(threadId);\n      if (thread) {\n        thread.updatedAt = now;\n      }\n    }\n  }\n\n  async listThreadsByResourceId(\n    args: StorageListThreadsByResourceIdInput,\n  ): Promise<StorageListThreadsByResourceIdOutput> {\n    const { resourceId, page = 0, perPage: perPageInput, orderBy } = args;\n    const { field, direction } = this.parseOrderBy(orderBy);\n    const perPage = normalizePerPage(perPageInput, 100);\n\n    if (page < 0) {\n      throw new Error('page must be >= 0');\n    }\n\n    // Prevent unreasonably large page values that could cause performance issues\n    const maxOffset = Number.MAX_SAFE_INTEGER / 2;\n    if (page * perPage > maxOffset) {\n      throw new Error('page value too large');\n    }\n\n    this.logger.debug(`InMemoryMemory: listThreadsByResourceId called for ${resourceId}`);\n    // Mock implementation - find threads by resourceId\n    const threads = Array.from(this.db.threads.values()).filter((t: any) => t.resourceId === resourceId);\n    const sortedThreads = this.sortThreads(threads, field, direction);\n    const clonedThreads = sortedThreads.map(thread => ({\n      ...thread,\n      metadata: thread.metadata ? { ...thread.metadata } : thread.metadata,\n    })) as StorageThreadType[];\n    const { offset, perPage: perPageForResponse } = calculatePagination(page, perPageInput, perPage);\n    return {\n      threads: clonedThreads.slice(offset, offset + perPage),\n      total: clonedThreads.length,\n      page,\n      perPage: perPageForResponse,\n      hasMore: offset + perPage < clonedThreads.length,\n    };\n  }\n\n  async getResourceById({ resourceId }: { resourceId: string }): Promise<StorageResourceType | null> {\n    this.logger.debug(`InMemoryMemory: getResourceById called for ${resourceId}`);\n    const resource = this.db.resources.get(resourceId);\n    return resource\n      ? { ...resource, metadata: resource.metadata ? { ...resource.metadata } : resource.metadata }\n      : null;\n  }\n\n  async saveResource({ resource }: { resource: StorageResourceType }): Promise<StorageResourceType> {\n    this.logger.debug(`InMemoryMemory: saveResource called for ${resource.id}`);\n    this.db.resources.set(resource.id, resource);\n    return resource;\n  }\n\n  async updateResource({\n    resourceId,\n    workingMemory,\n    metadata,\n  }: {\n    resourceId: string;\n    workingMemory?: string;\n    metadata?: Record<string, unknown>;\n  }): Promise<StorageResourceType> {\n    this.logger.debug(`InMemoryMemory: updateResource called for ${resourceId}`);\n    let resource = this.db.resources.get(resourceId);\n\n    if (!resource) {\n      // Create new resource if it doesn't exist\n      resource = {\n        id: resourceId,\n        workingMemory,\n        metadata: metadata || {},\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n    } else {\n      resource = {\n        ...resource,\n        workingMemory: workingMemory !== undefined ? workingMemory : resource.workingMemory,\n        metadata: {\n          ...resource.metadata,\n          ...metadata,\n        },\n        updatedAt: new Date(),\n      };\n    }\n\n    this.db.resources.set(resourceId, resource);\n    return resource;\n  }\n\n  async cloneThread(args: StorageCloneThreadInput): Promise<StorageCloneThreadOutput> {\n    const { sourceThreadId, newThreadId: providedThreadId, resourceId, title, metadata, options } = args;\n\n    this.logger.debug(`InMemoryMemory: cloneThread called for source thread ${sourceThreadId}`);\n\n    // Get the source thread\n    const sourceThread = this.db.threads.get(sourceThreadId);\n    if (!sourceThread) {\n      throw new Error(`Source thread with id ${sourceThreadId} not found`);\n    }\n\n    // Use provided ID or generate a new one\n    const newThreadId = providedThreadId || crypto.randomUUID();\n\n    // Check if the new thread ID already exists\n    if (this.db.threads.has(newThreadId)) {\n      throw new Error(`Thread with id ${newThreadId} already exists`);\n    }\n\n    // Get messages from the source thread\n    let sourceMessages = Array.from(this.db.messages.values())\n      .filter((msg: StorageMessageType) => msg.thread_id === sourceThreadId)\n      .sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n\n    // Apply message filters if provided\n    if (options?.messageFilter) {\n      const { startDate, endDate, messageIds } = options.messageFilter;\n\n      if (messageIds && messageIds.length > 0) {\n        const messageIdSet = new Set(messageIds);\n        sourceMessages = sourceMessages.filter(msg => messageIdSet.has(msg.id));\n      }\n\n      if (startDate) {\n        sourceMessages = sourceMessages.filter(msg => new Date(msg.createdAt) >= startDate);\n      }\n\n      if (endDate) {\n        sourceMessages = sourceMessages.filter(msg => new Date(msg.createdAt) <= endDate);\n      }\n    }\n\n    // Apply message limit (take from the end to get most recent)\n    if (options?.messageLimit && options.messageLimit > 0 && sourceMessages.length > options.messageLimit) {\n      sourceMessages = sourceMessages.slice(-options.messageLimit);\n    }\n\n    const now = new Date();\n\n    // Determine the last message ID for clone metadata\n    const lastMessageId = sourceMessages.length > 0 ? sourceMessages[sourceMessages.length - 1]!.id : undefined;\n\n    // Create clone metadata\n    const cloneMetadata: ThreadCloneMetadata = {\n      sourceThreadId,\n      clonedAt: now,\n      ...(lastMessageId && { lastMessageId }),\n    };\n\n    // Create the new thread\n    const newThread: StorageThreadType = {\n      id: newThreadId,\n      resourceId: resourceId || sourceThread.resourceId,\n      title: title || (sourceThread.title ? `Clone of ${sourceThread.title}` : undefined),\n      metadata: {\n        ...metadata,\n        clone: cloneMetadata,\n      },\n      createdAt: now,\n      updatedAt: now,\n    };\n\n    // Save the new thread\n    this.db.threads.set(newThreadId, newThread);\n\n    // Clone messages with new IDs\n    const clonedMessages: MastraDBMessage[] = [];\n    for (const sourceMsg of sourceMessages) {\n      const newMessageId = crypto.randomUUID();\n      const parsedContent = safelyParseJSON(sourceMsg.content);\n\n      // Create storage message\n      const newStorageMessage: StorageMessageType = {\n        id: newMessageId,\n        thread_id: newThreadId,\n        content: sourceMsg.content,\n        role: sourceMsg.role,\n        type: sourceMsg.type,\n        createdAt: sourceMsg.createdAt,\n        resourceId: resourceId || sourceMsg.resourceId,\n      };\n\n      this.db.messages.set(newMessageId, newStorageMessage);\n\n      // Create MastraDBMessage for return\n      clonedMessages.push({\n        id: newMessageId,\n        threadId: newThreadId,\n        content: parsedContent,\n        role: sourceMsg.role as MastraDBMessage['role'],\n        type: sourceMsg.type,\n        createdAt: sourceMsg.createdAt,\n        resourceId: resourceId || sourceMsg.resourceId || undefined,\n      });\n    }\n\n    this.logger.debug(\n      `InMemoryMemory: cloned thread ${sourceThreadId} to ${newThreadId} with ${clonedMessages.length} messages`,\n    );\n\n    return {\n      thread: newThread,\n      clonedMessages,\n    };\n  }\n\n  private sortThreads(threads: any[], field: ThreadOrderBy, direction: ThreadSortDirection): any[] {\n    return threads.sort((a, b) => {\n      const isDateField = field === 'createdAt' || field === 'updatedAt';\n      const aValue = isDateField ? new Date(a[field]).getTime() : a[field];\n      const bValue = isDateField ? new Date(b[field]).getTime() : b[field];\n\n      if (typeof aValue === 'number' && typeof bValue === 'number') {\n        if (direction === 'ASC') {\n          return aValue - bValue;\n        } else {\n          return bValue - aValue;\n        }\n      }\n      return direction === 'ASC'\n        ? String(aValue).localeCompare(String(bValue))\n        : String(bValue).localeCompare(String(aValue));\n    });\n  }\n}\n","import { ErrorCategory, ErrorDomain, MastraError } from '../../../error';\nimport { StorageDomain } from '../base';\nimport type {\n  BatchCreateSpansArgs,\n  BatchDeleteTracesArgs,\n  BatchUpdateSpansArgs,\n  CreateSpanArgs,\n  GetRootSpanArgs,\n  GetRootSpanResponse,\n  GetSpanArgs,\n  GetSpanResponse,\n  GetTraceArgs,\n  GetTraceResponse,\n  ListTracesArgs,\n  ListTracesResponse,\n  TracingStorageStrategy,\n  UpdateSpanArgs,\n} from './types';\n\n/**\n * ObservabilityStorage is not abstract because it provides default implementations\n * that throw errors - adapters override only the methods they support.\n */\nexport class ObservabilityStorage extends StorageDomain {\n  constructor() {\n    super({\n      component: 'STORAGE',\n      name: 'OBSERVABILITY',\n    });\n  }\n\n  async dangerouslyClearAll(): Promise<void> {\n    // Default no-op - subclasses override\n  }\n\n  /**\n   * Provides hints for tracing strategy selection by the DefaultExporter.\n   * Storage adapters can override this to specify their preferred and supported strategies.\n   */\n  public get tracingStrategy(): {\n    preferred: TracingStorageStrategy;\n    supported: TracingStorageStrategy[];\n  } {\n    return {\n      preferred: 'batch-with-updates', // Default for most SQL stores\n      supported: ['realtime', 'batch-with-updates', 'insert-only'],\n    };\n  }\n\n  /**\n   * Creates a single Span record in the storage provider.\n   */\n  async createSpan(_args: CreateSpanArgs): Promise<void> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_CREATE_SPAN_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support creating spans',\n    });\n  }\n\n  /**\n   * Updates a single Span with partial data. Primarily used for realtime trace creation.\n   */\n  async updateSpan(_args: UpdateSpanArgs): Promise<void> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_UPDATE_SPAN_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support updating spans',\n    });\n  }\n\n  /**\n   * Retrieves a single span.\n   */\n  async getSpan(_args: GetSpanArgs): Promise<GetSpanResponse | null> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_GET_SPAN_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support getting spans',\n    });\n  }\n\n  /**\n   * Retrieves a single root span.\n   */\n  async getRootSpan(_args: GetRootSpanArgs): Promise<GetRootSpanResponse | null> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_GET_ROOT_SPAN_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support getting root spans',\n    });\n  }\n\n  /**\n   * Retrieves a single trace with all its associated spans.\n   */\n  async getTrace(_args: GetTraceArgs): Promise<GetTraceResponse | null> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_GET_TRACE_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support getting traces',\n    });\n  }\n\n  /**\n   * Retrieves a list of traces with optional filtering.\n   */\n  async listTraces(_args: ListTracesArgs): Promise<ListTracesResponse> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_LIST_TRACES_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support listing traces',\n    });\n  }\n\n  /**\n   * Creates multiple Spans in a single batch.\n   */\n  async batchCreateSpans(_args: BatchCreateSpansArgs): Promise<void> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_BATCH_CREATE_SPAN_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support batch creating spans',\n    });\n  }\n\n  /**\n   * Updates multiple Spans in a single batch.\n   */\n  async batchUpdateSpans(_args: BatchUpdateSpansArgs): Promise<void> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_BATCH_UPDATE_SPANS_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support batch updating spans',\n    });\n  }\n\n  /**\n   * Deletes multiple traces and all their associated spans in a single batch operation.\n   */\n  async batchDeleteTraces(_args: BatchDeleteTracesArgs): Promise<void> {\n    throw new MastraError({\n      id: 'OBSERVABILITY_STORAGE_BATCH_DELETE_TRACES_NOT_IMPLEMENTED',\n      domain: ErrorDomain.MASTRA_OBSERVABILITY,\n      category: ErrorCategory.SYSTEM,\n      text: 'This storage provider does not support batch deleting traces',\n    });\n  }\n}\n","import { ErrorCategory, ErrorDomain, MastraError } from '../../../error';\nimport type { PaginationInfo } from '../../types';\nimport type { InMemoryDB } from '../inmemory-db';\nimport { ObservabilityStorage } from './base';\nimport type {\n  BatchCreateSpansArgs,\n  BatchDeleteTracesArgs,\n  BatchUpdateSpansArgs,\n  CreateSpanArgs,\n  CreateSpanRecord,\n  GetRootSpanArgs,\n  GetRootSpanResponse,\n  GetSpanArgs,\n  GetSpanResponse,\n  GetTraceArgs,\n  GetTraceResponse,\n  ListTracesArgs,\n  SpanRecord,\n  TracingStorageStrategy,\n  UpdateSpanArgs,\n} from './types';\nimport { listTracesArgsSchema, TraceStatus } from './types';\n\n/**\n * Internal structure for storing a trace with computed properties for efficient filtering\n */\nexport interface TraceEntry {\n  /** All spans in this trace, keyed by spanId */\n  spans: Record<string, SpanRecord>;\n  /** Root span for this trace (parentSpanId === null) */\n  rootSpan: SpanRecord | null;\n  /** Computed trace status based on root span state */\n  status: TraceStatus;\n  /** True if any span in the trace has an error */\n  hasChildError: boolean;\n}\n\nexport class ObservabilityInMemory extends ObservabilityStorage {\n  private db: InMemoryDB;\n\n  constructor({ db }: { db: InMemoryDB }) {\n    super();\n    this.db = db;\n  }\n\n  async dangerouslyClearAll(): Promise<void> {\n    this.db.traces.clear();\n  }\n\n  public get tracingStrategy(): {\n    preferred: TracingStorageStrategy;\n    supported: TracingStorageStrategy[];\n  } {\n    return {\n      preferred: 'realtime',\n      supported: ['realtime', 'batch-with-updates', 'insert-only'],\n    };\n  }\n\n  async createSpan(args: CreateSpanArgs): Promise<void> {\n    const { span } = args;\n    this.validateCreateSpan(span);\n    const now = new Date();\n    const record: SpanRecord = {\n      ...span,\n      createdAt: now,\n      updatedAt: now,\n    };\n\n    this.upsertSpanToTrace(record);\n  }\n\n  async batchCreateSpans(args: BatchCreateSpansArgs): Promise<void> {\n    const now = new Date();\n    for (const span of args.records) {\n      this.validateCreateSpan(span);\n      const record: SpanRecord = {\n        ...span,\n        createdAt: now,\n        updatedAt: now,\n      };\n      this.upsertSpanToTrace(record);\n    }\n  }\n\n  private validateCreateSpan(record: CreateSpanRecord): void {\n    if (!record.spanId) {\n      throw new MastraError({\n        id: 'OBSERVABILITY_SPAN_ID_REQUIRED',\n        domain: ErrorDomain.MASTRA_OBSERVABILITY,\n        category: ErrorCategory.SYSTEM,\n        text: 'Span ID is required for creating a span',\n      });\n    }\n\n    if (!record.traceId) {\n      throw new MastraError({\n        id: 'OBSERVABILITY_TRACE_ID_REQUIRED',\n        domain: ErrorDomain.MASTRA_OBSERVABILITY,\n        category: ErrorCategory.SYSTEM,\n        text: 'Trace ID is required for creating a span',\n      });\n    }\n  }\n\n  /**\n   * Inserts or updates a span in the trace and recomputes trace-level properties\n   */\n  private upsertSpanToTrace(span: SpanRecord): void {\n    const { traceId, spanId } = span;\n    let traceEntry = this.db.traces.get(traceId);\n\n    if (!traceEntry) {\n      traceEntry = {\n        spans: {},\n        rootSpan: null,\n        status: TraceStatus.RUNNING,\n        hasChildError: false,\n      };\n      this.db.traces.set(traceId, traceEntry);\n    }\n\n    traceEntry.spans[spanId] = span;\n\n    // Update root span if this is a root span\n    if (span.parentSpanId === null) {\n      traceEntry.rootSpan = span;\n    }\n\n    this.recomputeTraceProperties(traceEntry);\n  }\n\n  /**\n   * Recomputes derived trace properties from all spans\n   */\n  private recomputeTraceProperties(traceEntry: TraceEntry): void {\n    const spans = Object.values(traceEntry.spans);\n    if (spans.length === 0) return;\n\n    // Compute hasChildError (use != null to catch both null and undefined)\n    traceEntry.hasChildError = spans.some(s => s.error != null);\n\n    // Compute status from root span\n    const rootSpan = traceEntry.rootSpan;\n    if (rootSpan) {\n      if (rootSpan.error != null) {\n        traceEntry.status = TraceStatus.ERROR;\n      } else if (rootSpan.endedAt === null) {\n        traceEntry.status = TraceStatus.RUNNING;\n      } else {\n        traceEntry.status = TraceStatus.SUCCESS;\n      }\n    } else {\n      // No root span yet, consider it running\n      traceEntry.status = TraceStatus.RUNNING;\n    }\n  }\n\n  async getSpan(args: GetSpanArgs): Promise<GetSpanResponse | null> {\n    const { traceId, spanId } = args;\n    const traceEntry = this.db.traces.get(traceId);\n    if (!traceEntry) {\n      return null;\n    }\n\n    const span = traceEntry.spans[spanId];\n    if (!span) {\n      return null;\n    }\n\n    return { span };\n  }\n\n  async getRootSpan(args: GetRootSpanArgs): Promise<GetRootSpanResponse | null> {\n    const { traceId } = args;\n    const traceEntry = this.db.traces.get(traceId);\n    if (!traceEntry || !traceEntry.rootSpan) {\n      return null;\n    }\n\n    return { span: traceEntry.rootSpan };\n  }\n\n  async getTrace(args: GetTraceArgs): Promise<GetTraceResponse | null> {\n    const { traceId } = args;\n    const traceEntry = this.db.traces.get(traceId);\n    if (!traceEntry) {\n      return null;\n    }\n\n    const spans = Object.values(traceEntry.spans);\n    if (spans.length === 0) {\n      return null;\n    }\n\n    // Sort spans by startedAt\n    spans.sort((a, b) => a.startedAt.getTime() - b.startedAt.getTime());\n\n    return {\n      traceId,\n      spans,\n    };\n  }\n\n  async listTraces(args: ListTracesArgs): Promise<{ pagination: PaginationInfo; spans: SpanRecord[] }> {\n    // Parse args through schema to apply defaults\n    const { filters, pagination, orderBy } = listTracesArgsSchema.parse(args);\n\n    // Collect all traces that match filters\n    const matchingRootSpans: SpanRecord[] = [];\n\n    for (const [, traceEntry] of this.db.traces) {\n      if (!traceEntry.rootSpan) continue;\n\n      if (this.traceMatchesFilters(traceEntry, filters)) {\n        matchingRootSpans.push(traceEntry.rootSpan);\n      }\n    }\n\n    // Sort by orderBy field\n    const { field: sortField, direction: sortDirection } = orderBy;\n\n    matchingRootSpans.sort((a, b) => {\n      if (sortField === 'endedAt') {\n        const aVal = a.endedAt;\n        const bVal = b.endedAt;\n\n        // Handle nullish values (running spans with null endedAt)\n        // For endedAt DESC: NULLs FIRST (running spans on top when viewing newest)\n        // For endedAt ASC: NULLs LAST (running spans at end when viewing oldest)\n        if (aVal == null && bVal == null) return 0;\n        if (aVal == null) return sortDirection === 'DESC' ? -1 : 1;\n        if (bVal == null) return sortDirection === 'DESC' ? 1 : -1;\n\n        const diff = aVal.getTime() - bVal.getTime();\n        return sortDirection === 'DESC' ? -diff : diff;\n      } else {\n        // startedAt is never null (required field)\n        const diff = a.startedAt.getTime() - b.startedAt.getTime();\n        return sortDirection === 'DESC' ? -diff : diff;\n      }\n    });\n\n    // Apply pagination\n    const total = matchingRootSpans.length;\n    const { page, perPage } = pagination;\n    const start = page * perPage;\n    const end = start + perPage;\n\n    const paged = matchingRootSpans.slice(start, end);\n\n    return {\n      spans: paged,\n      pagination: { total, page, perPage, hasMore: end < total },\n    };\n  }\n\n  /**\n   * Check if a trace matches all provided filters\n   */\n  private traceMatchesFilters(traceEntry: TraceEntry, filters: ListTracesArgs['filters']): boolean {\n    if (!filters) return true;\n\n    const rootSpan = traceEntry.rootSpan;\n    if (!rootSpan) return false;\n\n    // Date range filters on startedAt (based on root span)\n    if (filters.startedAt) {\n      if (filters.startedAt.start && rootSpan.startedAt < filters.startedAt.start) {\n        return false;\n      }\n      if (filters.startedAt.end && rootSpan.startedAt > filters.startedAt.end) {\n        return false;\n      }\n    }\n\n    // Date range filters on endedAt (based on root span)\n    if (filters.endedAt) {\n      // If root span is still running (endedAt is nullish), it doesn't match endedAt filters\n      if (rootSpan.endedAt == null) {\n        return false;\n      }\n      if (filters.endedAt.start && rootSpan.endedAt < filters.endedAt.start) {\n        return false;\n      }\n      if (filters.endedAt.end && rootSpan.endedAt > filters.endedAt.end) {\n        return false;\n      }\n    }\n\n    // Span type filter (on root span)\n    if (filters.spanType !== undefined && rootSpan.spanType !== filters.spanType) {\n      return false;\n    }\n\n    // Entity filters\n    if (filters.entityType !== undefined && rootSpan.entityType !== filters.entityType) {\n      return false;\n    }\n    if (filters.entityId !== undefined && rootSpan.entityId !== filters.entityId) {\n      return false;\n    }\n    if (filters.entityName !== undefined && rootSpan.entityName !== filters.entityName) {\n      return false;\n    }\n\n    // Identity & Tenancy filters\n    if (filters.userId !== undefined && rootSpan.userId !== filters.userId) {\n      return false;\n    }\n    if (filters.organizationId !== undefined && rootSpan.organizationId !== filters.organizationId) {\n      return false;\n    }\n    if (filters.resourceId !== undefined && rootSpan.resourceId !== filters.resourceId) {\n      return false;\n    }\n\n    // Correlation ID filters\n    if (filters.runId !== undefined && rootSpan.runId !== filters.runId) {\n      return false;\n    }\n    if (filters.sessionId !== undefined && rootSpan.sessionId !== filters.sessionId) {\n      return false;\n    }\n    if (filters.threadId !== undefined && rootSpan.threadId !== filters.threadId) {\n      return false;\n    }\n    if (filters.requestId !== undefined && rootSpan.requestId !== filters.requestId) {\n      return false;\n    }\n\n    // Deployment context filters\n    if (filters.environment !== undefined && rootSpan.environment !== filters.environment) {\n      return false;\n    }\n    if (filters.source !== undefined && rootSpan.source !== filters.source) {\n      return false;\n    }\n    if (filters.serviceName !== undefined && rootSpan.serviceName !== filters.serviceName) {\n      return false;\n    }\n\n    // Scope filter (partial match - all provided keys must match)\n    // Use != null to handle both null and undefined (nullish filter fields)\n    if (filters.scope != null && rootSpan.scope != null) {\n      for (const [key, value] of Object.entries(filters.scope)) {\n        if (!this.jsonValueEquals(rootSpan.scope[key], value)) {\n          return false;\n        }\n      }\n    } else if (filters.scope != null && rootSpan.scope == null) {\n      return false;\n    }\n\n    // Metadata filter (partial match - all provided keys must match)\n    // Use != null to handle both null and undefined (nullish filter fields)\n    if (filters.metadata != null && rootSpan.metadata != null) {\n      for (const [key, value] of Object.entries(filters.metadata)) {\n        if (!this.jsonValueEquals(rootSpan.metadata[key], value)) {\n          return false;\n        }\n      }\n    } else if (filters.metadata != null && rootSpan.metadata == null) {\n      return false;\n    }\n\n    // Tags filter (all provided tags must be present)\n    // Use != null to handle both null and undefined (nullish filter fields)\n    if (filters.tags != null && filters.tags.length > 0) {\n      if (rootSpan.tags == null) {\n        return false;\n      }\n      for (const tag of filters.tags) {\n        if (!rootSpan.tags.includes(tag)) {\n          return false;\n        }\n      }\n    }\n\n    // Derived status filter\n    if (filters.status !== undefined && traceEntry.status !== filters.status) {\n      return false;\n    }\n\n    // Has child error filter\n    if (filters.hasChildError !== undefined && traceEntry.hasChildError !== filters.hasChildError) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Deep equality check for JSON values\n   */\n  private jsonValueEquals(a: unknown, b: unknown): boolean {\n    if (a === undefined || b === undefined) {\n      return a === b;\n    }\n    if (a === null || b === null) {\n      return a === b;\n    }\n    if (typeof a !== typeof b) {\n      return false;\n    }\n    // Handle Date objects\n    if (a instanceof Date && b instanceof Date) {\n      return a.getTime() === b.getTime();\n    }\n    if (a instanceof Date || b instanceof Date) {\n      return false; // One is Date, other is not\n    }\n    if (typeof a === 'object') {\n      if (Array.isArray(a) && Array.isArray(b)) {\n        if (a.length !== b.length) return false;\n        return a.every((val, i) => this.jsonValueEquals(val, b[i]));\n      }\n      if (Array.isArray(a) || Array.isArray(b)) {\n        return false;\n      }\n      const aKeys = Object.keys(a as object);\n      const bKeys = Object.keys(b as object);\n      if (aKeys.length !== bKeys.length) return false;\n      return aKeys.every(key =>\n        this.jsonValueEquals((a as Record<string, unknown>)[key], (b as Record<string, unknown>)[key]),\n      );\n    }\n    return a === b;\n  }\n\n  async updateSpan(args: UpdateSpanArgs): Promise<void> {\n    const { traceId, spanId, updates } = args;\n    const traceEntry = this.db.traces.get(traceId);\n\n    if (!traceEntry) {\n      throw new MastraError({\n        id: 'OBSERVABILITY_UPDATE_SPAN_NOT_FOUND',\n        domain: ErrorDomain.MASTRA_OBSERVABILITY,\n        category: ErrorCategory.SYSTEM,\n        text: 'Trace not found for span update',\n      });\n    }\n\n    const span = traceEntry.spans[spanId];\n    if (!span) {\n      throw new MastraError({\n        id: 'OBSERVABILITY_UPDATE_SPAN_NOT_FOUND',\n        domain: ErrorDomain.MASTRA_OBSERVABILITY,\n        category: ErrorCategory.SYSTEM,\n        text: 'Span not found for update',\n      });\n    }\n\n    const updatedSpan: SpanRecord = {\n      ...span,\n      ...updates,\n      updatedAt: new Date(),\n    };\n\n    traceEntry.spans[spanId] = updatedSpan;\n\n    // Update root span reference if this is the root span\n    if (updatedSpan.parentSpanId === null) {\n      traceEntry.rootSpan = updatedSpan;\n    }\n\n    this.recomputeTraceProperties(traceEntry);\n  }\n\n  async batchUpdateSpans(args: BatchUpdateSpansArgs): Promise<void> {\n    for (const record of args.records) {\n      await this.updateSpan(record);\n    }\n  }\n\n  async batchDeleteTraces(args: BatchDeleteTracesArgs): Promise<void> {\n    for (const traceId of args.traceIds) {\n      this.db.traces.delete(traceId);\n    }\n  }\n}\n","import { ErrorCategory, ErrorDomain, MastraError } from '../../../error';\nimport type { ListScoresResponse, SaveScorePayload, ScoreRowData, ScoringSource } from '../../../evals/types';\nimport type { StoragePagination } from '../../types';\nimport { StorageDomain } from '../base';\n\nexport abstract class ScoresStorage extends StorageDomain {\n  constructor() {\n    super({\n      component: 'STORAGE',\n      name: 'SCORES',\n    });\n  }\n\n  async dangerouslyClearAll(): Promise<void> {\n    // Default no-op - subclasses override\n  }\n\n  abstract getScoreById({ id }: { id: string }): Promise<ScoreRowData | null>;\n\n  abstract saveScore(score: SaveScorePayload): Promise<{ score: ScoreRowData }>;\n\n  abstract listScoresByScorerId({\n    scorerId,\n    pagination,\n    entityId,\n    entityType,\n    source,\n  }: {\n    scorerId: string;\n    pagination: StoragePagination;\n    entityId?: string;\n    entityType?: string;\n    source?: ScoringSource;\n  }): Promise<ListScoresResponse>;\n\n  abstract listScoresByRunId({\n    runId,\n    pagination,\n  }: {\n    runId: string;\n    pagination: StoragePagination;\n  }): Promise<ListScoresResponse>;\n\n  abstract listScoresByEntityId({\n    entityId,\n    entityType,\n    pagination,\n  }: {\n    pagination: StoragePagination;\n    entityId: string;\n    entityType: string;\n  }): Promise<ListScoresResponse>;\n\n  async listScoresBySpan({\n    traceId,\n    spanId,\n    pagination: _pagination,\n  }: {\n    traceId: string;\n    spanId: string;\n    pagination: StoragePagination;\n  }): Promise<ListScoresResponse> {\n    throw new MastraError({\n      id: 'SCORES_STORAGE_GET_SCORES_BY_SPAN_NOT_IMPLEMENTED',\n      domain: ErrorDomain.STORAGE,\n      category: ErrorCategory.SYSTEM,\n      details: { traceId, spanId },\n    });\n  }\n}\n","import type { ListScoresResponse, SaveScorePayload, ScoreRowData, ScoringSource } from '../../../evals/types';\nimport { calculatePagination, normalizePerPage } from '../../base';\nimport type { StoragePagination } from '../../types';\nimport type { InMemoryDB } from '../inmemory-db';\nimport { ScoresStorage } from './base';\n\nexport class ScoresInMemory extends ScoresStorage {\n  private db: InMemoryDB;\n\n  constructor({ db }: { db: InMemoryDB }) {\n    super();\n    this.db = db;\n  }\n\n  async dangerouslyClearAll(): Promise<void> {\n    this.db.scores.clear();\n  }\n\n  async getScoreById({ id }: { id: string }): Promise<ScoreRowData | null> {\n    return this.db.scores.get(id) ?? null;\n  }\n\n  async saveScore(score: SaveScorePayload): Promise<{ score: ScoreRowData }> {\n    const newScore = { id: crypto.randomUUID(), createdAt: new Date(), updatedAt: new Date(), ...score };\n    this.db.scores.set(newScore.id, newScore);\n    return { score: newScore };\n  }\n\n  async listScoresByScorerId({\n    scorerId,\n    pagination,\n    entityId,\n    entityType,\n    source,\n  }: {\n    scorerId: string;\n    pagination: StoragePagination;\n    entityId?: string;\n    entityType?: string;\n    source?: ScoringSource;\n  }): Promise<ListScoresResponse> {\n    const scores = Array.from(this.db.scores.values()).filter(score => {\n      let baseFilter = score.scorerId === scorerId;\n\n      if (entityId) {\n        baseFilter = baseFilter && score.entityId === entityId;\n      }\n\n      if (entityType) {\n        baseFilter = baseFilter && score.entityType === entityType;\n      }\n\n      if (source) {\n        baseFilter = baseFilter && score.source === source;\n      }\n\n      return baseFilter;\n    });\n\n    const { page, perPage: perPageInput } = pagination;\n    const perPage = normalizePerPage(perPageInput, Number.MAX_SAFE_INTEGER);\n    const { offset: start, perPage: perPageForResponse } = calculatePagination(page, perPageInput, perPage);\n    const end = perPageInput === false ? scores.length : start + perPage;\n\n    return {\n      scores: scores.slice(start, end),\n      pagination: {\n        total: scores.length,\n        page: page,\n        perPage: perPageForResponse,\n        hasMore: perPageInput === false ? false : scores.length > end,\n      },\n    };\n  }\n\n  async listScoresByRunId({\n    runId,\n    pagination,\n  }: {\n    runId: string;\n    pagination: StoragePagination;\n  }): Promise<ListScoresResponse> {\n    const scores = Array.from(this.db.scores.values()).filter(score => score.runId === runId);\n\n    const { page, perPage: perPageInput } = pagination;\n    const perPage = normalizePerPage(perPageInput, Number.MAX_SAFE_INTEGER); // false â†’ MAX_SAFE_INTEGER\n    const { offset: start, perPage: perPageForResponse } = calculatePagination(page, perPageInput, perPage);\n    const end = perPageInput === false ? scores.length : start + perPage;\n\n    return {\n      scores: scores.slice(start, end),\n      pagination: {\n        total: scores.length,\n        page: page,\n        perPage: perPageForResponse,\n        hasMore: perPageInput === false ? false : scores.length > end,\n      },\n    };\n  }\n\n  async listScoresByEntityId({\n    entityId,\n    entityType,\n    pagination,\n  }: {\n    entityId: string;\n    entityType: string;\n    pagination: StoragePagination;\n  }): Promise<ListScoresResponse> {\n    const scores = Array.from(this.db.scores.values()).filter(score => {\n      const baseFilter = score.entityId === entityId && score.entityType === entityType;\n\n      return baseFilter;\n    });\n\n    const { page, perPage: perPageInput } = pagination;\n    const perPage = normalizePerPage(perPageInput, Number.MAX_SAFE_INTEGER);\n    const { offset: start, perPage: perPageForResponse } = calculatePagination(page, perPageInput, perPage);\n    const end = perPageInput === false ? scores.length : start + perPage;\n\n    return {\n      scores: scores.slice(start, end),\n      pagination: {\n        total: scores.length,\n        page: page,\n        perPage: perPageForResponse,\n        hasMore: perPageInput === false ? false : scores.length > end,\n      },\n    };\n  }\n\n  async listScoresBySpan({\n    traceId,\n    spanId,\n    pagination,\n  }: {\n    traceId: string;\n    spanId: string;\n    pagination: StoragePagination;\n  }): Promise<ListScoresResponse> {\n    const scores = Array.from(this.db.scores.values()).filter(\n      score => score.traceId === traceId && score.spanId === spanId,\n    );\n    scores.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n\n    const { page, perPage: perPageInput } = pagination;\n    const perPage = normalizePerPage(perPageInput, Number.MAX_SAFE_INTEGER);\n    const { offset: start, perPage: perPageForResponse } = calculatePagination(page, perPageInput, perPage);\n    const end = perPageInput === false ? scores.length : start + perPage;\n\n    return {\n      scores: scores.slice(start, end),\n      pagination: {\n        total: scores.length,\n        page: page,\n        perPage: perPageForResponse,\n        hasMore: perPageInput === false ? false : scores.length > end,\n      },\n    };\n  }\n}\n","import type { StepResult, WorkflowRunState } from '../../../workflows';\nimport type { UpdateWorkflowStateOptions, WorkflowRun, WorkflowRuns, StorageListWorkflowRunsInput } from '../../types';\nimport { StorageDomain } from '../base';\n\nexport abstract class WorkflowsStorage extends StorageDomain {\n  constructor() {\n    super({\n      component: 'STORAGE',\n      name: 'WORKFLOWS',\n    });\n  }\n\n  abstract updateWorkflowResults({\n    workflowName,\n    runId,\n    stepId,\n    result,\n    requestContext,\n  }: {\n    workflowName: string;\n    runId: string;\n    stepId: string;\n    result: StepResult<any, any, any, any>;\n    requestContext: Record<string, any>;\n  }): Promise<Record<string, StepResult<any, any, any, any>>>;\n\n  abstract updateWorkflowState({\n    workflowName,\n    runId,\n    opts,\n  }: {\n    workflowName: string;\n    runId: string;\n    opts: UpdateWorkflowStateOptions;\n  }): Promise<WorkflowRunState | undefined>;\n\n  abstract persistWorkflowSnapshot(_: {\n    workflowName: string;\n    runId: string;\n    resourceId?: string;\n    snapshot: WorkflowRunState;\n    createdAt?: Date;\n    updatedAt?: Date;\n  }): Promise<void>;\n\n  abstract loadWorkflowSnapshot({\n    workflowName,\n    runId,\n  }: {\n    workflowName: string;\n    runId: string;\n  }): Promise<WorkflowRunState | null>;\n\n  abstract listWorkflowRuns(args?: StorageListWorkflowRunsInput): Promise<WorkflowRuns>;\n\n  abstract getWorkflowRunById(args: { runId: string; workflowName?: string }): Promise<WorkflowRun | null>;\n\n  abstract deleteWorkflowRunById(args: { runId: string; workflowName: string }): Promise<void>;\n}\n","import type { StepResult, WorkflowRunState } from '../../../workflows';\nimport { normalizePerPage } from '../../base';\nimport type {\n  StorageWorkflowRun,\n  WorkflowRun,\n  WorkflowRuns,\n  StorageListWorkflowRunsInput,\n  UpdateWorkflowStateOptions,\n} from '../../types';\nimport type { InMemoryDB } from '../inmemory-db';\nimport { WorkflowsStorage } from './base';\n\nexport class WorkflowsInMemory extends WorkflowsStorage {\n  private db: InMemoryDB;\n\n  constructor({ db }: { db: InMemoryDB }) {\n    super();\n    this.db = db;\n  }\n\n  async dangerouslyClearAll(): Promise<void> {\n    this.db.workflows.clear();\n  }\n\n  private getWorkflowKey(workflowName: string, runId: string): string {\n    return `${workflowName}-${runId}`;\n  }\n\n  async updateWorkflowResults({\n    workflowName,\n    runId,\n    stepId,\n    result,\n    requestContext,\n  }: {\n    workflowName: string;\n    runId: string;\n    stepId: string;\n    result: StepResult<any, any, any, any>;\n    requestContext: Record<string, any>;\n  }): Promise<Record<string, StepResult<any, any, any, any>>> {\n    this.logger.debug(`WorkflowsInMemory: updateWorkflowResults called for ${workflowName} ${runId} ${stepId}`, result);\n    const key = this.getWorkflowKey(workflowName, runId);\n    const run = this.db.workflows.get(key);\n\n    if (!run) {\n      return {};\n    }\n\n    let snapshot: WorkflowRunState;\n    if (!run.snapshot) {\n      snapshot = {\n        context: {},\n        activePaths: [],\n        activeStepsPath: {},\n        timestamp: Date.now(),\n        suspendedPaths: {},\n        resumeLabels: {},\n        serializedStepGraph: [],\n        value: {},\n        waitingPaths: {},\n        status: 'pending',\n        runId: run.run_id,\n      } as WorkflowRunState;\n\n      this.db.workflows.set(key, {\n        ...run,\n        snapshot,\n      });\n    } else {\n      snapshot = typeof run.snapshot === 'string' ? JSON.parse(run.snapshot) : run.snapshot;\n    }\n\n    if (!snapshot || !snapshot?.context) {\n      throw new Error(`Snapshot not found for runId ${runId}`);\n    }\n\n    snapshot.context[stepId] = result;\n    snapshot.requestContext = { ...snapshot.requestContext, ...requestContext };\n\n    this.db.workflows.set(key, {\n      ...run,\n      snapshot: snapshot,\n    });\n\n    return JSON.parse(JSON.stringify(snapshot.context));\n  }\n\n  async updateWorkflowState({\n    workflowName,\n    runId,\n    opts,\n  }: {\n    workflowName: string;\n    runId: string;\n    opts: UpdateWorkflowStateOptions;\n  }): Promise<WorkflowRunState | undefined> {\n    const key = this.getWorkflowKey(workflowName, runId);\n    const run = this.db.workflows.get(key);\n\n    if (!run) {\n      return;\n    }\n\n    let snapshot: WorkflowRunState;\n    if (!run.snapshot) {\n      snapshot = {\n        context: {},\n        activePaths: [],\n        activeStepsPath: {},\n        timestamp: Date.now(),\n        suspendedPaths: {},\n        resumeLabels: {},\n        serializedStepGraph: [],\n        value: {},\n        waitingPaths: {},\n        status: 'pending',\n        runId: run.run_id,\n      } as WorkflowRunState;\n\n      this.db.workflows.set(key, {\n        ...run,\n        snapshot,\n      });\n    } else {\n      snapshot = typeof run.snapshot === 'string' ? JSON.parse(run.snapshot) : run.snapshot;\n    }\n\n    if (!snapshot || !snapshot?.context) {\n      throw new Error(`Snapshot not found for runId ${runId}`);\n    }\n\n    snapshot = { ...snapshot, ...opts };\n    this.db.workflows.set(key, {\n      ...run,\n      snapshot: snapshot,\n    });\n\n    return snapshot;\n  }\n\n  async persistWorkflowSnapshot({\n    workflowName,\n    runId,\n    resourceId,\n    snapshot,\n    createdAt,\n    updatedAt,\n  }: {\n    workflowName: string;\n    runId: string;\n    resourceId?: string;\n    snapshot: WorkflowRunState;\n    createdAt?: Date;\n    updatedAt?: Date;\n  }): Promise<void> {\n    const key = this.getWorkflowKey(workflowName, runId);\n    const now = new Date();\n    const data: StorageWorkflowRun = {\n      workflow_name: workflowName,\n      run_id: runId,\n      resourceId,\n      snapshot,\n      createdAt: createdAt ?? now,\n      updatedAt: updatedAt ?? now,\n    };\n\n    this.db.workflows.set(key, data);\n  }\n\n  async loadWorkflowSnapshot({\n    workflowName,\n    runId,\n  }: {\n    workflowName: string;\n    runId: string;\n  }): Promise<WorkflowRunState | null> {\n    this.logger.debug('Loading workflow snapshot', { workflowName, runId });\n    const key = this.getWorkflowKey(workflowName, runId);\n    const run = this.db.workflows.get(key);\n\n    if (!run) {\n      return null;\n    }\n\n    const snapshot = typeof run.snapshot === 'string' ? JSON.parse(run.snapshot) : run.snapshot;\n    // Return a deep copy to prevent mutation\n    return snapshot ? JSON.parse(JSON.stringify(snapshot)) : null;\n  }\n\n  async listWorkflowRuns({\n    workflowName,\n    fromDate,\n    toDate,\n    perPage,\n    page,\n    resourceId,\n    status,\n  }: StorageListWorkflowRunsInput = {}): Promise<WorkflowRuns> {\n    if (page !== undefined && page < 0) {\n      throw new Error('page must be >= 0');\n    }\n\n    let runs = Array.from(this.db.workflows.values());\n\n    if (workflowName) runs = runs.filter((run: any) => run.workflow_name === workflowName);\n    if (status) {\n      runs = runs.filter((run: any) => {\n        let snapshot: WorkflowRunState | string = run?.snapshot!;\n\n        if (!snapshot) {\n          return false;\n        }\n\n        if (typeof snapshot === 'string') {\n          try {\n            snapshot = JSON.parse(snapshot) as WorkflowRunState;\n          } catch {\n            return false;\n          }\n        } else {\n          snapshot = JSON.parse(JSON.stringify(snapshot)) as WorkflowRunState;\n        }\n\n        return snapshot.status === status;\n      });\n    }\n\n    if (fromDate && toDate) {\n      runs = runs.filter(\n        (run: any) =>\n          new Date(run.createdAt).getTime() >= fromDate.getTime() &&\n          new Date(run.createdAt).getTime() <= toDate.getTime(),\n      );\n    } else if (fromDate) {\n      runs = runs.filter((run: any) => new Date(run.createdAt).getTime() >= fromDate.getTime());\n    } else if (toDate) {\n      runs = runs.filter((run: any) => new Date(run.createdAt).getTime() <= toDate.getTime());\n    }\n    if (resourceId) runs = runs.filter((run: any) => run.resourceId === resourceId);\n\n    const total = runs.length;\n\n    // Sort by createdAt\n    runs.sort((a: any, b: any) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n\n    // Apply pagination\n    if (perPage !== undefined && page !== undefined) {\n      // Use MAX_SAFE_INTEGER as default to maintain \"no pagination\" behavior when undefined\n      const normalizedPerPage = normalizePerPage(perPage, Number.MAX_SAFE_INTEGER);\n      const offset = page * normalizedPerPage;\n      const start = offset;\n      const end = start + normalizedPerPage;\n      runs = runs.slice(start, end);\n    }\n\n    // Deserialize snapshot if it's a string\n    const parsedRuns = runs.map((run: any) => ({\n      ...run,\n      snapshot: typeof run.snapshot === 'string' ? JSON.parse(run.snapshot) : JSON.parse(JSON.stringify(run.snapshot)),\n      createdAt: new Date(run.createdAt),\n      updatedAt: new Date(run.updatedAt),\n      runId: run.run_id,\n      workflowName: run.workflow_name,\n      resourceId: run.resourceId,\n    }));\n\n    return { runs: parsedRuns as WorkflowRun[], total };\n  }\n\n  async getWorkflowRunById({\n    runId,\n    workflowName,\n  }: {\n    runId: string;\n    workflowName?: string;\n  }): Promise<WorkflowRun | null> {\n    const runs = Array.from(this.db.workflows.values()).filter((r: any) => r.run_id === runId);\n    let run = runs.find((r: any) => r.workflow_name === workflowName);\n\n    if (!run) return null;\n\n    // Return a deep copy to prevent mutation\n    const parsedRun = {\n      ...run,\n      snapshot: typeof run.snapshot === 'string' ? JSON.parse(run.snapshot) : JSON.parse(JSON.stringify(run.snapshot)),\n      createdAt: new Date(run.createdAt),\n      updatedAt: new Date(run.updatedAt),\n      runId: run.run_id,\n      workflowName: run.workflow_name,\n      resourceId: run.resourceId,\n    };\n\n    return parsedRun as WorkflowRun;\n  }\n\n  async deleteWorkflowRunById({ runId, workflowName }: { runId: string; workflowName: string }): Promise<void> {\n    const key = this.getWorkflowKey(workflowName, runId);\n    this.db.workflows.delete(key);\n  }\n}\n","import { MastraStorage } from './base';\nimport type { StorageDomains } from './base';\nimport { InMemoryAgentsStorage } from './domains/agents/inmemory';\nimport { InMemoryDB } from './domains/inmemory-db';\nimport { InMemoryMemory } from './domains/memory/inmemory';\nimport { ObservabilityInMemory } from './domains/observability/inmemory';\nimport { ScoresInMemory } from './domains/scores/inmemory';\nimport { WorkflowsInMemory } from './domains/workflows/inmemory';\n/**\n * In-memory storage implementation for testing and development.\n *\n * All data is stored in memory and will be lost when the process ends.\n * Access domain-specific storage via `getStore()`:\n *\n * @example\n * ```typescript\n * const storage = new InMemoryStore();\n *\n * // Access memory domain\n * const memory = await storage.getStore('memory');\n * await memory?.saveThread({ thread });\n *\n * // Access workflows domain\n * const workflows = await storage.getStore('workflows');\n * await workflows?.persistWorkflowSnapshot({ workflowName, runId, snapshot });\n * ```\n */\nexport class InMemoryStore extends MastraStorage {\n  stores: StorageDomains;\n\n  /**\n   * Internal database layer shared across all domains.\n   * This is an implementation detail - domains interact with this\n   * rather than managing their own data structures.\n   */\n  #db: InMemoryDB;\n\n  constructor({ id = 'in-memory' }: { id?: string } = {}) {\n    super({ id, name: 'InMemoryStorage' });\n    // InMemoryStore doesn't need async initialization\n    this.hasInitialized = Promise.resolve(true);\n\n    // Create internal db layer - shared across all domains\n    this.#db = new InMemoryDB();\n\n    // Create all domain instances with the shared db\n    this.stores = {\n      memory: new InMemoryMemory({ db: this.#db }),\n      workflows: new WorkflowsInMemory({ db: this.#db }),\n      scores: new ScoresInMemory({ db: this.#db }),\n      observability: new ObservabilityInMemory({ db: this.#db }),\n      agents: new InMemoryAgentsStorage({ db: this.#db }),\n    };\n  }\n\n  /**\n   * Clears all data from the in-memory database.\n   * Useful for testing.\n   * @deprecated Use dangerouslyClearAll() on individual domains instead.\n   */\n  clear(): void {\n    this.#db.clear();\n  }\n}\n\nexport const MockStore = InMemoryStore;\n","import { MastraBase } from '../../../base';\nimport { ErrorCategory, ErrorDomain, MastraError } from '../../../error';\nimport type { TABLE_NAMES } from '../../constants';\nimport type { StorageColumn, CreateIndexOptions, IndexInfo, StorageIndexStats } from '../../types';\n\nexport abstract class StoreOperations extends MastraBase {\n  constructor() {\n    super({\n      component: 'STORAGE',\n      name: 'OPERATIONS',\n    });\n  }\n\n  abstract hasColumn(table: string, column: string): Promise<boolean>;\n\n  protected getSqlType(type: StorageColumn['type']): string {\n    switch (type) {\n      case 'text':\n        return 'TEXT';\n      case 'timestamp':\n        return 'TIMESTAMP';\n      case 'float':\n        return 'FLOAT';\n      case 'integer':\n        return 'INTEGER';\n      case 'bigint':\n        return 'BIGINT';\n      case 'jsonb':\n        return 'JSONB';\n      default:\n        return 'TEXT';\n    }\n  }\n\n  protected getDefaultValue(type: StorageColumn['type']): string {\n    switch (type) {\n      case 'text':\n      case 'uuid':\n        return \"DEFAULT ''\";\n      case 'timestamp':\n        return \"DEFAULT '1970-01-01 00:00:00'\";\n      case 'integer':\n      case 'bigint':\n      case 'float':\n        return 'DEFAULT 0';\n      case 'jsonb':\n        return \"DEFAULT '{}'\";\n      default:\n        return \"DEFAULT ''\";\n    }\n  }\n\n  abstract createTable({ tableName }: { tableName: TABLE_NAMES; schema: Record<string, StorageColumn> }): Promise<void>;\n\n  abstract clearTable({ tableName }: { tableName: TABLE_NAMES }): Promise<void>;\n\n  abstract dropTable({ tableName }: { tableName: TABLE_NAMES }): Promise<void>;\n\n  abstract alterTable(args: {\n    tableName: TABLE_NAMES;\n    schema: Record<string, StorageColumn>;\n    ifNotExists: string[];\n  }): Promise<void>;\n\n  abstract insert({ tableName, record }: { tableName: TABLE_NAMES; record: Record<string, any> }): Promise<void>;\n\n  abstract batchInsert({\n    tableName,\n    records,\n  }: {\n    tableName: TABLE_NAMES;\n    records: Record<string, any>[];\n  }): Promise<void>;\n\n  abstract load<R>({ tableName, keys }: { tableName: TABLE_NAMES; keys: Record<string, any> }): Promise<R | null>;\n\n  /**\n   * DATABASE INDEX MANAGEMENT\n   * Optional methods for database index management.\n   * Storage adapters can override these to provide index management capabilities.\n   */\n\n  /**\n   * Creates a database index on specified columns\n   * @throws {MastraError} if not supported by the storage adapter\n   */\n  async createIndex(_options: CreateIndexOptions): Promise<void> {\n    throw new MastraError({\n      id: 'MASTRA_STORAGE_CREATE_INDEX_NOT_SUPPORTED',\n      domain: ErrorDomain.STORAGE,\n      category: ErrorCategory.SYSTEM,\n      text: `Index management is not supported by this storage adapter`,\n    });\n  }\n\n  /**\n   * Drops a database index by name\n   * @throws {MastraError} if not supported by the storage adapter\n   */\n  async dropIndex(_indexName: string): Promise<void> {\n    throw new MastraError({\n      id: 'MASTRA_STORAGE_DROP_INDEX_NOT_SUPPORTED',\n      domain: ErrorDomain.STORAGE,\n      category: ErrorCategory.SYSTEM,\n      text: `Index management is not supported by this storage adapter`,\n    });\n  }\n\n  /**\n   * Lists database indexes for a table or all tables\n   * @throws {MastraError} if not supported by the storage adapter\n   */\n  async listIndexes(_tableName?: string): Promise<IndexInfo[]> {\n    throw new MastraError({\n      id: 'MASTRA_STORAGE_LIST_INDEXES_NOT_SUPPORTED',\n      domain: ErrorDomain.STORAGE,\n      category: ErrorCategory.SYSTEM,\n      text: `Index management is not supported by this storage adapter`,\n    });\n  }\n\n  /**\n   * Gets detailed statistics for a specific index\n   * @throws {MastraError} if not supported by the storage adapter\n   */\n  async describeIndex(_indexName: string): Promise<StorageIndexStats> {\n    throw new MastraError({\n      id: 'MASTRA_STORAGE_DESCRIBE_INDEX_NOT_SUPPORTED',\n      domain: ErrorDomain.STORAGE,\n      category: ErrorCategory.SYSTEM,\n      text: `Index management is not supported by this storage adapter`,\n    });\n  }\n\n  /**\n   * Returns definitions for automatic performance indexes\n   * Storage adapters can override this to define indexes that should be created during initialization\n   * @returns Array of index definitions to create automatically\n   */\n  protected getAutomaticIndexDefinitions(): CreateIndexOptions[] {\n    return [];\n  }\n}\n","import { TABLE_WORKFLOW_SNAPSHOT } from '../../constants';\nimport type { TABLE_NAMES } from '../../constants';\nimport type { StorageColumn } from '../../types';\nimport { StoreOperations } from './base';\n\nexport class StoreOperationsInMemory extends StoreOperations {\n  data: Record<TABLE_NAMES, Map<string, Record<string, any>>>;\n\n  constructor() {\n    super();\n    this.data = {\n      mastra_workflow_snapshot: new Map(),\n      mastra_messages: new Map(),\n      mastra_threads: new Map(),\n      mastra_traces: new Map(),\n      mastra_resources: new Map(),\n      mastra_scorers: new Map(),\n      mastra_ai_spans: new Map(),\n      mastra_agents: new Map(),\n    };\n  }\n\n  getDatabase() {\n    return this.data;\n  }\n\n  async insert({ tableName, record }: { tableName: TABLE_NAMES; record: Record<string, any> }): Promise<void> {\n    const table = this.data[tableName];\n    let key = record.id;\n    if ([TABLE_WORKFLOW_SNAPSHOT].includes(tableName) && !record.id && record.run_id) {\n      key = record.workflow_name ? `${record.workflow_name}-${record.run_id}` : record.run_id;\n      record.id = key;\n    } else if (!record.id) {\n      key = `auto-${Date.now()}-${Math.random()}`;\n      record.id = key;\n    }\n    table.set(key, record);\n  }\n\n  async batchInsert({ tableName, records }: { tableName: TABLE_NAMES; records: Record<string, any>[] }): Promise<void> {\n    const table = this.data[tableName];\n    for (const record of records) {\n      let key = record.id;\n      if ([TABLE_WORKFLOW_SNAPSHOT].includes(tableName) && !record.id && record.run_id) {\n        key = record.run_id;\n        record.id = key;\n      } else if (!record.id) {\n        key = `auto-${Date.now()}-${Math.random()}`;\n        record.id = key;\n      }\n      table.set(key, record);\n    }\n  }\n\n  async load<R>({ tableName, keys }: { tableName: TABLE_NAMES; keys: Record<string, string> }): Promise<R | null> {\n    this.logger.debug(`MockStore: load called for ${tableName} with keys`, keys);\n\n    const table = this.data[tableName];\n\n    const records = Array.from(table.values());\n\n    return records.filter(record => Object.keys(keys).every(key => record[key] === keys[key]))?.[0] as R | null;\n  }\n\n  async createTable({\n    tableName,\n    schema,\n  }: {\n    tableName: TABLE_NAMES;\n    schema: Record<string, StorageColumn>;\n  }): Promise<void> {\n    this.logger.debug(`MockStore: createTable called for ${tableName} with schema`, schema);\n\n    this.data[tableName] = new Map();\n  }\n\n  async clearTable({ tableName }: { tableName: TABLE_NAMES }): Promise<void> {\n    this.logger.debug(`MockStore: clearTable called for ${tableName}`);\n\n    this.data[tableName].clear();\n  }\n\n  async dropTable({ tableName }: { tableName: TABLE_NAMES }): Promise<void> {\n    this.logger.debug(`MockStore: dropTable called for ${tableName}`);\n    this.data[tableName].clear();\n  }\n\n  async alterTable({\n    tableName,\n    schema,\n  }: {\n    tableName: TABLE_NAMES;\n    schema: Record<string, StorageColumn>;\n    ifNotExists: string[];\n  }): Promise<void> {\n    this.logger.debug(`MockStore: alterTable called for ${tableName} with schema`, schema);\n  }\n\n  async hasColumn(table: string, column: string): Promise<boolean> {\n    this.logger.debug(`MockStore: hasColumn called for ${table} with column ${column}`);\n    return true;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6800, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-3CKZSDTQ.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/cache/base.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/cache/inmemory.ts"],"sourcesContent":["import { MastraBase } from '../base';\n\nexport abstract class MastraServerCache extends MastraBase {\n  constructor({ name }: { name: string }) {\n    super({\n      component: 'SERVER_CACHE',\n      name,\n    });\n  }\n\n  abstract get(key: string): Promise<unknown>;\n\n  abstract listLength(key: string): Promise<number>;\n\n  abstract set(key: string, value: unknown): Promise<void>;\n\n  abstract listPush(key: string, value: unknown): Promise<void>;\n\n  abstract listFromTo(key: string, from: number, to?: number): Promise<unknown[]>;\n\n  abstract delete(key: string): Promise<void>;\n\n  abstract clear(): Promise<void>;\n}\n","import TTLCache from '@isaacs/ttlcache';\nimport { MastraServerCache } from './base';\n\nexport class InMemoryServerCache extends MastraServerCache {\n  private cache: TTLCache<string, unknown> = new TTLCache({\n    max: 1000,\n    ttl: 1000 * 60 * 5,\n  });\n\n  constructor() {\n    super({ name: 'InMemoryServerCache' });\n  }\n\n  async get(key: string): Promise<unknown> {\n    return this.cache.get(key);\n  }\n\n  async set(key: string, value: unknown): Promise<void> {\n    this.cache.set(key, value);\n  }\n\n  async listLength(key: string): Promise<number> {\n    const list = this.cache.get(key) as unknown[];\n    if (!Array.isArray(list)) {\n      throw new Error(`${key} is not an array`);\n    }\n    return list.length;\n  }\n\n  async listPush(key: string, value: unknown): Promise<void> {\n    const list = this.cache.get(key) as unknown[];\n    if (Array.isArray(list)) {\n      list.push(value);\n    } else {\n      this.cache.set(key, [value]);\n    }\n  }\n\n  async listFromTo(key: string, from: number, to: number = -1): Promise<unknown[]> {\n    const list = this.cache.get(key) as unknown[];\n    if (Array.isArray(list)) {\n      // Make 'to' inclusive like Redis LRANGE - add 1 unless it's -1\n      const endIndex = to === -1 ? undefined : to + 1;\n      return list.slice(from, endIndex);\n    }\n    return [];\n  }\n\n  async delete(key: string): Promise<void> {\n    this.cache.delete(key);\n  }\n\n  async clear(): Promise<void> {\n    this.cache.clear();\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAEO,IAAe,iBAAA,GAAf,cAAyC,6KAAA,CAAW;IACzD,WAAA,CAAY,EAAE,IAAA,EAAK,CAAqB;QACtC,KAAA,CAAM;YACJ,SAAA,EAAW,cAAA;YACX;QAAA,CACD,CAAA;IACH;AAeF;ACpBO,IAAM,mBAAA,GAAN,cAAkC,iBAAA,CAAkB;IACjD,KAAA,GAAmC,IAAI,0JAAA,CAAS;QACtD,GAAA,EAAK,GAAA;QACL,GAAA,EAAK,MAAO,EAAA,GAAK;IAAA,CAClB,CAAA,CAAA;IAED,WAAA,EAAc;QACZ,KAAA,CAAM;YAAE,IAAA,EAAM,qBAAA;QAAA,CAAuB,CAAA;IACvC;IAEA,MAAM,IAAI,GAAA,EAA+B;QACvC,OAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;IAC3B;IAEA,MAAM,GAAA,CAAI,GAAA,EAAa,KAAA,EAA+B;QACpD,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;IAC3B;IAEA,MAAM,WAAW,GAAA,EAA8B;QAC7C,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;QAC/B,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,IAAI,CAAA,EAAG;YACxB,MAAM,IAAI,KAAA,CAAM,CAAA,EAAG,GAAG,CAAA,gBAAA,CAAkB,CAAA;QAC1C;QACA,OAAO,IAAA,CAAK,MAAA;IACd;IAEA,MAAM,QAAA,CAAS,GAAA,EAAa,KAAA,EAA+B;QACzD,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;QAC/B,IAAI,KAAA,CAAM,OAAA,CAAQ,IAAI,CAAA,EAAG;YACvB,IAAA,CAAK,IAAA,CAAK,KAAK,CAAA;QACjB,CAAA,MAAO;YACL,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAA,EAAK;gBAAC,KAAK;aAAC,CAAA;QAC7B;IACF;IAEA,MAAM,UAAA,CAAW,GAAA,EAAa,IAAA,EAAc,KAAa,CAAA,CAAA,EAAwB;QAC/E,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;QAC/B,IAAI,KAAA,CAAM,OAAA,CAAQ,IAAI,CAAA,EAAG;YAEvB,MAAM,QAAA,GAAW,EAAA,KAAO,CAAA,CAAA,GAAK,KAAA,CAAA,GAAY,EAAA,GAAK,CAAA;YAC9C,OAAO,IAAA,CAAK,KAAA,CAAM,IAAA,EAAM,QAAQ,CAAA;QAClC;QACA,OAAO,EAAC;IACV;IAEA,MAAM,OAAO,GAAA,EAA4B;QACvC,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,GAAG,CAAA;IACvB;IAEA,MAAM,KAAA,GAAuB;QAC3B,IAAA,CAAK,KAAA,CAAM,KAAA,EAAM;IACnB;AACF"}},
    {"offset": {"line": 6874, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-NKDMPZ4W.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/llm/model/gateways/netlify.ts"],"sourcesContent":["import { createAnthropic } from '@ai-sdk/anthropic-v5';\nimport { createGoogleGenerativeAI } from '@ai-sdk/google-v5';\nimport { createOpenAICompatible } from '@ai-sdk/openai-compatible-v5';\nimport { createOpenAI } from '@ai-sdk/openai-v5';\nimport type { LanguageModelV2 } from '@ai-sdk/provider-v5';\nimport { InMemoryServerCache } from '../../../cache/inmemory.js';\nimport { MastraError } from '../../../error/index.js';\nimport { MastraModelGateway } from './base.js';\nimport type { ProviderConfig } from './base.js';\n\ninterface NetlifyProviderResponse {\n  token_env_var: string;\n  url_env_var: string;\n  models: string[];\n}\ninterface NetlifyResponse {\n  providers: Record<string, NetlifyProviderResponse>;\n}\n\ninterface NetlifyTokenResponse {\n  token: string;\n  url: string;\n  expires_at: number;\n}\n\ninterface CachedToken {\n  token: string;\n  url: string;\n  expiresAt: number;\n}\n\ninterface TokenData {\n  token: string;\n  url: string;\n}\n\nexport class NetlifyGateway extends MastraModelGateway {\n  readonly id = 'netlify';\n  readonly name = 'Netlify AI Gateway';\n  private tokenCache = new InMemoryServerCache();\n\n  async fetchProviders(): Promise<Record<string, ProviderConfig>> {\n    const response = await fetch('https://api.netlify.com/api/v1/ai-gateway/providers');\n    if (!response.ok) {\n      throw new Error(`Failed to fetch from Netlify: ${response.statusText}`);\n    }\n    const data = (await response.json()) as NetlifyResponse;\n    const config: ProviderConfig = {\n      apiKeyEnvVar: ['NETLIFY_TOKEN', 'NETLIFY_SITE_ID'],\n      apiKeyHeader: 'Authorization',\n      name: `Netlify`,\n      gateway: `netlify`,\n      models: [],\n      docUrl: 'https://docs.netlify.com/build/ai-gateway/overview/',\n    };\n    // Convert Netlify format to our standard format\n    for (const [providerId, provider] of Object.entries(data.providers)) {\n      for (const model of provider.models) {\n        config.models.push(`${providerId}/${model}`);\n      }\n    }\n    // Return with gateway ID as key - registry generator will detect this and avoid doubling the prefix\n    return { netlify: config };\n  }\n\n  async buildUrl(routerId: string, envVars?: typeof process.env): Promise<string> {\n    // Check for Netlify site ID first (for token exchange)\n    const siteId = envVars?.['NETLIFY_SITE_ID'] || process.env['NETLIFY_SITE_ID'];\n    const netlifyToken = envVars?.['NETLIFY_TOKEN'] || process.env['NETLIFY_TOKEN'];\n\n    if (!netlifyToken) {\n      throw new MastraError({\n        id: 'NETLIFY_GATEWAY_NO_TOKEN',\n        domain: 'LLM',\n        category: 'UNKNOWN',\n        text: `Missing NETLIFY_TOKEN environment variable required for model: ${routerId}`,\n      });\n    }\n\n    if (!siteId) {\n      throw new MastraError({\n        id: 'NETLIFY_GATEWAY_NO_SITE_ID',\n        domain: 'LLM',\n        category: 'UNKNOWN',\n        text: `Missing NETLIFY_SITE_ID environment variable required for model: ${routerId}`,\n      });\n    }\n\n    try {\n      const tokenData = await this.getOrFetchToken(siteId, netlifyToken);\n      return tokenData.url.endsWith(`/`) ? tokenData.url.substring(0, tokenData.url.length - 1) : tokenData.url;\n    } catch (error) {\n      throw new MastraError({\n        id: 'NETLIFY_GATEWAY_TOKEN_ERROR',\n        domain: 'LLM',\n        category: 'UNKNOWN',\n        text: `Failed to get Netlify AI Gateway token for model ${routerId}: ${error instanceof Error ? error.message : String(error)}`,\n      });\n    }\n  }\n\n  /**\n   * Get cached token or fetch a new site-specific AI Gateway token from Netlify\n   */\n  private async getOrFetchToken(siteId: string, netlifyToken: string): Promise<TokenData> {\n    const cacheKey = `netlify-token:${siteId}:${netlifyToken}`;\n\n    // Check cache first\n    const cached = (await this.tokenCache.get(cacheKey)) as CachedToken | undefined;\n    if (cached && cached.expiresAt > Date.now() / 1000 + 60) {\n      // Return cached token if it won't expire in the next minute\n      return { token: cached.token, url: cached.url };\n    }\n\n    // Fetch new token\n    const response = await fetch(`https://api.netlify.com/api/v1/sites/${siteId}/ai-gateway/token`, {\n      method: 'GET',\n      headers: {\n        Authorization: `Bearer ${netlifyToken}`,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Failed to get Netlify AI Gateway token: ${response.status} ${error}`);\n    }\n\n    const tokenResponse = (await response.json()) as NetlifyTokenResponse;\n\n    // Cache the token - InMemoryServerCache will handle the TTL\n    await this.tokenCache.set(cacheKey, {\n      token: tokenResponse.token,\n      url: tokenResponse.url,\n      expiresAt: tokenResponse.expires_at,\n    });\n\n    return { token: tokenResponse.token, url: tokenResponse.url };\n  }\n\n  /**\n   * Get cached token or fetch a new site-specific AI Gateway token from Netlify\n   */\n  async getApiKey(modelId: string): Promise<string> {\n    const siteId = process.env['NETLIFY_SITE_ID'];\n    const netlifyToken = process.env['NETLIFY_TOKEN'];\n\n    if (!netlifyToken) {\n      throw new MastraError({\n        id: 'NETLIFY_GATEWAY_NO_TOKEN',\n        domain: 'LLM',\n        category: 'UNKNOWN',\n        text: `Missing NETLIFY_TOKEN environment variable required for model: ${modelId}`,\n      });\n    }\n\n    if (!siteId) {\n      throw new MastraError({\n        id: 'NETLIFY_GATEWAY_NO_SITE_ID',\n        domain: 'LLM',\n        category: 'UNKNOWN',\n        text: `Missing NETLIFY_SITE_ID environment variable required for model: ${modelId}`,\n      });\n    }\n\n    try {\n      return (await this.getOrFetchToken(siteId, netlifyToken)).token;\n    } catch (error) {\n      throw new MastraError({\n        id: 'NETLIFY_GATEWAY_TOKEN_ERROR',\n        domain: 'LLM',\n        category: 'UNKNOWN',\n        text: `Failed to get Netlify AI Gateway token for model ${modelId}: ${error instanceof Error ? error.message : String(error)}`,\n      });\n    }\n  }\n\n  async resolveLanguageModel({\n    modelId,\n    providerId,\n    apiKey,\n    headers,\n  }: {\n    modelId: string;\n    providerId: string;\n    apiKey: string;\n    headers?: Record<string, string>;\n  }): Promise<LanguageModelV2> {\n    const baseURL = await this.buildUrl(`${providerId}/${modelId}`);\n\n    switch (providerId) {\n      case 'openai':\n        return createOpenAI({ apiKey, baseURL, headers }).responses(modelId);\n      case 'gemini':\n        return createGoogleGenerativeAI({\n          baseURL: `${baseURL}/v1beta/`,\n          apiKey,\n          headers: {\n            'user-agent': 'google-genai-sdk/',\n            ...(headers ? headers : {}),\n          },\n        }).chat(modelId);\n      case 'anthropic':\n        return createAnthropic({\n          apiKey,\n          baseURL: `${baseURL}/v1/`,\n          headers: {\n            'anthropic-version': '2023-06-01',\n            'user-agent': 'anthropic/',\n            ...(headers ? headers : {}),\n          },\n        })(modelId);\n      default:\n        return createOpenAICompatible({ name: providerId, apiKey, baseURL, supportsStructuredOutputs: true }).chatModel(\n          modelId,\n        );\n    }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7055, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-DD2VNRQM.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tools/stream.ts"],"sourcesContent":["import { WritableStream } from 'node:stream/web';\nimport type { DataChunkType } from '../stream/types';\nimport type { OutputWriter } from '../workflows';\n\nexport class ToolStream extends WritableStream<unknown> {\n  private prefix: string;\n  private callId: string;\n  private name: string;\n  private runId: string;\n  private writeFn?: OutputWriter;\n\n  constructor(\n    {\n      prefix,\n      callId,\n      name,\n      runId,\n    }: {\n      prefix: string;\n      callId: string;\n      name: string;\n      runId: string;\n    },\n    writeFn?: OutputWriter,\n  ) {\n    super({\n      async write(chunk: any) {\n        await getInstance()._write(chunk);\n      },\n    });\n\n    const self = this;\n    function getInstance() {\n      return self;\n    }\n\n    this.prefix = prefix;\n    this.callId = callId;\n    this.name = name;\n    this.runId = runId;\n    this.writeFn = writeFn;\n  }\n\n  private async _write(data: any) {\n    if (this.writeFn) {\n      await this.writeFn({\n        type: `${this.prefix}-output`,\n        runId: this.runId,\n        from: 'USER',\n        payload: {\n          output: data,\n          ...(this.prefix === 'workflow-step'\n            ? {\n                runId: this.runId,\n                stepName: this.name,\n              }\n            : {\n                [`${this.prefix}CallId`]: this.callId,\n                [`${this.prefix}Name`]: this.name,\n              }),\n        },\n      });\n    }\n  }\n\n  async write(data: any) {\n    await this._write(data);\n  }\n\n  async custom<T extends { type: string }>(data: T extends { type: `data-${string}` } ? DataChunkType : T) {\n    if (this.writeFn) {\n      await this.writeFn(data);\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;AAIO,IAAM,UAAA,GAAN,cAAyB,qIAAA,CAAwB;IAC9C,MAAA,CAAA;IACA,MAAA,CAAA;IACA,IAAA,CAAA;IACA,KAAA,CAAA;IACA,OAAA,CAAA;IAER,WAAA,CACE,EACE,MAAA,EACA,MAAA,EACA,IAAA,EACA,KAAA,EAAA,EAOF,OAAA,CACA;QACA,KAAA,CAAM;YACJ,MAAM,OAAM,KAAA,EAAY;gBACtB,MAAM,WAAA,EAAY,CAAE,MAAA,CAAO,KAAK,CAAA;YAClC;QAAA,CACD,CAAA;QAED,MAAM,IAAA,GAAO,IAAA;QACb,SAAS,WAAA,GAAc;YACrB,OAAO,IAAA;QACT;QAEA,IAAA,CAAK,MAAA,GAAS,MAAA;QACd,IAAA,CAAK,MAAA,GAAS,MAAA;QACd,IAAA,CAAK,IAAA,GAAO,IAAA;QACZ,IAAA,CAAK,KAAA,GAAQ,KAAA;QACb,IAAA,CAAK,OAAA,GAAU,OAAA;IACjB;IAEA,MAAc,OAAO,IAAA,EAAW;QAC9B,IAAI,IAAA,CAAK,OAAA,EAAS;YAChB,MAAM,IAAA,CAAK,OAAA,CAAQ;gBACjB,IAAA,EAAM,CAAA,EAAG,IAAA,CAAK,MAAM,CAAA,OAAA,CAAA;gBACpB,OAAO,IAAA,CAAK,KAAA;gBACZ,IAAA,EAAM,MAAA;gBACN,OAAA,EAAS;oBACP,MAAA,EAAQ,IAAA;oBACR,GAAI,IAAA,CAAK,MAAA,KAAW,eAAA,GAChB;wBACE,OAAO,IAAA,CAAK,KAAA;wBACZ,UAAU,IAAA,CAAK,IAAA;oBAAA,CACjB,GACA;wBACE,CAAC,CAAA,EAAG,IAAA,CAAK,MAAM,CAAA,MAAA,CAAQ,CAAA,EAAG,IAAA,CAAK,MAAA;wBAC/B,CAAC,CAAA,EAAG,IAAA,CAAK,MAAM,CAAA,IAAA,CAAM,CAAA,EAAG,IAAA,CAAK,IAAA;oBAAA,CAAA;gBAC/B;YACN,CACD,CAAA;QACH;IACF;IAEA,MAAM,MAAM,IAAA,EAAW;QACrB,MAAM,IAAA,CAAK,MAAA,CAAO,IAAI,CAAA;IACxB;IAEA,MAAM,OAAmC,IAAA,EAAgE;QACvG,IAAI,IAAA,CAAK,OAAA,EAAS;YAChB,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,CAAA;QACzB;IACF;AACF"}},
    {"offset": {"line": 7119, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-N3PAHTKU.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tools/validation.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tools/tool.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tools/toolchecks.ts"],"sourcesContent":["import type { z } from 'zod';\nimport type { SchemaWithValidation } from '../stream/base/schema';\nimport { isZodArray, isZodObject } from '../utils/zod-utils';\n\nexport interface ValidationError<T = any> {\n  error: true;\n  message: string;\n  validationErrors: z.ZodFormattedError<T>;\n}\n\n/**\n * Safely truncates data for error messages to avoid exposing sensitive information.\n * @param data The data to truncate\n * @param maxLength Maximum length of the truncated string (default: 200)\n * @returns Truncated string representation\n */\nfunction truncateForLogging(data: unknown, maxLength: number = 200): string {\n  try {\n    const stringified = JSON.stringify(data, null, 2);\n    if (stringified.length <= maxLength) {\n      return stringified;\n    }\n    return stringified.slice(0, maxLength) + '... (truncated)';\n  } catch {\n    return '[Unable to serialize data]';\n  }\n}\n\n/**\n * Validates raw suspend data against a Zod schema.\n *\n * @param schema The Zod schema to validate against\n * @param suspendData The raw suspend data to validate\n * @param toolId Optional tool ID for better error messages\n * @returns The validated data or a validation error\n */\nexport function validateToolSuspendData<T = any>(\n  schema: SchemaWithValidation<T> | undefined,\n  suspendData: unknown,\n  toolId?: string,\n): { data: T | unknown; error?: ValidationError<T> } {\n  // If no schema, return suspend data as-is\n  if (!schema || !('safeParse' in schema)) {\n    return { data: suspendData };\n  }\n\n  // Validate the input directly - no unwrapping needed in v1.0\n  const validation = schema.safeParse(suspendData);\n\n  if (validation.success) {\n    return { data: validation.data };\n  }\n\n  // Validation failed, return error\n  const errorMessages = validation.error.issues.map(e => `- ${e.path?.join('.') || 'root'}: ${e.message}`).join('\\n');\n\n  const error: ValidationError<T> = {\n    error: true,\n    message: `Tool suspension data validation failed${toolId ? ` for ${toolId}` : ''}. Please fix the following errors and try again:\\n${errorMessages}\\n\\nProvided arguments: ${truncateForLogging(suspendData)}`,\n    validationErrors: validation.error.format() as z.ZodFormattedError<T>,\n  };\n\n  return { data: suspendData, error };\n}\n\n/**\n * Normalizes undefined/null input to an appropriate default value based on schema type.\n * This handles LLMs (Claude Sonnet 4.5, Gemini 2.4, etc.) that send undefined/null\n * instead of {} or [] when all parameters are optional.\n *\n * @param schema The Zod schema to check\n * @param input The input to normalize\n * @returns The normalized input (original value, {}, or [])\n */\nfunction normalizeNullishInput(schema: SchemaWithValidation<unknown>, input: unknown): unknown {\n  if (input !== undefined && input !== null) {\n    return input;\n  }\n\n  // Check if schema is an array type (using typeName to avoid dual-package hazard)\n  if (isZodArray(schema)) {\n    return [];\n  }\n\n  // Check if schema is an object type (using typeName to avoid dual-package hazard)\n  if (isZodObject(schema)) {\n    return {};\n  }\n\n  // For other schema types, return the original input and let Zod validate\n  return input;\n}\n\n/**\n * Checks if a value is a plain object (created by {} or new Object()).\n * This excludes class instances, built-in objects like Date/Map/URL, etc.\n *\n * @param value The value to check\n * @returns true if the value is a plain object\n */\nfunction isPlainObject(value: unknown): value is Record<string, unknown> {\n  if (value === null || typeof value !== 'object') {\n    return false;\n  }\n  const proto = Object.getPrototypeOf(value);\n  return proto === Object.prototype || proto === null;\n}\n\n/**\n * Recursively converts undefined values to null in an object.\n * This is needed for OpenAI compat layers which convert .optional() to .nullable()\n * for strict mode compliance. When fields are omitted (undefined), we convert them\n * to null so the schema validation passes, and the transform then converts null back\n * to undefined. (GitHub #11457)\n *\n * Only recurses into plain objects to preserve class instances and built-in objects\n * like Date, Map, URL, etc. (GitHub #11502)\n *\n * @param input The input to process\n * @returns The processed input with undefined values converted to null\n */\nfunction convertUndefinedToNull(input: unknown): unknown {\n  if (input === undefined) {\n    return null;\n  }\n\n  if (input === null || typeof input !== 'object') {\n    return input;\n  }\n\n  if (Array.isArray(input)) {\n    return input.map(convertUndefinedToNull);\n  }\n\n  // Only recurse into plain objects - preserve class instances, built-in objects\n  // (Date, Map, Set, URL, etc.) and any other non-plain objects\n  if (!isPlainObject(input)) {\n    return input;\n  }\n\n  // It's a plain object - recursively process all properties\n  const result: Record<string, unknown> = {};\n  for (const [key, value] of Object.entries(input)) {\n    result[key] = convertUndefinedToNull(value);\n  }\n  return result;\n}\n\n/**\n * Validates raw input data against a Zod schema.\n *\n * @param schema The Zod schema to validate against\n * @param input The raw input data to validate\n * @param toolId Optional tool ID for better error messages\n * @returns The validated data or a validation error\n */\nexport function validateToolInput<T = any>(\n  schema: SchemaWithValidation<T> | undefined,\n  input: unknown,\n  toolId?: string,\n): { data: T | unknown; error?: ValidationError<T> } {\n  // If no schema, return input as-is\n  if (!schema || !('safeParse' in schema)) {\n    return { data: input };\n  }\n\n  // Normalize undefined/null input to appropriate default for the schema type\n  // This handles LLMs that send undefined instead of {} or [] for optional parameters\n  let normalizedInput = normalizeNullishInput(schema, input);\n\n  // Convert undefined values to null recursively (GitHub #11457)\n  // This is needed because OpenAI compat layers convert .optional() to .nullable()\n  // for strict mode compliance. When fields are omitted (undefined), we convert them\n  // to null so the schema validation passes. The schema's transform will then convert\n  // null back to undefined to match the original .optional() semantics.\n  normalizedInput = convertUndefinedToNull(normalizedInput);\n\n  // Validate the normalized input\n  const validation = schema.safeParse(normalizedInput);\n\n  if (validation.success) {\n    return { data: validation.data };\n  }\n\n  // Validation failed, return error\n  const errorMessages = validation.error.issues.map(e => `- ${e.path?.join('.') || 'root'}: ${e.message}`).join('\\n');\n\n  const error: ValidationError<T> = {\n    error: true,\n    message: `Tool input validation failed${toolId ? ` for ${toolId}` : ''}. Please fix the following errors and try again:\\n${errorMessages}\\n\\nProvided arguments: ${truncateForLogging(input)}`,\n    validationErrors: validation.error.format() as z.ZodFormattedError<T>,\n  };\n\n  return { data: input, error };\n}\n\n/**\n * Validates tool output data against a Zod schema.\n *\n * @param schema The Zod schema to validate against\n * @param output The output data to validate\n * @param toolId Optional tool ID for better error messages\n * @returns The validated data or a validation error\n */\nexport function validateToolOutput<T = any>(\n  schema: SchemaWithValidation<T> | undefined,\n  output: unknown,\n  toolId?: string,\n  suspendCalled?: boolean,\n): { data: T | unknown; error?: ValidationError<T> } {\n  // If no schema, return output as-is\n  if (!schema || !('safeParse' in schema) || suspendCalled) {\n    return { data: output };\n  }\n\n  // Validate the output\n  const validation = schema.safeParse(output);\n\n  if (validation.success) {\n    return { data: validation.data };\n  }\n\n  // Validation failed, return error\n  const errorMessages = validation.error.issues.map(e => `- ${e.path?.join('.') || 'root'}: ${e.message}`).join('\\n');\n\n  const error: ValidationError<T> = {\n    error: true,\n    message: `Tool output validation failed${toolId ? ` for ${toolId}` : ''}. The tool returned invalid output:\\n${errorMessages}\\n\\nReturned output: ${truncateForLogging(output)}`,\n    validationErrors: validation.error.format() as z.ZodFormattedError<T>,\n  };\n\n  return { data: output, error };\n}\n","import type { Mastra } from '../mastra';\nimport { RequestContext } from '../request-context';\nimport type { SchemaWithValidation } from '../stream/base/schema';\nimport type { SuspendOptions } from '../workflows';\nimport type { MCPToolProperties, ToolAction, ToolExecutionContext } from './types';\nimport { validateToolInput, validateToolOutput, validateToolSuspendData } from './validation';\n\n/**\n * A type-safe tool that agents and workflows can call to perform specific actions.\n *\n * @template TSchemaIn - Input schema type\n * @template TSchemaOut - Output schema type\n * @template TSuspendSchema - Suspend operation schema type\n * @template TResumeSchema - Resume operation schema type\n * @template TContext - Execution context type\n *\n * @example Basic tool with validation\n * ```typescript\n * const weatherTool = createTool({\n *   id: 'get-weather',\n *   description: 'Get weather for a location',\n *   inputSchema: z.object({\n *     location: z.string(),\n *     units: z.enum(['celsius', 'fahrenheit']).optional()\n *   }),\n *   execute: async (inputData) => {\n *     return await fetchWeather(inputData.location, inputData.units);\n *   }\n * });\n * ```\n *\n * @example Tool requiring approval\n * ```typescript\n * const deleteFileTool = createTool({\n *   id: 'delete-file',\n *   description: 'Delete a file',\n *   requireApproval: true,\n *   inputSchema: z.object({ filepath: z.string() }),\n *   execute: async (inputData) => {\n *     await fs.unlink(inputData.filepath);\n *     return { deleted: true };\n *   }\n * });\n * ```\n *\n * @example Tool with Mastra integration\n * ```typescript\n * const saveTool = createTool({\n *   id: 'save-data',\n *   description: 'Save data to storage',\n *   inputSchema: z.object({ key: z.string(), value: z.any() }),\n *   execute: async (inputData, context) => {\n *     const storage = context?.mastra?.getStorage();\n *     await storage?.set(inputData.key, inputData.value);\n *     return { saved: true };\n *   }\n * });\n * ```\n */\nexport class Tool<\n  TSchemaIn = unknown,\n  TSchemaOut = unknown,\n  TSuspendSchema = unknown,\n  TResumeSchema = unknown,\n  TContext extends ToolExecutionContext<TSuspendSchema, TResumeSchema> = ToolExecutionContext<\n    TSuspendSchema,\n    TResumeSchema\n  >,\n  TId extends string = string,\n> implements ToolAction<TSchemaIn, TSchemaOut, TSuspendSchema, TResumeSchema, TContext, TId> {\n  /** Unique identifier for the tool */\n  id: TId;\n\n  /** Description of what the tool does */\n  description: string;\n\n  /** Schema for validating input parameters */\n  inputSchema?: SchemaWithValidation<TSchemaIn>;\n\n  /** Schema for validating output structure */\n  outputSchema?: SchemaWithValidation<TSchemaOut>;\n\n  /** Schema for suspend operation data */\n  suspendSchema?: SchemaWithValidation<TSuspendSchema>;\n\n  /** Schema for resume operation data */\n  resumeSchema?: SchemaWithValidation<TResumeSchema>;\n\n  /**\n   * Tool execution function\n   * @param inputData - The raw, validated input data\n   * @param context - Optional execution context with metadata\n   * @returns Promise resolving to tool output or a ValidationError if input validation fails\n   */\n  execute?: ToolAction<TSchemaIn, TSchemaOut, TSuspendSchema, TResumeSchema, TContext>['execute'];\n\n  /** Parent Mastra instance for accessing shared resources */\n  mastra?: Mastra;\n\n  /**\n   * Whether the tool requires explicit user approval before execution\n   * @example\n   * ```typescript\n   * // For destructive operations\n   * requireApproval: true\n   * ```\n   */\n  requireApproval?: boolean;\n\n  /**\n   * Provider-specific options passed to the model when this tool is used.\n   * Keys are provider names (e.g., 'anthropic', 'openai'), values are provider-specific configs.\n   * @example\n   * ```typescript\n   * providerOptions: {\n   *   anthropic: {\n   *     cacheControl: { type: 'ephemeral' }\n   *   }\n   * }\n   * ```\n   */\n  providerOptions?: Record<string, Record<string, unknown>>;\n\n  /**\n   * Optional MCP-specific properties including annotations and metadata.\n   * Only relevant when the tool is being used in an MCP context.\n   * @example\n   * ```typescript\n   * mcp: {\n   *   annotations: {\n   *     title: 'Weather Lookup',\n   *     readOnlyHint: true,\n   *     destructiveHint: false\n   *   },\n   *   _meta: {\n   *     version: '1.0.0',\n   *     author: 'team@example.com'\n   *   }\n   * }\n   * ```\n   */\n  mcp?: MCPToolProperties;\n\n  /**\n   * Creates a new Tool instance with input validation wrapper.\n   *\n   * @param opts - Tool configuration and execute function\n   * @example\n   * ```typescript\n   * const tool = new Tool({\n   *   id: 'my-tool',\n   *   description: 'Does something useful',\n   *   inputSchema: z.object({ name: z.string() }),\n   *   execute: async (inputData) => ({ greeting: `Hello ${inputData.name}` })\n   * });\n   * ```\n   */\n  constructor(opts: ToolAction<TSchemaIn, TSchemaOut, TSuspendSchema, TResumeSchema, TContext, TId>) {\n    this.id = opts.id;\n    this.description = opts.description;\n    this.inputSchema = opts.inputSchema;\n    this.outputSchema = opts.outputSchema;\n    this.suspendSchema = opts.suspendSchema;\n    this.resumeSchema = opts.resumeSchema;\n    this.mastra = opts.mastra;\n    this.requireApproval = opts.requireApproval || false;\n    this.providerOptions = opts.providerOptions;\n    this.mcp = opts.mcp;\n\n    // Tools receive two parameters:\n    // 1. input - The raw, validated input data\n    // 2. context - Execution metadata (mastra, suspend, etc.)\n    if (opts.execute) {\n      const originalExecute = opts.execute;\n      this.execute = async (inputData: unknown, context?: any) => {\n        // Validate input if schema exists\n        const { data, error } = validateToolInput(this.inputSchema, inputData, this.id);\n        if (error) {\n          return error as any;\n        }\n\n        let suspendData = null;\n\n        const baseContext = context\n          ? {\n              ...context,\n              ...(context.suspend\n                ? {\n                    suspend: (args: any, suspendOptions?: SuspendOptions) => {\n                      suspendData = args;\n                      return context.suspend?.(args, suspendOptions);\n                    },\n                  }\n                : {}),\n            }\n          : {};\n\n        // Organize context based on execution source\n        let organizedContext = baseContext;\n        if (!context) {\n          // No context provided - create a minimal context with requestContext\n          organizedContext = {\n            requestContext: new RequestContext(),\n            mastra: undefined,\n          };\n        } else {\n          // Check if this is agent execution (has toolCallId and messages)\n          const isAgentExecution = baseContext.toolCallId && baseContext.messages;\n\n          // Check if this is workflow execution (has workflow properties)\n          // Agent execution takes precedence - don't treat as workflow if it's an agent call\n          const isWorkflowExecution = !isAgentExecution && (baseContext.workflow || baseContext.workflowId);\n\n          if (isAgentExecution && !baseContext.agent) {\n            // Reorganize agent context - nest agent-specific properties under 'agent' key\n            const { toolCallId, messages, suspend, resumeData, threadId, resourceId, writableStream, ...rest } =\n              baseContext;\n            organizedContext = {\n              ...rest,\n              agent: {\n                toolCallId,\n                messages,\n                suspend,\n                resumeData,\n                threadId,\n                resourceId,\n                writableStream,\n              },\n              // Ensure requestContext is always present\n              requestContext: rest.requestContext || new RequestContext(),\n            };\n          } else if (isWorkflowExecution && !baseContext.workflow) {\n            // Reorganize workflow context - nest workflow-specific properties under 'workflow' key\n            const { workflowId, runId, state, setState, suspend, resumeData, ...rest } = baseContext;\n            organizedContext = {\n              ...rest,\n              workflow: {\n                workflowId,\n                runId,\n                state,\n                setState,\n                suspend,\n                resumeData,\n              },\n              // Ensure requestContext is always present\n              requestContext: rest.requestContext || new RequestContext(),\n            };\n          } else {\n            // Ensure requestContext is always present even for direct execution\n            organizedContext = {\n              ...baseContext,\n              agent: baseContext.agent\n                ? {\n                    ...baseContext.agent,\n                    suspend: (args: any, suspendOptions?: SuspendOptions) => {\n                      suspendData = args;\n                      return baseContext.agent?.suspend?.(args, suspendOptions);\n                    },\n                  }\n                : baseContext.agent,\n              workflow: baseContext.workflow\n                ? {\n                    ...baseContext.workflow,\n                    suspend: (args: any, suspendOptions?: SuspendOptions) => {\n                      suspendData = args;\n                      return baseContext.workflow?.suspend?.(args, suspendOptions);\n                    },\n                  }\n                : baseContext.workflow,\n              requestContext: baseContext.requestContext || new RequestContext(),\n            };\n          }\n        }\n\n        const resumeData =\n          organizedContext.agent?.resumeData ?? organizedContext.workflow?.resumeData ?? organizedContext?.resumeData;\n\n        if (resumeData) {\n          const resumeValidation = validateToolInput(this.resumeSchema, resumeData, this.id);\n          if (resumeValidation.error) {\n            return resumeValidation.error as any;\n          }\n        }\n\n        // Call the original execute with validated input and organized context\n        const output = await originalExecute(data as any, organizedContext);\n\n        if (suspendData) {\n          const suspendValidation = validateToolSuspendData(this.suspendSchema, suspendData, this.id);\n          if (suspendValidation.error) {\n            return suspendValidation.error as any;\n          }\n        }\n\n        const skiptOutputValidation = !!(typeof output === 'undefined' && suspendData);\n\n        // Validate output if schema exists\n        const outputValidation = validateToolOutput(this.outputSchema, output, this.id, skiptOutputValidation);\n        if (outputValidation.error) {\n          return outputValidation.error as any;\n        }\n\n        return outputValidation.data;\n      };\n    }\n  }\n}\n\n/**\n * Creates a type-safe tool with automatic input validation.\n *\n * @template TSchemaIn - Input schema type\n * @template TSchemaOut - Output schema type\n * @template TSuspendSchema - Suspend operation schema type\n * @template TResumeSchema - Resume operation schema type\n * @template TContext - Execution context type\n * @template TExecute - Execute function type\n *\n * @param opts - Tool configuration including schemas and execute function\n * @returns Type-safe Tool instance with conditional typing based on schemas\n *\n * @example Simple tool\n * ```typescript\n * const greetTool = createTool({\n *   id: 'greet',\n *   description: 'Say hello',\n *   execute: async () => ({ message: 'Hello!' })\n * });\n * ```\n *\n * @example Tool with input validation\n * ```typescript\n * const calculateTool = createTool({\n *   id: 'calculate',\n *   description: 'Perform calculations',\n *   inputSchema: z.object({\n *     operation: z.enum(['add', 'subtract']),\n *     a: z.number(),\n *     b: z.number()\n *   }),\n *   execute: async (inputData) => {\n *     const result = inputData.operation === 'add'\n *       ? inputData.a + inputData.b\n *       : inputData.a - inputData.b;\n *     return { result };\n *   }\n * });\n * ```\n *\n * @example Tool with output schema\n * ```typescript\n * const userTool = createTool({\n *   id: 'get-user',\n *   description: 'Get user data',\n *   inputSchema: z.object({ userId: z.string() }),\n *   outputSchema: z.object({\n *     id: z.string(),\n *     name: z.string(),\n *     email: z.string()\n *   }),\n *   execute: async (inputData) => {\n *     return await fetchUser(inputData.userId);\n *   }\n * });\n * ```\n *\n * @example Tool with external API\n * ```typescript\n * const weatherTool = createTool({\n *   id: 'weather',\n *   description: 'Get weather data',\n *   inputSchema: z.object({\n *     city: z.string(),\n *     units: z.enum(['metric', 'imperial']).default('metric')\n *   }),\n *   execute: async (inputData) => {\n *     const response = await fetch(\n *       `https://api.weather.com/v1/weather?q=${inputData.city}&units=${inputData.units}`\n *     );\n *     return response.json();\n *   }\n * });\n * ```\n */\nexport function createTool<\n  TId extends string = string,\n  TSchemaIn = unknown,\n  TSchemaOut = unknown,\n  TSuspend = unknown,\n  TResume = unknown,\n  TContext extends ToolExecutionContext<TSuspend, TResume> = ToolExecutionContext<TSuspend, TResume>,\n>(\n  opts: ToolAction<TSchemaIn, TSchemaOut, TSuspend, TResume, TContext, TId>,\n): Tool<TSchemaIn, TSchemaOut, TSuspend, TResume, TContext, TId> {\n  return new Tool(opts);\n}\n","import { Tool } from './tool';\nimport type { ToolToConvert } from './tool-builder/builder';\nimport type { VercelTool } from './types';\n\n/**\n * Checks if a tool is a Vercel Tool (AI SDK tool)\n * @param tool - The tool to check\n * @returns True if the tool is a Vercel Tool, false otherwise\n */\nexport function isVercelTool(tool?: ToolToConvert): tool is VercelTool {\n  // Checks if this tool is not an instance of Mastra's Tool class\n  // AI SDK tools must have an execute function and either:\n  // - 'parameters' (v4) or 'inputSchema' (v5/v6)\n  // This prevents plain objects with inputSchema (like client tools) from being treated as VercelTools\n  return !!(\n    tool &&\n    !(tool instanceof Tool) &&\n    ('parameters' in tool || ('execute' in tool && typeof tool.execute === 'function' && 'inputSchema' in tool))\n  );\n}\n"],"names":["resumeData"],"mappings":"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"}},
    {"offset": {"line": 7460, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-MCVLH3QV.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tools/tool-builder/builder.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/utils.ts"],"sourcesContent":["import type { ProviderDefinedTool, ToolExecutionOptions } from '@internal/external-types';\nimport {\n  OpenAIReasoningSchemaCompatLayer,\n  OpenAISchemaCompatLayer,\n  GoogleSchemaCompatLayer,\n  AnthropicSchemaCompatLayer,\n  DeepSeekSchemaCompatLayer,\n  MetaSchemaCompatLayer,\n  applyCompatLayer,\n  convertZodSchemaToAISDKSchema,\n} from '@mastra/schema-compat';\nimport { zodToJsonSchema } from '@mastra/schema-compat/zod-to-json';\nimport { z } from 'zod';\nimport { MastraBase } from '../../base';\nimport { ErrorCategory, MastraError, ErrorDomain } from '../../error';\nimport { SpanType, wrapMastra, executeWithContext, EntityType } from '../../observability';\nimport { RequestContext } from '../../request-context';\nimport { isVercelTool } from '../../tools/toolchecks';\nimport type { ToolOptions } from '../../utils';\nimport { isZodObject } from '../../utils/zod-utils';\nimport type { SuspendOptions } from '../../workflows';\nimport { ToolStream } from '../stream';\nimport type { CoreTool, MastraToolInvocationOptions, ToolAction, VercelTool, VercelToolV5 } from '../types';\nimport { validateToolInput, validateToolOutput, validateToolSuspendData } from '../validation';\n\n/**\n * Types that can be converted to Mastra tools.\n * Includes provider-defined tools from external packages via ProviderDefinedTool.\n */\nexport type ToolToConvert = VercelTool | ToolAction<any, any, any> | VercelToolV5 | ProviderDefinedTool;\nexport type LogType = 'tool' | 'toolset' | 'client-tool';\n\ninterface LogOptions {\n  agentName?: string;\n  toolName: string;\n  type?: 'tool' | 'toolset' | 'client-tool';\n}\n\ninterface LogMessageOptions {\n  start: string;\n  error: string;\n}\n\nexport class CoreToolBuilder extends MastraBase {\n  private originalTool: ToolToConvert;\n  private options: ToolOptions;\n  private logType?: LogType;\n\n  constructor(input: {\n    originalTool: ToolToConvert;\n    options: ToolOptions;\n    logType?: LogType;\n    autoResumeSuspendedTools?: boolean;\n  }) {\n    super({ name: 'CoreToolBuilder' });\n    this.originalTool = input.originalTool;\n    this.options = input.options;\n    this.logType = input.logType;\n    if (!isVercelTool(this.originalTool) && input.autoResumeSuspendedTools) {\n      let schema = this.originalTool.inputSchema;\n      if (typeof schema === 'function') {\n        schema = schema();\n      }\n      if (!schema) {\n        schema = z.object({});\n      }\n      if (isZodObject(schema)) {\n        this.originalTool.inputSchema = schema.extend({\n          suspendedToolRunId: z.string().describe('The runId of the suspended tool').optional().default(''),\n          resumeData: z\n            .any()\n            .describe('The resumeData object created from the resumeSchema of suspended tool')\n            .optional(),\n        });\n      }\n    }\n  }\n\n  // Helper to get parameters based on tool type\n  private getParameters = () => {\n    if (isVercelTool(this.originalTool)) {\n      // Handle both 'parameters' (v4) and 'inputSchema' (v5) properties\n      // Also handle case where the schema is a function that returns a schema\n      let schema =\n        this.originalTool.parameters ??\n        ('inputSchema' in this.originalTool ? (this.originalTool as any).inputSchema : undefined) ??\n        z.object({});\n\n      // If schema is a function, call it to get the actual schema\n      if (typeof schema === 'function') {\n        schema = schema();\n      }\n\n      return schema;\n    }\n\n    // For Mastra tools, inputSchema might also be a function\n    let schema = this.originalTool.inputSchema;\n\n    // If schema is a function, call it to get the actual schema\n    if (typeof schema === 'function') {\n      schema = schema();\n    }\n\n    return schema;\n  };\n\n  private getOutputSchema = () => {\n    if ('outputSchema' in this.originalTool) {\n      let schema = this.originalTool.outputSchema;\n\n      // If schema is a function, call it to get the actual schema\n      if (typeof schema === 'function') {\n        schema = schema();\n      }\n\n      return schema;\n    }\n    return null;\n  };\n\n  private getResumeSchema = () => {\n    if ('resumeSchema' in this.originalTool) {\n      let schema = this.originalTool.resumeSchema;\n\n      // If schema is a function, call it to get the actual schema\n      if (typeof schema === 'function') {\n        schema = schema();\n      }\n\n      return schema;\n    }\n    return null;\n  };\n\n  private getSuspendSchema = () => {\n    if ('suspendSchema' in this.originalTool) {\n      let schema = this.originalTool.suspendSchema;\n\n      // If schema is a function, call it to get the actual schema\n      if (typeof schema === 'function') {\n        schema = schema();\n      }\n\n      return schema;\n    }\n    return null;\n  };\n\n  // For provider-defined tools, we need to include all required properties\n  // AI SDK v5 uses type: 'provider-defined', AI SDK v6 uses type: 'provider'\n  private buildProviderTool(tool: ToolToConvert): (CoreTool & { id: `${string}.${string}` }) | undefined {\n    if (\n      'type' in tool &&\n      (tool.type === 'provider-defined' || tool.type === 'provider') &&\n      'id' in tool &&\n      typeof tool.id === 'string' &&\n      tool.id.includes('.')\n    ) {\n      // Get schema directly from provider-defined tool (v4 uses parameters, v5 uses inputSchema)\n      let parameters: unknown =\n        'parameters' in tool ? tool.parameters : 'inputSchema' in tool ? (tool as any).inputSchema : undefined;\n\n      // If schema is a function, call it to get the actual schema\n      if (typeof parameters === 'function') {\n        parameters = parameters();\n      }\n\n      // Get output schema directly from provider-defined tool\n      let outputSchema: unknown = 'outputSchema' in tool ? (tool as any).outputSchema : undefined;\n\n      // If schema is a function, call it to get the actual schema\n      if (typeof outputSchema === 'function') {\n        outputSchema = outputSchema();\n      }\n\n      // Convert parameters to AI SDK Schema format\n      let processedParameters;\n      if (parameters !== undefined && parameters !== null) {\n        if (typeof parameters === 'object' && 'jsonSchema' in parameters) {\n          // Already in AI SDK Schema format\n          processedParameters = parameters;\n        } else {\n          // Convert Zod schema to AI SDK Schema\n          processedParameters = convertZodSchemaToAISDKSchema(parameters as z.ZodType);\n        }\n      }\n\n      // Convert output schema to AI SDK Schema format if present\n      let processedOutputSchema;\n      if (outputSchema !== undefined && outputSchema !== null) {\n        if (typeof outputSchema === 'object' && 'jsonSchema' in outputSchema) {\n          // Already in AI SDK Schema format\n          processedOutputSchema = outputSchema;\n        } else {\n          // Convert Zod schema to AI SDK Schema\n          processedOutputSchema = convertZodSchemaToAISDKSchema(outputSchema as z.ZodType);\n        }\n      }\n\n      return {\n        ...(processedOutputSchema ? { outputSchema: processedOutputSchema } : {}),\n        type: 'provider-defined' as const,\n        id: tool.id as `${string}.${string}`,\n        args: ('args' in this.originalTool ? this.originalTool.args : {}) as Record<string, unknown>,\n        description: tool.description,\n        parameters: processedParameters,\n        execute: this.originalTool.execute\n          ? this.createExecute(\n              this.originalTool,\n              { ...this.options, description: this.originalTool.description },\n              this.logType,\n            )\n          : undefined,\n      } as unknown as (CoreTool & { id: `${string}.${string}` }) | undefined;\n    }\n\n    return undefined;\n  }\n\n  private createLogMessageOptions({ agentName, toolName, type }: LogOptions): LogMessageOptions {\n    // If no agent name, use default format\n    if (!agentName) {\n      return {\n        start: `Executing tool ${toolName}`,\n        error: `Failed tool execution`,\n      };\n    }\n\n    const prefix = `[Agent:${agentName}]`;\n    const toolType = type === 'toolset' ? 'toolset' : 'tool';\n\n    return {\n      start: `${prefix} - Executing ${toolType} ${toolName}`,\n      error: `${prefix} - Failed ${toolType} execution`,\n    };\n  }\n\n  private createExecute(\n    tool: ToolToConvert,\n    options: ToolOptions,\n    logType?: 'tool' | 'toolset' | 'client-tool',\n    processedSchema?: z.ZodTypeAny,\n  ) {\n    // dont't add memory or mastra to logging\n    const { logger, mastra: _mastra, memory: _memory, requestContext, model, ...rest } = options;\n    const logModelObject = {\n      modelId: model?.modelId,\n      provider: model?.provider,\n      specificationVersion: model?.specificationVersion,\n    };\n\n    const { start, error } = this.createLogMessageOptions({\n      agentName: options.agentName,\n      toolName: options.name,\n      type: logType,\n    });\n\n    const execFunction = async (args: unknown, execOptions: MastraToolInvocationOptions) => {\n      // Prefer execution-time tracingContext (passed at runtime for VNext methods)\n      // Fall back to build-time context for Legacy methods (AI SDK v4 doesn't support passing custom options)\n      const tracingContext = execOptions.tracingContext || options.tracingContext;\n\n      // Create tool span if we have a current span available\n      const toolSpan = tracingContext?.currentSpan?.createChildSpan({\n        type: SpanType.TOOL_CALL,\n        name: `tool: '${options.name}'`,\n        input: args,\n        entityType: EntityType.TOOL,\n        entityName: options.name,\n        attributes: {\n          toolDescription: options.description,\n          toolType: logType || 'tool',\n        },\n        tracingPolicy: options.tracingPolicy,\n      });\n\n      try {\n        let result;\n        let suspendData = null;\n\n        if (isVercelTool(tool)) {\n          // Handle Vercel tools (AI SDK tools)\n          result = await executeWithContext({\n            span: toolSpan,\n            fn: async () => tool?.execute?.(args, execOptions as ToolExecutionOptions),\n          });\n        } else {\n          // Handle Mastra tools - wrap mastra instance with tracing context for context propagation\n\n          /**\n           * MASTRA INSTANCE TYPES IN TOOL EXECUTION:\n           *\n           * Full Mastra & MastraPrimitives (has getAgent, getWorkflow, etc.):\n           * - Auto-generated workflow tools from agent.listWorkflows()\n           * - These get this.#mastra directly and can be wrapped\n           *\n           * MastraPrimitives only (limited interface):\n           * - Memory tools (from memory.listTools())\n           * - Assigned tools (agent.tools)\n           * - Toolset tools (from toolsets)\n           * - Client tools (passed as tools in generate/stream options)\n           * - These get mastraProxy and have limited functionality\n           *\n           * TODO: Consider providing full Mastra instance to more tool types for enhanced functionality\n           */\n          // Wrap mastra with tracing context - wrapMastra will handle whether it's a full instance or primitives\n          const wrappedMastra = options.mastra ? wrapMastra(options.mastra, { currentSpan: toolSpan }) : options.mastra;\n\n          const resumeSchema = this.getResumeSchema();\n          // Pass raw args as first parameter, context as second\n          // Properly structure context based on execution source\n          const baseContext = {\n            threadId: options.threadId,\n            resourceId: options.resourceId,\n            mastra: wrappedMastra,\n            memory: options.memory,\n            runId: options.runId,\n            requestContext: options.requestContext ?? new RequestContext(),\n            writer: new ToolStream(\n              {\n                prefix: 'tool',\n                callId: execOptions.toolCallId,\n                name: options.name,\n                runId: options.runId!,\n              },\n              options.outputWriter || execOptions.outputWriter,\n            ),\n            tracingContext: { currentSpan: toolSpan },\n            abortSignal: execOptions.abortSignal,\n            suspend: (args: any, suspendOptions?: SuspendOptions) => {\n              suspendData = args;\n              const newSuspendOptions = {\n                ...(suspendOptions ?? {}),\n                resumeSchema:\n                  suspendOptions?.resumeSchema ??\n                  (resumeSchema ? JSON.stringify(zodToJsonSchema(resumeSchema)) : undefined),\n              };\n              return execOptions.suspend?.(args, newSuspendOptions);\n            },\n            resumeData: execOptions.resumeData,\n          };\n\n          // Check if this is agent execution\n          // Agent execution takes precedence over workflow execution because agents may\n          // use workflows internally for their agentic loop\n          // Note: AI SDK v4 doesn't pass toolCallId/messages, so we also check for agentName and threadId\n          const isAgentExecution =\n            (execOptions.toolCallId && execOptions.messages) ||\n            (options.agentName && options.threadId && !options.workflowId);\n\n          // Check if this is workflow execution (has workflow properties in options)\n          // Only consider it workflow execution if it's NOT agent execution\n          const isWorkflowExecution = !isAgentExecution && (options.workflow || options.workflowId);\n\n          let toolContext;\n          if (isAgentExecution) {\n            // Nest agent-specific properties under 'agent' key\n            // Do NOT include workflow context even if workflow properties exist\n            // (agents use workflows internally but tools should see agent context)\n            const { suspend, resumeData, threadId, resourceId, ...restBaseContext } = baseContext;\n            toolContext = {\n              ...restBaseContext,\n              agent: {\n                toolCallId: execOptions.toolCallId || '',\n                messages: execOptions.messages || [],\n                suspend,\n                resumeData,\n                threadId,\n                resourceId,\n                outputWriter: execOptions.outputWriter,\n              },\n            };\n          } else if (isWorkflowExecution) {\n            // Nest workflow-specific properties under 'workflow' key\n            const { suspend, resumeData, ...restBaseContext } = baseContext;\n            toolContext = {\n              ...restBaseContext,\n              workflow: options.workflow || {\n                runId: options.runId,\n                workflowId: options.workflowId,\n                state: options.state,\n                setState: options.setState,\n                suspend,\n                resumeData,\n              },\n            };\n          } else if (execOptions.mcp) {\n            // MCP execution context\n            toolContext = {\n              ...baseContext,\n              mcp: execOptions.mcp,\n            };\n          } else {\n            // Direct execution or unknown context\n            toolContext = baseContext;\n          }\n\n          const resumeData = execOptions.resumeData;\n\n          if (resumeData) {\n            const resumeValidation = validateToolInput(resumeSchema, resumeData, options.name);\n            if (resumeValidation.error) {\n              logger?.warn(resumeValidation.error.message);\n              toolSpan?.end({ output: resumeValidation.error, attributes: { success: false } });\n              return resumeValidation.error as any;\n            }\n          }\n\n          result = await executeWithContext({ span: toolSpan, fn: async () => tool?.execute?.(args, toolContext) });\n        }\n\n        if (suspendData) {\n          const suspendSchema = this.getSuspendSchema();\n          const suspendValidation = validateToolSuspendData(suspendSchema, suspendData, options.name);\n          if (suspendValidation.error) {\n            logger?.warn(suspendValidation.error.message);\n            toolSpan?.end({ output: suspendValidation.error, attributes: { success: false } });\n            return suspendValidation.error as any;\n          }\n        }\n\n        // Skip validation if suspend was called without a result\n        const shouldSkipValidation = typeof result === 'undefined' && !!suspendData;\n        if (shouldSkipValidation) {\n          toolSpan?.end({ output: result, attributes: { success: true } });\n          return result;\n        }\n\n        // Validate output for Vercel/AI SDK tools which don't have built-in validation\n        // Mastra tools handle their own validation in Tool.execute() which properly\n        // applies Zod transforms (e.g., .transform(), .pipe()) to the output\n        if (isVercelTool(tool)) {\n          const outputSchema = this.getOutputSchema();\n          const outputValidation = validateToolOutput(outputSchema, result, options.name, false);\n          if (outputValidation.error) {\n            logger?.warn(outputValidation.error.message);\n            toolSpan?.end({ output: outputValidation.error, attributes: { success: false } });\n            return outputValidation.error;\n          }\n          result = outputValidation.data;\n        }\n\n        // Return result (validated for Vercel tools, already validated for Mastra tools)\n        toolSpan?.end({ output: result, attributes: { success: true } });\n        return result;\n      } catch (error) {\n        toolSpan?.error({ error: error as Error, attributes: { success: false } });\n        throw error;\n      }\n    };\n\n    return async (args: unknown, execOptions?: MastraToolInvocationOptions) => {\n      let logger = options.logger || this.logger;\n      try {\n        logger.debug(start, { ...rest, model: logModelObject, args });\n\n        // Validate input parameters if schema exists\n        // Use the processed schema for validation if available, otherwise fall back to original\n        const parameters = processedSchema || this.getParameters();\n        const { data, error } = validateToolInput(parameters, args, options.name);\n        if (error) {\n          logger.warn(error.message);\n          return error;\n        }\n        // Use validated/transformed data\n        args = data;\n\n        // there is a small delay in stream output so we add an immediate to ensure the stream is ready\n        return await new Promise((resolve, reject) => {\n          setImmediate(async () => {\n            try {\n              const result = await execFunction(args, execOptions!);\n              resolve(result);\n            } catch (err) {\n              reject(err);\n            }\n          });\n        });\n      } catch (err) {\n        const mastraError = new MastraError(\n          {\n            id: 'TOOL_EXECUTION_FAILED',\n            domain: ErrorDomain.TOOL,\n            category: ErrorCategory.USER,\n            details: {\n              errorMessage: String(error),\n              argsJson: JSON.stringify(args),\n              model: model?.modelId ?? '',\n            },\n          },\n          err,\n        );\n        logger.trackException(mastraError);\n        logger.error(error, { ...rest, model: logModelObject, error: mastraError, args });\n        return mastraError;\n      }\n    };\n  }\n\n  buildV5() {\n    const builtTool = this.build();\n\n    if (!builtTool.parameters) {\n      throw new Error('Tool parameters are required');\n    }\n\n    const base = {\n      ...builtTool,\n      inputSchema: builtTool.parameters,\n      onInputStart: 'onInputStart' in this.originalTool ? this.originalTool.onInputStart : undefined,\n      onInputDelta: 'onInputDelta' in this.originalTool ? this.originalTool.onInputDelta : undefined,\n      onInputAvailable: 'onInputAvailable' in this.originalTool ? this.originalTool.onInputAvailable : undefined,\n      onOutput: 'onOutput' in this.originalTool ? this.originalTool.onOutput : undefined,\n    };\n\n    // For provider-defined tools, exclude execute and add name as per v5 spec\n    if (builtTool.type === 'provider-defined') {\n      const { execute, parameters, ...rest } = base;\n      const name = builtTool.id.split('.')[1] || builtTool.id;\n      return {\n        ...rest,\n        type: builtTool.type,\n        id: builtTool.id,\n        name,\n        args: builtTool.args,\n      } as VercelToolV5;\n    }\n\n    return base as VercelToolV5;\n  }\n\n  build(): CoreTool {\n    const providerTool = this.buildProviderTool(this.originalTool);\n    if (providerTool) {\n      return providerTool;\n    }\n\n    const model = this.options.model;\n\n    const schemaCompatLayers = [];\n\n    if (model) {\n      // Respect the model's own capability flag; do not disable it based solely on specificationVersion.\n      const supportsStructuredOutputs =\n        'supportsStructuredOutputs' in model ? (model.supportsStructuredOutputs ?? false) : false;\n\n      const modelInfo = {\n        modelId: model.modelId,\n        supportsStructuredOutputs,\n        provider: model.provider,\n      };\n\n      schemaCompatLayers.push(\n        new OpenAIReasoningSchemaCompatLayer(modelInfo),\n        new OpenAISchemaCompatLayer(modelInfo),\n        new GoogleSchemaCompatLayer(modelInfo),\n        new AnthropicSchemaCompatLayer(modelInfo),\n        new DeepSeekSchemaCompatLayer(modelInfo),\n        new MetaSchemaCompatLayer(modelInfo),\n      );\n    }\n\n    // Apply schema compatibility to get both the transformed Zod schema (for validation)\n    // and the AI SDK Schema (for the LLM)\n    let processedZodSchema: z.ZodTypeAny | undefined;\n    let processedSchema;\n\n    const originalSchema = this.getParameters();\n\n    // Find the first applicable compatibility layer\n    const applicableLayer = schemaCompatLayers.find(layer => layer.shouldApply());\n\n    if (applicableLayer && originalSchema) {\n      // Get the transformed Zod schema (with constraints removed/modified)\n      processedZodSchema = applicableLayer.processZodType(originalSchema);\n      // Convert to AI SDK Schema for the LLM\n      processedSchema = applyCompatLayer({\n        schema: originalSchema,\n        compatLayers: schemaCompatLayers,\n        mode: 'aiSdkSchema',\n      });\n    } else if (originalSchema) {\n      // No compatibility layer applies, use original schema\n      processedZodSchema = originalSchema;\n      processedSchema = applyCompatLayer({\n        schema: originalSchema,\n        compatLayers: schemaCompatLayers,\n        mode: 'aiSdkSchema',\n      });\n    } else {\n      // No schema to process, set to undefined\n      processedZodSchema = undefined;\n      processedSchema = undefined;\n    }\n\n    let processedOutputSchema;\n\n    if (this.getOutputSchema()) {\n      // Don't add any compat layers to outputSchema since it's never sent to the LLM\n      processedOutputSchema = applyCompatLayer({\n        schema: this.getOutputSchema(),\n        compatLayers: [],\n        mode: 'aiSdkSchema',\n      });\n    }\n\n    // Map AI SDK's needsApproval to our requireApproval\n    // needsApproval can be boolean or a function that takes input and returns boolean\n    let requireApproval = this.options.requireApproval;\n    let needsApprovalFn: ((input: any) => boolean | Promise<boolean>) | undefined;\n\n    if (isVercelTool(this.originalTool) && 'needsApproval' in this.originalTool) {\n      const needsApproval = (this.originalTool as any).needsApproval;\n      if (typeof needsApproval === 'boolean') {\n        requireApproval = needsApproval;\n      } else if (typeof needsApproval === 'function') {\n        // Store the function to evaluate it per-call\n        needsApprovalFn = needsApproval;\n        // Set requireApproval to true so the tool-call-step knows to check the function\n        requireApproval = true;\n      }\n    }\n\n    const definition = {\n      type: 'function' as const,\n      description: this.originalTool.description,\n      requireApproval,\n      needsApprovalFn,\n      hasSuspendSchema: !!this.getSuspendSchema(),\n      execute: this.originalTool.execute\n        ? this.createExecute(\n            this.originalTool,\n            { ...this.options, description: this.originalTool.description },\n            this.logType,\n            processedZodSchema, // Pass the processed Zod schema for validation\n          )\n        : undefined,\n    };\n\n    return {\n      ...definition,\n      id: 'id' in this.originalTool ? this.originalTool.id : undefined,\n      parameters: processedSchema ?? z.object({}),\n      outputSchema: processedOutputSchema,\n      providerOptions: 'providerOptions' in this.originalTool ? this.originalTool.providerOptions : undefined,\n      mcp: 'mcp' in this.originalTool ? this.originalTool.mcp : undefined,\n    } as unknown as CoreTool;\n  }\n}\n","import { createHash } from 'node:crypto';\nimport type { CoreMessage } from '@internal/ai-sdk-v4';\nimport { jsonSchemaToZod } from '@mastra/schema-compat/json-to-zod';\nimport { z } from 'zod';\nimport type { MastraPrimitives } from './action';\nimport type { ToolsInput } from './agent';\nimport { ErrorCategory, ErrorDomain, MastraError } from './error';\nimport type { MastraLanguageModel, MastraLegacyLanguageModel } from './llm/model/shared.types';\nimport type { IMastraLogger } from './logger';\nimport type { Mastra } from './mastra';\nimport type { AiMessageType, MastraMemory } from './memory';\nimport type { TracingContext, TracingPolicy } from './observability';\nimport type { RequestContext } from './request-context';\nimport type { CoreTool, VercelTool, VercelToolV5 } from './tools';\nimport { Tool } from './tools/tool';\nimport { CoreToolBuilder } from './tools/tool-builder/builder';\nimport type { ToolToConvert } from './tools/tool-builder/builder';\nimport { isVercelTool } from './tools/toolchecks';\nimport type { OutputWriter } from './workflows/types';\n\n// Re-export Zod utilities for external use (isZodType is defined locally below)\nexport { getZodTypeName, getZodDef, isZodArray, isZodObject } from './utils/zod-utils';\n\nexport const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n\n/**\n * Deep merges two objects, recursively merging nested objects and arrays\n */\nexport function deepMerge<T extends object = object>(target: T, source: Partial<T>): T {\n  const output = { ...target };\n\n  if (!source) return output;\n\n  Object.keys(source).forEach(key => {\n    const targetValue = output[key as keyof T];\n    const sourceValue = source[key as keyof T];\n\n    if (Array.isArray(targetValue) && Array.isArray(sourceValue)) {\n      (output as any)[key] = sourceValue;\n    } else if (\n      sourceValue instanceof Object &&\n      targetValue instanceof Object &&\n      !Array.isArray(sourceValue) &&\n      !Array.isArray(targetValue)\n    ) {\n      (output as any)[key] = deepMerge(targetValue, sourceValue as T);\n    } else if (sourceValue !== undefined) {\n      (output as any)[key] = sourceValue;\n    }\n  });\n\n  return output;\n}\n\nexport function generateEmptyFromSchema(schema: string) {\n  try {\n    const parsedSchema = JSON.parse(schema);\n    if (!parsedSchema || parsedSchema.type !== 'object' || !parsedSchema.properties) return {};\n    const obj: Record<string, any> = {};\n    const TYPE_DEFAULTS = {\n      string: '',\n      array: [],\n      object: {},\n      number: 0,\n      integer: 0,\n      boolean: false,\n    };\n    for (const [key, prop] of Object.entries<any>(parsedSchema.properties)) {\n      obj[key] = TYPE_DEFAULTS[prop.type as keyof typeof TYPE_DEFAULTS] ?? null;\n    }\n    return obj;\n  } catch {\n    return {};\n  }\n}\n\nexport interface TagMaskOptions {\n  /** Called when masking begins */\n  onStart?: () => void;\n  /** Called when masking ends */\n  onEnd?: () => void;\n  /** Called for each chunk that is masked */\n  onMask?: (chunk: string) => void;\n}\n\n/**\n * Transforms a stream by masking content between XML tags.\n * @param stream Input stream to transform\n * @param tag Tag name to mask between (e.g. for <foo>...</foo>, use 'foo')\n * @param options Optional configuration for masking behavior\n */\nexport async function* maskStreamTags(\n  stream: AsyncIterable<string>,\n  tag: string,\n  options: TagMaskOptions = {},\n): AsyncIterable<string> {\n  const { onStart, onEnd, onMask } = options;\n  const openTag = `<${tag}>`;\n  const closeTag = `</${tag}>`;\n\n  let buffer = '';\n  let fullContent = '';\n  let isMasking = false;\n  let isBuffering = false;\n\n  // used for checking in chunks that include tags or partial tags + some other non-tag text\n  // eg: \"o <tag_name\" or \"name> w\", can trim before-start to get \"<tag_name\" or after-end to get \"name>\"\n  const trimOutsideDelimiter = (text: string, delimiter: string, trim: 'before-start' | 'after-end') => {\n    if (!text.includes(delimiter)) {\n      return text;\n    }\n\n    const parts = text.split(delimiter);\n\n    if (trim === `before-start`) {\n      return `${delimiter}${parts[1]}`;\n    }\n\n    return `${parts[0]}${delimiter}`;\n  };\n\n  // Helper to check if text starts with pattern (ignoring whitespace)\n  // When checking partial tags: startsWith(buffer, openTag) checks if buffer could be start of tag\n  // When checking full tags: startsWith(chunk, openTag) checks if chunk starts with full tag\n  const startsWith = (text: string, pattern: string) => {\n    // check start of opening tag\n    if (pattern.includes(openTag.substring(0, 3))) {\n      // our pattern for checking the start is always based on xml-like tags\n      // if the pattern looks like our opening tag and the pattern also includes\n      // some other chunked text before it, we just wanted to check the xml part of the pattern\n      pattern = trimOutsideDelimiter(pattern, `<`, `before-start`);\n    }\n\n    return text.trim().startsWith(pattern.trim());\n  };\n\n  for await (const chunk of stream) {\n    fullContent += chunk;\n\n    if (isBuffering) buffer += chunk;\n\n    const chunkHasTag = startsWith(chunk, openTag);\n    const bufferHasTag = !chunkHasTag && isBuffering && startsWith(openTag, buffer);\n\n    let toYieldBeforeMaskedStartTag = ``;\n    // Check if we should start masking chunks\n    if (!isMasking && (chunkHasTag || bufferHasTag)) {\n      isMasking = true;\n      isBuffering = false;\n\n      // check if the buffered text includes text before the start tag. ex \"o <tag_name\", \"o\" should be yielded and not masked\n      const taggedTextToMask = trimOutsideDelimiter(buffer, `<`, `before-start`);\n      if (taggedTextToMask !== buffer.trim()) {\n        toYieldBeforeMaskedStartTag = buffer.replace(taggedTextToMask, ``);\n      }\n\n      buffer = '';\n      onStart?.();\n    }\n\n    // Check if we should start buffering (looks like part of the opening tag but it's not the full <tag> yet eg <ta - could be <table> but we don't know yet)\n    if (!isMasking && !isBuffering && startsWith(openTag, chunk) && chunk.trim() !== '') {\n      isBuffering = true;\n      buffer += chunk;\n      continue;\n    }\n\n    // We're buffering, need to check again if our buffer has deviated from the opening <tag> eg <tag2>\n    if (isBuffering && buffer && !startsWith(openTag, buffer)) {\n      yield buffer;\n      buffer = '';\n      isBuffering = false;\n      continue;\n    }\n\n    // Check if we should stop masking chunks (since the content includes the closing </tag>)\n    if (isMasking && fullContent.includes(closeTag)) {\n      onMask?.(chunk);\n      onEnd?.();\n      isMasking = false;\n      const lastFullContent = fullContent;\n      fullContent = ``; // reset to handle streams with multiple full tags that have text inbetween\n\n      // check to see if we have a partial chunk outside the close tag. if we do we need to yield it so it isn't swallowed with the masked text\n      const textUntilEndTag = trimOutsideDelimiter(lastFullContent, closeTag, 'after-end');\n      if (textUntilEndTag !== lastFullContent) {\n        yield lastFullContent.replace(textUntilEndTag, ``);\n      }\n\n      continue;\n    }\n\n    // We're currently masking chunks inside a <tag>\n    if (isMasking) {\n      onMask?.(chunk);\n      // in the case that there was a chunk that included a tag to mask and some other text, ex \"o <tag_name\" we need to still yield the\n      // text before the tag (\"o \") so it's not swallowed with the masked text\n      if (toYieldBeforeMaskedStartTag) {\n        yield toYieldBeforeMaskedStartTag;\n      }\n      continue;\n    }\n\n    // default yield the chunk\n    yield chunk;\n  }\n}\n\n/**\n * Resolve serialized zod output - This function takes the string output ot the `jsonSchemaToZod` function\n * and instantiates the zod object correctly.\n *\n * @param schema - serialized zod object\n * @returns resolved zod object\n */\nexport function resolveSerializedZodOutput(schema: string): z.ZodType {\n  // Creates and immediately executes a new function that takes 'z' as a parameter\n  // The function body is a string that returns the serialized zod schema\n  // When executed with the 'z' parameter, it reconstructs the zod schema in the current context\n  return Function('z', `\"use strict\";return (${schema});`)(z);\n}\n\nexport interface ToolOptions {\n  name: string;\n  runId?: string;\n  threadId?: string;\n  resourceId?: string;\n  logger?: IMastraLogger;\n  description?: string;\n  mastra?: (Mastra & MastraPrimitives) | MastraPrimitives;\n  requestContext: RequestContext;\n  /** Build-time tracing context (fallback for Legacy methods that can't pass request context) */\n  tracingContext?: TracingContext;\n  tracingPolicy?: TracingPolicy;\n  memory?: MastraMemory;\n  agentName?: string;\n  model?: MastraLanguageModel | MastraLegacyLanguageModel;\n  /**\n   * Optional async writer used to stream tool output chunks back to the caller. Tools should treat this as fire-and-forget I/O.\n   */\n  outputWriter?: OutputWriter;\n  requireApproval?: boolean;\n  // Workflow-specific properties\n  workflow?: any;\n  workflowId?: string;\n  state?: any;\n  setState?: (state: any) => void;\n}\n\n/**\n * Checks if a value is a Zod type\n * @param value - The value to check\n * @returns True if the value is a Zod type, false otherwise\n */\nexport function isZodType(value: unknown): value is z.ZodType {\n  // Check if it's a Zod schema by looking for common Zod properties and methods\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    '_def' in value &&\n    'parse' in value &&\n    typeof (value as any).parse === 'function' &&\n    'safeParse' in value &&\n    typeof (value as any).safeParse === 'function'\n  );\n}\n\n// Helper function to create a deterministic hash\nfunction createDeterministicId(input: string): string {\n  return createHash('sha256').update(input).digest('hex').slice(0, 8); // Take first 8 characters for a shorter but still unique ID\n}\n\n/**\n * Sets the properties for a Vercel Tool, including an ID and inputSchema\n * @param tool - The tool to set the properties for\n * @returns The tool with the properties set\n */\nfunction setVercelToolProperties(tool: VercelTool) {\n  // Check if the tool already has inputSchema (v5 format)\n  // If it does, use it directly (it might be a function)\n  // Otherwise, convert the parameters to inputSchema\n  const inputSchema = 'inputSchema' in tool ? tool.inputSchema : convertVercelToolParameters(tool);\n\n  const toolId = !('id' in tool)\n    ? tool.description\n      ? `tool-${createDeterministicId(tool.description)}`\n      : `tool-${Math.random().toString(36).substring(2, 9)}`\n    : tool.id;\n\n  return {\n    ...tool,\n    id: toolId,\n    inputSchema,\n  };\n}\n\n/**\n * Ensures a tool has an ID and inputSchema by generating one if not present\n * @param tool - The tool to ensure has an ID and inputSchema\n * @returns The tool with an ID and inputSchema\n */\nexport function ensureToolProperties(tools: ToolsInput): ToolsInput {\n  const toolsWithProperties = Object.keys(tools).reduce<ToolsInput>((acc, key) => {\n    const tool = tools?.[key];\n    if (tool) {\n      // Check if the tool is a plain function (not a Tool instance or Vercel tool)\n      // This catches the common mistake of passing a tool factory function instead of the tool itself\n      // We need to cast to unknown first since ToolsInput doesn't include functions in its type,\n      // but users can still pass functions at runtime which causes silent failures\n      if (typeof tool === 'function' && !((tool as unknown) instanceof Tool) && !isVercelTool(tool)) {\n        throw new MastraError({\n          id: 'TOOL_INVALID_FORMAT',\n          domain: ErrorDomain.TOOL,\n          category: ErrorCategory.USER,\n          text: `Tool \"${key}\" is not a valid tool format. Tools must be created using createTool() or be a valid Vercel AI SDK tool. Received a function.`,\n        });\n      }\n\n      if (isVercelTool(tool)) {\n        acc[key] = setVercelToolProperties(tool) as VercelTool;\n      } else {\n        acc[key] = tool;\n      }\n    }\n    return acc;\n  }, {});\n\n  return toolsWithProperties;\n}\n\nfunction convertVercelToolParameters(tool: VercelTool): z.ZodType {\n  // If the tool is a Vercel Tool, check if the parameters are already a zod object\n  // If not, convert the parameters to a zod object using jsonSchemaToZod\n  // Handle case where parameters (or inputSchema in v5) is a function that returns a schema\n  let schema = tool.parameters ?? z.object({});\n\n  // If schema is a function, call it to get the actual schema\n  if (typeof schema === 'function') {\n    schema = schema();\n  }\n\n  return isZodType(schema) ? schema : resolveSerializedZodOutput(jsonSchemaToZod(schema));\n}\n\n/**\n * Converts a Vercel Tool or Mastra Tool into a CoreTool format\n * @param originalTool - The tool to convert (either VercelTool or ToolAction)\n * @param options - Tool options including Mastra-specific settings\n * @param logType - Type of tool to log (tool or toolset)\n * @returns A CoreTool that can be used by the system\n */\nexport function makeCoreTool(\n  originalTool: ToolToConvert,\n  options: ToolOptions,\n  logType?: 'tool' | 'toolset' | 'client-tool',\n  autoResumeSuspendedTools?: boolean,\n): CoreTool {\n  return new CoreToolBuilder({ originalTool, options, logType, autoResumeSuspendedTools }).build();\n}\n\nexport function makeCoreToolV5(\n  originalTool: ToolToConvert,\n  options: ToolOptions,\n  logType?: 'tool' | 'toolset' | 'client-tool',\n  autoResumeSuspendedTools?: boolean,\n): VercelToolV5 {\n  return new CoreToolBuilder({ originalTool, options, logType, autoResumeSuspendedTools }).buildV5();\n}\n\n/**\n * Creates a proxy for a Mastra instance to handle deprecated properties\n * @param mastra - The Mastra instance to proxy\n * @param logger - The logger to use for warnings\n * @returns A proxy for the Mastra instance\n */\nexport function createMastraProxy({ mastra, logger }: { mastra: Mastra; logger: IMastraLogger }) {\n  return new Proxy(mastra, {\n    get(target, prop) {\n      const hasProp = Reflect.has(target, prop);\n\n      if (hasProp) {\n        const value = Reflect.get(target, prop);\n        const isFunction = typeof value === 'function';\n        if (isFunction) {\n          return value.bind(target);\n        }\n        return value;\n      }\n\n      if (prop === 'logger') {\n        logger.warn(`Please use 'getLogger' instead, logger is deprecated`);\n        return Reflect.apply(target.getLogger, target, []);\n      }\n\n      if (prop === 'storage') {\n        logger.warn(`Please use 'getStorage' instead, storage is deprecated`);\n        return Reflect.get(target, 'storage');\n      }\n\n      if (prop === 'agents') {\n        logger.warn(`Please use 'listAgents' instead, agents is deprecated`);\n        return Reflect.apply(target.listAgents, target, []);\n      }\n\n      if (prop === 'tts') {\n        logger.warn(`Please use 'getTTS' instead, tts is deprecated`);\n        return Reflect.apply(target.getTTS, target, []);\n      }\n\n      if (prop === 'vectors') {\n        logger.warn(`Please use 'getVectors' instead, vectors is deprecated`);\n        return Reflect.apply(target.getVectors, target, []);\n      }\n\n      if (prop === 'memory') {\n        logger.warn(`Please use 'getMemory' instead, memory is deprecated`);\n        return Reflect.get(target, 'memory');\n      }\n\n      return Reflect.get(target, prop);\n    },\n  });\n}\n\nexport function checkEvalStorageFields(traceObject: any, logger?: IMastraLogger) {\n  const missingFields = [];\n  if (!traceObject.input) missingFields.push('input');\n  if (!traceObject.output) missingFields.push('output');\n  if (!traceObject.agentName) missingFields.push('agent_name');\n  if (!traceObject.metricName) missingFields.push('metric_name');\n  if (!traceObject.instructions) missingFields.push('instructions');\n  if (!traceObject.globalRunId) missingFields.push('global_run_id');\n  if (!traceObject.runId) missingFields.push('run_id');\n\n  if (missingFields.length > 0) {\n    if (logger) {\n      logger.warn('Skipping evaluation storage due to missing required fields', {\n        missingFields,\n        runId: traceObject.runId,\n        agentName: traceObject.agentName,\n      });\n    } else {\n      console.warn('Skipping evaluation storage due to missing required fields', {\n        missingFields,\n        runId: traceObject.runId,\n        agentName: traceObject.agentName,\n      });\n    }\n    return false;\n  }\n\n  return true;\n}\n\n// lifted from https://github.com/vercel/ai/blob/main/packages/ai/core/prompt/detect-prompt-type.ts#L27\nfunction detectSingleMessageCharacteristics(\n  message: any,\n): 'has-ui-specific-parts' | 'has-core-specific-parts' | 'message' | 'other' {\n  if (\n    typeof message === 'object' &&\n    message !== null &&\n    (message.role === 'function' || // UI-only role\n      message.role === 'data' || // UI-only role\n      'toolInvocations' in message || // UI-specific field\n      'parts' in message || // UI-specific field\n      'experimental_attachments' in message)\n  ) {\n    return 'has-ui-specific-parts';\n  } else if (\n    typeof message === 'object' &&\n    message !== null &&\n    'content' in message &&\n    (Array.isArray(message.content) || // Core messages can have array content\n      'experimental_providerMetadata' in message ||\n      'providerOptions' in message)\n  ) {\n    return 'has-core-specific-parts';\n  } else if (\n    typeof message === 'object' &&\n    message !== null &&\n    'role' in message &&\n    'content' in message &&\n    typeof message.content === 'string' &&\n    ['system', 'user', 'assistant', 'tool'].includes(message.role)\n  ) {\n    return 'message';\n  } else {\n    return 'other';\n  }\n}\n\nexport function isUiMessage(message: CoreMessage | AiMessageType): message is AiMessageType {\n  return detectSingleMessageCharacteristics(message) === `has-ui-specific-parts`;\n}\nexport function isCoreMessage(message: CoreMessage | AiMessageType): message is CoreMessage {\n  return [`has-core-specific-parts`, `message`].includes(detectSingleMessageCharacteristics(message));\n}\n\n/** Represents a validated SQL identifier (e.g., table or column name). */\ntype SqlIdentifier = string & { __brand: 'SqlIdentifier' };\n/** Represents a validated dot-separated SQL field key. */\ntype FieldKey = string & { __brand: 'FieldKey' };\n\nconst SQL_IDENTIFIER_PATTERN = /^[a-zA-Z_][a-zA-Z0-9_]*$/;\n\n/**\n * Parses and returns a valid SQL identifier (such as a table or column name).\n * The identifier must:\n *   - Start with a letter (a-z, A-Z) or underscore (_)\n *   - Contain only letters, numbers, or underscores\n *   - Be at most 63 characters long\n *\n * @param name - The identifier string to parse.\n * @param kind - Optional label for error messages (e.g., 'table name').\n * @returns The validated identifier as a branded type.\n * @throws {Error} If the identifier does not conform to SQL naming rules.\n *\n * @example\n * const id = parseSqlIdentifier('my_table'); // Ok\n * parseSqlIdentifier('123table'); // Throws error\n */\nexport function parseSqlIdentifier(name: string, kind = 'identifier'): SqlIdentifier {\n  if (!SQL_IDENTIFIER_PATTERN.test(name) || name.length > 63) {\n    throw new Error(\n      `Invalid ${kind}: ${name}. Must start with a letter or underscore, contain only letters, numbers, or underscores, and be at most 63 characters long.`,\n    );\n  }\n  return name as SqlIdentifier;\n}\n\n/**\n * Parses and returns a valid dot-separated SQL field key (e.g., 'user.profile.name').\n * Each segment must:\n *   - Start with a letter (a-z, A-Z) or underscore (_)\n *   - Contain only letters, numbers, or underscores\n *   - Be at most 63 characters long\n *\n * @param key - The dot-separated field key string to parse.\n * @returns The validated field key as a branded type.\n * @throws {Error} If any segment of the key is invalid.\n *\n * @example\n * const key = parseFieldKey('user_profile.name'); // Ok\n * parseFieldKey('user..name'); // Throws error\n * parseFieldKey('user.123name'); // Throws error\n */\nexport function parseFieldKey(key: string): FieldKey {\n  if (!key) throw new Error('Field key cannot be empty');\n  const segments = key.split('.');\n  for (const segment of segments) {\n    if (!SQL_IDENTIFIER_PATTERN.test(segment) || segment.length > 63) {\n      throw new Error(`Invalid field key segment: ${segment} in ${key}`);\n    }\n  }\n  return key as FieldKey;\n}\n\n/**\n * Performs a fetch request with automatic retries using exponential backoff\n * @param url The URL to fetch from\n * @param options Standard fetch options\n * @param maxRetries Maximum number of retry attempts\n * @param validateResponse Optional function to validate the response beyond HTTP status\n * @returns The fetch Response if successful\n */\nexport async function fetchWithRetry(\n  url: string,\n  options: RequestInit = {},\n  maxRetries: number = 3,\n): Promise<Response> {\n  let retryCount = 0;\n  let lastError: Error | null = null;\n\n  while (retryCount < maxRetries) {\n    try {\n      const response = await fetch(url, options);\n\n      if (!response.ok) {\n        throw new Error(`Request failed with status: ${response.status} ${response.statusText}`);\n      }\n\n      return response;\n    } catch (error) {\n      lastError = error instanceof Error ? error : new Error(String(error));\n      retryCount++;\n\n      if (retryCount >= maxRetries) {\n        break;\n      }\n\n      const delay = Math.min(1000 * Math.pow(2, retryCount) * 1000, 10000);\n      await new Promise(resolve => setTimeout(resolve, delay));\n    }\n  }\n\n  throw lastError || new Error('Request failed after multiple retry attempts');\n}\n\n/**\n * Removes specific keys from an object.\n * @param obj - The original object\n * @param keysToOmit - Keys to exclude from the returned object\n * @returns A new object with the specified keys removed\n */\nexport function omitKeys<T extends Record<string, any>>(obj: T, keysToOmit: string[]): Partial<T> {\n  return Object.fromEntries(Object.entries(obj).filter(([key]) => !keysToOmit.includes(key))) as Partial<T>;\n}\n\n/**\n * Selectively extracts specific fields from an object using dot notation.\n * Does not error if fields don't exist - simply omits them from the result.\n * @param obj - The source object to extract fields from\n * @param fields - Array of field paths (supports dot notation like 'output.text')\n * @returns New object containing only the specified fields\n */\nexport function selectFields(obj: any, fields: string[]): any {\n  if (!obj || typeof obj !== 'object') {\n    return obj;\n  }\n\n  const result: any = {};\n\n  for (const field of fields) {\n    const value = getNestedValue(obj, field);\n    if (value !== undefined) {\n      setNestedValue(result, field, value);\n    }\n  }\n\n  return result;\n}\n\n/**\n * Gets a nested value from an object using dot notation\n * @param obj - Source object\n * @param path - Dot notation path (e.g., 'output.text')\n * @returns The value at the path, or undefined if not found\n */\nexport function getNestedValue(obj: any, path: string): any {\n  return path.split('.').reduce((current, key) => {\n    return current && typeof current === 'object' ? current[key] : undefined;\n  }, obj);\n}\n\n/**\n * Sets a nested value in an object using dot notation\n * @param obj - Target object\n * @param path - Dot notation path (e.g., 'output.text')\n * @param value - Value to set\n */\nexport function setNestedValue(obj: any, path: string, value: any): void {\n  const keys = path.split('.');\n  const lastKey = keys.pop();\n  if (!lastKey) {\n    return;\n  }\n\n  const target = keys.reduce((current, key) => {\n    if (!current[key] || typeof current[key] !== 'object') {\n      current[key] = {};\n    }\n    return current[key];\n  }, obj);\n\n  target[lastKey] = value;\n}\n\nexport const removeUndefinedValues = (obj: Record<string, any>) => {\n  return Object.fromEntries(Object.entries(obj).filter(([_, value]) => value !== undefined));\n};\n"],"names":["schema","args","resumeData","error","logger","z","delay"],"mappings":"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"}},
    {"offset": {"line": 8348, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-FY75XHWB.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/stream/aisdk/v4/usage.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/llm/model/model.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/llm/model/aisdk/generate-to-stream.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/llm/model/aisdk/v5/model.ts"],"sourcesContent":["import type { UsageStats } from '../../../observability/types/tracing';\n\n/**\n * AI SDK v4 LanguageModelUsage type definition\n * (matches the ai package's LanguageModelUsage)\n */\ninterface LanguageModelUsageV4 {\n  promptTokens: number;\n  completionTokens: number;\n  totalTokens?: number;\n}\n\n/**\n * Converts AI SDK v4 LanguageModelUsage to our UsageStats format.\n *\n * @param usage - The LanguageModelUsage from AI SDK v4\n * @returns Normalized UsageStats\n */\nexport function convertV4Usage(usage: LanguageModelUsageV4 | undefined): UsageStats {\n  if (!usage) {\n    return {};\n  }\n\n  return {\n    inputTokens: usage.promptTokens,\n    outputTokens: usage.completionTokens,\n  };\n}\n","import { generateObject, generateText, Output, streamObject, streamText } from '@internal/ai-sdk-v4';\nimport type {\n  CoreMessage,\n  LanguageModelV1 as LanguageModel,\n  StreamObjectOnFinishCallback,\n  StreamTextOnFinishCallback,\n} from '@internal/ai-sdk-v4';\nimport type { JSONSchema7, Schema } from '@mastra/schema-compat';\nimport {\n  AnthropicSchemaCompatLayer,\n  applyCompatLayer,\n  DeepSeekSchemaCompatLayer,\n  GoogleSchemaCompatLayer,\n  MetaSchemaCompatLayer,\n  OpenAIReasoningSchemaCompatLayer,\n  OpenAISchemaCompatLayer,\n  jsonSchema,\n} from '@mastra/schema-compat';\nimport { zodToJsonSchema } from '@mastra/schema-compat/zod-to-json';\nimport type { ZodSchema, z } from 'zod';\nimport type { MastraPrimitives } from '../../action';\nimport { MastraBase } from '../../base';\nimport { MastraError, ErrorDomain, ErrorCategory } from '../../error';\nimport type { Mastra } from '../../mastra';\nimport { SpanType } from '../../observability';\nimport { executeWithContext, executeWithContextSync } from '../../observability/utils';\nimport { convertV4Usage } from '../../stream/aisdk/v4/usage';\nimport { delay, isZodType } from '../../utils';\nimport { isZodArray, getZodDef } from '../../utils/zod-utils';\n\nimport type {\n  GenerateObjectWithMessagesArgs,\n  GenerateTextResult,\n  GenerateObjectResult,\n  GenerateTextWithMessagesArgs,\n  OriginalGenerateTextOptions,\n  ToolSet,\n  GenerateReturn,\n  OriginalGenerateObjectOptions,\n  StreamTextWithMessagesArgs,\n  StreamTextResult,\n  OriginalStreamTextOptions,\n  StreamObjectWithMessagesArgs,\n  OriginalStreamObjectOptions,\n  StreamObjectResult,\n  StreamReturn,\n} from './base.types';\nimport type { inferOutput, MastraModelOptions } from './shared.types';\n\nexport class MastraLLMV1 extends MastraBase {\n  #model: LanguageModel;\n  #mastra?: Mastra;\n  #options?: MastraModelOptions;\n\n  constructor({ model, mastra, options }: { model: LanguageModel; mastra?: Mastra; options?: MastraModelOptions }) {\n    super({ name: 'aisdk' });\n\n    this.#model = model;\n    this.#options = options;\n\n    if (mastra) {\n      this.#mastra = mastra;\n      if (mastra.getLogger()) {\n        this.__setLogger(this.#mastra.getLogger());\n      }\n    }\n  }\n\n  __registerPrimitives(p: MastraPrimitives) {\n    if (p.logger) {\n      this.__setLogger(p.logger);\n    }\n  }\n\n  __registerMastra(p: Mastra) {\n    this.#mastra = p;\n  }\n\n  getProvider() {\n    return this.#model.provider;\n  }\n\n  getModelId() {\n    return this.#model.modelId;\n  }\n\n  getModel() {\n    return this.#model;\n  }\n\n  private _applySchemaCompat(schema: ZodSchema | JSONSchema7): Schema {\n    const model = this.#model;\n\n    const schemaCompatLayers = [];\n\n    if (model) {\n      const modelInfo = {\n        modelId: model.modelId,\n        supportsStructuredOutputs: model.supportsStructuredOutputs ?? false,\n        provider: model.provider,\n      };\n      schemaCompatLayers.push(\n        new OpenAIReasoningSchemaCompatLayer(modelInfo),\n        new OpenAISchemaCompatLayer(modelInfo),\n        new GoogleSchemaCompatLayer(modelInfo),\n        new AnthropicSchemaCompatLayer(modelInfo),\n        new DeepSeekSchemaCompatLayer(modelInfo),\n        new MetaSchemaCompatLayer(modelInfo),\n      );\n    }\n\n    return applyCompatLayer({\n      schema: schema,\n      compatLayers: schemaCompatLayers,\n      mode: 'aiSdkSchema',\n    });\n  }\n\n  async __text<Tools extends ToolSet, Z extends ZodSchema | JSONSchema7 | undefined>({\n    runId,\n    messages,\n    maxSteps = 5,\n    tools = {},\n    temperature,\n    toolChoice = 'auto',\n    onStepFinish,\n    experimental_output,\n    threadId,\n    resourceId,\n    requestContext,\n    tracingContext,\n    ...rest\n  }: GenerateTextWithMessagesArgs<Tools, Z>): Promise<GenerateTextResult<Tools, Z>> {\n    const model = this.#model;\n\n    this.logger.debug(`[LLM] - Generating text`, {\n      runId,\n      messages,\n      maxSteps,\n      threadId,\n      resourceId,\n      tools: Object.keys(tools),\n    });\n\n    let schema: z.ZodType<inferOutput<Z>> | Schema<inferOutput<Z>> | undefined = undefined;\n\n    if (experimental_output) {\n      this.logger.debug('[LLM] - Using experimental output', {\n        runId,\n      });\n\n      if (isZodType(experimental_output)) {\n        schema = experimental_output as z.ZodType<inferOutput<Z>>;\n        if (isZodArray(schema)) {\n          schema = getZodDef(schema).type as z.ZodType<inferOutput<Z>>;\n        }\n\n        const jsonSchemaToUse = zodToJsonSchema(schema, 'jsonSchema7');\n\n        schema = jsonSchema<inferOutput<Z>>(jsonSchemaToUse);\n      } else {\n        schema = jsonSchema<inferOutput<Z>>(experimental_output);\n      }\n    }\n\n    const llmSpan = tracingContext.currentSpan?.createChildSpan({\n      name: `llm: '${model.modelId}'`,\n      type: SpanType.MODEL_GENERATION,\n      input: {\n        messages,\n        schema,\n      },\n      attributes: {\n        model: model.modelId,\n        provider: model.provider,\n        parameters: {\n          temperature,\n          maxOutputTokens: rest.maxTokens,\n          topP: rest.topP,\n          frequencyPenalty: rest.frequencyPenalty,\n          presencePenalty: rest.presencePenalty,\n        },\n        streaming: false,\n      },\n      metadata: {\n        runId,\n        threadId,\n        resourceId,\n      },\n      tracingPolicy: this.#options?.tracingPolicy,\n    });\n\n    const argsForExecute: OriginalGenerateTextOptions<Tools, Z> = {\n      ...rest,\n      messages,\n      model,\n      temperature,\n      tools: {\n        ...(tools as Tools),\n      },\n      toolChoice,\n      maxSteps,\n      onStepFinish: async props => {\n        try {\n          await onStepFinish?.({ ...props, runId: runId! });\n        } catch (e: unknown) {\n          const mastraError = new MastraError(\n            {\n              id: 'LLM_TEXT_ON_STEP_FINISH_CALLBACK_EXECUTION_FAILED',\n              domain: ErrorDomain.LLM,\n              category: ErrorCategory.USER,\n              details: {\n                modelId: model.modelId,\n                modelProvider: model.provider,\n                runId: runId ?? 'unknown',\n                threadId: threadId ?? 'unknown',\n                resourceId: resourceId ?? 'unknown',\n                finishReason: props?.finishReason,\n                toolCalls: props?.toolCalls ? JSON.stringify(props.toolCalls) : '',\n                toolResults: props?.toolResults ? JSON.stringify(props.toolResults) : '',\n                usage: props?.usage ? JSON.stringify(props.usage) : '',\n              },\n            },\n            e,\n          );\n          throw mastraError;\n        }\n\n        this.logger.debug('[LLM] - Text Step Change:', {\n          text: props?.text,\n          toolCalls: props?.toolCalls,\n          toolResults: props?.toolResults,\n          finishReason: props?.finishReason,\n          usage: props?.usage,\n          runId,\n        });\n\n        const remainingTokens = parseInt(props?.response?.headers?.['x-ratelimit-remaining-tokens'] ?? '', 10);\n        if (!isNaN(remainingTokens) && remainingTokens > 0 && remainingTokens < 2000) {\n          this.logger.warn('Rate limit approaching, waiting 10 seconds', { runId });\n          await delay(10 * 1000);\n        }\n      },\n      experimental_output: schema\n        ? Output.object({\n            schema,\n          })\n        : undefined,\n    };\n\n    try {\n      const result: GenerateTextResult<Tools, Z> = await executeWithContext({\n        span: llmSpan,\n        fn: () => generateText(argsForExecute),\n      });\n\n      if (schema && result.finishReason === 'stop') {\n        result.object = (result as any).experimental_output;\n      }\n      llmSpan?.end({\n        output: {\n          text: result.text,\n          object: result.object,\n          reasoning: result.reasoningDetails,\n          reasoningText: result.reasoning,\n          files: result.files,\n          sources: result.sources,\n          warnings: result.warnings,\n        },\n        attributes: {\n          finishReason: result.finishReason,\n          usage: convertV4Usage(result.usage),\n        },\n      });\n\n      return result;\n    } catch (e: unknown) {\n      const mastraError = new MastraError(\n        {\n          id: 'LLM_GENERATE_TEXT_AI_SDK_EXECUTION_FAILED',\n          domain: ErrorDomain.LLM,\n          category: ErrorCategory.THIRD_PARTY,\n          details: {\n            modelId: model.modelId,\n            modelProvider: model.provider,\n            runId: runId ?? 'unknown',\n            threadId: threadId ?? 'unknown',\n            resourceId: resourceId ?? 'unknown',\n          },\n        },\n        e,\n      );\n      llmSpan?.error({ error: mastraError });\n      throw mastraError;\n    }\n  }\n\n  async __textObject<Z extends ZodSchema | JSONSchema7>({\n    messages,\n    structuredOutput,\n    runId,\n    threadId,\n    resourceId,\n    requestContext,\n    tracingContext,\n    ...rest\n  }: GenerateObjectWithMessagesArgs<Z>): Promise<GenerateObjectResult<Z>> {\n    const model = this.#model;\n\n    this.logger.debug(`[LLM] - Generating a text object`, { runId });\n\n    const llmSpan = tracingContext.currentSpan?.createChildSpan({\n      name: `llm: '${model.modelId}'`,\n      type: SpanType.MODEL_GENERATION,\n      input: {\n        messages,\n      },\n      attributes: {\n        model: model.modelId,\n        provider: model.provider,\n        parameters: {\n          temperature: rest.temperature,\n          maxOutputTokens: rest.maxTokens,\n          topP: rest.topP,\n          frequencyPenalty: rest.frequencyPenalty,\n          presencePenalty: rest.presencePenalty,\n        },\n        streaming: false,\n      },\n      metadata: {\n        runId,\n        threadId,\n        resourceId,\n      },\n      tracingPolicy: this.#options?.tracingPolicy,\n    });\n\n    try {\n      let output: 'object' | 'array' = 'object';\n      if (isZodArray(structuredOutput)) {\n        output = 'array';\n        structuredOutput = getZodDef(structuredOutput).type;\n      }\n\n      const processedSchema = this._applySchemaCompat(structuredOutput!);\n      llmSpan?.update({\n        input: {\n          messages,\n          schema: processedSchema,\n        },\n      });\n\n      const argsForExecute: OriginalGenerateObjectOptions<Z> = {\n        ...rest,\n        messages,\n        model,\n        // @ts-expect-error - output in our implementation can only be object or array\n        output,\n        schema: processedSchema as Schema<Z>,\n      };\n\n      try {\n        // @ts-expect-error - output in our implementation can only be object or array\n        const result = await generateObject(argsForExecute);\n\n        llmSpan?.end({\n          output: {\n            object: result.object,\n            warnings: result.warnings,\n          },\n          attributes: {\n            finishReason: result.finishReason,\n            usage: convertV4Usage(result.usage),\n          },\n        });\n\n        // @ts-expect-error - output in our implementation can only be object or array\n        return result;\n      } catch (e: unknown) {\n        const mastraError = new MastraError(\n          {\n            id: 'LLM_GENERATE_OBJECT_AI_SDK_EXECUTION_FAILED',\n            domain: ErrorDomain.LLM,\n            category: ErrorCategory.THIRD_PARTY,\n            details: {\n              modelId: model.modelId,\n              modelProvider: model.provider,\n              runId: runId ?? 'unknown',\n              threadId: threadId ?? 'unknown',\n              resourceId: resourceId ?? 'unknown',\n            },\n          },\n          e,\n        );\n        llmSpan?.error({ error: mastraError });\n        throw mastraError;\n      }\n    } catch (e: unknown) {\n      if (e instanceof MastraError) {\n        throw e;\n      }\n\n      const mastraError = new MastraError(\n        {\n          id: 'LLM_GENERATE_OBJECT_AI_SDK_SCHEMA_CONVERSION_FAILED',\n          domain: ErrorDomain.LLM,\n          category: ErrorCategory.USER,\n          details: {\n            modelId: model.modelId,\n            modelProvider: model.provider,\n            runId: runId ?? 'unknown',\n            threadId: threadId ?? 'unknown',\n            resourceId: resourceId ?? 'unknown',\n          },\n        },\n        e,\n      );\n      llmSpan?.error({ error: mastraError });\n      throw mastraError;\n    }\n  }\n\n  __stream<Tools extends ToolSet, Z extends ZodSchema | JSONSchema7 | undefined = undefined>({\n    messages,\n    onStepFinish,\n    onFinish,\n    maxSteps = 5,\n    tools = {},\n    runId,\n    temperature,\n    toolChoice = 'auto',\n    experimental_output,\n    threadId,\n    resourceId,\n    requestContext,\n    tracingContext,\n    ...rest\n  }: StreamTextWithMessagesArgs<Tools, Z>): StreamTextResult<Tools, Z> {\n    const model = this.#model;\n    this.logger.debug(`[LLM] - Streaming text`, {\n      runId,\n      threadId,\n      resourceId,\n      messages,\n      maxSteps,\n      tools: Object.keys(tools || {}),\n    });\n\n    let schema: z.ZodType<Z> | Schema<Z> | undefined;\n    if (experimental_output) {\n      this.logger.debug('[LLM] - Using experimental output', {\n        runId,\n      });\n      if (typeof (experimental_output as any).parse === 'function') {\n        schema = experimental_output as z.ZodType<Z>;\n        if (isZodArray(schema)) {\n          schema = getZodDef(schema).type as z.ZodType<Z>;\n        }\n      } else {\n        schema = jsonSchema(experimental_output as JSONSchema7) as Schema<Z>;\n      }\n    }\n\n    const llmSpan = tracingContext.currentSpan?.createChildSpan({\n      name: `llm: '${model.modelId}'`,\n      type: SpanType.MODEL_GENERATION,\n      input: {\n        messages,\n      },\n      attributes: {\n        model: model.modelId,\n        provider: model.provider,\n        parameters: {\n          temperature,\n          maxOutputTokens: rest.maxTokens,\n          topP: rest.topP,\n          frequencyPenalty: rest.frequencyPenalty,\n          presencePenalty: rest.presencePenalty,\n        },\n        streaming: true,\n      },\n      metadata: {\n        runId,\n        threadId,\n        resourceId,\n      },\n      tracingPolicy: this.#options?.tracingPolicy,\n    });\n\n    const argsForExecute: OriginalStreamTextOptions<Tools, Z> = {\n      model,\n      temperature,\n      tools: {\n        ...(tools as Tools),\n      },\n      maxSteps,\n      toolChoice,\n      onStepFinish: async props => {\n        try {\n          await onStepFinish?.({ ...props, runId: runId! });\n        } catch (e: unknown) {\n          const mastraError = new MastraError(\n            {\n              id: 'LLM_STREAM_ON_STEP_FINISH_CALLBACK_EXECUTION_FAILED',\n              domain: ErrorDomain.LLM,\n              category: ErrorCategory.USER,\n              details: {\n                modelId: model.modelId,\n                modelProvider: model.provider,\n                runId: runId ?? 'unknown',\n                threadId: threadId ?? 'unknown',\n                resourceId: resourceId ?? 'unknown',\n                finishReason: props?.finishReason,\n                toolCalls: props?.toolCalls ? JSON.stringify(props.toolCalls) : '',\n                toolResults: props?.toolResults ? JSON.stringify(props.toolResults) : '',\n                usage: props?.usage ? JSON.stringify(props.usage) : '',\n              },\n            },\n            e,\n          );\n          this.logger.trackException(mastraError);\n          llmSpan?.error({ error: mastraError });\n          throw mastraError;\n        }\n\n        this.logger.debug('[LLM] - Stream Step Change:', {\n          text: props?.text,\n          toolCalls: props?.toolCalls,\n          toolResults: props?.toolResults,\n          finishReason: props?.finishReason,\n          usage: props?.usage,\n          runId,\n        });\n\n        const remainingTokens = parseInt(props?.response?.headers?.['x-ratelimit-remaining-tokens'] ?? '', 10);\n        if (!isNaN(remainingTokens) && remainingTokens > 0 && remainingTokens < 2000) {\n          this.logger.warn('Rate limit approaching, waiting 10 seconds', { runId });\n          await delay(10 * 1000);\n        }\n      },\n      onFinish: async props => {\n        // End the model generation span BEFORE calling the user's onFinish callback\n        // This ensures the model span ends before the agent span\n        llmSpan?.end({\n          output: {\n            text: props?.text,\n            reasoning: props?.reasoningDetails,\n            reasoningText: props?.reasoning,\n            files: props?.files,\n            sources: props?.sources,\n            warnings: props?.warnings,\n          },\n          attributes: {\n            finishReason: props?.finishReason,\n            usage: convertV4Usage(props?.usage),\n          },\n        });\n\n        try {\n          await onFinish?.({ ...props, runId: runId! });\n        } catch (e: unknown) {\n          const mastraError = new MastraError(\n            {\n              id: 'LLM_STREAM_ON_FINISH_CALLBACK_EXECUTION_FAILED',\n              domain: ErrorDomain.LLM,\n              category: ErrorCategory.USER,\n              details: {\n                modelId: model.modelId,\n                modelProvider: model.provider,\n                runId: runId ?? 'unknown',\n                threadId: threadId ?? 'unknown',\n                resourceId: resourceId ?? 'unknown',\n                finishReason: props?.finishReason,\n                toolCalls: props?.toolCalls ? JSON.stringify(props.toolCalls) : '',\n                toolResults: props?.toolResults ? JSON.stringify(props.toolResults) : '',\n                usage: props?.usage ? JSON.stringify(props.usage) : '',\n              },\n            },\n            e,\n          );\n          llmSpan?.error({ error: mastraError });\n          this.logger.trackException(mastraError);\n          throw mastraError;\n        }\n\n        this.logger.debug('[LLM] - Stream Finished:', {\n          text: props?.text,\n          toolCalls: props?.toolCalls,\n          toolResults: props?.toolResults,\n          finishReason: props?.finishReason,\n          usage: props?.usage,\n          runId,\n          threadId,\n          resourceId,\n        });\n      },\n      ...rest,\n      messages,\n      experimental_output: schema\n        ? (Output.object({\n            schema,\n          }) as any)\n        : undefined,\n    };\n\n    try {\n      return executeWithContextSync({ span: llmSpan, fn: () => streamText(argsForExecute) });\n    } catch (e: unknown) {\n      const mastraError = new MastraError(\n        {\n          id: 'LLM_STREAM_TEXT_AI_SDK_EXECUTION_FAILED',\n          domain: ErrorDomain.LLM,\n          category: ErrorCategory.THIRD_PARTY,\n          details: {\n            modelId: model.modelId,\n            modelProvider: model.provider,\n            runId: runId ?? 'unknown',\n            threadId: threadId ?? 'unknown',\n            resourceId: resourceId ?? 'unknown',\n          },\n        },\n        e,\n      );\n      llmSpan?.error({ error: mastraError });\n      throw mastraError;\n    }\n  }\n\n  __streamObject<T extends ZodSchema | JSONSchema7>({\n    messages,\n    runId,\n    requestContext,\n    threadId,\n    resourceId,\n    onFinish,\n    structuredOutput,\n    tracingContext,\n    ...rest\n  }: StreamObjectWithMessagesArgs<T>): StreamObjectResult<T> {\n    const model = this.#model;\n    this.logger.debug(`[LLM] - Streaming structured output`, {\n      runId,\n      messages,\n    });\n\n    const llmSpan = tracingContext.currentSpan?.createChildSpan({\n      name: `llm: '${model.modelId}'`,\n      type: SpanType.MODEL_GENERATION,\n      input: {\n        messages,\n      },\n      attributes: {\n        model: model.modelId,\n        provider: model.provider,\n        parameters: {\n          temperature: rest.temperature,\n          maxOutputTokens: rest.maxTokens,\n          topP: rest.topP,\n          frequencyPenalty: rest.frequencyPenalty,\n          presencePenalty: rest.presencePenalty,\n        },\n        streaming: true,\n      },\n      metadata: {\n        runId,\n        threadId,\n        resourceId,\n      },\n      tracingPolicy: this.#options?.tracingPolicy,\n    });\n\n    try {\n      let output: 'object' | 'array' = 'object';\n      if (isZodArray(structuredOutput)) {\n        output = 'array';\n        structuredOutput = getZodDef(structuredOutput).type;\n      }\n\n      const processedSchema = this._applySchemaCompat(structuredOutput!);\n      llmSpan?.update({\n        input: {\n          messages,\n          schema: processedSchema,\n        },\n      });\n\n      const argsForExecute: OriginalStreamObjectOptions<T> = {\n        ...rest,\n        model,\n        onFinish: async (props: any) => {\n          // End the model generation span BEFORE calling the user's onFinish callback\n          // This ensures the model span ends before the agent span\n          llmSpan?.end({\n            output: {\n              text: props?.text,\n              object: props?.object,\n              reasoning: props?.reasoningDetails,\n              reasoningText: props?.reasoning,\n              files: props?.files,\n              sources: props?.sources,\n              warnings: props?.warnings,\n            },\n            attributes: {\n              finishReason: props?.finishReason,\n              usage: props?.usage,\n            },\n          });\n\n          try {\n            await onFinish?.({ ...props, runId: runId! });\n          } catch (e: unknown) {\n            const mastraError = new MastraError(\n              {\n                id: 'LLM_STREAM_OBJECT_ON_FINISH_CALLBACK_EXECUTION_FAILED',\n                domain: ErrorDomain.LLM,\n                category: ErrorCategory.USER,\n                details: {\n                  modelId: model.modelId,\n                  modelProvider: model.provider,\n                  runId: runId ?? 'unknown',\n                  threadId: threadId ?? 'unknown',\n                  resourceId: resourceId ?? 'unknown',\n                  toolCalls: '',\n                  toolResults: '',\n                  finishReason: '',\n                  usage: props?.usage ? JSON.stringify(props.usage) : '',\n                },\n              },\n              e,\n            );\n            this.logger.trackException(mastraError);\n            llmSpan?.error({ error: mastraError });\n            throw mastraError;\n          }\n\n          this.logger.debug('[LLM] - Object Stream Finished:', {\n            usage: props?.usage,\n            runId,\n            threadId,\n            resourceId,\n          });\n        },\n        messages,\n        // @ts-expect-error - output in our implementation can only be object or array\n        output,\n        schema: processedSchema as Schema<inferOutput<T>>,\n      };\n\n      try {\n        return streamObject(argsForExecute as any);\n      } catch (e: unknown) {\n        const mastraError = new MastraError(\n          {\n            id: 'LLM_STREAM_OBJECT_AI_SDK_EXECUTION_FAILED',\n            domain: ErrorDomain.LLM,\n            category: ErrorCategory.THIRD_PARTY,\n            details: {\n              modelId: model.modelId,\n              modelProvider: model.provider,\n              runId: runId ?? 'unknown',\n              threadId: threadId ?? 'unknown',\n              resourceId: resourceId ?? 'unknown',\n            },\n          },\n          e,\n        );\n        llmSpan?.error({ error: mastraError });\n        throw mastraError;\n      }\n    } catch (e: unknown) {\n      if (e instanceof MastraError) {\n        llmSpan?.error({ error: e });\n        throw e;\n      }\n\n      const mastraError = new MastraError(\n        {\n          id: 'LLM_STREAM_OBJECT_AI_SDK_SCHEMA_CONVERSION_FAILED',\n          domain: ErrorDomain.LLM,\n          category: ErrorCategory.USER,\n          details: {\n            modelId: model.modelId,\n            modelProvider: model.provider,\n            runId: runId ?? 'unknown',\n            threadId: threadId ?? 'unknown',\n            resourceId: resourceId ?? 'unknown',\n          },\n        },\n        e,\n      );\n      llmSpan?.error({ error: mastraError });\n      throw mastraError;\n    }\n  }\n\n  convertToMessages(messages: string | string[] | CoreMessage[]): CoreMessage[] {\n    if (Array.isArray(messages)) {\n      return messages.map(m => {\n        if (typeof m === 'string') {\n          return {\n            role: 'user',\n            content: m,\n          };\n        }\n        return m;\n      });\n    }\n\n    return [\n      {\n        role: 'user',\n        content: messages,\n      },\n    ];\n  }\n\n  async generate<\n    Output extends ZodSchema | JSONSchema7 | undefined = undefined,\n    StructuredOutput extends ZodSchema | JSONSchema7 | undefined = undefined,\n    Tools extends ToolSet = ToolSet,\n  >(\n    messages: string | string[] | CoreMessage[],\n    {\n      output,\n      ...rest\n    }: Omit<\n      Output extends undefined\n        ? GenerateTextWithMessagesArgs<Tools, StructuredOutput>\n        : Omit<GenerateObjectWithMessagesArgs<NonNullable<Output>>, 'structuredOutput' | 'output'>,\n      'messages'\n    > & { output?: Output },\n  ): Promise<GenerateReturn<Tools, Output, StructuredOutput>> {\n    const msgs = this.convertToMessages(messages);\n\n    if (!output) {\n      const { maxSteps, onStepFinish, ...textOptions } = rest as Omit<\n        GenerateTextWithMessagesArgs<Tools, StructuredOutput>,\n        'messages'\n      >;\n      return (await this.__text<Tools, StructuredOutput>({\n        messages: msgs,\n        maxSteps,\n        onStepFinish,\n        ...textOptions,\n      })) as unknown as GenerateReturn<Tools, Output, StructuredOutput>;\n    }\n\n    return (await this.__textObject({\n      messages: msgs,\n      structuredOutput: output as NonNullable<Output>,\n      ...rest,\n    })) as unknown as GenerateReturn<Tools, Output, StructuredOutput>;\n  }\n\n  stream<\n    Output extends ZodSchema | JSONSchema7 | undefined = undefined,\n    StructuredOutput extends ZodSchema | JSONSchema7 | undefined = undefined,\n    Tools extends ToolSet = ToolSet,\n  >(\n    messages: string | string[] | CoreMessage[],\n    {\n      maxSteps = 5,\n      output,\n      onFinish,\n      ...rest\n    }: Omit<\n      Output extends undefined\n        ? StreamTextWithMessagesArgs<Tools, StructuredOutput>\n        : Omit<StreamObjectWithMessagesArgs<NonNullable<Output>>, 'structuredOutput' | 'output'> & { maxSteps?: never },\n      'messages'\n    > & { output?: Output },\n  ): StreamReturn<Tools, Output, StructuredOutput> {\n    const msgs = this.convertToMessages(messages);\n\n    if (!output) {\n      return this.__stream({\n        messages: msgs,\n        maxSteps,\n        onFinish: onFinish as StreamTextOnFinishCallback<Tools> | undefined,\n        ...rest,\n      }) as unknown as StreamReturn<Tools, Output, StructuredOutput>;\n    }\n\n    return this.__streamObject({\n      messages: msgs,\n      structuredOutput: output as NonNullable<Output>,\n      onFinish: onFinish as StreamObjectOnFinishCallback<inferOutput<Output>> | undefined,\n      ...rest,\n    }) as unknown as StreamReturn<Tools, Output, StructuredOutput>;\n  }\n}\n","import { randomUUID } from 'node:crypto';\n\n/**\n * Converts a doGenerate result to a ReadableStream format.\n * This is shared between V2 and V3 model wrappers since the content/result structure is compatible.\n */\nexport function createStreamFromGenerateResult(result: {\n  warnings: unknown[];\n  response?: {\n    id?: string;\n    modelId?: string;\n    timestamp?: Date;\n  };\n  content: Array<{\n    type: string;\n    [key: string]: unknown;\n  }>;\n  finishReason: unknown;\n  usage: unknown;\n  providerMetadata?: unknown;\n}): ReadableStream {\n  return new ReadableStream({\n    start(controller) {\n      controller.enqueue({ type: 'stream-start', warnings: result.warnings });\n      controller.enqueue({\n        type: 'response-metadata',\n        id: result.response?.id,\n        modelId: result.response?.modelId,\n        timestamp: result.response?.timestamp,\n      });\n\n      for (const message of result.content) {\n        if (message.type === 'tool-call') {\n          const toolCall = message as {\n            type: 'tool-call';\n            toolCallId: string;\n            toolName: string;\n            input: unknown;\n          };\n          controller.enqueue({\n            type: 'tool-input-start',\n            id: toolCall.toolCallId,\n            toolName: toolCall.toolName,\n          });\n          controller.enqueue({\n            type: 'tool-input-delta',\n            id: toolCall.toolCallId,\n            delta: toolCall.input,\n          });\n          controller.enqueue({\n            type: 'tool-input-end',\n            id: toolCall.toolCallId,\n          });\n          controller.enqueue(toolCall);\n        } else if (message.type === 'tool-result') {\n          controller.enqueue(message);\n        } else if (message.type === 'text') {\n          const text = message as {\n            type: 'text';\n            text: string;\n            providerMetadata?: unknown;\n          };\n          const id = `msg_${randomUUID()}`;\n          controller.enqueue({\n            type: 'text-start',\n            id,\n            providerMetadata: text.providerMetadata,\n          });\n          controller.enqueue({\n            type: 'text-delta',\n            id,\n            delta: text.text,\n          });\n          controller.enqueue({\n            type: 'text-end',\n            id,\n          });\n        } else if (message.type === 'reasoning') {\n          const id = `reasoning_${randomUUID()}`;\n          const reasoning = message as {\n            type: 'reasoning';\n            text: string;\n            providerMetadata?: unknown;\n          };\n          controller.enqueue({\n            type: 'reasoning-start',\n            id,\n            providerMetadata: reasoning.providerMetadata,\n          });\n          controller.enqueue({\n            type: 'reasoning-delta',\n            id,\n            delta: reasoning.text,\n            providerMetadata: reasoning.providerMetadata,\n          });\n          controller.enqueue({\n            type: 'reasoning-end',\n            id,\n            providerMetadata: reasoning.providerMetadata,\n          });\n        } else if (message.type === 'file') {\n          const file = message as {\n            type: 'file';\n            mediaType: string;\n            data: unknown;\n          };\n          controller.enqueue({\n            type: 'file',\n            mediaType: file.mediaType,\n            data: file.data,\n          });\n        } else if (message.type === 'source') {\n          const source = message as {\n            type: 'source';\n            sourceType: 'url' | 'document';\n            id: string;\n            url?: string;\n            mediaType?: string;\n            filename?: string;\n            title?: string;\n            providerMetadata?: unknown;\n          };\n          if (source.sourceType === 'url') {\n            controller.enqueue({\n              type: 'source',\n              id: source.id,\n              sourceType: 'url',\n              url: source.url,\n              title: source.title,\n              providerMetadata: source.providerMetadata,\n            });\n          } else {\n            controller.enqueue({\n              type: 'source',\n              id: source.id,\n              sourceType: 'document',\n              mediaType: source.mediaType,\n              filename: source.filename,\n              title: source.title,\n              providerMetadata: source.providerMetadata,\n            });\n          }\n        }\n      }\n\n      controller.enqueue({\n        type: 'finish',\n        finishReason: result.finishReason,\n        usage: result.usage,\n        providerMetadata: result.providerMetadata,\n      });\n\n      controller.close();\n    },\n  });\n}\n","import type { LanguageModelV2, LanguageModelV2CallOptions } from '@ai-sdk/provider-v5';\nimport type { MastraLanguageModelV2 } from '../../shared.types';\nimport { createStreamFromGenerateResult } from '../generate-to-stream';\n\ntype StreamResult = Awaited<ReturnType<LanguageModelV2['doStream']>>;\n\n/**\n * Wrapper class for AI SDK V5 (LanguageModelV2) that converts doGenerate to return\n * a stream format for consistency with Mastra's streaming architecture.\n */\nexport class AISDKV5LanguageModel implements MastraLanguageModelV2 {\n  /**\n   * The language model must specify which language model interface version it implements.\n   */\n  readonly specificationVersion: 'v2' = 'v2';\n  /**\n   * Name of the provider for logging purposes.\n   */\n  readonly provider: string;\n  /**\n   * Provider-specific model ID for logging purposes.\n   */\n  readonly modelId: string;\n  /**\n   * Supported URL patterns by media type for the provider.\n   *\n   * The keys are media type patterns or full media types (e.g. `*\\/*` for everything, `audio/*`, `video/*`, or `application/pdf`).\n   * and the values are arrays of regular expressions that match the URL paths.\n   * The matching should be against lower-case URLs.\n   * Matched URLs are supported natively by the model and are not downloaded.\n   * @returns A map of supported URL patterns by media type (as a promise or a plain object).\n   */\n  supportedUrls: PromiseLike<Record<string, RegExp[]>> | Record<string, RegExp[]>;\n\n  #model: LanguageModelV2;\n\n  constructor(config: LanguageModelV2) {\n    this.#model = config;\n    this.provider = this.#model.provider;\n    this.modelId = this.#model.modelId;\n    this.supportedUrls = this.#model.supportedUrls;\n  }\n\n  async doGenerate(options: LanguageModelV2CallOptions) {\n    const result = await this.#model.doGenerate(options);\n\n    return {\n      request: result.request!,\n      response: result.response as unknown as StreamResult['response'],\n      stream: createStreamFromGenerateResult(result),\n    };\n  }\n\n  async doStream(options: LanguageModelV2CallOptions) {\n    return await this.#model.doStream(options);\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9235, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-BVUMKER5.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/events/pubsub.ts"],"sourcesContent":["import type { Event } from './types';\n\nexport abstract class PubSub {\n  abstract publish(topic: string, event: Omit<Event, 'id' | 'createdAt'>): Promise<void>;\n  abstract subscribe(topic: string, cb: (event: Event, ack?: () => Promise<void>) => void): Promise<void>;\n  abstract unsubscribe(topic: string, cb: (event: Event, ack?: () => Promise<void>) => void): Promise<void>;\n  abstract flush(): Promise<void>;\n}\n"],"names":[],"mappings":";;;;;AAEO,IAAe,SAAf,MAAsB;AAK7B"}},
    {"offset": {"line": 9249, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-L54GIUCB.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/hooks/mitt.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/hooks/index.ts"],"sourcesContent":["// copied from https://github.com/developit/mitt\n\nexport type EventType = string | symbol;\n\n// An event handler can take an optional event argument\n// and should not return a value\nexport type Handler<T = unknown> = (event: T) => void;\nexport type WildcardHandler<T = Record<string, unknown>> = (type: keyof T, event: T[keyof T]) => void;\n\n// An array of all currently registered event handlers for a type\nexport type EventHandlerList<T = unknown> = Array<Handler<T>>;\nexport type WildCardEventHandlerList<T = Record<string, unknown>> = Array<WildcardHandler<T>>;\n\n// A map of event types and their corresponding event handlers.\nexport type EventHandlerMap<Events extends Record<EventType, unknown>> = Map<\n  keyof Events | '*',\n  EventHandlerList<Events[keyof Events]> | WildCardEventHandlerList<Events>\n>;\n\nexport interface Emitter<Events extends Record<EventType, unknown>> {\n  all: EventHandlerMap<Events>;\n\n  on<Key extends keyof Events>(type: Key, handler: Handler<Events[Key]>): void;\n  on(type: '*', handler: WildcardHandler<Events>): void;\n\n  off<Key extends keyof Events>(type: Key, handler?: Handler<Events[Key]>): void;\n  off(type: '*', handler: WildcardHandler<Events>): void;\n\n  emit<Key extends keyof Events>(type: Key, event: Events[Key]): void;\n  emit<Key extends keyof Events>(type: undefined extends Events[Key] ? Key : never): void;\n}\n\n/**\n * Mitt: Tiny (~200b) functional event emitter / pubsub.\n * @name mitt\n * @returns {Mitt}\n */\nexport default function mitt<Events extends Record<EventType, unknown>>(\n  all?: EventHandlerMap<Events>,\n): Emitter<Events> {\n  type GenericEventHandler = Handler<Events[keyof Events]> | WildcardHandler<Events>;\n  all = all || new Map();\n\n  return {\n    /**\n     * A Map of event names to registered handler functions.\n     */\n    all,\n\n    /**\n     * Register an event handler for the given type.\n     * @param {string|symbol} type Type of event to listen for, or `'*'` for all events\n     * @param {Function} handler Function to call in response to given event\n     * @memberOf mitt\n     */\n    on<Key extends keyof Events>(type: Key, handler: GenericEventHandler) {\n      const handlers: Array<GenericEventHandler> | undefined = all!.get(type);\n      if (handlers) {\n        handlers.push(handler);\n      } else {\n        all!.set(type, [handler] as EventHandlerList<Events[keyof Events]>);\n      }\n    },\n\n    /**\n     * Remove an event handler for the given type.\n     * If `handler` is omitted, all handlers of the given type are removed.\n     * @param {string|symbol} type Type of event to unregister `handler` from (`'*'` to remove a wildcard handler)\n     * @param {Function} [handler] Handler function to remove\n     * @memberOf mitt\n     */\n    off<Key extends keyof Events>(type: Key, handler?: GenericEventHandler) {\n      const handlers: Array<GenericEventHandler> | undefined = all!.get(type);\n      if (handlers) {\n        if (handler) {\n          handlers.splice(handlers.indexOf(handler) >>> 0, 1);\n        } else {\n          all!.set(type, []);\n        }\n      }\n    },\n\n    /**\n     * Invoke all handlers for the given type.\n     * If present, `'*'` handlers are invoked after type-matched handlers.\n     *\n     * Note: Manually firing '*' handlers is not supported.\n     *\n     * @param {string|symbol} type The event type to invoke\n     * @param {Any} [evt] Any value (object is recommended and powerful), passed to each handler\n     * @memberOf mitt\n     */\n    emit<Key extends keyof Events>(type: Key, evt?: Events[Key]) {\n      let handlers = all!.get(type);\n      if (handlers) {\n        (handlers as EventHandlerList<Events[keyof Events]>).slice().map(handler => {\n          handler(evt!);\n        });\n      }\n\n      handlers = all!.get('*');\n      if (handlers) {\n        (handlers as WildCardEventHandlerList<Events>).slice().map(handler => {\n          handler(type, evt!);\n        });\n      }\n    },\n  };\n}\n","import type { ScoringHookInput } from '../evals';\n\nimport mitt from './mitt';\nimport type { Handler } from './mitt';\n\nexport enum AvailableHooks {\n  ON_EVALUATION = 'onEvaluation',\n  ON_GENERATION = 'onGeneration',\n  ON_SCORER_RUN = 'onScorerRun',\n}\n\nconst hooks = mitt();\n\nexport function registerHook(hook: AvailableHooks.ON_SCORER_RUN, action: Handler<ScoringHookInput>): void;\nexport function registerHook(hook: `${AvailableHooks}`, action: Handler<any>): void {\n  hooks.on(hook, action);\n}\n\nexport function executeHook(hook: AvailableHooks.ON_SCORER_RUN, action: ScoringHookInput): void;\nexport function executeHook(hook: `${AvailableHooks}`, data: unknown): void {\n  // do not block the main thread\n  setImmediate(() => {\n    hooks.emit(hook, data);\n  });\n}\n"],"names":["AvailableHooks"],"mappings":";;;;;;;;;AAqCe,SAAR,KACL,GAAA,EACiB;IAEjB,GAAA,GAAM,GAAA,IAAA,aAAA,GAAA,IAAW,GAAA,EAAI;IAErB,OAAO;QAAA;;KAAA,GAIL,GAAA;QAAA;;;;;KAAA,GAQA,EAAA,EAA6B,IAAA,EAAW,OAAA,EAA8B;YACpE,MAAM,QAAA,GAAmD,GAAA,CAAK,GAAA,CAAI,IAAI,CAAA;YACtE,IAAI,QAAA,EAAU;gBACZ,QAAA,CAAS,IAAA,CAAK,OAAO,CAAA;YACvB,CAAA,MAAO;gBACL,GAAA,CAAK,GAAA,CAAI,IAAA,EAAM;oBAAC,OAAO;iBAA2C,CAAA;YACpE;QACF,CAAA;QAAA;;;;;;KAAA,GASA,GAAA,EAA8B,IAAA,EAAW,OAAA,EAA+B;YACtE,MAAM,QAAA,GAAmD,GAAA,CAAK,GAAA,CAAI,IAAI,CAAA;YACtE,IAAI,QAAA,EAAU;gBACZ,IAAI,OAAA,EAAS;oBACX,QAAA,CAAS,MAAA,CAAO,QAAA,CAAS,OAAA,CAAQ,OAAO,CAAA,KAAM,GAAG,CAAC,CAAA;gBACpD,CAAA,MAAO;oBACL,GAAA,CAAK,GAAA,CAAI,IAAA,EAAM,EAAE,CAAA;gBACnB;YACF;QACF,CAAA;QAAA;;;;;;;;;KAAA,GAYA,IAAA,EAA+B,IAAA,EAAW,GAAA,EAAmB;YAC3D,IAAI,QAAA,GAAW,GAAA,CAAK,GAAA,CAAI,IAAI,CAAA;YAC5B,IAAI,QAAA,EAAU;gBACX,QAAA,CAAoD,KAAA,EAAM,CAAE,GAAA,CAAI,CAAA,OAAA,KAAW;oBAC1E,OAAA,CAAQ,GAAI,CAAA;gBACd,CAAC,CAAA;YACH;YAEA,QAAA,GAAW,GAAA,CAAK,GAAA,CAAI,GAAG,CAAA;YACvB,IAAI,QAAA,EAAU;gBACX,QAAA,CAA8C,KAAA,EAAM,CAAE,GAAA,CAAI,CAAA,OAAA,KAAW;oBACpE,OAAA,CAAQ,MAAM,GAAI,CAAA;gBACpB,CAAC,CAAA;YACH;QACF;IAAA,CACF;AACF;;ACvGO,IAAK,cAAA,GAAA,aAAA,GAAA,CAAA,CAAAA,eAAAA,KAAL;IACLA,eAAAA,CAAA,eAAA,CAAA,GAAgB,cAAA;IAChBA,eAAAA,CAAA,eAAA,CAAA,GAAgB,cAAA;IAChBA,eAAAA,CAAA,eAAA,CAAA,GAAgB,aAAA;IAHN,OAAAA,eAAAA;AAAA,CAAA,EAAA,cAAA,IAAA,CAAA,CAAA;AAMZ,IAAM,QAAQ,IAAA,EAAK;AAGZ,SAAS,YAAA,CAAa,IAAA,EAA2B,MAAA,EAA4B;IAClF,KAAA,CAAM,EAAA,CAAG,MAAM,MAAM,CAAA;AACvB;AAGO,SAAS,WAAA,CAAY,IAAA,EAA2B,IAAA,EAAqB;IAE1E,YAAA,CAAa,MAAM;QACjB,KAAA,CAAM,IAAA,CAAK,MAAM,IAAI,CAAA;IACvB,CAAC,CAAA;AACH"}},
    {"offset": {"line": 9343, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-2AU5ZHBL.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/_vendored/ai_v6/dist/chunk-7D4SUZUM.js","file:///Users/wsz/lifebud/version2/lifebud/node_modules/node_modules/.pnpm/%40vercel%2Boidc%403.0.5/node_modules/%40vercel/oidc/dist/token-error.js"],"sourcesContent":["var __create = Object.create;\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getProtoOf = Object.getPrototypeOf;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __require = /* @__PURE__ */ ((x) => typeof require !== \"undefined\" ? require : typeof Proxy !== \"undefined\" ? new Proxy(x, {\n  get: (a, b) => (typeof require !== \"undefined\" ? require : a)[b]\n}) : x)(function(x) {\n  if (typeof require !== \"undefined\") return require.apply(this, arguments);\n  throw Error('Dynamic require of \"' + x + '\" is not supported');\n});\nvar __commonJS = (cb, mod) => function __require2() {\n  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\n  // If the importer is in node compatibility mode or this is not an ESM\n  // file that has been converted to a CommonJS file using a Babel-\n  // compatible transform (i.e. \"__esModule\" has not been set), then set\n  // \"default\" to the CommonJS \"module.exports\" for node compatibility.\n  isNodeMode || !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\n  mod\n));\n\nexport { __commonJS, __require, __toESM };\n//# sourceMappingURL=chunk-7D4SUZUM.js.map\n//# sourceMappingURL=chunk-7D4SUZUM.js.map","\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_error_exports = {};\n__export(token_error_exports, {\n  VercelOidcTokenError: () => VercelOidcTokenError\n});\nmodule.exports = __toCommonJS(token_error_exports);\nclass VercelOidcTokenError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"VercelOidcTokenError\";\n    this.cause = cause;\n  }\n  toString() {\n    if (this.cause) {\n      return `${this.name}: ${this.message}: ${this.cause}`;\n    }\n    return `${this.name}: ${this.message}`;\n  }\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  VercelOidcTokenError\n});\n"],"names":["__require","__require2","__defProp","__getOwnPropDesc","__getOwnPropNames","__hasOwnProp","__copyProps"],"mappings":"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"}},
    {"offset": {"line": 9442, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-RYYO3WBT.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tool-loop-agent/utils.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tool-loop-agent/tool-loop-processor.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/tool-loop-agent/index.ts"],"sourcesContent":["import { ToolLoopAgent } from '@internal/ai-v6';\nimport type { ToolLoopAgentSettings } from '@internal/ai-v6';\n\n/**\n * Shape of a ToolLoopAgent-like object for runtime extraction.\n * We use this looser type because TypeScript's structural typing doesn't work\n * well with private properties across different package declarations.\n */\nexport interface ToolLoopAgentLike {\n  readonly id?: string;\n  readonly version?: string;\n  // The settings property is private in ToolLoopAgent but accessible at runtime\n  // We don't declare it here since we access it via type casting\n}\n\nexport function isToolLoopAgentLike(obj: any): obj is ToolLoopAgentLike {\n  if (!obj) return false;\n  if (obj instanceof ToolLoopAgent) return true;\n  return (\n    'version' in obj &&\n    typeof obj.version === 'string' &&\n    (obj.version === 'agent-v1' || obj.version.startsWith('agent-v'))\n  );\n}\n\n/**\n * Extracts the settings from a ToolLoopAgent instance.\n * ToolLoopAgent.settings is private in TypeScript but accessible at runtime.\n */\nexport function getSettings(agent: ToolLoopAgentLike): ToolLoopAgentSettings<any, any, any> {\n  const settings = (agent as unknown as { settings: ToolLoopAgentSettings<any, any, any> }).settings;\n  if (!settings) {\n    throw new Error('Could not extract settings from ToolLoopAgent. The agent may be from an incompatible version.');\n  }\n  return settings;\n}\n","import type {\n  ToolLoopAgent,\n  AgentCallParameters,\n  ModelMessage,\n  StepResult,\n  ToolLoopAgentSettings,\n} from '@internal/ai-v6';\nimport { isSupportedLanguageModel } from '../agent';\nimport type { AgentExecutionOptions, AgentInstructions } from '../agent';\nimport { resolveModelConfig } from '../llm/model/resolve-model';\nimport type { MastraLanguageModel } from '../llm/model/shared.types';\nimport type { ProcessInputStepArgs, ProcessInputStepResult, Processor } from '../processors';\nimport { getSettings as getToolLoopAgentSettings } from './utils';\nimport type { ToolLoopAgentLike } from './utils';\n\ntype PrepareCallInput = AgentCallParameters<never> &\n  Pick<\n    ToolLoopAgentSettings<never, any, any>,\n    | 'model'\n    | 'tools'\n    | 'maxOutputTokens'\n    | 'temperature'\n    | 'topP'\n    | 'topK'\n    | 'presencePenalty'\n    | 'frequencyPenalty'\n    | 'stopSequences'\n    | 'seed'\n    | 'headers'\n    | 'instructions'\n    | 'stopWhen'\n    | 'experimental_telemetry'\n    | 'activeTools'\n    | 'providerOptions'\n    | 'experimental_context'\n    | 'experimental_download'\n  >;\n\nexport class ToolLoopAgentProcessor implements Processor<'tool-loop-agent-processor'> {\n  readonly id = 'tool-loop-agent-processor';\n  readonly name = 'ToolLoop to Mastra Agent Processor';\n\n  private agent: ToolLoopAgentLike;\n  private settings: ToolLoopAgentSettings<any, any, any>;\n  private prepareCallResult?: Awaited<ReturnType<NonNullable<ToolLoopAgentSettings<any, any, any>['prepareCall']>>>;\n\n  constructor(agent: ToolLoopAgentLike) {\n    this.agent = agent;\n    this.settings = getToolLoopAgentSettings(agent);\n  }\n\n  public getAgentConfig() {\n    const tools = 'tools' in this.agent ? (this.agent as ToolLoopAgent).tools : undefined;\n\n    // Build default options from ToolLoopAgent config params\n    const defaultOptions: Omit<AgentExecutionOptions<unknown>, 'abortSignal'> = {};\n\n    // AgentExecutionOptions\n    if (this.settings.toolChoice) {\n      defaultOptions.toolChoice = this.settings.toolChoice;\n    }\n    if (this.settings.providerOptions) {\n      defaultOptions.providerOptions = this.settings.providerOptions;\n    }\n    // AgentExecutionOptions[\"modelSettings\"]\n    if (this.settings.temperature !== undefined) {\n      defaultOptions.modelSettings = {\n        ...(defaultOptions.modelSettings ?? {}),\n        temperature: this.settings.temperature,\n      };\n    }\n    if (this.settings.topP !== undefined) {\n      defaultOptions.modelSettings = { ...(defaultOptions.modelSettings ?? {}), topP: this.settings.topP };\n    }\n    if (this.settings.topK !== undefined) {\n      defaultOptions.modelSettings = { ...(defaultOptions.modelSettings ?? {}), topK: this.settings.topK };\n    }\n    if (this.settings.seed !== undefined) {\n      defaultOptions.modelSettings = { ...(defaultOptions.modelSettings ?? {}), seed: this.settings.seed };\n    }\n    if (this.settings.maxOutputTokens !== undefined) {\n      defaultOptions.modelSettings = {\n        ...(defaultOptions.modelSettings ?? {}),\n        maxOutputTokens: this.settings.maxOutputTokens,\n      };\n    }\n    if (this.settings.presencePenalty !== undefined) {\n      defaultOptions.modelSettings = {\n        ...(defaultOptions.modelSettings ?? {}),\n        presencePenalty: this.settings.presencePenalty,\n      };\n    }\n    if (this.settings.frequencyPenalty !== undefined) {\n      defaultOptions.modelSettings = {\n        ...(defaultOptions.modelSettings ?? {}),\n        frequencyPenalty: this.settings.frequencyPenalty,\n      };\n    }\n    if (this.settings.stopSequences !== undefined) {\n      defaultOptions.modelSettings = {\n        ...(defaultOptions.modelSettings ?? {}),\n        stopSequences: this.settings.stopSequences,\n      };\n    }\n    if (this.settings.stopWhen) {\n      // TODO: The callback signatures differ (Types of parameters stepResult and event are incompatible)\n      defaultOptions.stopWhen = this.settings.stopWhen as any;\n    }\n    if (this.settings.onStepFinish) {\n      // TODO: The callback signatures differ (Types of parameters stepResult and event are incompatible)\n      defaultOptions.onStepFinish = this.settings.onStepFinish as any;\n    }\n    if (this.settings.onFinish) {\n      // TODO: The callback signatures differ (Types of parameters 'event' and 'event' are incompatible)\n      defaultOptions.onFinish = this.settings.onFinish as any;\n    }\n\n    return {\n      id: this.settings.id,\n      name: this.settings.id,\n      instructions: (this.settings.instructions as AgentInstructions) ?? '',\n      model: this.settings.model,\n      tools,\n      maxRetries: this.settings.maxRetries,\n      defaultOptions: Object.keys(defaultOptions).length > 0 ? defaultOptions : undefined,\n    };\n  }\n\n  /**\n   * Maps prepareCall or prepareStep result to ProcessInputStepResult.\n   * Both hooks return similar structures that can override model, tools, activeTools, etc.\n   */\n  private mapToProcessInputStepResult(\n    result: Awaited<ReturnType<NonNullable<ToolLoopAgentSettings<any, any, any>['prepareCall']>>> | undefined,\n  ): ProcessInputStepResult {\n    if (!result) {\n      return {};\n    }\n\n    const stepResult: ProcessInputStepResult = {};\n\n    // Map model (both prepareCall and prepareStep can return this)\n    if (result.model) {\n      stepResult.model = result.model;\n    }\n\n    // Map tools (prepareCall can return this)\n    if ('tools' in result && result.tools) {\n      stepResult.tools = result.tools as Record<string, unknown>;\n    }\n\n    // Map toolChoice (prepareStep can return this)\n    if ('toolChoice' in result && result.toolChoice !== undefined) {\n      stepResult.toolChoice = result.toolChoice as ProcessInputStepResult['toolChoice'];\n    }\n\n    // Map activeTools (both can return this)\n    if (result.activeTools) {\n      stepResult.activeTools = result.activeTools as string[];\n    }\n\n    // Map providerOptions (prepareCall can return this)\n    if ('providerOptions' in result && result.providerOptions) {\n      stepResult.providerOptions = result.providerOptions;\n    }\n\n    // Map model settings (prepareCall can return individual settings)\n    const modelSettings: ProcessInputStepResult['modelSettings'] = {};\n    if ('temperature' in result && result.temperature !== undefined) {\n      modelSettings.temperature = result.temperature;\n    }\n    if ('topP' in result && result.topP !== undefined) {\n      modelSettings.topP = result.topP;\n    }\n    if ('topK' in result && result.topK !== undefined) {\n      modelSettings.topK = result.topK;\n    }\n    if ('maxOutputTokens' in result && result.maxOutputTokens !== undefined) {\n      modelSettings.maxOutputTokens = result.maxOutputTokens;\n    }\n    if ('presencePenalty' in result && result.presencePenalty !== undefined) {\n      modelSettings.presencePenalty = result.presencePenalty;\n    }\n    if ('frequencyPenalty' in result && result.frequencyPenalty !== undefined) {\n      modelSettings.frequencyPenalty = result.frequencyPenalty;\n    }\n    if ('stopSequences' in result && result.stopSequences !== undefined) {\n      modelSettings.stopSequences = result.stopSequences;\n    }\n    if ('seed' in result && result.seed !== undefined) {\n      modelSettings.seed = result.seed;\n    }\n\n    if (Object.keys(modelSettings).length > 0) {\n      stepResult.modelSettings = modelSettings;\n    }\n\n    // Map system/instructions to systemMessages\n    // prepareCall returns 'instructions', prepareStep returns 'system'\n    const systemContent =\n      'instructions' in result ? result.instructions : 'system' in result ? result.system : undefined;\n    if (systemContent) {\n      // Convert to CoreMessageV4 format\n      if (typeof systemContent === 'string') {\n        stepResult.systemMessages = [{ role: 'system', content: systemContent }];\n      } else if (Array.isArray(systemContent)) {\n        stepResult.systemMessages = systemContent.map(msg =>\n          typeof msg === 'string' ? { role: 'system' as const, content: msg } : msg,\n        );\n      } else if (typeof systemContent === 'object' && 'role' in systemContent && 'content' in systemContent) {\n        stepResult.systemMessages = [systemContent as { role: 'system'; content: string }];\n      }\n    }\n\n    // Map messages if prepareStep returns them\n    // Convert AI SDK ModelMessage[] to MastraDBMessage[]\n    if ('messages' in result && result.messages && Array.isArray(result.messages)) {\n      // AI SDK v6 ModelMessage is compatible with MessageListInput at runtime\n      // stepResult.messages = convertMessages(result.messages as any).to('Mastra.V2');\n      stepResult.messages = result.messages as any;\n    }\n\n    return stepResult;\n  }\n\n  private async handlePrepareCall(args: ProcessInputStepArgs) {\n    if (this.settings.prepareCall) {\n      const { model, messages, activeTools, providerOptions, modelSettings, tools } = args;\n      // TODO: This should probably happen in processInput, currently calling in processInputStep if stepNumber === 0\n\n      // Build the prepareCall input object\n      // AI SDK prepareCall expects: AgentCallParameters & Pick<ToolLoopAgentSettings, ...settings>\n      const prepareCallInput: PrepareCallInput = {\n        // TODO: prepareCall expects messages in AI SDK format, we have them in Mastra format\n        messages: messages as unknown as any,\n        model,\n        tools,\n        instructions: this.settings.instructions,\n        stopWhen: this.settings.stopWhen,\n        activeTools,\n        providerOptions,\n\n        // Model settings\n        temperature: modelSettings?.temperature,\n        topP: modelSettings?.topP,\n        topK: modelSettings?.topK,\n        maxOutputTokens: modelSettings?.maxOutputTokens,\n        presencePenalty: modelSettings?.presencePenalty,\n        frequencyPenalty: modelSettings?.frequencyPenalty,\n        stopSequences: modelSettings?.stopSequences,\n        seed: modelSettings?.seed,\n\n        // Experimental options\n        // experimental_telemetry: this.settings.experimental_telemetry,\n        // experimental_context: this.settings.experimental_context,\n        // experimental_download: this.settings.experimental_download,\n      };\n\n      // Call prepareCall and apply any returned overrides\n      const prepareCallResult = await this.settings.prepareCall(prepareCallInput as any); // TODO: types\n      this.prepareCallResult = prepareCallResult;\n    }\n  }\n\n  private async handlePrepareStep(args: ProcessInputStepArgs, currentResult: ProcessInputStepResult) {\n    if (this.settings.prepareStep) {\n      const { messages, steps, stepNumber } = args;\n\n      let model = args.model;\n      if (currentResult.model) {\n        const resolvedModel = await resolveModelConfig(currentResult.model);\n        if (!isSupportedLanguageModel(resolvedModel)) {\n          throw new Error('prepareStep returned an unsupported model version');\n        }\n        model = resolvedModel;\n      }\n\n      // Use the model from currentResult if prepareCall overrode it, otherwise use args.model\n\n      // Note: We pass messages and steps in Mastra format rather than converting to AI SDK format.\n      // This is intentional - most prepareStep callbacks only return overrides and don't inspect\n      // the message content. The type casts handle the format difference at runtime.\n      const prepareStepInputArgs: {\n        /**\n         * The steps that have been executed so far.\n         */\n        steps: Array<StepResult<NoInfer<any>>>;\n        /**\n         * The number of the step that is being executed.\n         */\n        stepNumber: number;\n        /**\n         * The model instance that is being used for this step.\n         */\n        model: MastraLanguageModel;\n        /**\n         * The messages that will be sent to the model for the current step.\n         * Note: These are in Mastra format (MastraDBMessage[]), not AI SDK ModelMessage format.\n         */\n        messages: Array<ModelMessage>;\n        /**\n         * The context passed via the experimental_context setting (experimental).\n         */\n        experimental_context: unknown;\n      } = {\n        model,\n        // Messages are in Mastra format (MastraDBMessage[])\n        messages: messages as any,\n        // Steps may have minor type differences in usage properties (inputTokenDetails/outputTokenDetails)\n        steps: steps as any,\n        stepNumber,\n        experimental_context: undefined,\n      };\n\n      const prepareStepResult = await this.settings.prepareStep(prepareStepInputArgs);\n      return prepareStepResult;\n    }\n  }\n\n  async processInputStep(args: ProcessInputStepArgs): Promise<ProcessInputStepResult | undefined | void> {\n    const { stepNumber } = args;\n\n    if (stepNumber === 0 && this.settings.prepareCall) {\n      await this.handlePrepareCall(args);\n    }\n\n    let result: ProcessInputStepResult = {};\n\n    // Apply prepareCall result (only on step 0, already called above)\n    if (this.prepareCallResult) {\n      const mappedResult = this.mapToProcessInputStepResult(this.prepareCallResult);\n      if (Object.keys(mappedResult).length > 0) {\n        result = { ...result, ...mappedResult };\n      }\n    }\n\n    // Apply prepareStep result (called on every step)\n    // Pass the current result so prepareStep sees any overrides from prepareCall\n    if (this.settings.prepareStep) {\n      const prepareStepResult = await this.handlePrepareStep(args, result);\n      if (prepareStepResult) {\n        const mappedResult = this.mapToProcessInputStepResult(prepareStepResult as any);\n        // prepareStep overrides prepareCall for this step\n        result = { ...result, ...mappedResult };\n      }\n    }\n\n    return result;\n  }\n}\n","import { generateId } from '@internal/ai-sdk-v5';\nimport { Agent } from '../agent';\nimport { ToolLoopAgentProcessor } from './tool-loop-processor';\nimport type { ToolLoopAgentLike } from './utils';\nexport { type ToolLoopAgentLike, isToolLoopAgentLike, getSettings } from './utils';\n\n/**\n * Converts an AI SDK v6 ToolLoopAgent instance into a Mastra Agent.\n *\n * This enables users to create a ToolLoopAgent using AI SDK's API\n * while gaining access to Mastra features like memory, processors, scorers, and observability.\n *\n * @example\n * ```typescript\n * import { ToolLoopAgent, tool } from 'ai';\n * import { openai } from '@ai-sdk/openai';\n * import { toolLoopAgentToMastraAgent } from '@mastra/core/tool-loop-agent';\n *\n * const toolLoopAgent = new ToolLoopAgent({\n *   id: 'weather-agent',\n *   model: openai('gpt-4o'),\n *   instructions: 'You are a helpful weather assistant.',\n *   tools: { weather: weatherTool },\n *   temperature: 0.7,\n * });\n *\n * const mastraAgent = toolLoopAgentToMastraAgent(toolLoopAgent);\n *\n * const result = await mastraAgent.generate({ prompt: 'What is the weather in NYC?' });\n * ```\n *\n * @param agent - The ToolLoopAgent instance\n * @param options - Optional name fallback since Mastra Agent requires id/name but ToolLoopAgent doesn't\n * @returns A Mastra Agent instance\n */\nexport function toolLoopAgentToMastraAgent(agent: ToolLoopAgentLike, options?: { fallbackName?: string }) {\n  const processor = new ToolLoopAgentProcessor(agent);\n  const agentConfig = processor.getAgentConfig();\n  const id = agentConfig.id || options?.fallbackName || `tool-loop-agent-${generateId()}`;\n\n  return new Agent({\n    ...agentConfig,\n    id,\n    name: agentConfig.name || id,\n    inputProcessors: [processor],\n  });\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9733, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-NCNYUGXD.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/mastra/hooks.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/evals/run/scorerAccumulator.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/evals/run/index.ts"],"sourcesContent":["import pMap from 'p-map';\nimport { ErrorCategory, ErrorDomain, MastraError } from '../error';\nimport { saveScorePayloadSchema } from '../evals';\nimport type { ScoringHookInput } from '../evals/types';\nimport type { Mastra } from '../mastra';\nimport type { MastraStorage } from '../storage';\n\nexport function createOnScorerHook(mastra: Mastra) {\n  return async (hookData: ScoringHookInput) => {\n    const storage = mastra.getStorage();\n\n    if (!storage) {\n      mastra.getLogger()?.warn('Storage not found, skipping score validation and saving');\n      return;\n    }\n\n    const entityId = hookData.entity.id as string;\n    const entityType = hookData.entityType;\n    const scorer = hookData.scorer;\n    const scorerId = scorer.id as string;\n\n    if (!scorerId) {\n      mastra.getLogger()?.warn('Scorer ID not found, skipping score validation and saving');\n      return;\n    }\n\n    try {\n      const scorerToUse = await findScorer(mastra, entityId, entityType, scorerId);\n\n      if (!scorerToUse) {\n        throw new MastraError({\n          id: 'MASTRA_SCORER_NOT_FOUND',\n          domain: ErrorDomain.MASTRA,\n          category: ErrorCategory.USER,\n          text: `Scorer with ID ${scorerId} not found`,\n        });\n      }\n\n      let input = hookData.input;\n      let output = hookData.output;\n\n      const { structuredOutput, ...rest } = hookData;\n\n      const runResult = await scorerToUse.scorer.run({\n        ...rest,\n        input,\n        output,\n      });\n\n      let spanId;\n      let traceId;\n      const currentSpan = hookData.tracingContext?.currentSpan;\n      if (currentSpan && currentSpan.isValid) {\n        spanId = currentSpan.id;\n        traceId = currentSpan.traceId;\n      }\n\n      const payload = {\n        ...rest,\n        ...runResult,\n        entityId,\n        scorerId: scorerId,\n        spanId,\n        traceId,\n        metadata: {\n          structuredOutput: !!structuredOutput,\n        },\n      };\n      await validateAndSaveScore(storage, payload);\n\n      if (currentSpan && spanId && traceId) {\n        await pMap(\n          currentSpan.observabilityInstance.getExporters(),\n          async exporter => {\n            if (exporter.addScoreToTrace) {\n              try {\n                await exporter.addScoreToTrace({\n                  traceId: traceId,\n                  spanId: spanId,\n                  score: runResult.score as number,\n                  reason: runResult.reason as string,\n                  scorerName: scorerToUse.scorer.id,\n                  metadata: {\n                    ...(currentSpan.metadata ?? {}),\n                  },\n                });\n              } catch (error) {\n                // Log error but don't fail the hook if exporter fails\n                mastra.getLogger()?.error(`Failed to add score to trace via exporter: ${error}`);\n              }\n            }\n          },\n          { concurrency: 3 },\n        );\n      }\n    } catch (error) {\n      const mastraError = new MastraError(\n        {\n          id: 'MASTRA_SCORER_FAILED_TO_RUN_HOOK',\n          domain: ErrorDomain.SCORER,\n          category: ErrorCategory.USER,\n          details: {\n            scorerId,\n            entityId,\n            entityType,\n          },\n        },\n        error,\n      );\n\n      mastra.getLogger()?.trackException(mastraError);\n      mastra.getLogger()?.error(mastraError.toString());\n    }\n  };\n}\n\nexport async function validateAndSaveScore(storage: MastraStorage, payload: unknown) {\n  const scoresStore = await storage.getStore('scores');\n  if (!scoresStore) {\n    throw new MastraError({\n      id: 'MASTRA_SCORES_STORAGE_NOT_AVAILABLE',\n      domain: ErrorDomain.STORAGE,\n      category: ErrorCategory.SYSTEM,\n      text: 'Scores storage domain is not available',\n    });\n  }\n  const payloadToSave = saveScorePayloadSchema.parse(payload);\n  await scoresStore.saveScore(payloadToSave);\n}\n\nasync function findScorer(mastra: Mastra, entityId: string, entityType: string, scorerId: string) {\n  let scorerToUse;\n  if (entityType === 'AGENT') {\n    const scorers = await mastra.getAgentById(entityId).listScorers();\n    for (const [_, scorer] of Object.entries(scorers)) {\n      if (scorer.scorer.id === scorerId) {\n        scorerToUse = scorer;\n        break;\n      }\n    }\n  } else if (entityType === 'WORKFLOW') {\n    const scorers = await mastra.getWorkflowById(entityId).listScorers();\n    for (const [_, scorer] of Object.entries(scorers)) {\n      if (scorer.scorer.id === scorerId) {\n        scorerToUse = scorer;\n        break;\n      }\n    }\n  }\n\n  // Fallback to mastra-registered scorer\n  if (!scorerToUse) {\n    const mastraRegisteredScorer = mastra.getScorerById(scorerId);\n    scorerToUse = mastraRegisteredScorer ? { scorer: mastraRegisteredScorer } : undefined;\n  }\n\n  return scorerToUse;\n}\n","export class ScoreAccumulator {\n  private flatScores: Record<string, number[]> = {};\n  private workflowScores: Record<string, number[]> = {};\n  private stepScores: Record<string, Record<string, number[]>> = {};\n\n  addScores(scorerResults: Record<string, any>) {\n    const isTargetWorkflowAndHasStepScores = 'steps' in scorerResults;\n    if (isTargetWorkflowAndHasStepScores) {\n      this.addNestedScores(scorerResults);\n    } else {\n      this.addFlatScores(scorerResults);\n    }\n  }\n\n  private addFlatScores(scorerResults: Record<string, any>) {\n    for (const [scorerName, result] of Object.entries(scorerResults)) {\n      if (!this.flatScores[scorerName]) {\n        this.flatScores[scorerName] = [];\n      }\n      this.flatScores[scorerName].push((result as { score: number }).score);\n    }\n  }\n\n  private addNestedScores(scorerResults: Record<string, any>) {\n    if ('workflow' in scorerResults && scorerResults.workflow) {\n      for (const [scorerName, result] of Object.entries(scorerResults.workflow)) {\n        if (!this.workflowScores[scorerName]) {\n          this.workflowScores[scorerName] = [];\n        }\n        this.workflowScores[scorerName].push((result as { score: number }).score);\n      }\n    }\n\n    if ('steps' in scorerResults && scorerResults.steps) {\n      for (const [stepId, stepResults] of Object.entries(scorerResults.steps)) {\n        if (!this.stepScores[stepId]) {\n          this.stepScores[stepId] = {};\n        }\n        for (const [scorerName, result] of Object.entries(stepResults as Record<string, any>)) {\n          if (!this.stepScores[stepId][scorerName]) {\n            this.stepScores[stepId][scorerName] = [];\n          }\n          this.stepScores[stepId][scorerName].push((result as { score: number }).score);\n        }\n      }\n    }\n  }\n\n  addStepScores(stepScorerResults: Record<string, Record<string, any>>) {\n    for (const [stepId, stepResults] of Object.entries(stepScorerResults)) {\n      if (!this.stepScores[stepId]) {\n        this.stepScores[stepId] = {};\n      }\n      for (const [scorerName, result] of Object.entries(stepResults)) {\n        if (!this.stepScores[stepId][scorerName]) {\n          this.stepScores[stepId][scorerName] = [];\n        }\n        this.stepScores[stepId][scorerName].push((result as { score: number }).score);\n      }\n    }\n  }\n\n  getAverageScores(): Record<string, any> {\n    const result: Record<string, any> = {};\n\n    for (const [scorerName, scoreArray] of Object.entries(this.flatScores)) {\n      result[scorerName] = this.getAverageScore(scoreArray);\n    }\n\n    // Add workflow scores\n    if (Object.keys(this.workflowScores).length > 0) {\n      result.workflow = {};\n      for (const [scorerName, scoreArray] of Object.entries(this.workflowScores)) {\n        result.workflow[scorerName] = this.getAverageScore(scoreArray);\n      }\n    }\n\n    if (Object.keys(this.stepScores).length > 0) {\n      result.steps = {};\n      for (const [stepId, stepScorers] of Object.entries(this.stepScores)) {\n        result.steps[stepId] = {};\n        for (const [scorerName, scoreArray] of Object.entries(stepScorers)) {\n          result.steps[stepId][scorerName] = this.getAverageScore(scoreArray);\n        }\n      }\n    }\n\n    return result;\n  }\n\n  private getAverageScore(scoreArray: number[]): number {\n    if (scoreArray.length > 0) {\n      return scoreArray.reduce((a, b) => a + b, 0) / scoreArray.length;\n    } else {\n      return 0;\n    }\n  }\n}\n","import type { CoreMessage } from '@internal/ai-sdk-v4';\nimport type { Agent, AiMessageType, UIMessageWithMetadata } from '../../agent';\nimport { isSupportedLanguageModel } from '../../agent';\nimport { MastraError } from '../../error';\nimport { validateAndSaveScore } from '../../mastra/hooks';\nimport type { TracingContext } from '../../observability';\nimport type { RequestContext } from '../../request-context';\nimport { Workflow } from '../../workflows';\nimport type { WorkflowResult, StepResult } from '../../workflows';\nimport type { MastraScorer } from '../base';\nimport { ScoreAccumulator } from './scorerAccumulator';\n\ntype RunEvalsDataItem<TTarget = unknown> = {\n  input: TTarget extends Workflow<any, any>\n    ? any\n    : TTarget extends Agent\n      ? string | string[] | CoreMessage[] | AiMessageType[] | UIMessageWithMetadata[]\n      : unknown;\n  groundTruth?: any;\n  requestContext?: RequestContext;\n  tracingContext?: TracingContext;\n};\n\ntype WorkflowScorerConfig = {\n  workflow?: MastraScorer<any, any, any, any>[];\n  steps?: Record<string, MastraScorer<any, any, any, any>[]>;\n};\n\ntype RunEvalsResult = {\n  scores: Record<string, any>;\n  summary: {\n    totalItems: number;\n  };\n};\n\n// Agent with scorers array\nexport function runEvals<TAgent extends Agent>(config: {\n  data: RunEvalsDataItem<TAgent>[];\n  scorers: MastraScorer<any, any, any, any>[];\n  target: TAgent;\n  onItemComplete?: (params: {\n    item: RunEvalsDataItem<TAgent>;\n    targetResult: ReturnType<Agent['generate']>;\n    scorerResults: Record<string, any>; // Flat structure: { scorerName: result }\n  }) => void | Promise<void>;\n  concurrency?: number;\n}): Promise<RunEvalsResult>;\n\n// Workflow with scorers array\nexport function runEvals<TWorkflow extends Workflow<any, any, any, any, any, any, any>>(config: {\n  data: RunEvalsDataItem<TWorkflow>[];\n  scorers: MastraScorer<any, any, any, any>[];\n  target: TWorkflow;\n  onItemComplete?: (params: {\n    item: RunEvalsDataItem<TWorkflow>;\n    targetResult: WorkflowResult<any, any, any, any>;\n    scorerResults: Record<string, any>; // Flat structure: { scorerName: result }\n  }) => void | Promise<void>;\n  concurrency?: number;\n}): Promise<RunEvalsResult>;\n\n// Workflow with workflow configuration\nexport function runEvals<TWorkflow extends Workflow<any, any, any, any, any, any, any>>(config: {\n  data: RunEvalsDataItem<TWorkflow>[];\n  scorers: WorkflowScorerConfig;\n  target: TWorkflow;\n  onItemComplete?: (params: {\n    item: RunEvalsDataItem<TWorkflow>;\n    targetResult: WorkflowResult<any, any, any, any>;\n    scorerResults: {\n      workflow?: Record<string, any>;\n      steps?: Record<string, Record<string, any>>;\n    };\n  }) => void | Promise<void>;\n  concurrency?: number;\n}): Promise<RunEvalsResult>;\nexport async function runEvals(config: {\n  data: RunEvalsDataItem<any>[];\n  scorers: MastraScorer<any, any, any, any>[] | WorkflowScorerConfig;\n  target: Agent | Workflow;\n  onItemComplete?: (params: {\n    item: RunEvalsDataItem<any>;\n    targetResult: any;\n    scorerResults: any;\n  }) => void | Promise<void>;\n  concurrency?: number;\n}): Promise<RunEvalsResult> {\n  const { data, scorers, target, onItemComplete, concurrency = 1 } = config;\n\n  validateEvalsInputs(data, scorers, target);\n\n  let totalItems = 0;\n  const scoreAccumulator = new ScoreAccumulator();\n\n  // Get storage from target's Mastra instance if available\n  // Agent uses getMastraInstance(), Workflow uses .mastra getter\n  const mastra = (target as any).getMastraInstance?.() || (target as any).mastra;\n  const storage = mastra?.getStorage();\n\n  const pMap = (await import('p-map')).default;\n  await pMap(\n    data,\n    async (item: RunEvalsDataItem<any>) => {\n      const targetResult = await executeTarget(target, item);\n      const scorerResults = await runScorers(scorers, targetResult, item);\n      scoreAccumulator.addScores(scorerResults);\n\n      // Save scores to storage if available\n      if (storage) {\n        await saveScoresToStorage({\n          storage,\n          scorerResults,\n          target,\n          item,\n          mastra,\n        });\n      }\n\n      if (onItemComplete) {\n        await onItemComplete({\n          item,\n          targetResult: targetResult as any,\n          scorerResults: scorerResults as any,\n        });\n      }\n\n      totalItems++;\n    },\n    { concurrency },\n  );\n\n  return {\n    scores: scoreAccumulator.getAverageScores(),\n    summary: {\n      totalItems,\n    },\n  };\n}\n\nfunction isWorkflow(target: Agent | Workflow): target is Workflow {\n  return target instanceof Workflow;\n}\n\nfunction isWorkflowScorerConfig(scorers: any): scorers is WorkflowScorerConfig {\n  return typeof scorers === 'object' && !Array.isArray(scorers) && ('workflow' in scorers || 'steps' in scorers);\n}\n\nfunction validateEvalsInputs(\n  data: RunEvalsDataItem<any>[],\n  scorers: MastraScorer<any, any, any, any>[] | WorkflowScorerConfig,\n  target: Agent | Workflow,\n): void {\n  if (data.length === 0) {\n    throw new MastraError({\n      domain: 'SCORER',\n      id: 'RUN_EXPERIMENT_FAILED_NO_DATA_PROVIDED',\n      category: 'USER',\n      text: 'Failed to run experiment: Data array is empty',\n    });\n  }\n\n  for (let i = 0; i < data.length; i++) {\n    const item = data[i];\n    if (!item || typeof item !== 'object' || !('input' in item)) {\n      throw new MastraError({\n        domain: 'SCORER',\n        id: 'INVALID_DATA_ITEM',\n        category: 'USER',\n        text: `Invalid data item at index ${i}: must have 'input' properties`,\n      });\n    }\n  }\n\n  // Validate scorers\n  if (Array.isArray(scorers)) {\n    if (scorers.length === 0) {\n      throw new MastraError({\n        domain: 'SCORER',\n        id: 'NO_SCORERS_PROVIDED',\n        category: 'USER',\n        text: 'At least one scorer must be provided',\n      });\n    }\n  } else if (isWorkflow(target) && isWorkflowScorerConfig(scorers)) {\n    const hasScorers =\n      (scorers.workflow && scorers.workflow.length > 0) || (scorers.steps && Object.keys(scorers.steps).length > 0);\n\n    if (!hasScorers) {\n      throw new MastraError({\n        domain: 'SCORER',\n        id: 'NO_SCORERS_PROVIDED',\n        category: 'USER',\n        text: 'At least one workflow or step scorer must be provided',\n      });\n    }\n  } else if (!isWorkflow(target) && !Array.isArray(scorers)) {\n    throw new MastraError({\n      domain: 'SCORER',\n      id: 'INVALID_AGENT_SCORERS',\n      category: 'USER',\n      text: 'Agent scorers must be an array of scorers',\n    });\n  }\n}\n\nasync function executeTarget(target: Agent | Workflow, item: RunEvalsDataItem<any>) {\n  try {\n    if (isWorkflow(target)) {\n      return await executeWorkflow(target, item);\n    } else {\n      return await executeAgent(target, item);\n    }\n  } catch (error) {\n    throw new MastraError(\n      {\n        domain: 'SCORER',\n        id: 'RUN_EXPERIMENT_TARGET_FAILED_TO_GENERATE_RESULT',\n        category: 'USER',\n        text: 'Failed to run experiment: Error generating result from target',\n        details: {\n          item: JSON.stringify(item),\n        },\n      },\n      error,\n    );\n  }\n}\n\nasync function executeWorkflow(target: Workflow, item: RunEvalsDataItem<any>) {\n  const run = await target.createRun({ disableScorers: true });\n  const workflowResult = await run.start({\n    inputData: item.input,\n    requestContext: item.requestContext,\n  });\n\n  return {\n    scoringData: {\n      input: item.input,\n      output: workflowResult.status === 'success' ? workflowResult.result : undefined,\n      stepResults: workflowResult.steps as Record<string, StepResult<any, any, any, any>>,\n    },\n  };\n}\n\nasync function executeAgent(agent: Agent, item: RunEvalsDataItem<any>) {\n  const model = await agent.getModel();\n  if (isSupportedLanguageModel(model)) {\n    return await agent.generate(item.input as any, {\n      scorers: {},\n      returnScorerData: true,\n      requestContext: item.requestContext,\n    });\n  } else {\n    return await agent.generateLegacy(item.input as any, {\n      scorers: {},\n      returnScorerData: true,\n      requestContext: item.requestContext,\n    });\n  }\n}\n\nasync function runScorers(\n  scorers: MastraScorer<any, any, any, any>[] | WorkflowScorerConfig,\n  targetResult: any,\n  item: RunEvalsDataItem<any>,\n): Promise<Record<string, any>> {\n  const scorerResults: Record<string, any> = {};\n\n  if (Array.isArray(scorers)) {\n    for (const scorer of scorers) {\n      try {\n        const score = await scorer.run({\n          input: targetResult.scoringData?.input,\n          output: targetResult.scoringData?.output,\n          groundTruth: item.groundTruth,\n          requestContext: item.requestContext,\n          tracingContext: item.tracingContext,\n        });\n\n        scorerResults[scorer.id] = score;\n      } catch (error) {\n        throw new MastraError(\n          {\n            domain: 'SCORER',\n            id: 'RUN_EXPERIMENT_SCORER_FAILED_TO_SCORE_RESULT',\n            category: 'USER',\n            text: `Failed to run experiment: Error running scorer ${scorer.id}`,\n            details: {\n              scorerId: scorer.id,\n              item: JSON.stringify(item),\n            },\n          },\n          error,\n        );\n      }\n    }\n  } else {\n    // Handle workflow scorer config\n    if (scorers.workflow) {\n      const workflowScorerResults: Record<string, any> = {};\n      for (const scorer of scorers.workflow) {\n        const score = await scorer.run({\n          input: targetResult.scoringData.input,\n          output: targetResult.scoringData.output,\n          groundTruth: item.groundTruth,\n          requestContext: item.requestContext,\n          tracingContext: item.tracingContext,\n        });\n        workflowScorerResults[scorer.id] = score;\n      }\n      if (Object.keys(workflowScorerResults).length > 0) {\n        scorerResults.workflow = workflowScorerResults;\n      }\n    }\n\n    if (scorers.steps) {\n      const stepScorerResults: Record<string, any> = {};\n      for (const [stepId, stepScorers] of Object.entries(scorers.steps)) {\n        const stepResult = targetResult.scoringData.stepResults?.[stepId];\n        if (stepResult?.status === 'success' && stepResult.payload && stepResult.output) {\n          const stepResults: Record<string, any> = {};\n          for (const scorer of stepScorers) {\n            try {\n              const score = await scorer.run({\n                input: stepResult.payload,\n                output: stepResult.output,\n                groundTruth: item.groundTruth,\n                requestContext: item.requestContext,\n                tracingContext: item.tracingContext,\n              });\n              stepResults[scorer.id] = score;\n            } catch (error) {\n              throw new MastraError(\n                {\n                  domain: 'SCORER',\n                  id: 'RUN_EXPERIMENT_SCORER_FAILED_TO_SCORE_STEP_RESULT',\n                  category: 'USER',\n                  text: `Failed to run experiment: Error running scorer ${scorer.id} on step ${stepId}`,\n                  details: {\n                    scorerId: scorer.id,\n                    stepId,\n                  },\n                },\n                error,\n              );\n            }\n          }\n          if (Object.keys(stepResults).length > 0) {\n            stepScorerResults[stepId] = stepResults;\n          }\n        }\n      }\n      if (Object.keys(stepScorerResults).length > 0) {\n        scorerResults.steps = stepScorerResults;\n      }\n    }\n  }\n\n  return scorerResults;\n}\n\n/**\n * Saves scorer results to storage when running evaluations.\n * This makes scores visible in Studio's observability section.\n */\nasync function saveScoresToStorage({\n  storage,\n  scorerResults,\n  target,\n  item,\n  mastra,\n}: {\n  storage: any;\n  scorerResults: Record<string, any>;\n  target: Agent | Workflow;\n  item: RunEvalsDataItem<any>;\n  mastra: any;\n}): Promise<void> {\n  const entityId = target.id;\n  const entityType = isWorkflow(target) ? 'WORKFLOW' : 'AGENT';\n\n  // Handle flat scorer results (for agents or workflow-level scorers)\n  if (Array.isArray(scorerResults) || !('workflow' in scorerResults && 'steps' in scorerResults)) {\n    for (const [scorerId, scoreResult] of Object.entries(scorerResults)) {\n      if (scoreResult && typeof scoreResult === 'object' && 'score' in scoreResult) {\n        await saveSingleScore({\n          storage,\n          scoreResult,\n          scorerId,\n          entityId,\n          entityType,\n          mastra,\n          target,\n          item,\n        });\n      }\n    }\n  } else {\n    // Handle workflow scorer config with workflow and step scorers\n    if (scorerResults.workflow) {\n      for (const [scorerId, scoreResult] of Object.entries(scorerResults.workflow)) {\n        if (scoreResult && typeof scoreResult === 'object' && 'score' in scoreResult) {\n          await saveSingleScore({\n            storage,\n            scoreResult,\n            scorerId,\n            entityId,\n            entityType: 'WORKFLOW',\n            mastra,\n            target,\n            item,\n          });\n        }\n      }\n    }\n\n    if (scorerResults.steps) {\n      for (const [stepId, stepScorers] of Object.entries(scorerResults.steps)) {\n        for (const [scorerId, scoreResult] of Object.entries(stepScorers as Record<string, any>)) {\n          if (scoreResult && typeof scoreResult === 'object' && 'score' in scoreResult) {\n            await saveSingleScore({\n              storage,\n              scoreResult,\n              scorerId,\n              entityId: stepId,\n              entityType: 'STEP',\n              mastra,\n              target,\n              item,\n            });\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Saves a single scorer result to storage\n */\nasync function saveSingleScore({\n  storage,\n  scoreResult,\n  scorerId,\n  entityId,\n  entityType,\n  mastra,\n  target,\n  item,\n}: {\n  storage: any;\n  scoreResult: any;\n  scorerId: string;\n  entityId: string;\n  entityType: string;\n  mastra: any;\n  target: Agent | Workflow;\n  item: RunEvalsDataItem<any>;\n}): Promise<void> {\n  try {\n    // Get scorer information\n    let scorer = mastra?.getScorerById?.(scorerId);\n\n    if (!scorer) {\n      // Try to get from target's scorers\n      const targetScorers = await (target as any).listScorers?.();\n      if (targetScorers) {\n        for (const [_, scorerEntry] of Object.entries(targetScorers)) {\n          if ((scorerEntry as any).scorer?.id === scorerId) {\n            scorer = (scorerEntry as any).scorer;\n            break;\n          }\n        }\n      }\n    }\n\n    // Extract tracing context if available\n    let traceId: string | undefined;\n    let spanId: string | undefined;\n    if (item.tracingContext?.currentSpan && item.tracingContext.currentSpan.isValid) {\n      spanId = item.tracingContext.currentSpan.id;\n      traceId = item.tracingContext.currentSpan.traceId;\n    }\n\n    // Build additional context with groundTruth if available\n    const additionalContext: Record<string, any> = {};\n    if (item.groundTruth !== undefined) {\n      additionalContext.groundTruth = item.groundTruth;\n    }\n\n    const payload = {\n      ...scoreResult,\n      scorerId,\n      entityId,\n      entityType,\n      source: 'TEST' as const,\n      scorer: {\n        id: scorer?.id || scorerId,\n        name: scorer?.name || scorerId,\n        description: scorer?.description || '',\n        type: scorer?.type || 'unknown',\n      },\n      entity: {\n        id: target.id,\n        name: (target as any).name || target.id,\n      },\n      // Include requestContext from item\n      requestContext: item.requestContext ? Object.fromEntries(item.requestContext.entries()) : undefined,\n      // Include additionalContext with groundTruth\n      additionalContext: Object.keys(additionalContext).length > 0 ? additionalContext : undefined,\n      // Include tracing information\n      traceId,\n      spanId,\n    };\n\n    await validateAndSaveScore(storage, payload);\n  } catch (error) {\n    // Log error but don't fail the evaluation\n    mastra?.getLogger?.()?.warn?.(`Failed to save score for scorer ${scorerId}:`, error);\n  }\n}\n"],"names":["pMap"],"mappings":"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"}},
    {"offset": {"line": 10308, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-PSCMWPLC.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/logger/multi-logger.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/logger/noop-logger.ts","file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/logger/transport.ts"],"sourcesContent":["import type { MastraError } from '../error';\nimport type { LogLevel } from './constants';\nimport type { IMastraLogger } from './logger';\nimport type { LoggerTransport } from './transport';\n\nexport class MultiLogger implements IMastraLogger {\n  private loggers: IMastraLogger[];\n\n  constructor(loggers: IMastraLogger[]) {\n    this.loggers = loggers;\n  }\n\n  debug(message: string, ...args: any[]): void {\n    this.loggers.forEach(logger => logger.debug(message, ...args));\n  }\n\n  info(message: string, ...args: any[]): void {\n    this.loggers.forEach(logger => logger.info(message, ...args));\n  }\n\n  warn(message: string, ...args: any[]): void {\n    this.loggers.forEach(logger => logger.warn(message, ...args));\n  }\n\n  error(message: string, ...args: any[]): void {\n    this.loggers.forEach(logger => logger.error(message, ...args));\n  }\n\n  trackException(error: MastraError): void {\n    this.loggers.forEach(logger => logger.trackException(error));\n  }\n\n  getTransports(): Map<string, LoggerTransport> {\n    const transports: [string, LoggerTransport][] = [];\n    this.loggers.forEach(logger => transports.push(...logger.getTransports().entries()));\n    return new Map(transports);\n  }\n\n  async listLogs(\n    transportId: string,\n    params?: {\n      fromDate?: Date;\n      toDate?: Date;\n      logLevel?: LogLevel;\n      filters?: Record<string, any>;\n      returnPaginationResults?: boolean;\n      page?: number;\n      perPage?: number;\n    },\n  ) {\n    for (const logger of this.loggers) {\n      const logs = await logger.listLogs(transportId, params);\n      if (logs.total > 0) {\n        return logs;\n      }\n    }\n\n    return { logs: [], total: 0, page: params?.page ?? 1, perPage: params?.perPage ?? 100, hasMore: false };\n  }\n\n  async listLogsByRunId(args: {\n    transportId: string;\n    runId: string;\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    page?: number;\n    perPage?: number;\n  }) {\n    for (const logger of this.loggers) {\n      const logs = await logger.listLogsByRunId(args);\n      if (logs.total > 0) {\n        return logs;\n      }\n    }\n\n    return { logs: [], total: 0, page: args.page ?? 1, perPage: args.perPage ?? 100, hasMore: false };\n  }\n}\n","import type { IMastraLogger } from './logger';\n\nexport const noopLogger = {\n  debug: () => {},\n  info: () => {},\n  warn: () => {},\n  error: () => {},\n  cleanup: async () => {},\n  getTransports: () => new Map(),\n  trackException: () => {},\n  listLogs: async () => ({ logs: [], total: 0, page: 1, perPage: 100, hasMore: false }),\n  listLogsByRunId: async () => ({ logs: [], total: 0, page: 1, perPage: 100, hasMore: false }),\n} as IMastraLogger;\n","import { Transform } from 'node:stream';\nimport type { LogLevel } from './constants';\n\nexport interface BaseLogMessage {\n  runId?: string;\n  msg: string;\n  level: LogLevel;\n  time: Date;\n  pid: number;\n  hostname: string;\n  name: string;\n}\n\nexport abstract class LoggerTransport extends Transform {\n  constructor(opts: any = {}) {\n    super({ ...opts, objectMode: true });\n  }\n\n  async listLogsByRunId(_args: {\n    runId: string;\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    page?: number;\n    perPage?: number;\n  }): Promise<{\n    logs: BaseLogMessage[];\n    total: number;\n    page: number;\n    perPage: number;\n    hasMore: boolean;\n  }> {\n    return { logs: [], total: 0, page: _args?.page ?? 1, perPage: _args?.perPage ?? 100, hasMore: false };\n  }\n  async listLogs(_args?: {\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    returnPaginationResults?: boolean;\n    page?: number;\n    perPage?: number;\n  }): Promise<{\n    logs: BaseLogMessage[];\n    total: number;\n    page: number;\n    perPage: number;\n    hasMore: boolean;\n  }> {\n    return { logs: [], total: 0, page: _args?.page ?? 1, perPage: _args?.perPage ?? 100, hasMore: false };\n  }\n}\n\nexport const createCustomTransport = (\n  stream: Transform,\n  listLogs?: LoggerTransport['listLogs'],\n  listLogsByRunId?: LoggerTransport['listLogsByRunId'],\n) => {\n  let transport = stream as LoggerTransport;\n  if (listLogs) {\n    transport.listLogs = listLogs;\n  }\n  if (listLogsByRunId) {\n    transport.listLogsByRunId = listLogsByRunId;\n  }\n  return transport as LoggerTransport;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10444, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-52NRCLCF.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/mastra/index.ts"],"sourcesContent":["import { randomUUID } from 'node:crypto';\nimport { Agent } from '../agent';\nimport type { BundlerConfig } from '../bundler/types';\nimport { InMemoryServerCache } from '../cache';\nimport type { MastraServerCache } from '../cache';\nimport type { MastraDeployer } from '../deployer';\nimport { MastraError, ErrorDomain, ErrorCategory } from '../error';\nimport type { MastraScorer, MastraScorers, ScoringSamplingConfig } from '../evals';\nimport { EventEmitterPubSub } from '../events/event-emitter';\nimport type { PubSub } from '../events/pubsub';\nimport type { Event } from '../events/types';\nimport { AvailableHooks, registerHook } from '../hooks';\nimport type { MastraModelGateway } from '../llm/model/gateways';\nimport { LogLevel, noopLogger, ConsoleLogger } from '../logger';\nimport type { IMastraLogger } from '../logger';\nimport type { MCPServerBase } from '../mcp';\nimport type { MastraMemory } from '../memory';\nimport type { ObservabilityEntrypoint } from '../observability';\nimport { NoOpObservability } from '../observability';\nimport type { Processor } from '../processors';\nimport type { MastraServerBase } from '../server/base';\nimport type { Middleware, ServerConfig } from '../server/types';\nimport type { MastraStorage, WorkflowRuns, StorageAgentType, StorageScorerConfig } from '../storage';\nimport { augmentWithInit } from '../storage/storageWithInit';\nimport type { ToolLoopAgentLike } from '../tool-loop-agent';\nimport { isToolLoopAgentLike, toolLoopAgentToMastraAgent } from '../tool-loop-agent';\nimport type { ToolAction } from '../tools';\nimport type { MastraTTS } from '../tts';\nimport type { MastraIdGenerator, IdGeneratorContext } from '../types';\nimport type { MastraVector } from '../vector';\nimport type { Workflow } from '../workflows';\nimport { WorkflowEventProcessor } from '../workflows/evented/workflow-event-processor';\nimport { createOnScorerHook } from './hooks';\n\n/**\n * Creates an error for when a null/undefined value is passed to an add* method.\n * This commonly occurs when config is spread ({ ...config }) and the original\n * object had getters or non-enumerable properties.\n */\nfunction createUndefinedPrimitiveError(\n  type: 'agent' | 'tool' | 'processor' | 'vector' | 'scorer' | 'workflow' | 'mcp-server' | 'gateway' | 'memory',\n  value: null | undefined,\n  key?: string,\n): MastraError {\n  const typeLabel = type === 'mcp-server' ? 'MCP server' : type;\n  const errorId = `MASTRA_ADD_${type.toUpperCase().replace('-', '_')}_UNDEFINED` as Uppercase<string>;\n  return new MastraError({\n    id: errorId,\n    domain: ErrorDomain.MASTRA,\n    category: ErrorCategory.USER,\n    text: `Cannot add ${typeLabel}: ${typeLabel} is ${value === null ? 'null' : 'undefined'}. This may occur if config was spread ({ ...config }) and the original object had getters or non-enumerable properties.`,\n    details: { status: 400, ...(key && { key }) },\n  });\n}\n\n/**\n * Configuration interface for initializing a Mastra instance.\n *\n * The Config interface defines all the optional components that can be registered\n * with a Mastra instance, including agents, workflows, storage, logging, and more.\n *\n * @template TAgents - Record of agent instances keyed by their names\n * @template TWorkflows - Record of workflow instances\n * @template TVectors - Record of vector store instances\n * @template TTTS - Record of text-to-speech instances\n * @template TLogger - Logger implementation type\n * @template TVNextNetworks - Record of agent network instances\n * @template TMCPServers - Record of MCP server instances\n * @template TScorers - Record of scorer instances\n *\n * @example\n * ```typescript\n * const mastra = new Mastra({\n *   agents: {\n *     weatherAgent: new Agent({\n *       id: 'weather-agent',\n *       name: 'Weather Agent',\n *       instructions: 'You help with weather information',\n *       model: 'openai/gpt-5'\n *     })\n *   },\n *   storage: new LibSQLStore({ id: 'mastra-storage', url: ':memory:' }),\n *   logger: new PinoLogger({ name: 'MyApp' })\n * });\n * ```\n */\nexport interface Config<\n  TAgents extends Record<string, Agent<any>> = Record<string, Agent<any>>,\n  TWorkflows extends Record<string, Workflow<any, any, any, any, any, any, any>> = Record<\n    string,\n    Workflow<any, any, any, any, any, any, any>\n  >,\n  TVectors extends Record<string, MastraVector<any>> = Record<string, MastraVector<any>>,\n  TTTS extends Record<string, MastraTTS> = Record<string, MastraTTS>,\n  TLogger extends IMastraLogger = IMastraLogger,\n  TMCPServers extends Record<string, MCPServerBase<any>> = Record<string, MCPServerBase<any>>,\n  TScorers extends Record<string, MastraScorer<any, any, any, any>> = Record<string, MastraScorer<any, any, any, any>>,\n  TTools extends Record<string, ToolAction<any, any, any, any, any, any>> = Record<\n    string,\n    ToolAction<any, any, any, any, any, any>\n  >,\n  TProcessors extends Record<string, Processor<any>> = Record<string, Processor<any>>,\n  TMemory extends Record<string, MastraMemory> = Record<string, MastraMemory>,\n> {\n  /**\n   * Agents are autonomous systems that can make decisions and take actions.\n   * Accepts both Mastra Agent instances and AI SDK v6 ToolLoopAgent instances.\n   * ToolLoopAgent instances are automatically converted to Mastra Agents.\n   */\n  agents?: { [K in keyof TAgents]: TAgents[K] | ToolLoopAgentLike };\n\n  /**\n   * Storage provider for persisting data, conversation history, and workflow state.\n   * Required for agent memory and workflow persistence.\n   */\n  storage?: MastraStorage;\n\n  /**\n   * Vector stores for semantic search and retrieval-augmented generation (RAG).\n   * Used for storing and querying embeddings.\n   */\n  vectors?: TVectors;\n\n  /**\n   * Logger implementation for application logging and debugging.\n   * Set to `false` to disable logging entirely.\n   * @default `INFO` level in development, `WARN` in production.\n   */\n  logger?: TLogger | false;\n\n  /**\n   * Workflows provide type-safe, composable task execution with built-in error handling.\n   */\n  workflows?: TWorkflows;\n\n  /**\n   * Text-to-speech providers for voice synthesis capabilities.\n   */\n  tts?: TTTS;\n\n  /**\n   * Observability entrypoint for tracking model interactions and tracing.\n   * Pass an instance of the Observability class from @mastra/observability.\n   *\n   * @example\n   * ```typescript\n   * import { Observability, DefaultExporter, CloudExporter, SensitiveDataFilter } from '@mastra/observability';\n   *\n   * new Mastra({\n   *   observability: new Observability({\n   *     configs: {\n   *       default: {\n   *         serviceName: 'mastra',\n   *         exporters: [new DefaultExporter(), new CloudExporter()],\n   *         spanOutputProcessors: [new SensitiveDataFilter()],\n   *       },\n   *     },\n   *   })\n   * })\n   * ```\n   */\n  observability?: ObservabilityEntrypoint;\n\n  /**\n   * Custom ID generator function for creating unique identifiers.\n   * @default `crypto.randomUUID()`\n   */\n  idGenerator?: MastraIdGenerator;\n\n  /**\n   * Deployment provider for publishing applications to cloud platforms.\n   */\n  deployer?: MastraDeployer;\n\n  /**\n   * Server configuration for HTTP endpoints and middleware.\n   */\n  server?: ServerConfig;\n\n  /**\n   * MCP servers provide tools and resources that agents can use.\n   */\n  mcpServers?: TMCPServers;\n\n  /**\n   * Bundler configuration for packaging and deployment.\n   */\n  bundler?: BundlerConfig;\n\n  /**\n   * Pub/sub system for event-driven communication between components.\n   * @default EventEmitterPubSub\n   */\n  pubsub?: PubSub;\n\n  /**\n   * Scorers help assess the quality of agent responses and workflow outputs.\n   */\n  scorers?: TScorers;\n\n  /**\n   * Tools are reusable functions that agents can use to interact with external systems.\n   */\n  tools?: TTools;\n\n  /**\n   * Processors transform inputs and outputs for agents and workflows.\n   */\n  processors?: TProcessors;\n\n  /**\n   * Memory instances that can be referenced by stored agents.\n   * Keys are used to look up memory instances when resolving stored agent configurations.\n   */\n  memory?: TMemory;\n\n  /**\n   * Custom model router gateways for accessing LLM providers.\n   * Gateways handle provider-specific authentication, URL construction, and model resolution.\n   */\n  gateways?: Record<string, MastraModelGateway>;\n\n  /**\n   * Event handlers for custom application events.\n   * Maps event topics to handler functions for event-driven architectures.\n   */\n  events?: {\n    [topic: string]: (\n      event: Event,\n      cb?: () => Promise<void>,\n    ) => Promise<void> | ((event: Event, cb?: () => Promise<void>) => Promise<void>)[];\n  };\n}\n\n/**\n * The central orchestrator for Mastra applications, managing agents, workflows, storage, logging, observability, and more.\n *\n * The `Mastra` class serves as the main entry point and registry for all components in a Mastra application.\n * It coordinates the interaction between agents, workflows, storage systems, and other services.\n\n * @template TAgents - Record of agent instances keyed by their names\n * @template TWorkflows - Record of modern workflow instances\n * @template TVectors - Record of vector store instances for semantic search and RAG\n * @template TTTS - Record of text-to-speech provider instances\n * @template TLogger - Logger implementation type for application logging\n * @template TVNextNetworks - Record of next-generation agent network instances\n * @template TMCPServers - Record of Model Context Protocol server instances\n * @template TScorers - Record of evaluation scorer instances for measuring AI performance\n *\n * @example\n * ```typescript\n * const mastra = new Mastra({\n *   agents: {\n *     weatherAgent: new Agent({\n *       id: 'weather-agent',\n *       name: 'Weather Agent',\n *       instructions: 'You provide weather information',\n *       model: 'openai/gpt-5',\n *       tools: [getWeatherTool]\n *     })\n *   },\n *   workflows: { dataWorkflow },\n *   storage: new LibSQLStore({ id: 'mastra-storage', url: ':memory:' }),\n *   logger: new PinoLogger({ name: 'MyApp' })\n * });\n * ```\n */\nexport class Mastra<\n  TAgents extends Record<string, Agent<any>> = Record<string, Agent<any>>,\n  TWorkflows extends Record<string, Workflow<any, any, any, any, any, any, any>> = Record<\n    string,\n    Workflow<any, any, any, any, any, any, any>\n  >,\n  TVectors extends Record<string, MastraVector<any>> = Record<string, MastraVector<any>>,\n  TTTS extends Record<string, MastraTTS> = Record<string, MastraTTS>,\n  TLogger extends IMastraLogger = IMastraLogger,\n  TMCPServers extends Record<string, MCPServerBase<any>> = Record<string, MCPServerBase<any>>,\n  TScorers extends Record<string, MastraScorer<any, any, any, any>> = Record<string, MastraScorer<any, any, any, any>>,\n  TTools extends Record<string, ToolAction<any, any, any, any, any, any>> = Record<\n    string,\n    ToolAction<any, any, any, any, any, any>\n  >,\n  TProcessors extends Record<string, Processor<any>> = Record<string, Processor<any>>,\n  TMemory extends Record<string, MastraMemory> = Record<string, MastraMemory>,\n> {\n  #vectors?: TVectors;\n  #agents: TAgents;\n  #logger: TLogger;\n  #workflows: TWorkflows;\n  #observability: ObservabilityEntrypoint;\n  #tts?: TTTS;\n  #deployer?: MastraDeployer;\n  #serverMiddleware: Array<{\n    handler: (c: any, next: () => Promise<void>) => Promise<Response | void>;\n    path: string;\n  }> = [];\n\n  #storage?: MastraStorage;\n  #scorers?: TScorers;\n  #tools?: TTools;\n  #processors?: TProcessors;\n  #memory?: TMemory;\n  #server?: ServerConfig;\n  #serverAdapter?: MastraServerBase;\n  #mcpServers?: TMCPServers;\n  #bundler?: BundlerConfig;\n  #idGenerator?: MastraIdGenerator;\n  #pubsub: PubSub;\n  #gateways?: Record<string, MastraModelGateway>;\n  #events: {\n    [topic: string]: ((event: Event, cb?: () => Promise<void>) => Promise<void>)[];\n  } = {};\n  #internalMastraWorkflows: Record<string, Workflow> = {};\n  // This is only used internally for server handlers that require temporary persistence\n  #serverCache: MastraServerCache;\n\n  get pubsub() {\n    return this.#pubsub;\n  }\n\n  /**\n   * Gets the currently configured ID generator function.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   idGenerator: () => `custom-${Date.now()}`\n   * });\n   * const generator = mastra.getIdGenerator();\n   * console.log(generator?.()); // \"custom-1234567890\"\n   * ```\n   */\n  public getIdGenerator() {\n    return this.#idGenerator;\n  }\n\n  /**\n   * Generates a unique identifier using the configured generator or defaults to `crypto.randomUUID()`.\n   *\n   * This method is used internally by Mastra for creating unique IDs for various entities\n   * like workflow runs, agent conversations, and other resources that need unique identification.\n   *\n   * @param context - Optional context information about what type of ID is being generated\n   *                  and where it's being requested from. This allows custom ID generators\n   *                  to create deterministic IDs based on context.\n   *\n   * @throws {MastraError} When the custom ID generator returns an empty string\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const id = mastra.generateId();\n   * console.log(id); // \"550e8400-e29b-41d4-a716-446655440000\"\n   *\n   * // With context for deterministic IDs\n   * const messageId = mastra.generateId({\n   *   idType: 'message',\n   *   source: 'agent',\n   *   threadId: 'thread-123'\n   * });\n   * ```\n   */\n  public generateId(context?: IdGeneratorContext): string {\n    if (this.#idGenerator) {\n      const id = this.#idGenerator(context);\n      if (!id) {\n        const error = new MastraError({\n          id: 'MASTRA_ID_GENERATOR_RETURNED_EMPTY_STRING',\n          domain: ErrorDomain.MASTRA,\n          category: ErrorCategory.USER,\n          text: 'ID generator returned an empty string, which is not allowed',\n        });\n        this.#logger?.trackException(error);\n        throw error;\n      }\n      return id;\n    }\n    return randomUUID();\n  }\n\n  /**\n   * Sets a custom ID generator function for creating unique identifiers.\n   *\n   * The ID generator function will be used by `generateId()` instead of the default\n   * `crypto.randomUUID()`. This is useful for creating application-specific ID formats\n   * or integrating with existing ID generation systems.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * mastra.setIdGenerator(() => `custom-${Date.now()}`);\n   * const id = mastra.generateId();\n   * console.log(id); // \"custom-1234567890\"\n   * ```\n   */\n  public setIdGenerator(idGenerator: MastraIdGenerator) {\n    this.#idGenerator = idGenerator;\n  }\n\n  /**\n   * Creates a new Mastra instance with the provided configuration.\n   *\n   * The constructor initializes all the components specified in the config, sets up\n   * internal systems like logging and observability, and registers components with each other.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     assistant: new Agent({\n   *       id: 'assistant',\n   *       name: 'Assistant',\n   *       instructions: 'You are a helpful assistant',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   },\n   *   storage: new PostgresStore({\n   *     connectionString: process.env.DATABASE_URL\n   *   }),\n   *   logger: new PinoLogger({ name: 'MyApp' }),\n   *   observability: new Observability({\n   *     configs: { default: { serviceName: 'mastra', exporters: [new DefaultExporter()] } },\n   *   }),\n   * });\n   * ```\n   */\n  constructor(\n    config?: Config<TAgents, TWorkflows, TVectors, TTTS, TLogger, TMCPServers, TScorers, TTools, TProcessors, TMemory>,\n  ) {\n    // This is only used internally for server handlers that require temporary persistence\n    this.#serverCache = new InMemoryServerCache();\n\n    if (config?.pubsub) {\n      this.#pubsub = config.pubsub;\n    } else {\n      this.#pubsub = new EventEmitterPubSub();\n    }\n\n    this.#events = {};\n    for (const topic in config?.events ?? {}) {\n      if (!Array.isArray(config?.events?.[topic])) {\n        this.#events[topic] = [config?.events?.[topic] as any];\n      } else {\n        this.#events[topic] = config?.events?.[topic] ?? [];\n      }\n    }\n\n    const workflowEventProcessor = new WorkflowEventProcessor({ mastra: this });\n    const workflowEventCb = async (event: Event, cb?: () => Promise<void>): Promise<void> => {\n      try {\n        await workflowEventProcessor.process(event, cb);\n      } catch (e) {\n        this.getLogger()?.error('Error processing event', e);\n      }\n    };\n    if (this.#events.workflows) {\n      this.#events.workflows.push(workflowEventCb);\n    } else {\n      this.#events.workflows = [workflowEventCb];\n    }\n\n    let logger: TLogger;\n    if (config?.logger === false) {\n      logger = noopLogger as unknown as TLogger;\n    } else {\n      if (config?.logger) {\n        logger = config.logger;\n      } else {\n        const levelOnEnv =\n          process.env.NODE_ENV === 'production' && process.env.MASTRA_DEV !== 'true' ? LogLevel.WARN : LogLevel.INFO;\n        logger = new ConsoleLogger({ name: 'Mastra', level: levelOnEnv }) as unknown as TLogger;\n      }\n    }\n    this.#logger = logger;\n\n    this.#idGenerator = config?.idGenerator;\n\n    let storage = config?.storage;\n\n    if (storage) {\n      storage = augmentWithInit(storage);\n    }\n\n    // Validate and assign observability instance\n    if (config?.observability) {\n      if (typeof config.observability.getDefaultInstance === 'function') {\n        this.#observability = config.observability;\n        // Set logger early\n        this.#observability.setLogger({ logger: this.#logger });\n      } else {\n        this.#logger?.warn(\n          'Observability configuration error: Expected an Observability instance, but received a config object. ' +\n            'Import and instantiate: import { Observability, DefaultExporter } from \"@mastra/observability\"; ' +\n            'then pass: observability: new Observability({ configs: { default: { serviceName: \"mastra\", exporters: [new DefaultExporter()] } } }). ' +\n            'Observability has been disabled.',\n        );\n        this.#observability = new NoOpObservability();\n      }\n    } else {\n      this.#observability = new NoOpObservability();\n    }\n\n    this.#storage = storage;\n\n    // Initialize all primitive storage objects first, we need to do this before adding primitives to avoid circular dependencies\n    this.#vectors = {} as TVectors;\n    this.#mcpServers = {} as TMCPServers;\n    this.#tts = {} as TTTS;\n    this.#agents = {} as TAgents;\n    this.#scorers = {} as TScorers;\n    this.#tools = {} as TTools;\n    this.#processors = {} as TProcessors;\n    this.#memory = {} as TMemory;\n    this.#workflows = {} as TWorkflows;\n    this.#gateways = {} as Record<string, MastraModelGateway>;\n\n    // Now add primitives - order matters for auto-registration\n    // Tools and processors should be added before agents and MCP servers that might use them\n    // Note: We validate each entry to handle cases where config was spread ({ ...config })\n    // which can cause undefined values if the source object had getters or non-enumerable properties\n    if (config?.tools) {\n      Object.entries(config.tools).forEach(([key, tool]) => {\n        if (tool != null) {\n          this.addTool(tool, key);\n        }\n      });\n    }\n\n    if (config?.processors) {\n      Object.entries(config.processors).forEach(([key, processor]) => {\n        if (processor != null) {\n          this.addProcessor(processor, key);\n        }\n      });\n    }\n\n    if (config?.memory) {\n      Object.entries(config.memory).forEach(([key, memory]) => {\n        if (memory != null) {\n          this.addMemory(memory, key);\n        }\n      });\n    }\n\n    if (config?.vectors) {\n      Object.entries(config.vectors).forEach(([key, vector]) => {\n        if (vector != null) {\n          this.addVector(vector, key);\n        }\n      });\n    }\n\n    if (config?.scorers) {\n      Object.entries(config.scorers).forEach(([key, scorer]) => {\n        if (scorer != null) {\n          this.addScorer(scorer, key);\n        }\n      });\n    }\n\n    if (config?.workflows) {\n      Object.entries(config.workflows).forEach(([key, workflow]) => {\n        if (workflow != null) {\n          this.addWorkflow(workflow, key);\n        }\n      });\n    }\n\n    if (config?.gateways) {\n      Object.entries(config.gateways).forEach(([key, gateway]) => {\n        if (gateway != null) {\n          this.addGateway(gateway, key);\n        }\n      });\n    }\n\n    // Add MCP servers and agents last since they might reference other primitives\n    if (config?.mcpServers) {\n      Object.entries(config.mcpServers).forEach(([key, server]) => {\n        if (server != null) {\n          this.addMCPServer(server, key);\n        }\n      });\n    }\n\n    if (config?.agents) {\n      Object.entries(config.agents).forEach(([key, agent]) => {\n        if (agent != null) {\n          this.addAgent(agent, key);\n        }\n      });\n    }\n\n    if (config?.tts) {\n      Object.entries(config.tts).forEach(([key, tts]) => {\n        if (tts != null) {\n          (this.#tts as Record<string, MastraTTS>)[key] = tts;\n        }\n      });\n    }\n\n    if (config?.server) {\n      this.#server = config.server;\n    }\n\n    registerHook(AvailableHooks.ON_SCORER_RUN, createOnScorerHook(this));\n\n    /*\n      Initialize observability with Mastra context (after storage configured)\n    */\n    this.#observability.setMastraContext({ mastra: this });\n\n    this.setLogger({ logger });\n  }\n\n  /**\n   * Retrieves a registered agent by its name.\n   *\n   * @template TAgentName - The specific agent name type from the registered agents\n   * @throws {MastraError} When the agent with the specified name is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     weatherAgent: new Agent({\n   *       id: 'weather-agent',\n   *       name: 'weather-agent',\n   *       instructions: 'You provide weather information',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   * const agent = mastra.getAgent('weatherAgent');\n   * const response = await agent.generate('What is the weather?');\n   * ```\n   */\n  public getAgent<TAgentName extends keyof TAgents>(name: TAgentName): TAgents[TAgentName] {\n    const agent = this.#agents?.[name];\n    if (!agent) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_AGENT_BY_NAME_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Agent with name ${String(name)} not found`,\n        details: {\n          status: 404,\n          agentName: String(name),\n          agents: Object.keys(this.#agents ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return this.#agents[name];\n  }\n\n  /**\n   * Retrieves a registered agent by its unique ID.\n   *\n   * This method searches for an agent using its internal ID property. If no agent\n   * is found with the given ID, it also attempts to find an agent using the ID as\n   * a name.\n   *\n   * @throws {MastraError} When no agent is found with the specified ID\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     assistant: new Agent({\n   *       id: 'assistant',\n   *       name: 'assistant',\n   *       instructions: 'You are a helpful assistant',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   *\n   * const assistant = mastra.getAgent('assistant');\n   * const sameAgent = mastra.getAgentById(assistant.id);\n   * ```\n   */\n  public getAgentById<TAgentName extends keyof TAgents>(id: TAgents[TAgentName]['id']): TAgents[TAgentName] {\n    let agent = Object.values(this.#agents).find(a => a.id === id);\n\n    if (!agent) {\n      try {\n        agent = this.getAgent(id);\n      } catch {\n        // do nothing\n      }\n    }\n\n    if (!agent) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_AGENT_BY_AGENT_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Agent with id ${String(id)} not found`,\n        details: {\n          status: 404,\n          agentId: String(id),\n          agents: Object.keys(this.#agents ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    return agent as TAgents[TAgentName];\n  }\n\n  /**\n   * Returns all registered agents as a record keyed by their names.\n   *\n   * This method provides access to the complete registry of agents, allowing you to\n   * iterate over them, check what agents are available, or perform bulk operations.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: {\n   *     weatherAgent: new Agent({ id: 'weather-agent', name: 'weather', model: 'openai/gpt-4o' }),\n   *     supportAgent: new Agent({ id: 'support-agent', name: 'support', model: 'openai/gpt-4o' })\n   *   }\n   * });\n   *\n   * const allAgents = mastra.listAgents();\n   * console.log(Object.keys(allAgents)); // ['weatherAgent', 'supportAgent']\n   * ```\n   */\n  public listAgents() {\n    return this.#agents;\n  }\n\n  /**\n   * Retrieves a stored agent from the database by its unique identifier.\n   *\n   * By default, returns an executable Agent instance. Set `raw: true` to get\n   * the raw stored configuration data instead.\n   *\n   * @param id - The unique identifier of the stored agent\n   * @param options - Options for the query\n   * @param options.raw - If true, returns raw stored data instead of Agent instance\n   *\n   * @throws {MastraError} When storage is not configured or doesn't support agents\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   storage: new PostgresStore({ connectionString: process.env.DATABASE_URL })\n   * });\n   *\n   * // Get as executable Agent instance (default)\n   * const agent = await mastra.getStoredAgentById('my-agent-id');\n   * if (agent) {\n   *   const response = await agent.generate('Hello!');\n   *   console.log(response.text);\n   * }\n   *\n   * // Get raw stored configuration\n   * const rawConfig = await mastra.getStoredAgentById('my-agent-id', { raw: true });\n   * if (rawConfig) {\n   *   console.log(rawConfig.instructions);\n   * }\n   * ```\n   */\n  public async getStoredAgentById(id: string, options?: { raw?: false }): Promise<Agent | null>;\n  public async getStoredAgentById(id: string, options: { raw: true }): Promise<StorageAgentType | null>;\n  public async getStoredAgentById(id: string, options?: { raw?: boolean }): Promise<Agent | StorageAgentType | null> {\n    const storage = this.#storage;\n\n    if (!storage) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_STORED_AGENT_STORAGE_NOT_CONFIGURED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Storage is not configured',\n        details: { status: 400 },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    const agentsStore = await storage.getStore('agents');\n    if (!agentsStore) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_STORED_AGENT_NOT_SUPPORTED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Agents storage is not available',\n        details: { status: 400 },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    const storedAgent = await agentsStore.getAgentById({ id });\n\n    if (!storedAgent) {\n      return null;\n    }\n\n    if (options?.raw) {\n      return storedAgent;\n    }\n\n    return this.#createAgentFromStoredConfig(storedAgent);\n  }\n\n  /**\n   * Lists all stored agents from the database with optional pagination.\n   *\n   * By default, returns executable Agent instances. Set `raw: true` to get\n   * the raw stored configuration data instead.\n   *\n   * @param args - Options for pagination and output format\n   * @param args.page - Zero-indexed page number (default: 0)\n   * @param args.perPage - Items per page, or false for all (default: 100)\n   * @param args.orderBy - Sort order configuration\n   * @param args.raw - If true, returns raw stored data instead of Agent instances\n   *\n   * @throws {MastraError} When storage is not configured or doesn't support agents\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   storage: new PostgresStore({ connectionString: process.env.DATABASE_URL })\n   * });\n   *\n   * // List as executable Agent instances (default)\n   * const result = await mastra.listStoredAgents();\n   * for (const agent of result.agents) {\n   *   const response = await agent.generate('Hello!');\n   * }\n   *\n   * // List raw stored configurations\n   * const rawResult = await mastra.listStoredAgents({ raw: true });\n   * for (const config of rawResult.agents) {\n   *   console.log(config.instructions, config.createdAt);\n   * }\n   *\n   * // With pagination\n   * const paginated = await mastra.listStoredAgents({\n   *   page: 0,\n   *   perPage: 10,\n   *   orderBy: { field: 'createdAt', direction: 'DESC' }\n   * });\n   * ```\n   */\n  public async listStoredAgents(args?: {\n    page?: number;\n    perPage?: number | false;\n    orderBy?: { field: 'createdAt' | 'updatedAt'; direction: 'ASC' | 'DESC' };\n    raw?: false;\n  }): Promise<{\n    agents: Agent[];\n    total: number;\n    page: number;\n    perPage: number | false;\n    hasMore: boolean;\n  }>;\n  public async listStoredAgents(args: {\n    page?: number;\n    perPage?: number | false;\n    orderBy?: { field: 'createdAt' | 'updatedAt'; direction: 'ASC' | 'DESC' };\n    raw: true;\n  }): Promise<{\n    agents: StorageAgentType[];\n    total: number;\n    page: number;\n    perPage: number | false;\n    hasMore: boolean;\n  }>;\n  public async listStoredAgents(args?: {\n    page?: number;\n    perPage?: number | false;\n    orderBy?: { field: 'createdAt' | 'updatedAt'; direction: 'ASC' | 'DESC' };\n    raw?: boolean;\n  }): Promise<{\n    agents: Agent[] | StorageAgentType[];\n    total: number;\n    page: number;\n    perPage: number | false;\n    hasMore: boolean;\n  }> {\n    const storage = this.#storage;\n\n    if (!storage) {\n      const error = new MastraError({\n        id: 'MASTRA_LIST_STORED_AGENTS_STORAGE_NOT_CONFIGURED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Storage is not configured',\n        details: { status: 400 },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    const agentsStore = await storage.getStore('agents');\n    if (!agentsStore) {\n      const error = new MastraError({\n        id: 'MASTRA_LIST_STORED_AGENTS_NOT_SUPPORTED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Agents storage is not available',\n        details: { status: 400 },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    const result = await agentsStore.listAgents({\n      page: args?.page,\n      perPage: args?.perPage,\n      orderBy: args?.orderBy,\n    });\n\n    if (args?.raw) {\n      return result;\n    }\n\n    // Transform stored configs into Agent instances\n    const agents = result.agents.map(storedAgent => this.#createAgentFromStoredConfig(storedAgent));\n\n    return {\n      agents,\n      total: result.total,\n      page: result.page,\n      perPage: result.perPage,\n      hasMore: result.hasMore,\n    };\n  }\n\n  /**\n   * Creates an Agent instance from a stored agent configuration.\n   * @private\n   */\n  #createAgentFromStoredConfig(storedAgent: StorageAgentType): Agent {\n    // Build model config from stored data\n    // The model field stores { provider, name, ...otherConfig }\n    const modelConfig = storedAgent.model as { provider?: string; name?: string; [key: string]: unknown };\n\n    // Build the model string in \"provider/modelName\" format\n    if (!modelConfig.provider || !modelConfig.name) {\n      throw new MastraError({\n        id: 'MASTRA_STORED_AGENT_INVALID_MODEL',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Stored agent \"${storedAgent.id}\" has invalid model configuration. Both provider and name are required.`,\n        details: { agentId: storedAgent.id, model: JSON.stringify(storedAgent.model) },\n      });\n    }\n\n    // Use model router format: \"provider/modelName\"\n    const model = `${modelConfig.provider}/${modelConfig.name}`;\n\n    // Resolve tools from the stored tool references\n    const tools = this.#resolveStoredTools(storedAgent.tools);\n\n    // Resolve workflows from the stored workflow references\n    const workflows = this.#resolveStoredWorkflows(storedAgent.workflows);\n\n    // Resolve sub-agents from the stored agent references\n    const agents = this.#resolveStoredAgents(storedAgent.agents);\n\n    // Resolve memory from the stored memory reference\n    const memory = this.#resolveStoredMemory(storedAgent.memory);\n\n    // Resolve scorers from the stored scorer references\n    const scorers = this.#resolveStoredScorers(storedAgent.scorers);\n\n    // Create the agent instance\n    const agent = new Agent({\n      id: storedAgent.id,\n      name: storedAgent.name,\n      description: storedAgent.description,\n      instructions: storedAgent.instructions,\n      model,\n      tools,\n      workflows,\n      agents,\n      memory,\n      scorers,\n      defaultOptions: storedAgent.defaultOptions,\n    });\n\n    // Register the agent with Mastra\n    agent.__setLogger(this.#logger);\n    agent.__registerMastra(this);\n    agent.__registerPrimitives({\n      logger: this.getLogger(),\n      storage: this.getStorage(),\n      agents: this.#agents as Record<string, Agent<any>>,\n      tts: this.#tts,\n      vectors: this.#vectors,\n    });\n\n    return agent;\n  }\n\n  /**\n   * Resolves tool references from stored configuration to actual tool instances.\n   * @private\n   */\n  #resolveStoredTools(storedTools?: string[]): Record<string, ToolAction<any, any, any, any, any, any>> {\n    if (!storedTools || storedTools.length === 0) {\n      return {};\n    }\n\n    const resolvedTools: Record<string, ToolAction<any, any, any, any, any, any>> = {};\n    const registeredTools = this.#tools;\n\n    for (const toolKey of storedTools) {\n      // Try to find the tool in registered tools\n      if (registeredTools && registeredTools[toolKey]) {\n        resolvedTools[toolKey] = registeredTools[toolKey];\n      } else {\n        // Tool reference exists but tool is not registered - log warning\n        this.#logger?.warn(`Tool \"${toolKey}\" referenced in stored agent but not registered in Mastra`);\n      }\n    }\n\n    return resolvedTools;\n  }\n\n  /**\n   * Resolves workflow references from stored configuration to actual workflow instances.\n   * @private\n   */\n  #resolveStoredWorkflows(storedWorkflows?: string[]): Record<string, Workflow<any, any, any, any, any, any, any>> {\n    if (!storedWorkflows || storedWorkflows.length === 0) {\n      return {};\n    }\n\n    const resolvedWorkflows: Record<string, Workflow<any, any, any, any, any, any, any>> = {};\n\n    for (const workflowKey of storedWorkflows) {\n      // Try to find the workflow in registered workflows\n      try {\n        const workflow = this.getWorkflow(workflowKey);\n        resolvedWorkflows[workflowKey] = workflow;\n      } catch {\n        // Try by ID\n        try {\n          const workflow = this.getWorkflowById(workflowKey);\n          resolvedWorkflows[workflowKey] = workflow;\n        } catch {\n          this.#logger?.warn(`Workflow \"${workflowKey}\" referenced in stored agent but not registered in Mastra`);\n        }\n      }\n    }\n\n    return resolvedWorkflows;\n  }\n\n  /**\n   * Resolves agent references from stored configuration to actual agent instances.\n   * @private\n   */\n  #resolveStoredAgents(storedAgents?: string[]): Record<string, Agent<any>> {\n    if (!storedAgents || storedAgents.length === 0) {\n      return {};\n    }\n\n    const resolvedAgents: Record<string, Agent<any>> = {};\n\n    for (const agentKey of storedAgents) {\n      // Try to find the agent in registered agents\n      try {\n        const agent = this.getAgent(agentKey as keyof TAgents);\n        resolvedAgents[agentKey] = agent;\n      } catch {\n        // Try by ID\n        try {\n          const agent = this.getAgentById(agentKey as TAgents[keyof TAgents]['id']);\n          resolvedAgents[agentKey] = agent;\n        } catch {\n          this.#logger?.warn(`Agent \"${agentKey}\" referenced in stored agent but not registered in Mastra`);\n        }\n      }\n    }\n\n    return resolvedAgents;\n  }\n\n  /**\n   * Resolves memory reference from stored configuration to actual memory instance.\n   * @private\n   */\n  #resolveStoredMemory(storedMemory?: string): MastraMemory | undefined {\n    if (!storedMemory) {\n      return undefined;\n    }\n\n    // Try by key first\n    try {\n      return this.getMemory(storedMemory as keyof TMemory);\n    } catch {\n      // Try by id\n      try {\n        return this.getMemoryById(storedMemory);\n      } catch {\n        this.#logger?.warn(`Memory \"${storedMemory}\" referenced in stored agent but not registered in Mastra`);\n      }\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Resolves scorer references from stored configuration to actual scorer instances.\n   * @private\n   */\n  #resolveStoredScorers(storedScorers?: Record<string, StorageScorerConfig>): MastraScorers | undefined {\n    if (!storedScorers) {\n      return undefined;\n    }\n\n    const resolvedScorers: MastraScorers = {};\n\n    for (const [scorerKey, scorerConfig] of Object.entries(storedScorers)) {\n      // Try to find the scorer in registered scorers by key\n      try {\n        const scorer = this.getScorer(scorerKey as keyof TScorers);\n        resolvedScorers[scorerKey] = {\n          scorer,\n          sampling: scorerConfig.sampling as ScoringSamplingConfig | undefined,\n        };\n      } catch {\n        // Try by ID\n        try {\n          const scorer = this.getScorerById(scorerKey);\n          resolvedScorers[scorerKey] = {\n            scorer,\n            sampling: scorerConfig.sampling as ScoringSamplingConfig | undefined,\n          };\n        } catch {\n          this.#logger?.warn(`Scorer \"${scorerKey}\" referenced in stored agent but not registered in Mastra`);\n        }\n      }\n    }\n\n    return Object.keys(resolvedScorers).length > 0 ? resolvedScorers : undefined;\n  }\n\n  /**\n   * Adds a new agent to the Mastra instance.\n   *\n   * This method allows dynamic registration of agents after the Mastra instance\n   * has been created. The agent will be initialized with the current logger.\n   *\n   * @throws {MastraError} When an agent with the same key already exists\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const newAgent = new Agent({\n   *   id: 'chat-agent',\n   *   name: 'Chat Assistant',\n   *   model: 'openai/gpt-4o'\n   * });\n   * mastra.addAgent(newAgent); // Uses agent.id as key\n   * // or\n   * mastra.addAgent(newAgent, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addAgent<A extends Agent | ToolLoopAgentLike>(agent: A, key?: string): void {\n    if (!agent) {\n      throw createUndefinedPrimitiveError('agent', agent, key);\n    }\n    let mastraAgent: Agent<any, any, any>;\n    if (isToolLoopAgentLike(agent)) {\n      // Pass the config key as the name if the ToolLoopAgent doesn't have an id\n      mastraAgent = toolLoopAgentToMastraAgent(agent, { fallbackName: key });\n    } else {\n      mastraAgent = agent;\n    }\n    const agentKey = key || mastraAgent.id;\n    const agents = this.#agents as Record<string, Agent<any>>;\n    if (agents[agentKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Agent with key ${agentKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    // Initialize the agent\n    mastraAgent.__setLogger(this.#logger);\n    mastraAgent.__registerMastra(this);\n    mastraAgent.__registerPrimitives({\n      logger: this.getLogger(),\n      storage: this.getStorage(),\n      agents: agents,\n      tts: this.#tts,\n      vectors: this.#vectors,\n    });\n    agents[agentKey] = mastraAgent;\n\n    // Register configured processor workflows from the agent\n    // Use .then() to handle async resolution without blocking the constructor\n    // This excludes memory-derived processors to avoid triggering memory factory functions\n    mastraAgent\n      .getConfiguredProcessorWorkflows()\n      .then(processorWorkflows => {\n        for (const workflow of processorWorkflows) {\n          this.addWorkflow(workflow, workflow.id);\n        }\n      })\n      .catch(err => {\n        this.#logger?.debug(`Failed to register processor workflows for agent ${agentKey}:`, err);\n      });\n  }\n\n  /**\n   * Retrieves a registered vector store by its name.\n   *\n   * @template TVectorName - The specific vector store name type from the registered vectors\n   * @throws {MastraError} When the vector store with the specified name is not found\n   *\n   * @example Using a vector store for semantic search\n   * ```typescript\n   * import { PineconeVector } from '@mastra/pinecone';\n   * import { OpenAIEmbedder } from '@mastra/embedders';\n   *\n   * const mastra = new Mastra({\n   *   vectors: {\n   *     knowledge: new PineconeVector({\n   *       apiKey: process.env.PINECONE_API_KEY,\n   *       indexName: 'knowledge-base',\n   *       embedder: new OpenAIEmbedder({\n   *         apiKey: process.env.OPENAI_API_KEY,\n   *         model: 'text-embedding-3-small'\n   *       })\n   *     }),\n   *     products: new PineconeVector({\n   *       apiKey: process.env.PINECONE_API_KEY,\n   *       indexName: 'product-catalog'\n   *     })\n   *   }\n   * });\n   *\n   * // Get a vector store and perform semantic search\n   * const knowledgeBase = mastra.getVector('knowledge');\n   * const results = await knowledgeBase.query({\n   *   query: 'How to reset password?',\n   *   topK: 5\n   * });\n   *\n   * console.log('Relevant documents:', results);\n   * ```\n   */\n  public getVector<TVectorName extends keyof TVectors>(name: TVectorName): TVectors[TVectorName] {\n    const vector = this.#vectors?.[name];\n    if (!vector) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_VECTOR_BY_NAME_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Vector with name ${String(name)} not found`,\n        details: {\n          status: 404,\n          vectorName: String(name),\n          vectors: Object.keys(this.#vectors ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return vector;\n  }\n\n  /**\n   * Retrieves a specific vector store instance by its ID.\n   *\n   * This method searches for a vector store by its internal ID property.\n   * If not found by ID, it falls back to searching by registration key.\n   *\n   * @throws {MastraError} When the specified vector store is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   vectors: {\n   *     embeddings: chromaVector\n   *   }\n   * });\n   *\n   * const vectorStore = mastra.getVectorById('chroma-123');\n   * ```\n   */\n  public getVectorById<TVectorName extends keyof TVectors>(id: TVectors[TVectorName]['id']): TVectors[TVectorName] {\n    const allVectors = this.#vectors ?? ({} as Record<string, MastraVector>);\n\n    // First try to find by internal ID\n    for (const vector of Object.values(allVectors)) {\n      if (vector.id === id) {\n        return vector as TVectors[TVectorName];\n      }\n    }\n\n    // Fallback to searching by registration key\n    const vectorByKey = allVectors[id];\n    if (vectorByKey) {\n      return vectorByKey as TVectors[TVectorName];\n    }\n\n    const error = new MastraError({\n      id: 'MASTRA_GET_VECTOR_BY_ID_NOT_FOUND',\n      domain: ErrorDomain.MASTRA,\n      category: ErrorCategory.USER,\n      text: `Vector store with id ${id} not found`,\n      details: {\n        status: 404,\n        vectorId: String(id),\n        vectors: Object.keys(allVectors).join(', '),\n      },\n    });\n    this.#logger?.trackException(error);\n    throw error;\n  }\n\n  /**\n   * Returns all registered vector stores as a record keyed by their names.\n   *\n   * @example Listing all vector stores\n   * ```typescript\n   * const mastra = new Mastra({\n   *   vectors: {\n   *     documents: new PineconeVector({ indexName: 'docs' }),\n   *     images: new PineconeVector({ indexName: 'images' }),\n   *     products: new ChromaVector({ collectionName: 'products' })\n   *   }\n   * });\n   *\n   * const allVectors = mastra.getVectors();\n   * console.log(Object.keys(allVectors)); // ['documents', 'images', 'products']\n   *\n   * // Check vector store types and configurations\n   * for (const [name, vectorStore] of Object.entries(allVectors)) {\n   *   console.log(`Vector store ${name}:`, vectorStore.constructor.name);\n   * }\n   * ```\n   */\n  public listVectors(): TVectors | undefined {\n    return this.#vectors;\n  }\n\n  /**\n   * Adds a new vector store to the Mastra instance.\n   *\n   * This method allows dynamic registration of vector stores after the Mastra instance\n   * has been created. The vector store will be initialized with the current logger.\n   *\n   * @throws {MastraError} When a vector store with the same key already exists\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const newVector = new ChromaVector({ id: 'chroma-embeddings' });\n   * mastra.addVector(newVector); // Uses vector.id as key\n   * // or\n   * mastra.addVector(newVector, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addVector<V extends MastraVector>(vector: V, key?: string): void {\n    if (!vector) {\n      throw createUndefinedPrimitiveError('vector', vector, key);\n    }\n    const vectorKey = key || vector.id;\n    const vectors = this.#vectors as Record<string, MastraVector>;\n    if (vectors[vectorKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Vector with key ${vectorKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    // Initialize the vector with the logger\n    vector.__setLogger(this.#logger || this.getLogger());\n    vectors[vectorKey] = vector;\n  }\n\n  /**\n   * @deprecated Use listVectors() instead\n   */\n  public getVectors(): TVectors | undefined {\n    console.warn('getVectors() is deprecated. Use listVectors() instead.');\n    return this.listVectors();\n  }\n\n  /**\n   * Gets the currently configured deployment provider.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   deployer: new VercelDeployer({\n   *     token: process.env.VERCEL_TOKEN,\n   *     projectId: process.env.VERCEL_PROJECT_ID\n   *   })\n   * });\n   *\n   * const deployer = mastra.getDeployer();\n   * if (deployer) {\n   *   await deployer.deploy({\n   *     name: 'my-mastra-app',\n   *     environment: 'production'\n   *   });\n   * }\n   * ```\n   */\n  public getDeployer() {\n    return this.#deployer;\n  }\n\n  /**\n   * Retrieves a registered workflow by its ID.\n   *\n   * @template TWorkflowId - The specific workflow ID type from the registered workflows\n   * @throws {MastraError} When the workflow with the specified ID is not found\n   *\n   * @example Getting and executing a workflow\n   * ```typescript\n   * import { createWorkflow, createStep } from '@mastra/core/workflows';\n   * import { z } from 'zod';\n   *\n   * const processDataWorkflow = createWorkflow({\n   *   name: 'process-data',\n   *   triggerSchema: z.object({ input: z.string() })\n   * })\n   *   .then(validateStep)\n   *   .then(transformStep)\n   *   .then(saveStep)\n   *   .commit();\n   *\n   * const mastra = new Mastra({\n   *   workflows: {\n   *     dataProcessor: processDataWorkflow\n   *   }\n   * });\n   * ```\n   */\n  public getWorkflow<TWorkflowId extends keyof TWorkflows>(\n    id: TWorkflowId,\n    { serialized }: { serialized?: boolean } = {},\n  ): TWorkflows[TWorkflowId] {\n    const workflow = this.#workflows?.[id];\n    if (!workflow) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_WORKFLOW_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Workflow with ID ${String(id)} not found`,\n        details: {\n          status: 404,\n          workflowId: String(id),\n          workflows: Object.keys(this.#workflows ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (serialized) {\n      return { name: workflow.name } as TWorkflows[TWorkflowId];\n    }\n\n    return workflow;\n  }\n\n  __registerInternalWorkflow(workflow: Workflow) {\n    workflow.__registerMastra(this);\n    workflow.__registerPrimitives({\n      logger: this.getLogger(),\n    });\n    this.#internalMastraWorkflows[workflow.id] = workflow;\n  }\n\n  __hasInternalWorkflow(id: string): boolean {\n    return Object.values(this.#internalMastraWorkflows).some(workflow => workflow.id === id);\n  }\n\n  __getInternalWorkflow(id: string): Workflow {\n    const workflow = Object.values(this.#internalMastraWorkflows).find(a => a.id === id);\n    if (!workflow) {\n      throw new MastraError({\n        id: 'MASTRA_GET_INTERNAL_WORKFLOW_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.SYSTEM,\n        text: `Workflow with id ${String(id)} not found`,\n        details: {\n          status: 404,\n          workflowId: String(id),\n        },\n      });\n    }\n\n    return workflow;\n  }\n\n  /**\n   * Retrieves a registered workflow by its unique ID.\n   *\n   * This method searches for a workflow using its internal ID property. If no workflow\n   * is found with the given ID, it also attempts to find a workflow using the ID as\n   * a name.\n   *\n   * @throws {MastraError} When no workflow is found with the specified ID\n   *\n   * @example Finding a workflow by ID\n   * ```typescript\n   * const mastra = new Mastra({\n   *   workflows: {\n   *     dataProcessor: createWorkflow({\n   *       name: 'process-data',\n   *       triggerSchema: z.object({ input: z.string() })\n   *     }).commit()\n   *   }\n   * });\n   *\n   * // Get the workflow's ID\n   * const workflow = mastra.getWorkflow('dataProcessor');\n   * const workflowId = workflow.id;\n   *\n   * // Later, retrieve the workflow by ID\n   * const sameWorkflow = mastra.getWorkflowById(workflowId);\n   * console.log(sameWorkflow.name); // \"process-data\"\n   * ```\n   */\n  public getWorkflowById<TWorkflowName extends keyof TWorkflows>(\n    id: TWorkflows[TWorkflowName]['id'],\n  ): TWorkflows[TWorkflowName] {\n    let workflow = Object.values(this.#workflows).find(a => a.id === id);\n\n    if (!workflow) {\n      try {\n        workflow = this.getWorkflow(id);\n      } catch {\n        // do nothing\n      }\n    }\n\n    if (!workflow) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_WORKFLOW_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Workflow with id ${String(id)} not found`,\n        details: {\n          status: 404,\n          workflowId: String(id),\n          workflows: Object.keys(this.#workflows ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    return workflow as TWorkflows[TWorkflowName];\n  }\n\n  public async listActiveWorkflowRuns(): Promise<WorkflowRuns> {\n    const storage = this.#storage;\n    if (!storage) {\n      this.#logger.debug('Cannot get active workflow runs. Mastra storage is not initialized');\n      return { runs: [], total: 0 };\n    }\n\n    // Get all workflows with default engine type\n    const defaultEngineWorkflows = Object.values(this.#workflows).filter(workflow => workflow.engineType === 'default');\n\n    // Collect all active runs for workflows with default engine type\n    const allRuns: WorkflowRuns['runs'] = [];\n    let allTotal = 0;\n\n    for (const workflow of defaultEngineWorkflows) {\n      const runningRuns = await workflow.listWorkflowRuns({ status: 'running' });\n      const waitingRuns = await workflow.listWorkflowRuns({ status: 'waiting' });\n\n      allRuns.push(...runningRuns.runs, ...waitingRuns.runs);\n      allTotal += runningRuns.total + waitingRuns.total;\n    }\n\n    return {\n      runs: allRuns,\n      total: allTotal,\n    };\n  }\n\n  public async restartAllActiveWorkflowRuns(): Promise<void> {\n    const activeRuns = await this.listActiveWorkflowRuns();\n    if (activeRuns.runs.length > 0) {\n      this.#logger.debug(\n        `Restarting ${activeRuns.runs.length} active workflow run${activeRuns.runs.length > 1 ? 's' : ''}`,\n      );\n    }\n    for (const runSnapshot of activeRuns.runs) {\n      const workflow = this.getWorkflowById(runSnapshot.workflowName);\n      try {\n        const run = await workflow.createRun({ runId: runSnapshot.runId });\n        await run.restart();\n        this.#logger.debug(`Restarted ${runSnapshot.workflowName} workflow run ${runSnapshot.runId}`);\n      } catch (error) {\n        this.#logger.error(`Failed to restart ${runSnapshot.workflowName} workflow run ${runSnapshot.runId}: ${error}`);\n      }\n    }\n  }\n\n  /**\n   * Returns all registered scorers as a record keyed by their IDs.\n   *\n   * @example Listing all scorers\n   * ```typescript\n   * import { HelpfulnessScorer, AccuracyScorer, RelevanceScorer } from '@mastra/scorers';\n   *\n   * const mastra = new Mastra({\n   *   scorers: {\n   *     helpfulness: new HelpfulnessScorer(),\n   *     accuracy: new AccuracyScorer(),\n   *     relevance: new RelevanceScorer()\n   *   }\n   * });\n   *\n   * const allScorers = mastra.listScorers();\n   * console.log(Object.keys(allScorers)); // ['helpfulness', 'accuracy', 'relevance']\n   *\n   * // Check scorer configurations\n   * for (const [id, scorer] of Object.entries(allScorers)) {\n   *   console.log(`Scorer ${id}:`, scorer.id, scorer.name, scorer.description);\n   * }\n   * ```\n   */\n  public listScorers() {\n    return this.#scorers;\n  }\n\n  /**\n   * Adds a new scorer to the Mastra instance.\n   *\n   * This method allows dynamic registration of scorers after the Mastra instance\n   * has been created.\n   *\n   * @throws {MastraError} When a scorer with the same key already exists\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const newScorer = new MastraScorer({\n   *   id: 'quality-scorer',\n   *   name: 'Quality Scorer'\n   * });\n   * mastra.addScorer(newScorer); // Uses scorer.id as key\n   * // or\n   * mastra.addScorer(newScorer, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addScorer<S extends MastraScorer<any, any, any, any>>(scorer: S, key?: string): void {\n    if (!scorer) {\n      throw createUndefinedPrimitiveError('scorer', scorer, key);\n    }\n    const scorerKey = key || scorer.id;\n    const scorers = this.#scorers as Record<string, MastraScorer<any, any, any, any>>;\n    if (scorers[scorerKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Scorer with key ${scorerKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    // Register Mastra instance with scorer to enable custom gateway access\n    scorer.__registerMastra(this);\n\n    scorers[scorerKey] = scorer;\n  }\n\n  /**\n   * Retrieves a registered scorer by its key.\n   *\n   * @template TScorerKey - The specific scorer key type from the registered scorers\n   * @throws {MastraError} When the scorer with the specified key is not found\n   *\n   * @example Getting and using a scorer\n   * ```typescript\n   * import { HelpfulnessScorer, AccuracyScorer } from '@mastra/scorers';\n   *\n   * const mastra = new Mastra({\n   *   scorers: {\n   *     helpfulness: new HelpfulnessScorer({\n   *       model: 'openai/gpt-4o',\n   *       criteria: 'Rate how helpful this response is'\n   *     }),\n   *     accuracy: new AccuracyScorer({\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   *\n   * // Get a specific scorer\n   * const helpfulnessScorer = mastra.getScorer('helpfulness');\n   * const score = await helpfulnessScorer.score({\n   *   input: 'How do I reset my password?',\n   *   output: 'You can reset your password by clicking the forgot password link.',\n   *   expected: 'Detailed password reset instructions'\n   * });\n   *\n   * console.log('Helpfulness score:', score);\n   * ```\n   */\n  public getScorer<TScorerKey extends keyof TScorers>(key: TScorerKey): TScorers[TScorerKey] {\n    const scorer = this.#scorers?.[key];\n    if (!scorer) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_SCORER_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Scorer with ${String(key)} not found`,\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return scorer;\n  }\n\n  /**\n   * Retrieves a registered scorer by its name.\n   *\n   * This method searches through all registered scorers to find one with the specified name.\n   * Unlike `getScorer()` which uses the registration key, this method uses the scorer's\n   * internal name property.\n   *\n   * @throws {MastraError} When no scorer is found with the specified name\n   *\n   * @example Finding a scorer by name\n   * ```typescript\n   * import { HelpfulnessScorer } from '@mastra/scorers';\n   *\n   * const mastra = new Mastra({\n   *   scorers: {\n   *     myHelpfulnessScorer: new HelpfulnessScorer({\n   *       name: 'helpfulness-evaluator',\n   *       model: 'openai/gpt-5'\n   *     })\n   *   }\n   * });\n   *\n   * // Find scorer by its internal name, not the registration key\n   * const scorer = mastra.getScorerById('helpfulness-evaluator');\n   * const score = await scorer.score({\n   *   input: 'question',\n   *   output: 'answer'\n   * });\n   * ```\n   */\n  public getScorerById<TScorerName extends keyof TScorers>(id: TScorers[TScorerName]['id']): TScorers[TScorerName] {\n    for (const [_key, value] of Object.entries(this.#scorers ?? {})) {\n      if (value.id === id || value?.name === id) {\n        return value as TScorers[TScorerName];\n      }\n    }\n\n    const error = new MastraError({\n      id: 'MASTRA_GET_SCORER_BY_ID_NOT_FOUND',\n      domain: ErrorDomain.MASTRA,\n      category: ErrorCategory.USER,\n      text: `Scorer with id ${String(id)} not found`,\n    });\n    this.#logger?.trackException(error);\n    throw error;\n  }\n\n  /**\n   * Retrieves a specific tool by registration key.\n   *\n   * @throws {MastraError} When the specified tool is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   tools: {\n   *     calculator: calculatorTool,\n   *     weather: weatherTool\n   *   }\n   * });\n   *\n   * const tool = mastra.getTool('calculator');\n   * ```\n   */\n  public getTool<TToolName extends keyof TTools>(name: TToolName): TTools[TToolName] {\n    if (!this.#tools || !this.#tools[name]) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_TOOL_BY_NAME_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Tool with name ${String(name)} not found`,\n        details: {\n          status: 404,\n          toolName: String(name),\n          tools: Object.keys(this.#tools ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return this.#tools[name];\n  }\n\n  /**\n   * Retrieves a specific tool by its ID.\n   *\n   * @throws {MastraError} When the specified tool is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   tools: {\n   *     calculator: calculatorTool\n   *   }\n   * });\n   *\n   * const tool = mastra.getToolById('calculator-tool-id');\n   * ```\n   */\n  public getToolById<TToolName extends keyof TTools>(id: TTools[TToolName]['id']): TTools[TToolName] {\n    const allTools = this.#tools;\n\n    if (!allTools) {\n      throw new MastraError({\n        id: 'MASTRA_GET_TOOL_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Tool with id ${id} not found`,\n      });\n    }\n    // First try to find by internal ID\n    for (const tool of Object.values(allTools)) {\n      if (tool.id === id) {\n        return tool as TTools[TToolName];\n      }\n    }\n\n    // Fallback to searching by registration key\n    const toolByKey = allTools[id];\n    if (toolByKey) {\n      return toolByKey as TTools[TToolName];\n    }\n\n    const error = new MastraError({\n      id: 'MASTRA_GET_TOOL_BY_ID_NOT_FOUND',\n      domain: ErrorDomain.MASTRA,\n      category: ErrorCategory.USER,\n      text: `Tool with id ${id} not found`,\n      details: {\n        status: 404,\n        toolId: String(id),\n        tools: Object.keys(allTools).join(', '),\n      },\n    });\n    this.#logger?.trackException(error);\n    throw error;\n  }\n\n  /**\n   * Lists all configured tools.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   tools: {\n   *     calculator: calculatorTool,\n   *     weather: weatherTool\n   *   }\n   * });\n   *\n   * const tools = mastra.listTools();\n   * Object.entries(tools || {}).forEach(([name, tool]) => {\n   *   console.log(`Tool \"${name}\":`, tool.id);\n   * });\n   * ```\n   */\n  public listTools(): TTools | undefined {\n    return this.#tools;\n  }\n\n  /**\n   * Adds a new tool to the Mastra instance.\n   *\n   * This method allows dynamic registration of tools after the Mastra instance\n   * has been created.\n   *\n   * @throws {MastraError} When a tool with the same key already exists\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const newTool = createTool({\n   *   id: 'calculator-tool',\n   *   description: 'Performs calculations'\n   * });\n   * mastra.addTool(newTool); // Uses tool.id as key\n   * // or\n   * mastra.addTool(newTool, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addTool<T extends ToolAction<any, any, any, any>>(tool: T, key?: string): void {\n    if (!tool) {\n      throw createUndefinedPrimitiveError('tool', tool, key);\n    }\n    const toolKey = key || tool.id;\n    const tools = this.#tools as Record<string, ToolAction<any, any, any, any>>;\n    if (tools[toolKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Tool with key ${toolKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    tools[toolKey] = tool;\n  }\n\n  /**\n   * Retrieves a specific processor by registration key.\n   *\n   * @throws {MastraError} When the specified processor is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   processors: {\n   *     validator: validatorProcessor,\n   *     transformer: transformerProcessor\n   *   }\n   * });\n   *\n   * const processor = mastra.getProcessor('validator');\n   * ```\n   */\n  public getProcessor<TProcessorName extends keyof TProcessors>(name: TProcessorName): TProcessors[TProcessorName] {\n    if (!this.#processors || !this.#processors[name]) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_PROCESSOR_BY_NAME_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Processor with name ${String(name)} not found`,\n        details: {\n          status: 404,\n          processorName: String(name),\n          processors: Object.keys(this.#processors ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return this.#processors[name];\n  }\n\n  /**\n   * Retrieves a specific processor by its ID.\n   *\n   * @throws {MastraError} When the specified processor is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   processors: {\n   *     validator: validatorProcessor\n   *   }\n   * });\n   *\n   * const processor = mastra.getProcessorById('validator-processor-id');\n   * ```\n   */\n  public getProcessorById<TProcessorName extends keyof TProcessors>(\n    id: TProcessors[TProcessorName]['id'],\n  ): TProcessors[TProcessorName] {\n    const allProcessors = this.#processors;\n\n    if (!allProcessors) {\n      throw new MastraError({\n        id: 'MASTRA_GET_PROCESSOR_BY_ID_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Processor with id ${id} not found`,\n      });\n    }\n\n    // First try to find by internal ID\n    for (const processor of Object.values(allProcessors)) {\n      if (processor.id === id) {\n        return processor as TProcessors[TProcessorName];\n      }\n    }\n\n    // Fallback to searching by registration key\n    const processorByKey = allProcessors[id];\n    if (processorByKey) {\n      return processorByKey as TProcessors[TProcessorName];\n    }\n\n    const error = new MastraError({\n      id: 'MASTRA_GET_PROCESSOR_BY_ID_NOT_FOUND',\n      domain: ErrorDomain.MASTRA,\n      category: ErrorCategory.USER,\n      text: `Processor with id ${id} not found`,\n      details: {\n        status: 404,\n        processorId: String(id),\n        processors: Object.keys(allProcessors).join(', '),\n      },\n    });\n    this.#logger?.trackException(error);\n    throw error;\n  }\n\n  /**\n   * Lists all configured processors.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   processors: {\n   *     validator: validatorProcessor,\n   *     transformer: transformerProcessor\n   *   }\n   * });\n   *\n   * const processors = mastra.listProcessors();\n   * Object.entries(processors || {}).forEach(([name, processor]) => {\n   *   console.log(`Processor \"${name}\":`, processor.id);\n   * });\n   * ```\n   */\n  public listProcessors(): TProcessors | undefined {\n    return this.#processors;\n  }\n\n  /**\n   * Adds a new processor to the Mastra instance.\n   *\n   * This method allows dynamic registration of processors after the Mastra instance\n   * has been created.\n   *\n   * @throws {MastraError} When a processor with the same key already exists\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const newProcessor = {\n   *   id: 'text-processor',\n   *   processInput: async (messages) => messages\n   * };\n   * mastra.addProcessor(newProcessor); // Uses processor.id as key\n   * // or\n   * mastra.addProcessor(newProcessor, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addProcessor<P extends Processor>(processor: P, key?: string): void {\n    if (!processor) {\n      throw createUndefinedPrimitiveError('processor', processor, key);\n    }\n    const processorKey = key || processor.id;\n    const processors = this.#processors as Record<string, Processor>;\n    if (processors[processorKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Processor with key ${processorKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    processors[processorKey] = processor;\n  }\n\n  /**\n   * Retrieves a registered memory instance by its registration key.\n   *\n   * @throws {MastraError} When the memory instance with the specified key is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   memory: {\n   *     chat: new Memory({ storage })\n   *   }\n   * });\n   *\n   * const chatMemory = mastra.getMemory('chat');\n   * ```\n   */\n  public getMemory<TMemoryName extends keyof TMemory>(name: TMemoryName): TMemory[TMemoryName] {\n    if (!this.#memory || !this.#memory[name]) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_MEMORY_BY_KEY_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Memory with key ${String(name)} not found`,\n        details: {\n          status: 404,\n          memoryKey: String(name),\n          memory: Object.keys(this.#memory ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return this.#memory[name];\n  }\n\n  /**\n   * Retrieves a registered memory instance by its ID.\n   *\n   * Searches through all registered memory instances and returns the one whose ID matches.\n   *\n   * @throws {MastraError} When no memory instance with the specified ID is found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   memory: {\n   *     chat: new Memory({ id: 'chat-memory', storage })\n   *   }\n   * });\n   *\n   * const memory = mastra.getMemoryById('chat-memory');\n   * ```\n   */\n  public getMemoryById(id: string): MastraMemory {\n    const allMemory = this.#memory;\n    if (allMemory) {\n      for (const [, memory] of Object.entries(allMemory)) {\n        if (memory.id === id) {\n          return memory;\n        }\n      }\n    }\n\n    const error = new MastraError({\n      id: 'MASTRA_GET_MEMORY_BY_ID_NOT_FOUND',\n      domain: ErrorDomain.MASTRA,\n      category: ErrorCategory.USER,\n      text: `Memory with id ${id} not found`,\n      details: {\n        status: 404,\n        memoryId: id,\n        availableIds: Object.values(allMemory ?? {})\n          .map(m => m.id)\n          .join(', '),\n      },\n    });\n    this.#logger?.trackException(error);\n    throw error;\n  }\n\n  /**\n   * Returns all registered memory instances as a record keyed by their names.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   memory: {\n   *     chat: new Memory({ storage }),\n   *     longTerm: new Memory({ storage })\n   *   }\n   * });\n   *\n   * const allMemory = mastra.listMemory();\n   * console.log(Object.keys(allMemory)); // ['chat', 'longTerm']\n   * ```\n   */\n  public listMemory(): TMemory | undefined {\n    return this.#memory;\n  }\n\n  /**\n   * Adds a new memory instance to the Mastra instance.\n   *\n   * This method allows dynamic registration of memory instances after the Mastra instance\n   * has been created.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const chatMemory = new Memory({\n   *   id: 'chat-memory',\n   *   storage: mastra.getStorage()\n   * });\n   * mastra.addMemory(chatMemory); // Uses memory.id as key\n   * // or\n   * mastra.addMemory(chatMemory, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addMemory<M extends MastraMemory>(memory: M, key?: string): void {\n    if (!memory) {\n      throw createUndefinedPrimitiveError('memory', memory, key);\n    }\n    const memoryKey = key || memory.id;\n    const memoryRegistry = this.#memory as Record<string, MastraMemory>;\n    if (memoryRegistry[memoryKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Memory with key ${memoryKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    memoryRegistry[memoryKey] = memory;\n  }\n\n  /**\n   * Returns all registered workflows as a record keyed by their IDs.\n   *\n   * @example Listing all workflows\n   * ```typescript\n   * const mastra = new Mastra({\n   *   workflows: {\n   *     dataProcessor: createWorkflow({...}).commit(),\n   *     emailSender: createWorkflow({...}).commit(),\n   *     reportGenerator: createWorkflow({...}).commit()\n   *   }\n   * });\n   *\n   * const allWorkflows = mastra.listWorkflows();\n   * console.log(Object.keys(allWorkflows)); // ['dataProcessor', 'emailSender', 'reportGenerator']\n   *\n   * // Execute all workflows with sample data\n   * for (const [id, workflow] of Object.entries(allWorkflows)) {\n   *   console.log(`Workflow ${id}:`, workflow.name);\n   *   // const result = await workflow.execute(sampleData);\n   * }\n   * ```\n   */\n  public listWorkflows(props: { serialized?: boolean } = {}): Record<string, Workflow> {\n    if (props.serialized) {\n      return Object.entries(this.#workflows).reduce((acc, [k, v]) => {\n        return {\n          ...acc,\n          [k]: { name: v.name },\n        };\n      }, {});\n    }\n    return this.#workflows;\n  }\n\n  /**\n   * Adds a new workflow to the Mastra instance.\n   *\n   * This method allows dynamic registration of workflows after the Mastra instance\n   * has been created. The workflow will be initialized with Mastra and primitives.\n   *\n   * @throws {MastraError} When a workflow with the same key already exists\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const newWorkflow = createWorkflow({\n   *   id: 'data-pipeline',\n   *   name: 'Data Pipeline'\n   * }).commit();\n   * mastra.addWorkflow(newWorkflow); // Uses workflow.id as key\n   * // or\n   * mastra.addWorkflow(newWorkflow, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addWorkflow(workflow: Workflow<any, any, any, any, any, any, any>, key?: string): void {\n    if (!workflow) {\n      throw createUndefinedPrimitiveError('workflow', workflow, key);\n    }\n    const workflowKey = key || workflow.id;\n    const workflows = this.#workflows as Record<string, Workflow<any, any, any, any, any, any, any>>;\n    if (workflows[workflowKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Workflow with key ${workflowKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    // Initialize the workflow with Mastra and primitives\n    workflow.__registerMastra(this);\n    workflow.__registerPrimitives({\n      logger: this.getLogger(),\n      storage: this.getStorage(),\n    });\n    if (!workflow.committed) {\n      workflow.commit();\n    }\n    workflows[workflowKey] = workflow;\n  }\n\n  /**\n   * Sets the storage provider for the Mastra instance.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   *\n   * // Set PostgreSQL storage\n   * mastra.setStorage(new PostgresStore({\n   *   connectionString: process.env.DATABASE_URL\n   * }));\n   *\n   * // Now agents can use memory with the storage\n   * const agent = new Agent({\n   *   id: 'assistant',\n   *   name: 'assistant',\n   *   memory: new Memory({ storage: mastra.getStorage() })\n   * });\n   * ```\n   */\n  public setStorage(storage: MastraStorage) {\n    this.#storage = augmentWithInit(storage);\n  }\n\n  public setLogger({ logger }: { logger: TLogger }) {\n    this.#logger = logger;\n\n    if (this.#agents) {\n      Object.keys(this.#agents).forEach(key => {\n        this.#agents?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    if (this.#deployer) {\n      this.#deployer.__setLogger(this.#logger);\n    }\n\n    if (this.#tts) {\n      Object.keys(this.#tts).forEach(key => {\n        this.#tts?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    if (this.#storage) {\n      this.#storage.__setLogger(this.#logger);\n    }\n\n    if (this.#vectors) {\n      Object.keys(this.#vectors).forEach(key => {\n        this.#vectors?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    if (this.#mcpServers) {\n      Object.keys(this.#mcpServers).forEach(key => {\n        this.#mcpServers?.[key]?.__setLogger(this.#logger);\n      });\n    }\n\n    if (this.#serverAdapter) {\n      this.#serverAdapter.__setLogger(this.#logger);\n    }\n\n    this.#observability.setLogger({ logger: this.#logger });\n  }\n\n  /**\n   * Gets all registered text-to-speech (TTS) providers.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   tts: {\n   *     openai: new OpenAITTS({\n   *       apiKey: process.env.OPENAI_API_KEY,\n   *       voice: 'alloy'\n   *     })\n   *   }\n   * });\n   *\n   * const ttsProviders = mastra.getTTS();\n   * const openaiTTS = ttsProviders?.openai;\n   * if (openaiTTS) {\n   *   const audioBuffer = await openaiTTS.synthesize('Hello, world!');\n   * }\n   * ```\n   */\n  public getTTS() {\n    return this.#tts;\n  }\n\n  /**\n   * Gets the currently configured logger instance.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   logger: new PinoLogger({\n   *     name: 'MyApp',\n   *     level: 'info'\n   *   })\n   * });\n   *\n   * const logger = mastra.getLogger();\n   * logger.info('Application started');\n   * logger.error('An error occurred', { error: 'details' });\n   * ```\n   */\n  public getLogger() {\n    return this.#logger;\n  }\n\n  /**\n   * Gets the currently configured storage provider.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   storage: new LibSQLStore({ id: 'mastra-storage', url: 'file:./data.db' })\n   * });\n   *\n   * // Use the storage in agent memory\n   * const agent = new Agent({\n   *   id: 'assistant',\n   *   name: 'assistant',\n   *   memory: new Memory({\n   *     storage: mastra.getStorage()\n   *   })\n   * });\n   * ```\n   */\n  public getStorage() {\n    return this.#storage;\n  }\n\n  get observability(): ObservabilityEntrypoint {\n    return this.#observability;\n  }\n\n  public getServerMiddleware() {\n    return this.#serverMiddleware;\n  }\n\n  public getServerCache() {\n    return this.#serverCache;\n  }\n\n  public setServerMiddleware(serverMiddleware: Middleware | Middleware[]) {\n    if (typeof serverMiddleware === 'function') {\n      this.#serverMiddleware = [\n        {\n          handler: serverMiddleware,\n          path: '/api/*',\n        },\n      ];\n      return;\n    }\n\n    if (!Array.isArray(serverMiddleware)) {\n      const error = new MastraError({\n        id: 'MASTRA_SET_SERVER_MIDDLEWARE_INVALID_TYPE',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Invalid middleware: expected a function or array, received ${typeof serverMiddleware}`,\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    this.#serverMiddleware = serverMiddleware.map(m => {\n      if (typeof m === 'function') {\n        return {\n          handler: m,\n          path: '/api/*',\n        };\n      }\n      return {\n        handler: m.handler,\n        path: m.path || '/api/*',\n      };\n    });\n  }\n\n  public getServer() {\n    return this.#server;\n  }\n\n  /**\n   * Sets the server adapter for this Mastra instance.\n   *\n   * The server adapter provides access to the underlying server app (e.g., Hono, Express)\n   * and allows users to call routes directly via `app.fetch()` instead of making HTTP requests.\n   *\n   * This is typically called by `createHonoServer` or similar factory functions during\n   * server initialization.\n   *\n   * @param adapter - The server adapter instance (e.g., MastraServer from @mastra/hono or @mastra/express)\n   *\n   * @example\n   * ```typescript\n   * const app = new Hono();\n   * const adapter = new MastraServer({ app, mastra });\n   * mastra.setMastraServer(adapter);\n   * ```\n   */\n  public setMastraServer(adapter: MastraServerBase): void {\n    if (this.#serverAdapter) {\n      this.#logger?.debug(\n        'Replacing existing server adapter. Only one adapter should be registered per Mastra instance.',\n      );\n    }\n    this.#serverAdapter = adapter;\n    // Inject the logger into the adapter\n    if (this.#logger) {\n      adapter.__setLogger(this.#logger);\n    }\n  }\n\n  /**\n   * Gets the server adapter for this Mastra instance.\n   *\n   * @returns The server adapter, or undefined if not set\n   *\n   * @example\n   * ```typescript\n   * const adapter = mastra.getMastraServer();\n   * if (adapter) {\n   *   const app = adapter.getApp<Hono>();\n   * }\n   * ```\n   */\n  public getMastraServer(): MastraServerBase | undefined {\n    return this.#serverAdapter;\n  }\n\n  /**\n   * Gets the server app from the server adapter.\n   *\n   * This is a convenience method that calls `getMastraServer()?.getApp<T>()`.\n   * Use this to access the underlying server framework's app instance (e.g., Hono, Express)\n   * for direct operations like calling routes via `app.fetch()`.\n   *\n   * @template T - The expected type of the app (e.g., Hono, Express Application)\n   * @returns The server app, or undefined if no adapter is set\n   *\n   * @example\n   * ```typescript\n   * // After createHonoServer() is called:\n   * const app = mastra.getServerApp<Hono>();\n   *\n   * // Call routes directly without HTTP overhead\n   * const response = await app?.fetch(new Request('http://localhost/health'));\n   * const data = await response?.json();\n   * ```\n   */\n  public getServerApp<T = unknown>(): T | undefined {\n    return this.#serverAdapter?.getApp<T>();\n  }\n\n  public getBundlerConfig() {\n    return this.#bundler;\n  }\n\n  public async listLogsByRunId({\n    runId,\n    transportId,\n    fromDate,\n    toDate,\n    logLevel,\n    filters,\n    page,\n    perPage,\n  }: {\n    runId: string;\n    transportId: string;\n    fromDate?: Date;\n    toDate?: Date;\n    logLevel?: LogLevel;\n    filters?: Record<string, any>;\n    page?: number;\n    perPage?: number;\n  }) {\n    if (!transportId) {\n      const error = new MastraError({\n        id: 'MASTRA_LIST_LOGS_BY_RUN_ID_MISSING_TRANSPORT',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Transport ID is required',\n        details: {\n          runId,\n          transportId,\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (!this.#logger?.listLogsByRunId) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LOGS_BY_RUN_ID_LOGGER_NOT_CONFIGURED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.SYSTEM,\n        text: 'Logger is not configured or does not support listLogsByRunId operation',\n        details: {\n          runId,\n          transportId,\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    return await this.#logger.listLogsByRunId({\n      runId,\n      transportId,\n      fromDate,\n      toDate,\n      logLevel,\n      filters,\n      page,\n      perPage,\n    });\n  }\n\n  public async listLogs(\n    transportId: string,\n    params?: {\n      fromDate?: Date;\n      toDate?: Date;\n      logLevel?: LogLevel;\n      filters?: Record<string, any>;\n      page?: number;\n      perPage?: number;\n    },\n  ) {\n    if (!transportId) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LOGS_MISSING_TRANSPORT',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'Transport ID is required',\n        details: {\n          transportId,\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    if (!this.#logger) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_LOGS_LOGGER_NOT_CONFIGURED',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.SYSTEM,\n        text: 'Logger is not set',\n        details: {\n          transportId,\n        },\n      });\n      throw error;\n    }\n\n    return await this.#logger.listLogs(transportId, params);\n  }\n\n  /**\n   * Gets all registered Model Context Protocol (MCP) server instances.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   mcpServers: {\n   *     filesystem: new FileSystemMCPServer({\n   *       rootPath: '/app/data'\n   *     })\n   *   }\n   * });\n   *\n   * const mcpServers = mastra.getMCPServers();\n   * if (mcpServers) {\n   *   const fsServer = mcpServers.filesystem;\n   *   const tools = await fsServer.listTools();\n   * }\n   * ```\n   */\n  public listMCPServers(): Record<string, MCPServerBase> | undefined {\n    return this.#mcpServers;\n  }\n\n  /**\n   * Adds a new MCP server to the Mastra instance.\n   *\n   * This method allows dynamic registration of MCP servers after the Mastra instance\n   * has been created. The server will be initialized with ID, Mastra instance, and logger.\n   *\n   * @throws {MastraError} When an MCP server with the same key already exists\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra();\n   * const newServer = new FileSystemMCPServer({\n   *   rootPath: '/data'\n   * });\n   * mastra.addMCPServer(newServer); // Uses server.id as key\n   * // or\n   * mastra.addMCPServer(newServer, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addMCPServer<M extends MCPServerBase>(server: M, key?: string): void {\n    if (!server) {\n      throw createUndefinedPrimitiveError('mcp-server', server, key);\n    }\n    // If a key is provided, try to set it as the ID\n    // The setId method will only update if the ID wasn't explicitly set by the user\n    if (key) {\n      server.setId(key);\n    }\n\n    // Now resolve the ID after potentially setting it\n    const resolvedId = server.id;\n    if (!resolvedId) {\n      const error = new MastraError({\n        id: 'MASTRA_ADD_MCP_SERVER_MISSING_ID',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: 'MCP server must expose an id or be registered under one',\n        details: { status: 400 },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n\n    const serverKey = key ?? resolvedId;\n    const servers = this.#mcpServers as Record<string, MCPServerBase>;\n    if (servers[serverKey]) {\n      const logger = this.getLogger();\n      logger.debug(`MCP server with key ${serverKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    // Initialize the server\n    server.__registerMastra(this);\n    server.__setLogger(this.getLogger());\n    servers[serverKey] = server;\n  }\n\n  /**\n   * Retrieves a specific MCP server instance by registration key.\n   *\n   * @throws {MastraError} When the specified MCP server is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   mcpServers: {\n   *     filesystem: new FileSystemMCPServer({...})\n   *   }\n   * });\n   *\n   * const fsServer = mastra.getMCPServer('filesystem');\n   * const tools = await fsServer.listTools();\n   * ```\n   */\n  public getMCPServer<TMCPServerName extends keyof TMCPServers>(\n    name: TMCPServerName,\n  ): TMCPServers[TMCPServerName] | undefined {\n    if (!this.#mcpServers || !this.#mcpServers[name]) {\n      this.#logger?.debug(`MCP server with name ${String(name)} not found`);\n      return undefined as TMCPServers[TMCPServerName] | undefined;\n    }\n    return this.#mcpServers[name];\n  }\n\n  /**\n   * Retrieves a specific Model Context Protocol (MCP) server instance by its logical ID.\n   *\n   * This method searches for an MCP server using its logical ID. If a version is specified,\n   * it returns the exact version match. If no version is provided, it returns the server\n   * with the most recent release date.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   mcpServers: {\n   *     filesystem: new FileSystemMCPServer({\n   *       id: 'fs-server',\n   *       version: '1.0.0',\n   *       rootPath: '/app/data'\n   *     })\n   *   }\n   * });\n   *\n   * const fsServer = mastra.getMCPServerById('fs-server');\n   * if (fsServer) {\n   *   const tools = await fsServer.listTools();\n   * }\n   * ```\n   */\n  public getMCPServerById<TMCPServerName extends keyof TMCPServers>(\n    serverId: TMCPServers[TMCPServerName]['id'],\n    version?: string,\n  ): TMCPServers[TMCPServerName] | undefined {\n    if (!this.#mcpServers) {\n      return undefined;\n    }\n\n    const allRegisteredServers = Object.values(this.#mcpServers || {});\n\n    const matchingLogicalIdServers = allRegisteredServers.filter(server => server.id === serverId);\n\n    if (matchingLogicalIdServers.length === 0) {\n      this.#logger?.debug(`No MCP servers found with logical ID: ${serverId}`);\n      return undefined;\n    }\n\n    if (version) {\n      const specificVersionServer = matchingLogicalIdServers.find(server => server.version === version);\n      if (!specificVersionServer) {\n        this.#logger?.debug(`MCP server with logical ID '${serverId}' found, but not version '${version}'.`);\n      }\n      return specificVersionServer as TMCPServers[TMCPServerName] | undefined;\n    } else {\n      // No version specified, find the one with the most recent releaseDate\n      if (matchingLogicalIdServers.length === 1) {\n        return matchingLogicalIdServers[0] as TMCPServers[TMCPServerName];\n      }\n\n      matchingLogicalIdServers.sort((a, b) => {\n        // Ensure releaseDate exists and is a string before creating a Date object\n        const dateAVal = a.releaseDate && typeof a.releaseDate === 'string' ? new Date(a.releaseDate).getTime() : NaN;\n        const dateBVal = b.releaseDate && typeof b.releaseDate === 'string' ? new Date(b.releaseDate).getTime() : NaN;\n\n        if (isNaN(dateAVal) && isNaN(dateBVal)) return 0;\n        if (isNaN(dateAVal)) return 1; // Treat invalid/missing dates as older\n        if (isNaN(dateBVal)) return -1; // Treat invalid/missing dates as older\n\n        return dateBVal - dateAVal; // Sorts in descending order of time (latest first)\n      });\n\n      // After sorting, the first element should be the latest if its date is valid\n      if (matchingLogicalIdServers.length > 0) {\n        const latestServer = matchingLogicalIdServers[0];\n        if (\n          latestServer &&\n          latestServer.releaseDate &&\n          typeof latestServer.releaseDate === 'string' &&\n          !isNaN(new Date(latestServer.releaseDate).getTime())\n        ) {\n          return latestServer as TMCPServers[TMCPServerName];\n        }\n      }\n      this.#logger?.warn(\n        `Could not determine the latest server for logical ID '${serverId}' due to invalid or missing release dates, or no servers left after filtering.`,\n      );\n      return undefined;\n    }\n  }\n\n  public async addTopicListener(topic: string, listener: (event: any) => Promise<void>) {\n    await this.#pubsub.subscribe(topic, listener);\n  }\n\n  public async removeTopicListener(topic: string, listener: (event: any) => Promise<void>) {\n    await this.#pubsub.unsubscribe(topic, listener);\n  }\n\n  public async startEventEngine() {\n    for (const topic in this.#events) {\n      if (!this.#events[topic]) {\n        continue;\n      }\n\n      const listeners = Array.isArray(this.#events[topic]) ? this.#events[topic] : [this.#events[topic]];\n      for (const listener of listeners) {\n        await this.#pubsub.subscribe(topic, listener);\n      }\n    }\n  }\n\n  public async stopEventEngine() {\n    for (const topic in this.#events) {\n      if (!this.#events[topic]) {\n        continue;\n      }\n\n      const listeners = Array.isArray(this.#events[topic]) ? this.#events[topic] : [this.#events[topic]];\n      for (const listener of listeners) {\n        await this.#pubsub.unsubscribe(topic, listener);\n      }\n    }\n\n    await this.#pubsub.flush();\n  }\n\n  /**\n   * Retrieves a registered gateway by its key.\n   *\n   * @throws {MastraError} When the gateway with the specified key is not found\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   gateways: {\n   *     myGateway: new CustomGateway()\n   *   }\n   * });\n   *\n   * const gateway = mastra.getGateway('myGateway');\n   * ```\n   */\n  public getGateway(key: string): MastraModelGateway {\n    const gateway = this.#gateways?.[key];\n    if (!gateway) {\n      const error = new MastraError({\n        id: 'MASTRA_GET_GATEWAY_BY_KEY_NOT_FOUND',\n        domain: ErrorDomain.MASTRA,\n        category: ErrorCategory.USER,\n        text: `Gateway with key ${key} not found`,\n        details: {\n          status: 404,\n          gatewayKey: key,\n          gateways: Object.keys(this.#gateways ?? {}).join(', '),\n        },\n      });\n      this.#logger?.trackException(error);\n      throw error;\n    }\n    return gateway;\n  }\n\n  /**\n   * Retrieves a registered gateway by its ID.\n   *\n   * Searches through all registered gateways and returns the one whose ID matches.\n   * If a gateway doesn't have an explicit ID, its name is used as the ID.\n   *\n   * @throws {MastraError} When no gateway with the specified ID is found\n   *\n   * @example\n   * ```typescript\n   * class CustomGateway extends MastraModelGateway {\n   *   readonly id = 'custom-gateway-v1';\n   *   readonly name = 'Custom Gateway';\n   *   // ...\n   * }\n   *\n   * const mastra = new Mastra({\n   *   gateways: {\n   *     myGateway: new CustomGateway()\n   *   }\n   * });\n   *\n   * const gateway = mastra.getGatewayById('custom-gateway-v1');\n   * ```\n   */\n  public getGatewayById(id: string): MastraModelGateway {\n    const gateways = this.#gateways ?? {};\n    for (const gateway of Object.values(gateways)) {\n      if (gateway.getId() === id) {\n        return gateway;\n      }\n    }\n\n    const error = new MastraError({\n      id: 'MASTRA_GET_GATEWAY_BY_ID_NOT_FOUND',\n      domain: ErrorDomain.MASTRA,\n      category: ErrorCategory.USER,\n      text: `Gateway with ID ${id} not found`,\n      details: {\n        status: 404,\n        gatewayId: id,\n        availableIds: Object.values(gateways)\n          .map(g => g.getId())\n          .join(', '),\n      },\n    });\n    this.#logger?.trackException(error);\n    throw error;\n  }\n\n  /**\n   * Returns all registered gateways as a record keyed by their names.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   gateways: {\n   *     netlify: new NetlifyGateway(),\n   *     custom: new CustomGateway()\n   *   }\n   * });\n   *\n   * const allGateways = mastra.listGateways();\n   * console.log(Object.keys(allGateways)); // ['netlify', 'custom']\n   * ```\n   */\n  public listGateways(): Record<string, MastraModelGateway> | undefined {\n    return this.#gateways;\n  }\n\n  /**\n   * Adds a new gateway to the Mastra instance.\n   *\n   * This method allows dynamic registration of gateways after the Mastra instance\n   * has been created. Gateways enable access to LLM providers through custom\n   * authentication and routing logic.\n   *\n   * If no key is provided, the gateway's ID (or name if no ID is set) will be used as the key.\n   *\n   * @example\n   * ```typescript\n   * import { MastraModelGateway } from '@mastra/core';\n   *\n   * class CustomGateway extends MastraModelGateway {\n   *   readonly id = 'custom-gateway-v1';  // Optional, defaults to name\n   *   readonly name = 'custom';\n   *   readonly prefix = 'custom';\n   *\n   *   async fetchProviders() {\n   *     return {\n   *       myProvider: {\n   *         name: 'My Provider',\n   *         models: ['model-1', 'model-2'],\n   *         apiKeyEnvVar: 'MY_API_KEY',\n   *         gateway: 'custom'\n   *       }\n   *     };\n   *   }\n   *\n   *   buildUrl(modelId: string) {\n   *     return 'https://api.myprovider.com/v1';\n   *   }\n   *\n   *   async getApiKey(modelId: string) {\n   *     return process.env.MY_API_KEY || '';\n   *   }\n   *\n   *   async resolveLanguageModel({ modelId, providerId, apiKey }) {\n   *     const baseURL = this.buildUrl(`${providerId}/${modelId}`);\n   *     return createOpenAICompatible({\n   *       name: providerId,\n   *       apiKey,\n   *       baseURL,\n   *       supportsStructuredOutputs: true,\n   *     }).chatModel(modelId);\n   *   }\n   * }\n   *\n   * const mastra = new Mastra();\n   * const newGateway = new CustomGateway();\n   * mastra.addGateway(newGateway); // Uses gateway.getId() as key (gateway.id)\n   * // or\n   * mastra.addGateway(newGateway, 'customKey'); // Uses custom key\n   * ```\n   */\n  public addGateway(gateway: MastraModelGateway, key?: string): void {\n    if (!gateway) {\n      throw createUndefinedPrimitiveError('gateway', gateway, key);\n    }\n    const gatewayKey = key || gateway.getId();\n    const gateways = this.#gateways as Record<string, MastraModelGateway>;\n    if (gateways[gatewayKey]) {\n      const logger = this.getLogger();\n      logger.debug(`Gateway with key ${gatewayKey} already exists. Skipping addition.`);\n      return;\n    }\n\n    gateways[gatewayKey] = gateway;\n\n    // Register custom gateways with the registry for type generation\n    this.#syncGatewayRegistry();\n  }\n\n  /**\n   * Sync custom gateways with the GatewayRegistry for type generation\n   * @private\n   */\n  #syncGatewayRegistry(): void {\n    try {\n      // Only sync in dev mode (when MASTRA_DEV is set)\n      if (process.env.MASTRA_DEV !== 'true' && process.env.MASTRA_DEV !== '1') {\n        return;\n      }\n\n      // Trigger sync immediately (non-blocking, but logs progress)\n      import('../llm/model/provider-registry.js')\n        .then(async ({ GatewayRegistry }) => {\n          const registry = GatewayRegistry.getInstance();\n          const customGateways = Object.values(this.#gateways || {});\n          registry.registerCustomGateways(customGateways);\n\n          // Log that we're syncing\n          const logger = this.getLogger();\n          logger.info('ðŸ”„ Syncing custom gateway types...');\n\n          // Trigger a sync to regenerate types\n          await registry.syncGateways(true);\n\n          logger.info('âœ… Custom gateway types synced! Restart your TypeScript server to see autocomplete.');\n        })\n        .catch(err => {\n          const logger = this.getLogger();\n          logger.debug('Gateway registry sync skipped:', err);\n        });\n    } catch (err) {\n      // Silent fail - this is a dev-only feature\n      const logger = this.getLogger();\n      logger.debug('Gateway registry sync failed:', err);\n    }\n  }\n\n  /**\n   * Gracefully shuts down the Mastra instance and cleans up all resources.\n   *\n   * This method performs a clean shutdown of all Mastra components, including:\n   * - tracing registry and all tracing instances\n   * - Event engine and pub/sub system\n   * - All registered components and their resources\n   *\n   * It's important to call this method when your application is shutting down\n   * to ensure proper cleanup and prevent resource leaks.\n   *\n   * @example\n   * ```typescript\n   * const mastra = new Mastra({\n   *   agents: { myAgent },\n   *   workflows: { myWorkflow }\n   * });\n   *\n   * // Graceful shutdown on SIGINT\n   * process.on('SIGINT', async () => {\n   *   await mastra.shutdown();\n   *   process.exit(0);\n   * });\n   * ```\n   */\n  async shutdown(): Promise<void> {\n    await this.stopEventEngine();\n    // Shutdown observability registry, exporters, etc...\n    await this.#observability.shutdown();\n\n    this.#logger?.info('Mastra shutdown completed');\n  }\n\n  // This method is only used internally for server hnadlers that require temporary persistence\n  public get serverCache() {\n    return this.#serverCache;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12871, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/vector/index.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/vector/vector.ts"],"sourcesContent":["import type {\n  EmbeddingModel as EmbeddingModelV1,\n  ProviderOptions as ProviderOptionsV1,\n  TelemetrySettings as TelemetrySettingsV1,\n} from '@internal/ai-sdk-v4';\nimport type {\n  EmbeddingModelV2,\n  TelemetrySettings as TelemetrySettingsV5,\n  ProviderOptions as ProviderOptionsV5,\n} from '@internal/ai-sdk-v5';\nimport type {\n  EmbeddingModelV3,\n  TelemetrySettings as TelemetrySettingsV6,\n  ProviderOptions as ProviderOptionsV6,\n} from '@internal/ai-v6';\nimport { MastraBase } from '../base';\nimport { MastraError, ErrorDomain, ErrorCategory } from '../error';\nimport type { VectorFilter } from './filter';\nimport type {\n  CreateIndexParams,\n  UpsertVectorParams,\n  QueryVectorParams,\n  IndexStats,\n  QueryResult,\n  UpdateVectorParams,\n  DeleteVectorParams,\n  DeleteVectorsParams,\n  DescribeIndexParams,\n  DeleteIndexParams,\n} from './types';\n\n/** Legacy embedding model (V1) - use embedV1 function */\nexport type MastraLegacyEmbeddingModel<T> = EmbeddingModelV1<T>;\n\n/** Modern embedding model (V2/V3) - use embedV2 for V2 models, embedV3 for V3 models */\nexport type MastraSupportedEmbeddingModel<T> = EmbeddingModelV2<T> | EmbeddingModelV3;\n\n/** All supported embedding model types */\nexport type MastraEmbeddingModel<T> = MastraLegacyEmbeddingModel<T> | MastraSupportedEmbeddingModel<T>;\n\nexport type MastraEmbeddingOptions = {\n  maxRetries?: number;\n\n  headers?: Record<string, string>;\n  /**\n   * Optional telemetry configuration (experimental).\n   */\n  telemetry?: TelemetrySettingsV1 | TelemetrySettingsV5 | TelemetrySettingsV6;\n\n  providerOptions?: ProviderOptionsV1 | ProviderOptionsV5 | ProviderOptionsV6;\n\n  maxParallelCalls?: number;\n};\n\n/** Specification versions for supported (modern) embedding models */\nexport const supportedEmbeddingModelSpecifications = ['v2', 'v3'] as const;\n\n/**\n * Type guard to check if an embedding model is a supported modern version (V2 or V3).\n * Use embedV2 for V2 models, embedV3 for V3 models, and embedV1 for legacy V1 models.\n */\nexport const isSupportedEmbeddingModel = <T>(\n  model: MastraEmbeddingModel<T>,\n): model is MastraSupportedEmbeddingModel<T> => {\n  return supportedEmbeddingModelSpecifications.includes(\n    model.specificationVersion as (typeof supportedEmbeddingModelSpecifications)[number],\n  );\n};\n\nexport abstract class MastraVector<Filter = VectorFilter> extends MastraBase {\n  id: string;\n\n  constructor({ id }: { id: string }) {\n    if (!id || typeof id !== 'string' || id.trim() === '') {\n      throw new MastraError({\n        id: 'VECTOR_INVALID_ID',\n        text: 'Vector id must be provided and cannot be empty',\n        domain: ErrorDomain.MASTRA_VECTOR,\n        category: ErrorCategory.USER,\n      });\n    }\n    super({ name: 'MastraVector', component: 'VECTOR' });\n    this.id = id;\n  }\n\n  get indexSeparator(): string {\n    return '_';\n  }\n\n  abstract query(params: QueryVectorParams<Filter>): Promise<QueryResult[]>;\n  // Adds type checks for positional arguments if used\n  abstract upsert(params: UpsertVectorParams): Promise<string[]>;\n  // Adds type checks for positional arguments if used\n  abstract createIndex(params: CreateIndexParams): Promise<void>;\n\n  abstract listIndexes(): Promise<string[]>;\n\n  abstract describeIndex(params: DescribeIndexParams): Promise<IndexStats>;\n\n  abstract deleteIndex(params: DeleteIndexParams): Promise<void>;\n\n  abstract updateVector(params: UpdateVectorParams<Filter>): Promise<void>;\n\n  abstract deleteVector(params: DeleteVectorParams): Promise<void>;\n\n  /**\n   * Delete multiple vectors by IDs or metadata filter.\n   *\n   * This enables bulk deletion and source-based vector management.\n   * Implementations should throw MastraError with appropriate error code\n   * if the operation is not supported.\n   *\n   * @param params - Parameters including indexName and either ids or filter (mutually exclusive)\n   * @throws {MastraError} If operation is not supported or parameters are invalid\n   *\n   * @example\n   * ```ts\n   * // Delete all chunks from a document\n   * await vectorStore.deleteVectors({\n   *   indexName: 'docs',\n   *   filter: { source_id: 'manual.pdf' }\n   * });\n   *\n   * // Delete multiple vectors by ID\n   * await vectorStore.deleteVectors({\n   *   indexName: 'docs',\n   *   ids: ['vec_1', 'vec_2', 'vec_3']\n   * });\n   *\n   * // Delete old temporary documents\n   * await vectorStore.deleteVectors({\n   *   indexName: 'docs',\n   *   filter: {\n   *     $and: [\n   *       { bucket: 'temp' },\n   *       { indexed_at: { $lt: '2025-01-01' } }\n   *     ]\n   *   }\n   * });\n   * ```\n   */\n  abstract deleteVectors(params: DeleteVectorsParams<Filter>): Promise<void>;\n\n  protected async validateExistingIndex(indexName: string, dimension: number, metric: string) {\n    let info: IndexStats;\n    try {\n      info = await this.describeIndex({ indexName });\n    } catch (infoError) {\n      const mastraError = new MastraError(\n        {\n          id: 'VECTOR_VALIDATE_INDEX_FETCH_FAILED',\n          text: `Index \"${indexName}\" already exists, but failed to fetch index info for dimension check.`,\n          domain: ErrorDomain.MASTRA_VECTOR,\n          category: ErrorCategory.SYSTEM,\n          details: { indexName },\n        },\n        infoError,\n      );\n      this.logger?.trackException(mastraError);\n      this.logger?.error(mastraError.toString());\n      throw mastraError;\n    }\n    const existingDim = info?.dimension;\n    const existingMetric = info?.metric;\n    if (existingDim === dimension) {\n      this.logger?.info(\n        `Index \"${indexName}\" already exists with ${existingDim} dimensions and metric ${existingMetric}, skipping creation.`,\n      );\n      if (existingMetric !== metric) {\n        this.logger?.warn(\n          `Attempted to create index with metric \"${metric}\", but index already exists with metric \"${existingMetric}\". To use a different metric, delete and recreate the index.`,\n        );\n      }\n    } else if (info) {\n      const mastraError = new MastraError({\n        id: 'VECTOR_VALIDATE_INDEX_DIMENSION_MISMATCH',\n        text: `Index \"${indexName}\" already exists with ${existingDim} dimensions, but ${dimension} dimensions were requested`,\n        domain: ErrorDomain.MASTRA_VECTOR,\n        category: ErrorCategory.USER,\n        details: { indexName, existingDim, requestedDim: dimension },\n      });\n      this.logger?.trackException(mastraError);\n      this.logger?.error(mastraError.toString());\n      throw mastraError;\n    } else {\n      const mastraError = new MastraError({\n        id: 'VECTOR_VALIDATE_INDEX_NO_DIMENSION',\n        text: `Index \"${indexName}\" already exists, but could not retrieve its dimensions for validation.`,\n        domain: ErrorDomain.MASTRA_VECTOR,\n        category: ErrorCategory.SYSTEM,\n        details: { indexName },\n      });\n      this.logger?.trackException(mastraError);\n      this.logger?.error(mastraError.toString());\n      throw mastraError;\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAuDO,IAAM,qCAAA,GAAwC;IAAC,IAAA;IAAM,IAAI;CAAA;AAMzD,IAAM,yBAAA,GAA4B,CACvC,KAAA,KAC8C;IAC9C,OAAO,qCAAA,CAAsC,QAAA,CAC3C,KAAA,CAAM,oBAAA;AAEV;AAEO,IAAe,YAAA,GAAf,cAA2D,6KAAA,CAAW;IAC3E,EAAA,CAAA;IAEA,WAAA,CAAY,EAAE,EAAA,EAAG,CAAmB;QAClC,IAAI,CAAC,MAAM,OAAO,EAAA,KAAO,YAAY,EAAA,CAAG,IAAA,OAAW,EAAA,EAAI;YACrD,MAAM,IAAI,8KAAA,CAAY;gBACpB,EAAA,EAAI,mBAAA;gBACJ,IAAA,EAAM,gDAAA;gBACN,MAAA,EAAA,eAAA,CAAA,iBAAA;gBACA,QAAA,EAAA,MAAA,CAAA,QAAA;YAAA,CACD,CAAA;QACH;QACA,KAAA,CAAM;YAAE,IAAA,EAAM,cAAA;YAAgB,SAAA,EAAW;QAAA,CAAU,CAAA;QACnD,IAAA,CAAK,EAAA,GAAK,EAAA;IACZ;IAEA,IAAI,cAAA,GAAyB;QAC3B,OAAO,GAAA;IACT;IAwDA,MAAgB,qBAAA,CAAsB,SAAA,EAAmB,SAAA,EAAmB,MAAA,EAAgB;QAC1F,IAAI,IAAA;QACJ,IAAI;YACF,IAAA,GAAO,MAAM,IAAA,CAAK,aAAA,CAAc;gBAAE;YAAA,CAAW,CAAA;QAC/C,EAAA,OAAS,SAAA,EAAW;YAClB,MAAM,cAAc,IAAI,8KAAA,CACtB;gBACE,EAAA,EAAI,oCAAA;gBACJ,IAAA,EAAM,CAAA,OAAA,EAAU,SAAS,CAAA,qEAAA,CAAA;gBACzB,MAAA,EAAA,eAAA,CAAA,iBAAA;gBACA,QAAA,EAAA,QAAA,CAAA,UAAA;gBACA,OAAA,EAAS;oBAAE,SAAA;gBAAA;YAAU,CACvB,EACA;YAEF,IAAA,CAAK,MAAA,EAAQ,eAAe,WAAW,CAAA;YACvC,IAAA,CAAK,MAAA,EAAQ,KAAA,CAAM,WAAA,CAAY,QAAA,EAAU,CAAA;YACzC,MAAM,WAAA;QACR;QACA,MAAM,cAAc,IAAA,EAAM,SAAA;QAC1B,MAAM,iBAAiB,IAAA,EAAM,MAAA;QAC7B,IAAI,gBAAgB,SAAA,EAAW;YAC7B,IAAA,CAAK,MAAA,EAAQ,IAAA,CACX,CAAA,OAAA,EAAU,SAAS,CAAA,sBAAA,EAAyB,WAAW,CAAA,uBAAA,EAA0B,cAAc,CAAA,oBAAA,CAAA;YAEjG,IAAI,mBAAmB,MAAA,EAAQ;gBAC7B,IAAA,CAAK,MAAA,EAAQ,IAAA,CACX,CAAA,uCAAA,EAA0C,MAAM,CAAA,yCAAA,EAA4C,cAAc,CAAA,4DAAA,CAAA;YAE9G;QACF,OAAA,IAAW,IAAA,EAAM;YACf,MAAM,WAAA,GAAc,IAAI,8KAAA,CAAY;gBAClC,EAAA,EAAI,0CAAA;gBACJ,MAAM,CAAA,OAAA,EAAU,SAAS,CAAA,sBAAA,EAAyB,WAAW,CAAA,iBAAA,EAAoB,SAAS,CAAA,0BAAA,CAAA;gBAC1F,MAAA,EAAA,eAAA,CAAA,iBAAA;gBACA,QAAA,EAAA,MAAA,CAAA,QAAA;gBACA,OAAA,EAAS;oBAAE,SAAA;oBAAW,WAAA;oBAAa,cAAc,SAAA;gBAAA;YAAU,CAC5D,CAAA;YACD,IAAA,CAAK,MAAA,EAAQ,eAAe,WAAW,CAAA;YACvC,IAAA,CAAK,MAAA,EAAQ,KAAA,CAAM,WAAA,CAAY,QAAA,EAAU,CAAA;YACzC,MAAM,WAAA;QACR,CAAA,MAAO;YACL,MAAM,WAAA,GAAc,IAAI,8KAAA,CAAY;gBAClC,EAAA,EAAI,oCAAA;gBACJ,IAAA,EAAM,CAAA,OAAA,EAAU,SAAS,CAAA,uEAAA,CAAA;gBACzB,MAAA,EAAA,eAAA,CAAA,iBAAA;gBACA,QAAA,EAAA,QAAA,CAAA,UAAA;gBACA,OAAA,EAAS;oBAAE,SAAA;gBAAA;YAAU,CACtB,CAAA;YACD,IAAA,CAAK,MAAA,EAAQ,eAAe,WAAW,CAAA;YACvC,IAAA,CAAK,MAAA,EAAQ,KAAA,CAAM,WAAA,CAAY,QAAA,EAAU,CAAA;YACzC,MAAM,WAAA;QACR;IACF;AACF"}},
    {"offset": {"line": 12980, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@mastra/core/dist/chunk-BWYU7D33.js","sources":["file:///Users/wsz/lifebud/version2/lifebud/node_modules/%40mastra/core/src/vector/filter/base.ts"],"sourcesContent":["type BasicOperator =\n  | '$eq' // Matches values equal to specified value\n  | '$ne'; // Matches values not equal\n\ntype NumericOperator =\n  | '$gt' // Greater than\n  | '$gte' // Greater than or equal\n  | '$lt' // Less than\n  | '$lte'; // Less than or equal\n\ntype LogicalOperator =\n  | '$and' // Joins query clauses with logical AND\n  | '$not' // Inverts the effect of a query expression\n  | '$nor' // Joins query clauses with logical NOR\n  | '$or'; // Joins query clauses with logical OR\n\ntype ArrayOperator =\n  | '$all' // Matches arrays containing all elements\n  | '$in' // Matches any value in array\n  | '$nin' // Matches none of the values in array\n  | '$elemMatch'; // Matches documents that contain an array field with at least one element that matches all the specified query criteria\n\ntype ElementOperator = '$exists'; // Matches documents that have the specified field\n\ntype RegexOperator = '$regex' | '$options'; // Matches documents that have the specified field\n\n// Union of all supported operators\ntype QueryOperator =\n  | BasicOperator\n  | NumericOperator\n  | LogicalOperator\n  | ArrayOperator\n  | ElementOperator\n  | RegexOperator;\n\ntype EmptyObject = Record<string, never>;\n\ntype FilterValue = string | number | boolean | Date | null | undefined | EmptyObject;\n\n// Logical operators are handled at the top level as objects, not as values here\n// $and, $or, $nor, $not are handled in LogicalCondition\ntype OperatorValueMap<Op extends string = string, ValueMap extends Record<string, any> = any> = {\n  $eq: FilterValue;\n  $ne: FilterValue;\n  $gt: number | string | Date;\n  $gte: number | string | Date;\n  $lt: number | string | Date;\n  $lte: number | string | Date;\n  $all: FilterValue[];\n  $in: FilterValue[];\n  $nin: FilterValue[];\n  $elemMatch: Record<string, unknown>;\n  $exists: boolean;\n  $regex: string | RegExp;\n  $options: string;\n  $not: OperatorCondition<Op, ValueMap> | RegExp;\n};\n\ntype LogicalOperatorValueMap = {\n  $and: 'array';\n  $or: 'array';\n  $nor: 'array';\n  $not: 'object';\n};\n\ntype BlacklistedRootOperators =\n  | '$eq'\n  | '$ne'\n  | '$gt'\n  | '$gte'\n  | '$lt'\n  | '$lte'\n  | '$in'\n  | '$nin'\n  | '$all'\n  | '$exists'\n  | '$regex'\n  | '$options'\n  | '$elemMatch';\n\ntype VectorFieldValue = FilterValue | FilterValue[];\n\n// Vector filter parameterized by operator set\ntype VectorFilter<\n  Op extends keyof ValueMap = keyof OperatorValueMap,\n  ValueMap extends Record<string, any> = OperatorValueMap,\n  LogicalValueMap extends Record<string, any> = LogicalOperatorValueMap,\n  Blacklisted extends string = BlacklistedRootOperators,\n  FieldValue = VectorFieldValue,\n> = FilterCondition<Op, ValueMap, LogicalValueMap, Blacklisted, FieldValue> | null | undefined;\n\ntype FilterCondition<\n  Op extends keyof ValueMap = keyof OperatorValueMap,\n  ValueMap extends Record<string, any> = OperatorValueMap,\n  LogicalValueMap extends Record<string, any> = LogicalOperatorValueMap,\n  Blacklisted extends string = BlacklistedRootOperators,\n  FieldValue = VectorFieldValue,\n> = (FieldCondition<Op, ValueMap, FieldValue> | LogicalCondition<Op, ValueMap, LogicalValueMap>) &\n  ForbiddenRootOperators<Blacklisted>;\n\n// Field condition can be a value or an operator condition\ntype FieldCondition<\n  Op extends keyof ValueMap = keyof OperatorValueMap,\n  ValueMap extends Record<string, any> = OperatorValueMap,\n  FieldValue = VectorFieldValue,\n> = {\n  [field: string]: OperatorCondition<Op, ValueMap> | FieldValue;\n};\n\ntype ForbiddenRootOperators<Blacklisted extends string> = {\n  [K in Blacklisted]?: never;\n};\n\n// Logical conditions\ntype LogicalCondition<\n  Op extends keyof ValueMap = keyof OperatorValueMap,\n  ValueMap extends Record<string, any> = OperatorValueMap,\n  LogicalValueMap extends Record<string, any> = LogicalOperatorValueMap,\n> = {\n  [K in keyof LogicalValueMap]: LogicalValueMap[K] extends 'array'\n    ? {\n        [P in K]: Array<LogicalBranch<Op, ValueMap, LogicalValueMap>>;\n      }\n    : {\n        [P in K]: LogicalBranch<Op, ValueMap, LogicalValueMap>;\n      };\n}[keyof LogicalValueMap];\n\ntype LogicalBranch<\n  Op extends keyof ValueMap = keyof OperatorValueMap,\n  ValueMap extends Record<string, any> = OperatorValueMap,\n  LogicalValueMap extends Record<string, any> = LogicalOperatorValueMap,\n> = FieldCondition<Op, ValueMap> | LogicalCondition<Op, ValueMap, LogicalValueMap>;\n\n// Base operator condition, parameterized by operator set\ntype OperatorCondition<\n  Op extends keyof ValueMap = keyof OperatorValueMap,\n  ValueMap extends Record<string, any> = OperatorValueMap,\n> = {\n  [K in Exclude<Op, '$and' | '$or' | '$nor'>]?: ValueMap[K];\n};\n\ntype OperatorSupport = {\n  logical?: LogicalOperator[];\n  array?: ArrayOperator[];\n  basic?: BasicOperator[];\n  numeric?: NumericOperator[];\n  element?: ElementOperator[];\n  regex?: RegexOperator[];\n  custom?: string[];\n};\n\n// Base abstract class for filter translators\nabstract class BaseFilterTranslator<Filter = VectorFilter, Result = Filter> {\n  abstract translate(filter: Filter): Result;\n\n  /**\n   * Operator type checks\n   */\n  protected isOperator(key: string): key is QueryOperator {\n    return key.startsWith('$');\n  }\n\n  protected static readonly BASIC_OPERATORS: BasicOperator[] = ['$eq', '$ne'];\n  protected static readonly NUMERIC_OPERATORS: NumericOperator[] = ['$gt', '$gte', '$lt', '$lte'];\n  protected static readonly ARRAY_OPERATORS: ArrayOperator[] = ['$in', '$nin', '$all', '$elemMatch'];\n  protected static readonly LOGICAL_OPERATORS: LogicalOperator[] = ['$and', '$or', '$not', '$nor'];\n  protected static readonly ELEMENT_OPERATORS: ElementOperator[] = ['$exists'];\n  protected static readonly REGEX_OPERATORS: RegexOperator[] = ['$regex', '$options'];\n\n  public static readonly DEFAULT_OPERATORS = {\n    logical: BaseFilterTranslator.LOGICAL_OPERATORS,\n    basic: BaseFilterTranslator.BASIC_OPERATORS,\n    numeric: BaseFilterTranslator.NUMERIC_OPERATORS,\n    array: BaseFilterTranslator.ARRAY_OPERATORS,\n    element: BaseFilterTranslator.ELEMENT_OPERATORS,\n    regex: BaseFilterTranslator.REGEX_OPERATORS,\n  };\n\n  protected isLogicalOperator(key: string): key is LogicalOperator {\n    return BaseFilterTranslator.DEFAULT_OPERATORS.logical.includes(key as LogicalOperator);\n  }\n\n  protected isBasicOperator(key: string): key is BasicOperator {\n    return BaseFilterTranslator.DEFAULT_OPERATORS.basic.includes(key as BasicOperator);\n  }\n\n  protected isNumericOperator(key: string): key is NumericOperator {\n    return BaseFilterTranslator.DEFAULT_OPERATORS.numeric.includes(key as NumericOperator);\n  }\n\n  protected isArrayOperator(key: string): key is ArrayOperator {\n    return BaseFilterTranslator.DEFAULT_OPERATORS.array.includes(key as ArrayOperator);\n  }\n\n  protected isElementOperator(key: string): key is ElementOperator {\n    return BaseFilterTranslator.DEFAULT_OPERATORS.element.includes(key as ElementOperator);\n  }\n\n  protected isRegexOperator(key: string): key is RegexOperator {\n    return BaseFilterTranslator.DEFAULT_OPERATORS.regex.includes(key as RegexOperator);\n  }\n\n  protected isFieldOperator(key: string): key is QueryOperator {\n    return this.isOperator(key) && !this.isLogicalOperator(key);\n  }\n\n  protected isCustomOperator(key: string): boolean {\n    const support = this.getSupportedOperators();\n    return support.custom?.includes(key) ?? false;\n  }\n\n  protected getSupportedOperators(): OperatorSupport {\n    return BaseFilterTranslator.DEFAULT_OPERATORS;\n  }\n\n  protected isValidOperator(key: string): boolean {\n    const support = this.getSupportedOperators();\n    const allSupported = Object.values(support).flat();\n    return allSupported.includes(key as QueryOperator);\n  }\n\n  /**\n   * Value normalization for comparison operators\n   */\n  protected normalizeComparisonValue(value: any): any {\n    if (value instanceof Date) {\n      return value.toISOString();\n    }\n\n    // Handle -0 case\n    if (typeof value === 'number' && Object.is(value, -0)) {\n      return 0;\n    }\n    return value;\n  }\n\n  /**\n   * Helper method to simulate $all operator using $and + $eq when needed.\n   * Some vector stores don't support $all natively.\n   */\n  protected simulateAllOperator(field: string, values: any[]): VectorFilter<keyof OperatorValueMap, OperatorValueMap> {\n    return {\n      $and: values.map(value => ({\n        [field]: { $in: [this.normalizeComparisonValue(value)] },\n      })),\n    };\n  }\n\n  /**\n   * Utility functions for type checking\n   */\n  protected isPrimitive(value: any): boolean {\n    return (\n      value === null ||\n      value === undefined ||\n      typeof value === 'string' ||\n      typeof value === 'number' ||\n      typeof value === 'boolean'\n    );\n  }\n\n  protected isRegex(value: any): boolean {\n    return value instanceof RegExp;\n  }\n\n  protected isEmpty(obj: any): boolean {\n    return obj === null || obj === undefined || (typeof obj === 'object' && Object.keys(obj).length === 0);\n  }\n\n  protected static readonly ErrorMessages = {\n    UNSUPPORTED_OPERATOR: (op: string) => `Unsupported operator: ${op}`,\n    INVALID_LOGICAL_OPERATOR_LOCATION: (op: string, path: string) =>\n      `Logical operator ${op} cannot be used at field level: ${path}`,\n    NOT_REQUIRES_OBJECT: `$not operator requires an object`,\n    NOT_CANNOT_BE_EMPTY: `$not operator cannot be empty`,\n    INVALID_LOGICAL_OPERATOR_CONTENT: (path: string) =>\n      `Logical operators must contain field conditions, not direct operators: ${path}`,\n    INVALID_TOP_LEVEL_OPERATOR: (op: string) => `Invalid top-level operator: ${op}`,\n    ELEM_MATCH_REQUIRES_OBJECT: `$elemMatch requires an object with conditions`,\n  } as const;\n\n  /**\n   * Helper to handle array value normalization consistently\n   */\n  protected normalizeArrayValues(values: any[]): any[] {\n    return values.map(value => this.normalizeComparisonValue(value));\n  }\n\n  protected validateFilter(filter: Filter): void {\n    const validation = this.validateFilterSupport(filter);\n    if (!validation.supported) {\n      throw new Error(validation.messages.join(', '));\n    }\n  }\n\n  /**\n   * Validates if a filter structure is supported by the specific vector DB\n   * and returns detailed validation information.\n   */\n  private validateFilterSupport(\n    node: Filter,\n    path: string = '',\n  ): {\n    supported: boolean;\n    messages: string[];\n  } {\n    const messages: string[] = [];\n\n    // Handle primitives and empty values\n    if (this.isPrimitive(node) || this.isEmpty(node)) {\n      return { supported: true, messages: [] };\n    }\n\n    // Handle arrays\n    if (Array.isArray(node)) {\n      const arrayResults = node.map(item => this.validateFilterSupport(item, path));\n      const arrayMessages = arrayResults.flatMap(r => r.messages);\n      return {\n        supported: arrayResults.every(r => r.supported),\n        messages: arrayMessages,\n      };\n    }\n\n    // Process object entries\n    const nodeObj = node as Record<string, any>;\n    let isSupported = true;\n\n    for (const [key, value] of Object.entries(nodeObj)) {\n      const newPath = path ? `${path}.${key}` : key;\n      // Check if the key is an operator\n      if (this.isOperator(key)) {\n        if (!this.isValidOperator(key)) {\n          isSupported = false;\n          messages.push(BaseFilterTranslator.ErrorMessages.UNSUPPORTED_OPERATOR(key));\n          continue;\n        }\n\n        // Add check for non-logical operators at top level\n        if (!path && !this.isLogicalOperator(key)) {\n          isSupported = false;\n          messages.push(BaseFilterTranslator.ErrorMessages.INVALID_TOP_LEVEL_OPERATOR(key));\n          continue;\n        }\n\n        // In the translate method or wherever operators are handled\n        if (key === '$elemMatch' && (typeof value !== 'object' || Array.isArray(value))) {\n          isSupported = false;\n          messages.push(BaseFilterTranslator.ErrorMessages.ELEM_MATCH_REQUIRES_OBJECT);\n          continue;\n        }\n\n        // Special validation for logical operators\n        if (this.isLogicalOperator(key)) {\n          if (key === '$not') {\n            if (Array.isArray(value) || typeof value !== 'object') {\n              isSupported = false;\n              messages.push(BaseFilterTranslator.ErrorMessages.NOT_REQUIRES_OBJECT);\n              continue;\n            }\n            if (this.isEmpty(value)) {\n              isSupported = false;\n              messages.push(BaseFilterTranslator.ErrorMessages.NOT_CANNOT_BE_EMPTY);\n              continue;\n            }\n            // $not can be used at field level or top level\n            continue;\n          }\n          // Other logical operators can only be at top level or nested in logical operators\n          if (path && !this.isLogicalOperator(path.split('.').pop()!)) {\n            isSupported = false;\n            messages.push(BaseFilterTranslator.ErrorMessages.INVALID_LOGICAL_OPERATOR_LOCATION(key, newPath));\n            continue;\n          }\n\n          if (Array.isArray(value)) {\n            const hasDirectOperators = value.some(\n              item =>\n                typeof item === 'object' &&\n                Object.keys(item).length === 1 &&\n                this.isFieldOperator(Object.keys(item)[0]!),\n            );\n\n            if (hasDirectOperators) {\n              isSupported = false;\n              messages.push(BaseFilterTranslator.ErrorMessages.INVALID_LOGICAL_OPERATOR_CONTENT(newPath));\n              continue;\n            }\n          }\n        }\n      }\n\n      // Recursively validate nested value\n      const nestedValidation = this.validateFilterSupport(value, newPath);\n      if (!nestedValidation.supported) {\n        isSupported = false;\n        messages.push(...nestedValidation.messages);\n      }\n    }\n\n    return { supported: isSupported, messages };\n  }\n}\n\n// Export types and base class\nexport {\n  type QueryOperator,\n  type BasicOperator,\n  type NumericOperator,\n  type LogicalOperator,\n  type ArrayOperator,\n  type RegexOperator,\n  type ElementOperator,\n  type VectorFilter,\n  type FilterValue,\n  type VectorFieldValue,\n  type FieldCondition,\n  type OperatorCondition,\n  type OperatorSupport,\n  type OperatorValueMap,\n  type LogicalOperatorValueMap,\n  type BlacklistedRootOperators,\n  BaseFilterTranslator,\n};\n"],"names":[],"mappings":"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"}}]
}