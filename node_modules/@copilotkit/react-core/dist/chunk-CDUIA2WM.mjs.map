{"version":3,"sources":["../src/hooks/use-frontend-tool.ts"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport { ActionRenderProps, FrontendAction } from \"../types/frontend-action\";\nimport { Parameter, getZodParameters, MappedParameterTypes } from \"@copilotkit/shared\";\nimport { parseJson } from \"@copilotkit/shared\";\nimport { ToolCallStatus } from \"@copilotkitnext/core\";\nimport {\n  type ReactFrontendTool,\n  useFrontendTool as useFrontendToolVNext,\n} from \"@copilotkitnext/react\";\n\ntype FrontendToolOptions<T extends Parameter[] | []> = ReactFrontendTool<MappedParameterTypes<T>>;\ntype FrontendToolRenderArgs<T extends Parameter[] | []> =\n  | {\n      name: string;\n      args: Partial<MappedParameterTypes<T>>;\n      status: ToolCallStatus.InProgress;\n      result: undefined;\n    }\n  | {\n      name: string;\n      args: MappedParameterTypes<T>;\n      status: ToolCallStatus.Executing;\n      result: undefined;\n    }\n  | {\n      name: string;\n      args: MappedParameterTypes<T>;\n      status: ToolCallStatus.Complete;\n      result: string;\n    };\n\nexport type UseFrontendToolArgs<T extends Parameter[] | [] = []> = {\n  available?: \"disabled\" | \"enabled\";\n} & Pick<\n  FrontendAction<T>,\n  \"name\" | \"description\" | \"parameters\" | \"handler\" | \"followUp\" | \"render\"\n>;\n\nexport function useFrontendTool<const T extends Parameter[] = []>(\n  tool: UseFrontendToolArgs<T>,\n  dependencies?: any[],\n) {\n  const { name, description, parameters, render, followUp } = tool;\n  const zodParameters = getZodParameters(parameters);\n\n  const normalizedRender: FrontendToolOptions<T>[\"render\"] | undefined = (() => {\n    if (typeof render === \"undefined\") {\n      return undefined;\n    }\n\n    if (typeof render === \"string\") {\n      const staticRender = render;\n      return (() =>\n        React.createElement(\n          React.Fragment,\n          null,\n          staticRender,\n        )) as FrontendToolOptions<T>[\"render\"];\n    }\n\n    return ((args: FrontendToolRenderArgs<T>) => {\n      const renderArgs = {\n        ...args,\n        result: typeof args.result === \"string\" ? parseJson(args.result, args.result) : args.result,\n      } as ActionRenderProps<T>;\n\n      const rendered = render(renderArgs);\n\n      if (typeof rendered === \"string\") {\n        return React.createElement(React.Fragment, null, rendered);\n      }\n\n      return rendered ?? null;\n    }) as FrontendToolOptions<T>[\"render\"];\n  })();\n\n  // Handler ref to avoid stale closures\n  const handlerRef = useRef<typeof tool.handler>(tool.handler);\n\n  useEffect(() => {\n    handlerRef.current = tool.handler;\n  }, [tool.handler, ...(dependencies ?? [])]);\n\n  const normalizedHandler = tool.handler\n    ? (args: MappedParameterTypes<T>) => handlerRef.current?.(args)\n    : undefined;\n\n  useFrontendToolVNext<MappedParameterTypes<T>>({\n    name,\n    description,\n    parameters: zodParameters,\n    handler: normalizedHandler,\n    followUp,\n    render: normalizedRender,\n  });\n}\n"],"mappings":";;;;;;AAAA,OAAO,SAAS,WAAW,cAAc;AAEzC,SAAoB,wBAA8C;AAClE,SAAS,iBAAiB;AAE1B;AAAA,EAEE,mBAAmB;AAAA,OACd;AA8BA,SAAS,gBACd,MACA,cACA;AACA,QAAM,EAAE,MAAM,aAAa,YAAY,QAAQ,SAAS,IAAI;AAC5D,QAAM,gBAAgB,iBAAiB,UAAU;AAEjD,QAAM,oBAAkE,MAAM;AAC5E,QAAI,OAAO,WAAW,aAAa;AACjC,aAAO;AAAA,IACT;AAEA,QAAI,OAAO,WAAW,UAAU;AAC9B,YAAM,eAAe;AACrB,aAAQ,MACN,MAAM;AAAA,QACJ,MAAM;AAAA,QACN;AAAA,QACA;AAAA,MACF;AAAA,IACJ;AAEA,WAAQ,CAAC,SAAoC;AAC3C,YAAM,aAAa,iCACd,OADc;AAAA,QAEjB,QAAQ,OAAO,KAAK,WAAW,WAAW,UAAU,KAAK,QAAQ,KAAK,MAAM,IAAI,KAAK;AAAA,MACvF;AAEA,YAAM,WAAW,OAAO,UAAU;AAElC,UAAI,OAAO,aAAa,UAAU;AAChC,eAAO,MAAM,cAAc,MAAM,UAAU,MAAM,QAAQ;AAAA,MAC3D;AAEA,aAAO,8BAAY;AAAA,IACrB;AAAA,EACF,GAAG;AAGH,QAAM,aAAa,OAA4B,KAAK,OAAO;AAE3D,YAAU,MAAM;AACd,eAAW,UAAU,KAAK;AAAA,EAC5B,GAAG,CAAC,KAAK,SAAS,GAAI,sCAAgB,CAAC,CAAE,CAAC;AAE1C,QAAM,oBAAoB,KAAK,UAC3B,CAAC,SAA+B;AApFtC;AAoFyC,4BAAW,YAAX,oCAAqB;AAAA,MACxD;AAEJ,uBAA8C;AAAA,IAC5C;AAAA,IACA;AAAA,IACA,YAAY;AAAA,IACZ,SAAS;AAAA,IACT;AAAA,IACA,QAAQ;AAAA,EACV,CAAC;AACH;","names":[]}