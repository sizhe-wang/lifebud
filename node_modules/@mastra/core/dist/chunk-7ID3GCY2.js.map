{"version":3,"sources":["../src/workflows/evented/step-executor.ts","../src/events/processor.ts","../src/workflows/evented/workflow-event-processor/loop.ts","../src/workflows/evented/workflow-event-processor/parallel.ts","../src/workflows/evented/workflow-event-processor/sleep.ts","../src/workflows/evented/workflow-event-processor/index.ts","../src/workflows/evented/workflow.ts","../src/workflows/evented/workflow-event-processor/utils.ts","../src/workflows/evented/execution-engine.ts"],"names":["validationError","EventEmitter","step","processorSpan","processorTracingContext","randomUUID"],"mappings":"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","file":"chunk-7ID3GCY2.js","sourcesContent":["import EventEmitter from 'node:events';\nimport { MastraBase } from '../../base';\nimport type { RequestContext } from '../../di';\nimport { getErrorFromUnknown } from '../../error/utils.js';\nimport { EventEmitterPubSub } from '../../events/event-emitter';\nimport type { PubSub } from '../../events/pubsub';\nimport { RegisteredLogger } from '../../logger';\nimport type { Mastra } from '../../mastra';\nimport { PUBSUB_SYMBOL, STREAM_FORMAT_SYMBOL } from '../constants';\nimport { getStepResult } from '../step';\nimport type { InnerOutput, LoopConditionFunction, Step } from '../step';\nimport type { StepFlowEntry, StepResult } from '../types';\nimport {\n  validateStepInput,\n  createDeprecationProxy,\n  runCountDeprecationMessage,\n  validateStepSuspendData,\n} from '../utils';\n\nexport class StepExecutor extends MastraBase {\n  protected mastra?: Mastra;\n  constructor({ mastra }: { mastra?: Mastra }) {\n    super({ name: 'StepExecutor', component: RegisteredLogger.WORKFLOW });\n    this.mastra = mastra;\n  }\n\n  __registerMastra(mastra: Mastra) {\n    this.mastra = mastra;\n  }\n\n  async execute(params: {\n    workflowId: string;\n    step: Step<any, any, any, any>;\n    runId: string;\n    input?: any;\n    resumeData?: any;\n    stepResults: Record<string, StepResult<any, any, any, any>>;\n    state: Record<string, any>;\n    emitter: EventEmitter;\n    requestContext: RequestContext;\n    retryCount?: number;\n    foreachIdx?: number;\n    validateInputs?: boolean;\n    abortController?: AbortController;\n    perStep?: boolean;\n  }): Promise<StepResult<any, any, any, any>> {\n    const { step, stepResults, runId, requestContext, retryCount = 0, perStep } = params;\n\n    // Use provided abortController or create a new one for backwards compatibility\n    const abortController = params.abortController ?? new AbortController();\n\n    let suspended: { payload: any } | undefined;\n    let bailed: { payload: any } | undefined;\n    const startedAt = Date.now();\n    const { inputData, validationError } = await validateStepInput({\n      prevOutput: typeof params.foreachIdx === 'number' ? params.input?.[params.foreachIdx] : params.input,\n      step,\n      validateInputs: params.validateInputs ?? true,\n    });\n\n    let stepInfo: {\n      startedAt: number;\n      payload: any;\n      resumePayload?: any;\n      resumedAt?: number;\n      [key: string]: any;\n    } = {\n      ...stepResults[step.id],\n      startedAt,\n      payload: (typeof params.foreachIdx === 'number' ? params.input : inputData) ?? {},\n    };\n\n    if (params.resumeData) {\n      delete stepInfo.suspendPayload?.['__workflow_meta'];\n      stepInfo.resumePayload = params.resumeData;\n      stepInfo.resumedAt = Date.now();\n    }\n\n    // Extract suspend data if this step was previously suspended\n    let suspendDataToUse =\n      params.stepResults[step.id]?.status === 'suspended' ? params.stepResults[step.id]?.suspendPayload : undefined;\n\n    // Filter out internal workflow metadata before exposing to step code\n    if (suspendDataToUse && '__workflow_meta' in suspendDataToUse) {\n      const { __workflow_meta, ...userSuspendData } = suspendDataToUse;\n      suspendDataToUse = userSuspendData;\n    }\n\n    try {\n      if (validationError) {\n        throw validationError;\n      }\n\n      const stepOutput = await step.execute(\n        createDeprecationProxy(\n          {\n            workflowId: params.workflowId,\n            runId,\n            mastra: this.mastra!,\n            requestContext,\n            inputData,\n            state: params.state,\n            setState: async (state: any) => {\n              // TODO\n              params.state = state;\n            },\n            retryCount,\n            resumeData: params.resumeData,\n            suspendData: suspendDataToUse,\n            getInitData: () => stepResults?.input as any,\n            getStepResult: getStepResult.bind(this, stepResults),\n            suspend: async (suspendPayload: unknown): Promise<InnerOutput> => {\n              const { suspendData, validationError } = await validateStepSuspendData({\n                suspendData: suspendPayload,\n                step,\n                validateInputs: params.validateInputs ?? true,\n              });\n              if (validationError) {\n                throw validationError;\n              }\n              suspended = { payload: { ...suspendData, __workflow_meta: { runId, path: [step.id] } } };\n            },\n            bail: (result: any): InnerOutput => {\n              bailed = { payload: result };\n            },\n            // TODO\n            writer: undefined as any,\n            abort: () => {\n              abortController?.abort();\n            },\n            [PUBSUB_SYMBOL]: this.mastra?.pubsub ?? new EventEmitterPubSub(params.emitter),\n            [STREAM_FORMAT_SYMBOL]: undefined, // TODO\n            engine: {},\n            abortSignal: abortController?.signal,\n            // TODO\n            tracingContext: {},\n          },\n          {\n            paramName: 'runCount',\n            deprecationMessage: runCountDeprecationMessage,\n            logger: this.logger,\n          },\n        ),\n      );\n\n      const isNestedWorkflowStep = step.component === 'WORKFLOW';\n\n      const nestedWflowStepPaused = isNestedWorkflowStep && perStep;\n\n      const endedAt = Date.now();\n\n      let finalResult: StepResult<any, any, any, any>;\n      if (suspended) {\n        finalResult = {\n          ...stepInfo,\n          status: 'suspended',\n          suspendedAt: endedAt,\n          ...(stepOutput ? { suspendOutput: stepOutput } : {}),\n        };\n\n        if (suspended.payload) {\n          finalResult.suspendPayload = suspended.payload;\n        }\n      } else if (bailed) {\n        finalResult = {\n          ...stepInfo,\n          // @ts-ignore\n          status: 'bailed',\n          endedAt,\n          output: bailed.payload,\n        };\n      } else if (nestedWflowStepPaused) {\n        finalResult = {\n          ...stepInfo,\n          status: 'paused',\n        };\n      } else {\n        finalResult = {\n          ...stepInfo,\n          status: 'success',\n          endedAt,\n          output: stepOutput,\n        };\n      }\n\n      return finalResult;\n    } catch (error: any) {\n      const endedAt = Date.now();\n\n      const errorInstance = getErrorFromUnknown(error, {\n        serializeStack: false,\n        fallbackMessage: 'Unknown step execution error',\n      });\n\n      return {\n        ...stepInfo,\n        status: 'failed',\n        endedAt,\n        error: errorInstance,\n      };\n    }\n  }\n\n  async evaluateConditions(params: {\n    workflowId: string;\n    step: Extract<StepFlowEntry, { type: 'conditional' }>;\n    runId: string;\n    input?: any;\n    resumeData?: any;\n    stepResults: Record<string, StepResult<any, any, any, any>>;\n    state: Record<string, any>;\n    emitter: { runtime: PubSub; events: PubSub };\n    requestContext: RequestContext;\n    retryCount?: number;\n    abortController?: AbortController;\n  }): Promise<number[]> {\n    const { step, stepResults, runId, requestContext, retryCount = 0 } = params;\n\n    const abortController = params.abortController ?? new AbortController();\n    const ee = new EventEmitter();\n\n    const results = await Promise.all(\n      step.conditions.map(condition => {\n        try {\n          return this.evaluateCondition({\n            workflowId: params.workflowId,\n            condition,\n            runId,\n            requestContext,\n            inputData: params.input,\n            state: params.state,\n            retryCount,\n            resumeData: params.resumeData,\n            abortController,\n            stepResults,\n            emitter: ee,\n            iterationCount: 0,\n          });\n        } catch (e) {\n          this.mastra?.getLogger()?.error('error evaluating condition', e);\n          return false;\n        }\n      }),\n    );\n\n    const idxs = results.reduce((acc, result, idx) => {\n      if (result) {\n        acc.push(idx);\n      }\n\n      return acc;\n    }, [] as number[]);\n\n    return idxs;\n  }\n\n  async evaluateCondition({\n    workflowId,\n    condition,\n    runId,\n    inputData,\n    resumeData,\n    stepResults,\n    state,\n    requestContext,\n    emitter,\n    abortController,\n    retryCount = 0,\n    iterationCount,\n  }: {\n    workflowId: string;\n    condition: LoopConditionFunction<any, any, any, any, any, any>;\n    runId: string;\n    inputData?: any;\n    resumeData?: any;\n    stepResults: Record<string, StepResult<any, any, any, any>>;\n    state: Record<string, any>;\n    emitter: EventEmitter;\n    requestContext: RequestContext;\n    abortController: AbortController;\n    retryCount?: number;\n    iterationCount: number;\n  }): Promise<boolean> {\n    return condition(\n      createDeprecationProxy(\n        {\n          workflowId,\n          runId,\n          mastra: this.mastra!,\n          requestContext,\n          inputData,\n          state,\n          retryCount,\n          resumeData: resumeData,\n          getInitData: () => stepResults?.input as any,\n          getStepResult: getStepResult.bind(this, stepResults),\n          bail: (_result: any) => {\n            throw new Error('Not implemented');\n          },\n          // TODO\n          writer: undefined as any,\n          abort: () => {\n            abortController?.abort();\n          },\n          [PUBSUB_SYMBOL]: this.mastra?.pubsub ?? new EventEmitterPubSub(emitter),\n          [STREAM_FORMAT_SYMBOL]: undefined, // TODO\n          engine: {},\n          abortSignal: abortController?.signal,\n          // TODO\n          tracingContext: {},\n          iterationCount,\n        },\n        {\n          paramName: 'runCount',\n          deprecationMessage: runCountDeprecationMessage,\n          logger: this.logger,\n        },\n      ),\n    );\n  }\n\n  async resolveSleep(params: {\n    workflowId: string;\n    step: Extract<StepFlowEntry, { type: 'sleep' }>;\n    runId: string;\n    input?: any;\n    resumeData?: any;\n    stepResults: Record<string, StepResult<any, any, any, any>>;\n    emitter: { runtime: PubSub; events: PubSub };\n    requestContext: RequestContext;\n    retryCount?: number;\n    abortController?: AbortController;\n  }): Promise<number> {\n    const { step, stepResults, runId, requestContext, retryCount = 0 } = params;\n\n    const abortController = params.abortController ?? new AbortController();\n    const ee = new EventEmitter();\n\n    if (step.duration) {\n      return step.duration;\n    }\n\n    if (!step.fn) {\n      return 0;\n    }\n\n    try {\n      return await step.fn(\n        createDeprecationProxy(\n          {\n            workflowId: params.workflowId,\n            runId,\n            mastra: this.mastra!,\n            requestContext,\n            inputData: params.input,\n            // TODO: implement state\n            state: {},\n            setState: async (_state: any) => {\n              // TODO\n            },\n            retryCount,\n            resumeData: params.resumeData,\n            getInitData: () => stepResults?.input as any,\n            getStepResult: getStepResult.bind(this, stepResults),\n            suspend: async (_suspendPayload: any): Promise<any> => {\n              throw new Error('Not implemented');\n            },\n            bail: (_result: any) => {\n              throw new Error('Not implemented');\n            },\n            abort: () => {\n              abortController?.abort();\n            },\n            // TODO\n            writer: undefined as any,\n            [PUBSUB_SYMBOL]: this.mastra?.pubsub ?? new EventEmitterPubSub(ee),\n            [STREAM_FORMAT_SYMBOL]: undefined, // TODO\n            engine: {},\n            abortSignal: abortController?.signal,\n            // TODO\n            tracingContext: {},\n          },\n          {\n            paramName: 'runCount',\n            deprecationMessage: runCountDeprecationMessage,\n            logger: this.logger,\n          },\n        ),\n      );\n    } catch (e) {\n      this.mastra?.getLogger()?.error('error evaluating condition', e);\n      return 0;\n    }\n  }\n\n  async resolveSleepUntil(params: {\n    workflowId: string;\n    step: Extract<StepFlowEntry, { type: 'sleepUntil' }>;\n    runId: string;\n    input?: any;\n    resumeData?: any;\n    stepResults: Record<string, StepResult<any, any, any, any>>;\n    emitter: { runtime: PubSub; events: PubSub };\n    requestContext: RequestContext;\n    retryCount?: number;\n    abortController?: AbortController;\n  }): Promise<number> {\n    const { step, stepResults, runId, requestContext, retryCount = 0 } = params;\n\n    const abortController = params.abortController ?? new AbortController();\n    const ee = new EventEmitter();\n\n    if (step.date) {\n      return step.date.getTime() - Date.now();\n    }\n\n    if (!step.fn) {\n      return 0;\n    }\n\n    try {\n      const result = await step.fn(\n        createDeprecationProxy(\n          {\n            workflowId: params.workflowId,\n            runId,\n            mastra: this.mastra!,\n            requestContext,\n            inputData: params.input,\n            // TODO: implement state\n            state: {},\n            setState: async (_state: any) => {\n              // TODO\n            },\n            retryCount,\n            resumeData: params.resumeData,\n            getInitData: () => stepResults?.input as any,\n            getStepResult: getStepResult.bind(this, stepResults),\n            suspend: async (_suspendPayload: any): Promise<any> => {\n              throw new Error('Not implemented');\n            },\n            bail: (_result: any) => {\n              throw new Error('Not implemented');\n            },\n            abort: () => {\n              abortController?.abort();\n            },\n            // TODO\n            writer: undefined as any,\n            [PUBSUB_SYMBOL]: this.mastra?.pubsub ?? new EventEmitterPubSub(ee),\n            [STREAM_FORMAT_SYMBOL]: undefined, // TODO\n            engine: {},\n            abortSignal: abortController?.signal,\n            // TODO\n            tracingContext: {},\n          },\n          {\n            paramName: 'runCount',\n            deprecationMessage: runCountDeprecationMessage,\n            logger: this.logger,\n          },\n        ),\n      );\n\n      return result.getTime() - Date.now();\n    } catch (e) {\n      this.mastra?.getLogger()?.error('error evaluating condition', e);\n      return 0;\n    }\n  }\n}\n","import type { Mastra } from '../mastra';\nimport type { Event } from './types';\n\nexport abstract class EventProcessor {\n  protected mastra: Mastra;\n\n  __registerMastra(mastra: Mastra) {\n    this.mastra = mastra;\n  }\n\n  constructor({ mastra }: { mastra: Mastra }) {\n    this.mastra = mastra;\n  }\n\n  protected abstract process(event: Event): Promise<void>;\n}\n","import EventEmitter from 'node:events';\nimport type { StepFlowEntry, StepResult } from '../..';\nimport { RequestContext } from '../../../di';\nimport type { PubSub } from '../../../events';\nimport type { Mastra } from '../../../mastra';\nimport type { StepExecutor } from '../step-executor';\nimport type { ProcessorArgs } from '.';\n\nexport async function processWorkflowLoop(\n  {\n    workflowId,\n    prevResult,\n    runId,\n    executionPath,\n    stepResults,\n    activeSteps,\n    resumeSteps,\n    resumeData,\n    parentWorkflow,\n    requestContext,\n    retryCount = 0,\n    perStep,\n  }: ProcessorArgs,\n  {\n    pubsub,\n    stepExecutor,\n    step,\n    stepResult,\n  }: {\n    pubsub: PubSub;\n    stepExecutor: StepExecutor;\n    step: Extract<StepFlowEntry, { type: 'loop' }>;\n    stepResult: StepResult<any, any, any, any>;\n  },\n) {\n  const loopCondition = await stepExecutor.evaluateCondition({\n    workflowId,\n    condition: step.condition,\n    runId,\n    stepResults,\n    // TODO: implement state\n    state: {},\n    emitter: new EventEmitter() as any, // TODO\n    requestContext: new RequestContext(), // TODO\n    inputData: prevResult?.status === 'success' ? prevResult.output : undefined,\n    resumeData,\n    abortController: new AbortController(),\n    retryCount,\n    iterationCount: 0, //TODO: implement\n  });\n\n  if (step.loopType === 'dountil') {\n    if (loopCondition) {\n      await pubsub.publish('workflows', {\n        type: 'workflow.step.end',\n        runId,\n        data: {\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          stepResults,\n          prevResult: stepResult,\n          resumeData,\n          activeSteps,\n          requestContext,\n          perStep,\n        },\n      });\n    } else {\n      await pubsub.publish('workflows', {\n        type: 'workflow.step.run',\n        runId,\n        data: {\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          stepResults,\n          prevResult: stepResult,\n          resumeData,\n          activeSteps,\n          requestContext,\n          retryCount,\n          perStep,\n        },\n      });\n    }\n  } else {\n    if (loopCondition) {\n      await pubsub.publish('workflows', {\n        type: 'workflow.step.run',\n        runId,\n        data: {\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          stepResults,\n          prevResult: stepResult,\n          resumeData,\n          activeSteps,\n          requestContext,\n          retryCount,\n          perStep,\n        },\n      });\n    } else {\n      await pubsub.publish('workflows', {\n        type: 'workflow.step.end',\n        runId,\n        data: {\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          stepResults,\n          prevResult: stepResult,\n          resumeData,\n          activeSteps,\n          requestContext,\n          perStep,\n        },\n      });\n    }\n  }\n}\n\nexport async function processWorkflowForEach(\n  {\n    workflowId,\n    prevResult,\n    runId,\n    executionPath,\n    stepResults,\n    activeSteps,\n    resumeSteps,\n    timeTravel,\n    resumeData,\n    parentWorkflow,\n    requestContext,\n    perStep,\n  }: ProcessorArgs,\n  {\n    pubsub,\n    mastra,\n    step,\n  }: {\n    pubsub: PubSub;\n    mastra: Mastra;\n    step: Extract<StepFlowEntry, { type: 'foreach' }>;\n  },\n) {\n  const currentResult: Extract<StepResult<any, any, any, any>, { status: 'success' }> = stepResults[\n    step.step.id\n  ] as any;\n\n  const idx = currentResult?.output?.length ?? 0;\n  const targetLen = (prevResult as any)?.output?.length ?? 0;\n\n  if (idx >= targetLen && currentResult.output.filter((r: any) => r !== null).length >= targetLen) {\n    await pubsub.publish('workflows', {\n      type: 'workflow.step.run',\n      runId,\n      data: {\n        parentWorkflow,\n        workflowId,\n        runId,\n        executionPath: executionPath.slice(0, -1).concat([executionPath[executionPath.length - 1]! + 1]),\n        resumeSteps,\n        stepResults,\n        timeTravel,\n        prevResult: currentResult,\n        resumeData,\n        activeSteps,\n        requestContext,\n        perStep,\n      },\n    });\n\n    return;\n  } else if (idx >= targetLen) {\n    // wait for the 'null' values to be filled from the concurrent run\n    return;\n  }\n\n  const workflowsStore = await mastra.getStorage()?.getStore('workflows');\n\n  if (executionPath.length === 1 && idx === 0) {\n    // on first iteratation we need to kick off up to the set concurrency\n    const concurrency = Math.min(step.opts.concurrency ?? 1, targetLen);\n    const dummyResult = Array.from({ length: concurrency }, () => null);\n\n    await workflowsStore?.updateWorkflowResults({\n      workflowName: workflowId,\n      runId,\n      stepId: step.step.id,\n      result: {\n        status: 'success',\n        output: dummyResult as any,\n        startedAt: Date.now(),\n        payload: (prevResult as any)?.output,\n      } as any,\n      requestContext,\n    });\n\n    for (let i = 0; i < concurrency; i++) {\n      await pubsub.publish('workflows', {\n        type: 'workflow.step.run',\n        runId,\n        data: {\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath: [executionPath[0]!, i],\n          resumeSteps,\n          stepResults,\n          timeTravel,\n          prevResult,\n          resumeData,\n          activeSteps,\n          requestContext,\n          perStep,\n        },\n      });\n    }\n\n    return;\n  }\n\n  (currentResult as any).output.push(null);\n  await workflowsStore?.updateWorkflowResults({\n    workflowName: workflowId,\n    runId,\n    stepId: step.step.id,\n    result: {\n      status: 'success',\n      output: (currentResult as any).output,\n      startedAt: Date.now(),\n      payload: (prevResult as any)?.output,\n    } as any,\n    requestContext,\n  });\n\n  await pubsub.publish('workflows', {\n    type: 'workflow.step.run',\n    runId,\n    data: {\n      parentWorkflow,\n      workflowId,\n      runId,\n      executionPath: [executionPath[0]!, idx],\n      resumeSteps,\n      timeTravel,\n      stepResults,\n      prevResult,\n      resumeData,\n      activeSteps,\n      requestContext,\n      perStep,\n    },\n  });\n}\n","import EventEmitter from 'node:events';\nimport type { StepFlowEntry } from '../..';\nimport { RequestContext } from '../../../di';\nimport type { PubSub } from '../../../events';\nimport type { StepExecutor } from '../step-executor';\nimport type { ProcessorArgs } from '.';\n\nexport async function processWorkflowParallel(\n  {\n    workflowId,\n    runId,\n    executionPath,\n    stepResults,\n    activeSteps,\n    resumeSteps,\n    timeTravel,\n    prevResult,\n    resumeData,\n    parentWorkflow,\n    requestContext,\n    perStep,\n  }: ProcessorArgs,\n  {\n    pubsub,\n    step,\n  }: {\n    pubsub: PubSub;\n    step: Extract<StepFlowEntry, { type: 'parallel' }>;\n  },\n) {\n  for (let i = 0; i < step.steps.length; i++) {\n    const nestedStep = step.steps[i];\n    if (nestedStep?.type === 'step') {\n      activeSteps[nestedStep.step.id] = true;\n      if (perStep) {\n        break;\n      }\n    }\n  }\n\n  await Promise.all(\n    step.steps\n      ?.filter(step => activeSteps[step.step.id])\n      .map(async (_step, idx) => {\n        return pubsub.publish('workflows', {\n          type: 'workflow.step.run',\n          runId,\n          data: {\n            workflowId,\n            runId,\n            executionPath: executionPath.concat([idx]),\n            resumeSteps,\n            stepResults,\n            prevResult,\n            resumeData,\n            timeTravel,\n            parentWorkflow,\n            activeSteps,\n            requestContext,\n            perStep,\n          },\n        });\n      }),\n  );\n}\n\nexport async function processWorkflowConditional(\n  {\n    workflowId,\n    runId,\n    executionPath,\n    stepResults,\n    activeSteps,\n    resumeSteps,\n    timeTravel,\n    prevResult,\n    resumeData,\n    parentWorkflow,\n    requestContext,\n    perStep,\n  }: ProcessorArgs,\n  {\n    pubsub,\n    stepExecutor,\n    step,\n  }: {\n    pubsub: PubSub;\n    stepExecutor: StepExecutor;\n    step: Extract<StepFlowEntry, { type: 'conditional' }>;\n  },\n) {\n  const idxs = await stepExecutor.evaluateConditions({\n    workflowId,\n    step,\n    runId,\n    stepResults,\n    // TODO: implement state\n    state: {},\n    emitter: new EventEmitter() as any, // TODO\n    requestContext: new RequestContext(), // TODO\n    input: prevResult?.status === 'success' ? prevResult.output : undefined,\n    resumeData,\n  });\n\n  const truthyIdxs: Record<number, boolean> = {};\n  for (let i = 0; i < idxs.length; i++) {\n    truthyIdxs[idxs[i]!] = true;\n  }\n\n  let onlyStepToRun: Extract<StepFlowEntry, { type: 'step' }> | undefined;\n\n  if (perStep) {\n    const stepsToRun = step.steps.filter((_, idx) => truthyIdxs[idx]);\n    onlyStepToRun = stepsToRun[0];\n  }\n\n  if (onlyStepToRun) {\n    activeSteps[onlyStepToRun.step.id] = true;\n    const stepIndex = step.steps.findIndex(step => step.step.id === onlyStepToRun.step.id);\n    await pubsub.publish('workflows', {\n      type: 'workflow.step.run',\n      runId,\n      data: {\n        workflowId,\n        runId,\n        executionPath: executionPath.concat([stepIndex]),\n        resumeSteps,\n        stepResults,\n        timeTravel,\n        prevResult,\n        resumeData,\n        parentWorkflow,\n        activeSteps,\n        requestContext,\n        perStep,\n      },\n    });\n  } else {\n    await Promise.all(\n      step.steps.map(async (step, idx) => {\n        if (truthyIdxs[idx]) {\n          if (step?.type === 'step') {\n            activeSteps[step.step.id] = true;\n          }\n          return pubsub.publish('workflows', {\n            type: 'workflow.step.run',\n            runId,\n            data: {\n              workflowId,\n              runId,\n              executionPath: executionPath.concat([idx]),\n              resumeSteps,\n              stepResults,\n              timeTravel,\n              prevResult,\n              resumeData,\n              parentWorkflow,\n              activeSteps,\n              requestContext,\n              perStep,\n            },\n          });\n        } else {\n          return pubsub.publish('workflows', {\n            type: 'workflow.step.end',\n            runId,\n            data: {\n              workflowId,\n              runId,\n              executionPath: executionPath.concat([idx]),\n              resumeSteps,\n              stepResults,\n              prevResult: { status: 'skipped' },\n              resumeData,\n              parentWorkflow,\n              activeSteps,\n              requestContext,\n              perStep,\n            },\n          });\n        }\n      }),\n    );\n  }\n}\n","import EventEmitter from 'node:events';\nimport type { StepFlowEntry, WorkflowRunState } from '../..';\nimport { RequestContext } from '../../../di';\nimport type { PubSub } from '../../../events';\nimport type { StepExecutor } from '../step-executor';\nimport { getStep } from './utils';\nimport type { ProcessorArgs } from '.';\n\nexport async function processWorkflowWaitForEvent(\n  workflowData: ProcessorArgs,\n  {\n    pubsub,\n    eventName,\n    currentState,\n  }: {\n    pubsub: PubSub;\n    eventName: string;\n    currentState: WorkflowRunState;\n  },\n) {\n  const executionPath = currentState?.waitingPaths[eventName];\n  if (!executionPath) {\n    return;\n  }\n\n  const currentStep = getStep(workflowData.workflow, executionPath);\n  const prevResult = {\n    status: 'success',\n    output: currentState?.context[currentStep?.id ?? 'input']?.payload,\n  };\n\n  await pubsub.publish('workflows', {\n    type: 'workflow.step.run',\n    runId: workflowData.runId,\n    data: {\n      workflowId: workflowData.workflowId,\n      runId: workflowData.runId,\n      executionPath,\n      resumeSteps: [],\n      resumeData: workflowData.resumeData,\n      parentWorkflow: workflowData.parentWorkflow,\n      stepResults: currentState?.context,\n      prevResult,\n      activeSteps: [],\n      requestContext: currentState?.requestContext,\n      perStep: workflowData.perStep,\n    },\n  });\n}\n\nexport async function processWorkflowSleep(\n  {\n    workflowId,\n    runId,\n    executionPath,\n    stepResults,\n    activeSteps,\n    resumeSteps,\n    timeTravel,\n    prevResult,\n    resumeData,\n    parentWorkflow,\n    requestContext,\n    perStep,\n  }: ProcessorArgs,\n  {\n    pubsub,\n    stepExecutor,\n    step,\n  }: {\n    pubsub: PubSub;\n    stepExecutor: StepExecutor;\n    step: Extract<StepFlowEntry, { type: 'sleep' }>;\n  },\n) {\n  const startedAt = Date.now();\n  await pubsub.publish(`workflow.events.v2.${runId}`, {\n    type: 'watch',\n    runId,\n    data: {\n      type: 'workflow-step-waiting',\n      payload: {\n        id: step.id,\n        status: 'waiting',\n        payload: prevResult.status === 'success' ? prevResult.output : undefined,\n        startedAt,\n      },\n    },\n  });\n\n  const duration = await stepExecutor.resolveSleep({\n    workflowId,\n    step,\n    runId,\n    stepResults,\n    emitter: new EventEmitter() as any, // TODO\n    requestContext: new RequestContext(), // TODO\n    input: prevResult?.status === 'success' ? prevResult.output : undefined,\n    resumeData,\n  });\n\n  setTimeout(\n    async () => {\n      await pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-step-result',\n          payload: {\n            id: step.id,\n            status: 'success',\n            payload: prevResult.status === 'success' ? prevResult.output : undefined,\n            output: prevResult.status === 'success' ? prevResult.output : undefined,\n            startedAt,\n            endedAt: Date.now(),\n          },\n        },\n      });\n\n      await pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-step-finish',\n          payload: {\n            id: step.id,\n            metadata: {},\n          },\n        },\n      });\n\n      await pubsub.publish('workflows', {\n        type: 'workflow.step.run',\n        runId,\n        data: {\n          workflowId,\n          runId,\n          executionPath: executionPath.slice(0, -1).concat([executionPath[executionPath.length - 1]! + 1]),\n          resumeSteps,\n          timeTravel,\n          stepResults,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          activeSteps,\n          requestContext,\n          perStep,\n        },\n      });\n    },\n    duration < 0 ? 0 : duration,\n  );\n}\n\nexport async function processWorkflowSleepUntil(\n  {\n    workflowId,\n    runId,\n    executionPath,\n    stepResults,\n    activeSteps,\n    resumeSteps,\n    timeTravel,\n    prevResult,\n    resumeData,\n    parentWorkflow,\n    requestContext,\n    perStep,\n  }: ProcessorArgs,\n  {\n    pubsub,\n    stepExecutor,\n    step,\n  }: {\n    pubsub: PubSub;\n    stepExecutor: StepExecutor;\n    step: Extract<StepFlowEntry, { type: 'sleepUntil' }>;\n  },\n) {\n  const startedAt = Date.now();\n  const duration = await stepExecutor.resolveSleepUntil({\n    workflowId,\n    step,\n    runId,\n    stepResults,\n    emitter: new EventEmitter() as any, // TODO\n    requestContext: new RequestContext(), // TODO\n    input: prevResult?.status === 'success' ? prevResult.output : undefined,\n    resumeData,\n  });\n\n  await pubsub.publish(`workflow.events.v2.${runId}`, {\n    type: 'watch',\n    runId,\n    data: {\n      type: 'workflow-step-waiting',\n      payload: {\n        id: step.id,\n        status: 'waiting',\n        payload: prevResult.status === 'success' ? prevResult.output : undefined,\n        startedAt,\n      },\n    },\n  });\n\n  setTimeout(\n    async () => {\n      await pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-step-result',\n          payload: {\n            id: step.id,\n            status: 'success',\n            payload: prevResult.status === 'success' ? prevResult.output : undefined,\n            output: prevResult.status === 'success' ? prevResult.output : undefined,\n            startedAt,\n            endedAt: Date.now(),\n          },\n        },\n      });\n\n      await pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-step-finish',\n          payload: {\n            id: step.id,\n            metadata: {},\n          },\n        },\n      });\n\n      await pubsub.publish('workflows', {\n        type: 'workflow.step.run',\n        runId,\n        data: {\n          workflowId,\n          runId,\n          executionPath: executionPath.slice(0, -1).concat([executionPath[executionPath.length - 1]! + 1]),\n          resumeSteps,\n          timeTravel,\n          stepResults,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          activeSteps,\n          requestContext,\n          perStep,\n        },\n      });\n    },\n    duration < 0 ? 0 : duration,\n  );\n}\n","import { randomUUID } from 'node:crypto';\nimport EventEmitter from 'node:events';\nimport { ErrorCategory, ErrorDomain, MastraError, getErrorFromUnknown } from '../../../error';\nimport { EventProcessor } from '../../../events/processor';\nimport type { Event } from '../../../events/types';\nimport type { Mastra } from '../../../mastra';\nimport { RequestContext } from '../../../request-context/';\nimport type {\n  StepFlowEntry,\n  StepResult,\n  StepSuccess,\n  TimeTravelExecutionParams,\n  WorkflowRunState,\n} from '../../../workflows/types';\nimport type { Workflow } from '../../../workflows/workflow';\nimport { createTimeTravelExecutionParams, validateStepResumeData } from '../../utils';\nimport { StepExecutor } from '../step-executor';\nimport { EventedWorkflow } from '../workflow';\nimport { processWorkflowForEach, processWorkflowLoop } from './loop';\nimport { processWorkflowConditional, processWorkflowParallel } from './parallel';\nimport { processWorkflowSleep, processWorkflowSleepUntil, processWorkflowWaitForEvent } from './sleep';\nimport { getNestedWorkflow, getStep, isExecutableStep } from './utils';\n\nexport type ProcessorArgs = {\n  activeSteps: Record<string, boolean>;\n  workflow: Workflow;\n  workflowId: string;\n  runId: string;\n  executionPath: number[];\n  stepResults: Record<string, StepResult<any, any, any, any>>;\n  resumeSteps: string[];\n  prevResult: StepResult<any, any, any, any>;\n  requestContext: Record<string, any>;\n  timeTravel?: TimeTravelExecutionParams;\n  resumeData?: any;\n  parentWorkflow?: ParentWorkflow;\n  parentContext?: {\n    workflowId: string;\n    input: any;\n  };\n  retryCount?: number;\n  perStep?: boolean;\n};\n\nexport type ParentWorkflow = {\n  workflowId: string;\n  runId: string;\n  executionPath: number[];\n  resume: boolean;\n  stepResults: Record<string, StepResult<any, any, any, any>>;\n  parentWorkflow?: ParentWorkflow;\n  stepId: string;\n};\n\nexport class WorkflowEventProcessor extends EventProcessor {\n  private stepExecutor: StepExecutor;\n  // Map of runId -> AbortController for active workflow runs\n  private abortControllers: Map<string, AbortController> = new Map();\n  // Map of child runId -> parent runId for tracking nested workflows\n  private parentChildRelationships: Map<string, string> = new Map();\n\n  constructor({ mastra }: { mastra: Mastra }) {\n    super({ mastra });\n    this.stepExecutor = new StepExecutor({ mastra });\n  }\n\n  /**\n   * Get or create an AbortController for a workflow run\n   */\n  private getOrCreateAbortController(runId: string): AbortController {\n    let controller = this.abortControllers.get(runId);\n    if (!controller) {\n      controller = new AbortController();\n      this.abortControllers.set(runId, controller);\n    }\n    return controller;\n  }\n\n  /**\n   * Cancel a workflow run and all its nested child workflows\n   */\n  private cancelRunAndChildren(runId: string): void {\n    // Abort the controller for this run\n    const controller = this.abortControllers.get(runId);\n    if (controller) {\n      controller.abort();\n    }\n\n    // Find and cancel all child workflows\n    for (const [childRunId, parentRunId] of this.parentChildRelationships.entries()) {\n      if (parentRunId === runId) {\n        this.cancelRunAndChildren(childRunId);\n      }\n    }\n  }\n\n  /**\n   * Clean up abort controller and relationships when a workflow completes.\n   * Also cleans up any orphaned child entries that reference this run as parent.\n   */\n  private cleanupRun(runId: string): void {\n    this.abortControllers.delete(runId);\n    this.parentChildRelationships.delete(runId);\n\n    // Clean up any orphaned child entries pointing to this run as their parent\n    for (const [childRunId, parentRunId] of this.parentChildRelationships.entries()) {\n      if (parentRunId === runId) {\n        this.parentChildRelationships.delete(childRunId);\n      }\n    }\n  }\n\n  __registerMastra(mastra: Mastra) {\n    super.__registerMastra(mastra);\n    this.stepExecutor.__registerMastra(mastra);\n  }\n\n  private async errorWorkflow(\n    {\n      parentWorkflow,\n      workflowId,\n      runId,\n      resumeSteps,\n      stepResults,\n      resumeData,\n      requestContext,\n    }: Omit<ProcessorArgs, 'workflow'>,\n    e: Error,\n  ) {\n    await this.mastra.pubsub.publish('workflows', {\n      type: 'workflow.fail',\n      runId,\n      data: {\n        workflowId,\n        runId,\n        executionPath: [],\n        resumeSteps,\n        stepResults,\n        prevResult: { status: 'failed', error: getErrorFromUnknown(e).toJSON() },\n        requestContext,\n        resumeData,\n        activeSteps: {},\n        parentWorkflow: parentWorkflow,\n      },\n    });\n  }\n\n  protected async processWorkflowCancel({ workflowId, runId }: ProcessorArgs) {\n    // Cancel this workflow and all nested child workflows\n    this.cancelRunAndChildren(runId);\n\n    const workflowsStore = await this.mastra.getStorage()?.getStore('workflows');\n    const currentState = await workflowsStore?.loadWorkflowSnapshot({\n      workflowName: workflowId,\n      runId,\n    });\n\n    if (!currentState) {\n      this.mastra.getLogger()?.warn('Canceling workflow without loaded state', { workflowId, runId });\n    }\n\n    await this.endWorkflow(\n      {\n        workflow: undefined as any,\n        workflowId,\n        runId,\n        stepResults: (currentState?.context ?? {}) as any,\n        prevResult: { status: 'canceled' } as any,\n        requestContext: (currentState?.requestContext ?? {}) as any,\n        executionPath: [],\n        activeSteps: {},\n        resumeSteps: [],\n        resumeData: undefined,\n        parentWorkflow: undefined,\n      },\n      'canceled',\n    );\n  }\n\n  protected async processWorkflowStart({\n    workflow,\n    parentWorkflow,\n    workflowId,\n    runId,\n    resumeSteps,\n    prevResult,\n    resumeData,\n    timeTravel,\n    executionPath,\n    stepResults,\n    requestContext,\n    perStep,\n  }: ProcessorArgs) {\n    // Create abort controller for this workflow run\n    this.getOrCreateAbortController(runId);\n\n    // Track parent-child relationship if this is a nested workflow\n    if (parentWorkflow?.runId) {\n      this.parentChildRelationships.set(runId, parentWorkflow.runId);\n    }\n    // Preserve resourceId from existing snapshot if present\n    const workflowsStore = await this.mastra.getStorage()?.getStore('workflows');\n    const existingRun = await workflowsStore?.getWorkflowRunById({ runId, workflowName: workflow.id });\n    const resourceId = existingRun?.resourceId;\n\n    await workflowsStore?.persistWorkflowSnapshot({\n      workflowName: workflow.id,\n      runId,\n      resourceId,\n      snapshot: {\n        activePaths: [],\n        suspendedPaths: {},\n        resumeLabels: {},\n        waitingPaths: {},\n        activeStepsPath: {},\n        serializedStepGraph: workflow.serializedStepGraph,\n        timestamp: Date.now(),\n        runId,\n        context: stepResults ?? {\n          input: prevResult?.status === 'success' ? prevResult.output : undefined,\n        },\n        status: 'running',\n        value: {},\n      },\n    });\n\n    await this.mastra.pubsub.publish('workflows', {\n      type: 'workflow.step.run',\n      runId,\n      data: {\n        parentWorkflow,\n        workflowId,\n        runId,\n        executionPath: executionPath ?? [0],\n        resumeSteps,\n        stepResults: stepResults ?? {\n          input: prevResult?.status === 'success' ? prevResult.output : undefined,\n        },\n        prevResult,\n        timeTravel,\n        requestContext,\n        resumeData,\n        activeSteps: {},\n        perStep,\n      },\n    });\n  }\n\n  protected async endWorkflow(args: ProcessorArgs, status: 'success' | 'failed' | 'canceled' | 'paused' = 'success') {\n    const { workflowId, runId, prevResult, perStep } = args;\n    const workflowsStore = await this.mastra.getStorage()?.getStore('workflows');\n    await workflowsStore?.updateWorkflowState({\n      workflowName: workflowId,\n      runId,\n      opts: {\n        status: perStep && status === 'success' ? 'paused' : status,\n        result: prevResult,\n      },\n    });\n\n    if (perStep) {\n      await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-paused',\n          payload: {},\n        },\n      });\n    }\n\n    await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n      type: 'watch',\n      runId,\n      data: {\n        type: 'workflow-finish',\n        payload: {\n          runId,\n        },\n      },\n    });\n\n    await this.mastra.pubsub.publish('workflows', {\n      type: 'workflow.end',\n      runId,\n      data: { ...args, workflow: undefined },\n    });\n  }\n\n  protected async processWorkflowEnd(args: ProcessorArgs) {\n    const {\n      resumeSteps,\n      prevResult,\n      resumeData,\n      parentWorkflow,\n      activeSteps,\n      requestContext,\n      runId,\n      timeTravel,\n      perStep,\n    } = args;\n\n    // Clean up abort controller and parent-child tracking\n    this.cleanupRun(runId);\n\n    // handle nested workflow\n    if (parentWorkflow) {\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.step.end',\n        runId,\n        data: {\n          workflowId: parentWorkflow.workflowId,\n          runId: parentWorkflow.runId,\n          executionPath: parentWorkflow.executionPath,\n          resumeSteps,\n          stepResults: parentWorkflow.stepResults,\n          prevResult,\n          resumeData,\n          activeSteps,\n          parentWorkflow: parentWorkflow.parentWorkflow,\n          parentContext: parentWorkflow,\n          requestContext,\n          timeTravel,\n          perStep,\n        },\n      });\n    }\n\n    await this.mastra.pubsub.publish('workflows-finish', {\n      type: 'workflow.end',\n      runId,\n      data: { ...args, workflow: undefined },\n    });\n  }\n\n  protected async processWorkflowSuspend(args: ProcessorArgs) {\n    const { resumeSteps, prevResult, resumeData, parentWorkflow, activeSteps, runId, requestContext, timeTravel } =\n      args;\n\n    // TODO: if there are still active paths don't end the workflow yet\n    // handle nested workflow\n    if (parentWorkflow) {\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.step.end',\n        runId,\n        data: {\n          workflowId: parentWorkflow.workflowId,\n          runId: parentWorkflow.runId,\n          executionPath: parentWorkflow.executionPath,\n          resumeSteps,\n          stepResults: parentWorkflow.stepResults,\n          prevResult: {\n            ...prevResult,\n            suspendPayload: {\n              ...prevResult.suspendPayload,\n              __workflow_meta: {\n                runId: runId,\n                path: parentWorkflow?.stepId\n                  ? [parentWorkflow.stepId].concat(prevResult.suspendPayload?.__workflow_meta?.path ?? [])\n                  : (prevResult.suspendPayload?.__workflow_meta?.path ?? []),\n              },\n            },\n          },\n          timeTravel,\n          resumeData,\n          activeSteps,\n          requestContext,\n          parentWorkflow: parentWorkflow.parentWorkflow,\n          parentContext: parentWorkflow,\n        },\n      });\n    }\n\n    await this.mastra.pubsub.publish('workflows-finish', {\n      type: 'workflow.suspend',\n      runId,\n      data: { ...args, workflow: undefined },\n    });\n  }\n\n  protected async processWorkflowFail(args: ProcessorArgs) {\n    const {\n      workflowId,\n      runId,\n      resumeSteps,\n      prevResult,\n      resumeData,\n      parentWorkflow,\n      activeSteps,\n      requestContext,\n      timeTravel,\n    } = args;\n\n    // Clean up abort controller and parent-child tracking\n    this.cleanupRun(runId);\n\n    const workflowsStore = await this.mastra.getStorage()?.getStore('workflows');\n    await workflowsStore?.updateWorkflowState({\n      workflowName: workflowId,\n      runId,\n      opts: {\n        status: 'failed',\n        error: (prevResult as any).error,\n      },\n    });\n\n    // handle nested workflow\n    if (parentWorkflow) {\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.step.end',\n        runId,\n        data: {\n          workflowId: parentWorkflow.workflowId,\n          runId: parentWorkflow.runId,\n          executionPath: parentWorkflow.executionPath,\n          resumeSteps,\n          stepResults: parentWorkflow.stepResults,\n          prevResult,\n          timeTravel,\n          resumeData,\n          activeSteps,\n          requestContext,\n          parentWorkflow: parentWorkflow.parentWorkflow,\n          parentContext: parentWorkflow,\n        },\n      });\n    }\n\n    await this.mastra.pubsub.publish('workflows-finish', {\n      type: 'workflow.fail',\n      runId,\n      data: { ...args, workflow: undefined },\n    });\n  }\n\n  protected async processWorkflowStepRun({\n    workflow,\n    workflowId,\n    runId,\n    executionPath,\n    stepResults,\n    activeSteps,\n    resumeSteps,\n    timeTravel,\n    prevResult,\n    resumeData,\n    parentWorkflow,\n    requestContext,\n    retryCount = 0,\n    perStep,\n  }: ProcessorArgs) {\n    let stepGraph: StepFlowEntry[] = workflow.stepGraph;\n\n    if (!executionPath?.length) {\n      return this.errorWorkflow(\n        {\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n        },\n        new MastraError({\n          id: 'MASTRA_WORKFLOW',\n          text: `Execution path is empty: ${JSON.stringify(executionPath)}`,\n          domain: ErrorDomain.MASTRA_WORKFLOW,\n          category: ErrorCategory.SYSTEM,\n        }),\n      );\n    }\n\n    let step: StepFlowEntry | undefined = stepGraph[executionPath[0]!];\n\n    if (!step) {\n      return this.errorWorkflow(\n        {\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n        },\n        new MastraError({\n          id: 'MASTRA_WORKFLOW',\n          text: `Step not found in step graph: ${JSON.stringify(executionPath)}`,\n          domain: ErrorDomain.MASTRA_WORKFLOW,\n          category: ErrorCategory.SYSTEM,\n        }),\n      );\n    }\n\n    if ((step.type === 'parallel' || step.type === 'conditional') && executionPath.length > 1) {\n      step = step.steps[executionPath[1]!] as StepFlowEntry;\n    } else if (step.type === 'parallel') {\n      return processWorkflowParallel(\n        {\n          workflow,\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          timeTravel,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n          perStep,\n        },\n        {\n          pubsub: this.mastra.pubsub,\n          step,\n        },\n      );\n    } else if (step?.type === 'conditional') {\n      return processWorkflowConditional(\n        {\n          workflow,\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          timeTravel,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n          perStep,\n        },\n        {\n          pubsub: this.mastra.pubsub,\n          stepExecutor: this.stepExecutor,\n          step,\n        },\n      );\n    } else if (step?.type === 'sleep') {\n      return processWorkflowSleep(\n        {\n          workflow,\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          timeTravel,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n          perStep,\n        },\n        {\n          pubsub: this.mastra.pubsub,\n          stepExecutor: this.stepExecutor,\n          step,\n        },\n      );\n    } else if (step?.type === 'sleepUntil') {\n      return processWorkflowSleepUntil(\n        {\n          workflow,\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          timeTravel,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n          perStep,\n        },\n        {\n          pubsub: this.mastra.pubsub,\n          stepExecutor: this.stepExecutor,\n          step,\n        },\n      );\n    } else if (step?.type === 'foreach' && executionPath.length === 1) {\n      return processWorkflowForEach(\n        {\n          workflow,\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          timeTravel,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n          perStep,\n        },\n        {\n          pubsub: this.mastra.pubsub,\n          mastra: this.mastra,\n          step,\n        },\n      );\n    }\n\n    if (!isExecutableStep(step)) {\n      return this.errorWorkflow(\n        {\n          workflowId,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          prevResult,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n        },\n        new MastraError({\n          id: 'MASTRA_WORKFLOW',\n          text: `Step is not executable: ${step?.type} -- ${JSON.stringify(executionPath)}`,\n          domain: ErrorDomain.MASTRA_WORKFLOW,\n          category: ErrorCategory.SYSTEM,\n        }),\n      );\n    }\n\n    activeSteps[step.step.id] = true;\n\n    const workflowsStore = await this.mastra?.getStorage()?.getStore('workflows');\n\n    // Run nested workflow\n    if (step.step instanceof EventedWorkflow) {\n      if (resumeSteps?.length > 1) {\n        const stepData = stepResults[step.step.id];\n        const nestedRunId = stepData?.suspendPayload?.__workflow_meta?.runId;\n        if (!nestedRunId) {\n          return this.errorWorkflow(\n            {\n              workflowId,\n              runId,\n              executionPath,\n              stepResults,\n              activeSteps,\n              resumeSteps,\n              prevResult,\n              resumeData,\n              parentWorkflow,\n              requestContext,\n            },\n            new MastraError({\n              id: 'MASTRA_WORKFLOW',\n              text: `Nested workflow run id not found: ${JSON.stringify(stepResults)}`,\n              domain: ErrorDomain.MASTRA_WORKFLOW,\n              category: ErrorCategory.SYSTEM,\n            }),\n          );\n        }\n\n        const snapshot = await workflowsStore?.loadWorkflowSnapshot({\n          workflowName: step.step.id,\n          runId: nestedRunId,\n        });\n\n        const nestedStepResults = snapshot?.context;\n        const nestedSteps = resumeSteps.slice(1);\n\n        await this.mastra.pubsub.publish('workflows', {\n          type: 'workflow.resume',\n          runId,\n          data: {\n            workflowId: step.step.id,\n            parentWorkflow: {\n              stepId: step.step.id,\n              workflowId,\n              runId,\n              executionPath,\n              resumeSteps,\n              stepResults,\n              input: prevResult,\n              parentWorkflow,\n            },\n            executionPath: snapshot?.suspendedPaths?.[nestedSteps[0]!] as any,\n            runId: nestedRunId,\n            resumeSteps: nestedSteps,\n            stepResults: nestedStepResults,\n            prevResult,\n            resumeData,\n            activeSteps,\n            requestContext,\n            perStep,\n          },\n        });\n      } else if (timeTravel && timeTravel.steps?.length > 1 && timeTravel.steps[0] === step.step.id) {\n        const snapshot =\n          (await workflowsStore?.loadWorkflowSnapshot({\n            workflowName: step.step.id,\n            runId,\n          })) ?? ({ context: {} } as WorkflowRunState);\n\n        const timeTravelParams = createTimeTravelExecutionParams({\n          steps: timeTravel.steps.slice(1),\n          inputData: timeTravel.inputData,\n          resumeData: timeTravel.resumeData,\n          context: (timeTravel.nestedStepResults?.[step.step.id] ?? {}) as any,\n          nestedStepsContext: (timeTravel.nestedStepResults ?? {}) as any,\n          snapshot,\n          graph: step.step.buildExecutionGraph(),\n          perStep,\n        });\n\n        // @ts-ignore\n        const nestedPrevStep = getStep(step.step, timeTravelParams.executionPath);\n        const nestedPrevResult = timeTravelParams.stepResults[nestedPrevStep?.id ?? 'input'];\n\n        await this.mastra.pubsub.publish('workflows', {\n          type: 'workflow.start',\n          runId,\n          data: {\n            workflowId: step.step.id,\n            parentWorkflow: {\n              stepId: step.step.id,\n              workflowId,\n              runId,\n              executionPath,\n              resumeSteps,\n              stepResults,\n              timeTravel,\n              input: prevResult,\n              parentWorkflow,\n            },\n            executionPath: timeTravelParams.executionPath,\n            runId: randomUUID(),\n            stepResults: timeTravelParams.stepResults,\n            prevResult: { status: 'success', output: nestedPrevResult?.payload },\n            timeTravel: timeTravelParams,\n            activeSteps,\n            requestContext,\n            perStep,\n          },\n        });\n      } else {\n        await this.mastra.pubsub.publish('workflows', {\n          type: 'workflow.start',\n          runId,\n          data: {\n            workflowId: step.step.id,\n            parentWorkflow: {\n              stepId: step.step.id,\n              workflowId,\n              runId,\n              executionPath,\n              resumeSteps,\n              stepResults,\n              input: prevResult,\n              parentWorkflow,\n            },\n            executionPath: [0],\n            runId: randomUUID(),\n            resumeSteps,\n            prevResult,\n            resumeData,\n            activeSteps,\n            requestContext,\n            perStep,\n          },\n        });\n      }\n\n      return;\n    }\n\n    if (step.type === 'step') {\n      await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-step-start',\n          payload: {\n            id: step.step.id,\n            startedAt: Date.now(),\n            payload: prevResult.status === 'success' ? prevResult.output : undefined,\n            status: 'running',\n          },\n        },\n      });\n    }\n\n    const ee = new EventEmitter();\n    ee.on('watch', async (event: any) => {\n      await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: event,\n      });\n    });\n    const rc = new RequestContext();\n    for (const [key, value] of Object.entries(requestContext)) {\n      rc.set(key, value);\n    }\n    const { resumeData: timeTravelResumeData, validationError: timeTravelResumeValidationError } =\n      await validateStepResumeData({\n        resumeData: timeTravel?.stepResults[step.step.id]?.status === 'suspended' ? timeTravel?.resumeData : undefined,\n        step: step.step,\n      });\n\n    let resumeDataToUse;\n    if (timeTravelResumeData && !timeTravelResumeValidationError) {\n      resumeDataToUse = timeTravelResumeData;\n    } else if (timeTravelResumeData && timeTravelResumeValidationError) {\n      this.mastra.getLogger()?.warn('Time travel resume data validation failed', {\n        stepId: step.step.id,\n        error: timeTravelResumeValidationError.message,\n      });\n    } else if (resumeSteps?.length > 0 && resumeSteps?.[0] === step.step.id) {\n      resumeDataToUse = resumeData;\n    }\n\n    // Get the abort controller for this workflow run\n    const abortController = this.getOrCreateAbortController(runId);\n\n    const stepResult = await this.stepExecutor.execute({\n      workflowId,\n      step: step.step,\n      runId,\n      stepResults,\n      // TODO: implement state\n      state: {},\n      emitter: ee,\n      requestContext: rc,\n      input: (prevResult as any)?.output,\n      resumeData: resumeDataToUse,\n      retryCount,\n      foreachIdx: step.type === 'foreach' ? executionPath[1] : undefined,\n      validateInputs: workflow.options.validateInputs,\n      abortController,\n      perStep,\n    });\n    requestContext = Object.fromEntries(rc.entries());\n\n    // @ts-ignore\n    if (stepResult.status === 'bailed') {\n      // @ts-ignore\n      stepResult.status = 'success';\n\n      await this.endWorkflow({\n        workflow,\n        resumeData,\n        parentWorkflow,\n        workflowId,\n        runId,\n        executionPath,\n        resumeSteps,\n        stepResults: {\n          ...stepResults,\n          [step.step.id]: stepResult,\n        },\n        prevResult: stepResult,\n        activeSteps,\n        requestContext,\n        perStep,\n      });\n      return;\n    }\n\n    if (stepResult.status === 'failed') {\n      const retries = step.step.retries ?? workflow.retryConfig.attempts ?? 0;\n      if (retryCount >= retries) {\n        await this.mastra.pubsub.publish('workflows', {\n          type: 'workflow.step.end',\n          runId,\n          data: {\n            parentWorkflow,\n            workflowId,\n            runId,\n            executionPath,\n            resumeSteps,\n            stepResults,\n            prevResult: stepResult,\n            activeSteps,\n            requestContext,\n          },\n        });\n      } else {\n        return this.mastra.pubsub.publish('workflows', {\n          type: 'workflow.step.run',\n          runId,\n          data: {\n            parentWorkflow,\n            workflowId,\n            runId,\n            executionPath,\n            resumeSteps,\n            stepResults,\n            timeTravel,\n            prevResult,\n            activeSteps,\n            requestContext,\n            retryCount: retryCount + 1,\n          },\n        });\n      }\n    }\n\n    if (step.type === 'loop') {\n      //timeTravel is not passed to the processWorkflowLoop function becuase the step already ran the first time\n      // with whatever information it needs from timeTravel, subsequent loop runs use the previous loop run result as it's input.\n      await processWorkflowLoop(\n        {\n          workflow,\n          workflowId,\n          prevResult: stepResult,\n          runId,\n          executionPath,\n          stepResults,\n          activeSteps,\n          resumeSteps,\n          resumeData,\n          parentWorkflow,\n          requestContext,\n          retryCount: retryCount + 1,\n        },\n        {\n          pubsub: this.mastra.pubsub,\n          stepExecutor: this.stepExecutor,\n          step,\n          stepResult,\n        },\n      );\n    } else {\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.step.end',\n        runId,\n        data: {\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          timeTravel, //timeTravel is passed in as workflow.step.end ends the step, not the workflow, the timeTravel info is passed to the next step to run.\n          stepResults,\n          prevResult: stepResult,\n          activeSteps,\n          requestContext,\n          perStep,\n        },\n      });\n    }\n  }\n\n  protected async processWorkflowStepEnd({\n    workflow,\n    workflowId,\n    runId,\n    executionPath,\n    resumeSteps,\n    timeTravel,\n    prevResult,\n    parentWorkflow,\n    stepResults,\n    activeSteps,\n    parentContext,\n    requestContext,\n    perStep,\n  }: ProcessorArgs) {\n    let step = workflow.stepGraph[executionPath[0]!];\n\n    if ((step?.type === 'parallel' || step?.type === 'conditional') && executionPath.length > 1) {\n      step = step.steps[executionPath[1]!];\n    }\n\n    if (!step) {\n      return this.errorWorkflow(\n        {\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          prevResult,\n          stepResults,\n          activeSteps,\n          requestContext,\n        },\n        new MastraError({\n          id: 'MASTRA_WORKFLOW',\n          text: `Step not found: ${JSON.stringify(executionPath)}`,\n          domain: ErrorDomain.MASTRA_WORKFLOW,\n          category: ErrorCategory.SYSTEM,\n        }),\n      );\n    }\n\n    // Cache workflows store to avoid redundant async calls\n    const workflowsStore = await this.mastra.getStorage()?.getStore('workflows');\n\n    if (step.type === 'foreach') {\n      const snapshot = await workflowsStore?.loadWorkflowSnapshot({\n        workflowName: workflowId,\n        runId,\n      });\n\n      const currentIdx = executionPath[1];\n      const currentResult = (snapshot?.context?.[step.step.id] as any)?.output;\n\n      let newResult = prevResult;\n      if (currentIdx !== undefined) {\n        if (currentResult) {\n          currentResult[currentIdx] = (prevResult as any).output;\n          newResult = { ...prevResult, output: currentResult } as any;\n        } else {\n          newResult = { ...prevResult, output: [(prevResult as any).output] } as any;\n        }\n      }\n      const newStepResults = await workflowsStore?.updateWorkflowResults({\n        workflowName: workflow.id,\n        runId,\n        stepId: step.step.id,\n        result: newResult,\n        requestContext,\n      });\n\n      if (!newStepResults) {\n        return;\n      }\n\n      stepResults = newStepResults;\n    } else if (isExecutableStep(step)) {\n      // clear from activeSteps\n      delete activeSteps[step.step.id];\n\n      // handle nested workflow\n      if (parentContext) {\n        prevResult = stepResults[step.step.id] = {\n          ...prevResult,\n          payload: parentContext.input?.output ?? {},\n        };\n      }\n\n      const newStepResults = await workflowsStore?.updateWorkflowResults({\n        workflowName: workflow.id,\n        runId,\n        stepId: step.step.id,\n        result: prevResult,\n        requestContext,\n      });\n\n      if (!newStepResults) {\n        return;\n      }\n\n      stepResults = newStepResults;\n    }\n\n    if (!prevResult?.status || prevResult.status === 'failed') {\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.fail',\n        runId,\n        data: {\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          parentWorkflow,\n          stepResults,\n          timeTravel,\n          prevResult,\n          activeSteps,\n          requestContext,\n        },\n      });\n\n      return;\n    } else if (prevResult.status === 'suspended') {\n      const suspendedPaths: Record<string, number[]> = {};\n      const suspendedStep = getStep(workflow, executionPath);\n      if (suspendedStep) {\n        suspendedPaths[suspendedStep.id] = executionPath;\n      }\n\n      await workflowsStore?.updateWorkflowState({\n        workflowName: workflowId,\n        runId,\n        opts: {\n          status: 'suspended',\n          result: prevResult,\n          suspendedPaths,\n        },\n      });\n\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.suspend',\n        runId,\n        data: {\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          parentWorkflow,\n          stepResults,\n          prevResult,\n          activeSteps,\n          requestContext,\n          timeTravel,\n        },\n      });\n\n      await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-step-suspended',\n          payload: {\n            id: (step as any)?.step?.id,\n            ...prevResult,\n            suspendedAt: Date.now(),\n            suspendPayload: prevResult.suspendPayload,\n          },\n        },\n      });\n\n      return;\n    }\n\n    if (step?.type === 'step') {\n      await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-step-result',\n          payload: {\n            id: step.step.id,\n            ...prevResult,\n          },\n        },\n      });\n\n      if (prevResult.status === 'success') {\n        await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n          type: 'watch',\n          runId,\n          data: {\n            type: 'workflow-step-finish',\n            payload: {\n              id: step.step.id,\n              metadata: {},\n            },\n          },\n        });\n      }\n    }\n\n    step = workflow.stepGraph[executionPath[0]!];\n    if (perStep) {\n      if (parentWorkflow && executionPath[0]! < workflow.stepGraph.length - 1) {\n        const { endedAt, output, status, ...nestedPrevResult } = prevResult as StepSuccess<any, any, any, any>;\n        await this.endWorkflow({\n          workflow,\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          stepResults,\n          prevResult: { ...nestedPrevResult, status: 'paused' },\n          activeSteps,\n          requestContext,\n          perStep,\n        });\n      } else {\n        await this.endWorkflow({\n          workflow,\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath,\n          resumeSteps,\n          stepResults,\n          prevResult,\n          activeSteps,\n          requestContext,\n          perStep,\n        });\n      }\n    } else if ((step?.type === 'parallel' || step?.type === 'conditional') && executionPath.length > 1) {\n      let skippedCount = 0;\n      const allResults: Record<string, any> = step.steps.reduce(\n        (acc, step) => {\n          if (isExecutableStep(step)) {\n            const res = stepResults?.[step.step.id];\n            if (res && res.status === 'success') {\n              acc[step.step.id] = res?.output;\n              // @ts-ignore\n            } else if (res?.status === 'skipped') {\n              skippedCount++;\n            }\n          }\n\n          return acc;\n        },\n        {} as Record<string, StepResult<any, any, any, any>>,\n      );\n\n      const keys = Object.keys(allResults);\n      if (keys.length + skippedCount < step.steps.length) {\n        return;\n      }\n\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.step.end',\n        runId,\n        data: {\n          parentWorkflow,\n          workflowId,\n          runId,\n          executionPath: executionPath.slice(0, -1),\n          resumeSteps,\n          stepResults,\n          prevResult: { status: 'success', output: allResults },\n          activeSteps,\n          requestContext,\n          timeTravel,\n        },\n      });\n    } else if (step?.type === 'foreach') {\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.step.run',\n        runId,\n        data: {\n          workflowId,\n          runId,\n          executionPath: executionPath.slice(0, -1),\n          resumeSteps,\n          parentWorkflow,\n          stepResults,\n          prevResult: { ...prevResult, output: prevResult?.payload },\n          activeSteps,\n          requestContext,\n          timeTravel,\n        },\n      });\n    } else if (executionPath[0]! >= workflow.stepGraph.length - 1) {\n      await this.endWorkflow({\n        workflow,\n        parentWorkflow,\n        workflowId,\n        runId,\n        executionPath,\n        resumeSteps,\n        stepResults,\n        prevResult,\n        activeSteps,\n        requestContext,\n      });\n    } else {\n      await this.mastra.pubsub.publish('workflows', {\n        type: 'workflow.step.run',\n        runId,\n        data: {\n          workflowId,\n          runId,\n          executionPath: executionPath.slice(0, -1).concat([executionPath[executionPath.length - 1]! + 1]),\n          resumeSteps,\n          parentWorkflow,\n          stepResults,\n          prevResult,\n          activeSteps,\n          requestContext,\n          timeTravel,\n        },\n      });\n    }\n  }\n\n  async loadData({\n    workflowId,\n    runId,\n  }: {\n    workflowId: string;\n    runId: string;\n  }): Promise<WorkflowRunState | null | undefined> {\n    const workflowsStore = await this.mastra.getStorage()?.getStore('workflows');\n    const snapshot = await workflowsStore?.loadWorkflowSnapshot({\n      workflowName: workflowId,\n      runId,\n    });\n\n    return snapshot;\n  }\n\n  async process(event: Event, ack?: () => Promise<void>) {\n    const { type, data } = event;\n\n    const workflowData = data as Omit<ProcessorArgs, 'workflow'>;\n\n    const currentState = await this.loadData({\n      workflowId: workflowData.workflowId,\n      runId: workflowData.runId,\n    });\n\n    if (currentState?.status === 'canceled' && type !== 'workflow.end' && type !== 'workflow.cancel') {\n      return;\n    }\n\n    if (type.startsWith('workflow.user-event.')) {\n      await processWorkflowWaitForEvent(\n        {\n          ...workflowData,\n          workflow: this.mastra.getWorkflow(workflowData.workflowId),\n        },\n        {\n          pubsub: this.mastra.pubsub,\n          eventName: type.split('.').slice(2).join('.'),\n          currentState: currentState!,\n        },\n      );\n      return;\n    }\n\n    let workflow;\n    if (this.mastra.__hasInternalWorkflow(workflowData.workflowId)) {\n      workflow = this.mastra.__getInternalWorkflow(workflowData.workflowId);\n    } else if (workflowData.parentWorkflow) {\n      workflow = getNestedWorkflow(this.mastra, workflowData.parentWorkflow);\n    } else {\n      workflow = this.mastra.getWorkflow(workflowData.workflowId);\n    }\n\n    if (!workflow) {\n      return this.errorWorkflow(\n        workflowData,\n        new MastraError({\n          id: 'MASTRA_WORKFLOW',\n          text: `Workflow not found: ${workflowData.workflowId}`,\n          domain: ErrorDomain.MASTRA_WORKFLOW,\n          category: ErrorCategory.SYSTEM,\n        }),\n      );\n    }\n\n    if (type === 'workflow.start' || type === 'workflow.resume') {\n      const { runId } = workflowData;\n      await this.mastra.pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: {\n          type: 'workflow-start',\n          payload: {\n            runId,\n          },\n        },\n      });\n    }\n\n    switch (type) {\n      case 'workflow.cancel':\n        await this.processWorkflowCancel({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      case 'workflow.start':\n        await this.processWorkflowStart({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      case 'workflow.resume':\n        await this.processWorkflowStart({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      case 'workflow.end':\n        await this.processWorkflowEnd({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      case 'workflow.step.end':\n        await this.processWorkflowStepEnd({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      case 'workflow.step.run':\n        await this.processWorkflowStepRun({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      case 'workflow.suspend':\n        await this.processWorkflowSuspend({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      case 'workflow.fail':\n        await this.processWorkflowFail({\n          workflow,\n          ...workflowData,\n        });\n        break;\n      default:\n        break;\n    }\n\n    try {\n      await ack?.();\n    } catch (e) {\n      this.mastra.getLogger()?.error('Error acking event', e);\n    }\n  }\n}\n","import { randomUUID } from 'node:crypto';\nimport type { CoreMessage } from '@internal/ai-sdk-v4';\nimport { z } from 'zod';\nimport { Agent } from '../../agent';\nimport type { MastraDBMessage } from '../../agent';\nimport { MessageList } from '../../agent/message-list';\nimport { TripWire } from '../../agent/trip-wire';\nimport { RequestContext } from '../../di';\nimport { ErrorCategory, ErrorDomain, MastraError } from '../../error';\nimport type { MastraScorers } from '../../evals';\nimport type { Event } from '../../events';\nimport type { Mastra } from '../../mastra';\nimport type { TracingContext } from '../../observability';\nimport { EntityType, SpanType } from '../../observability';\nimport type { Processor } from '../../processors';\nimport { ProcessorRunner, ProcessorStepOutputSchema, ProcessorStepSchema } from '../../processors';\nimport type { ProcessorStepOutput } from '../../processors/step-schema';\nimport type { InferSchemaOutput, SchemaWithValidation } from '../../stream/base/schema';\nimport type { ChunkType } from '../../stream/types';\nimport { Tool } from '../../tools';\nimport type { ToolExecutionContext } from '../../tools/types';\nimport type { DynamicArgument } from '../../types';\nimport { Workflow, Run } from '../../workflows';\nimport type { AgentStepOptions } from '../../workflows';\nimport type { ExecutionEngine, ExecutionGraph } from '../../workflows/execution-engine';\nimport type { Step } from '../../workflows/step';\nimport type {\n  SerializedStepFlowEntry,\n  WorkflowConfig,\n  WorkflowResult,\n  StepWithComponent,\n  WorkflowStreamEvent,\n  WorkflowEngineType,\n  StepParams,\n  ToolStep,\n  DefaultEngineType,\n} from '../../workflows/types';\nimport { PUBSUB_SYMBOL } from '../constants';\nimport { EventedExecutionEngine } from './execution-engine';\nimport { WorkflowEventProcessor } from './workflow-event-processor';\n\nexport type EventedEngineType = {};\n\nexport function cloneWorkflow<\n  TWorkflowId extends string = string,\n  TState = unknown,\n  TInput = unknown,\n  TOutput = unknown,\n  TSteps extends Step<string, any, any, any, any, any, EventedEngineType>[] = Step<\n    string,\n    any,\n    any,\n    any,\n    any,\n    any,\n    EventedEngineType\n  >[],\n  TPrevSchema = TInput,\n>(\n  workflow: Workflow<EventedEngineType, TSteps, string, TState, TInput, TOutput, TPrevSchema>,\n  opts: { id: TWorkflowId },\n): Workflow<EventedEngineType, TSteps, TWorkflowId, TState, TInput, TOutput, TPrevSchema> {\n  const wf: Workflow<EventedEngineType, TSteps, TWorkflowId, TState, TInput, TOutput, TPrevSchema> = new Workflow({\n    id: opts.id,\n    inputSchema: workflow.inputSchema,\n    outputSchema: workflow.outputSchema,\n    steps: workflow.stepDefs,\n    mastra: workflow.mastra,\n    options: workflow.options,\n  });\n\n  wf.setStepFlow(workflow.stepGraph);\n  wf.commit();\n  return wf;\n}\n\nexport function cloneStep<TStepId extends string>(\n  step: Step<string, any, any, any, any, any, EventedEngineType>,\n  opts: { id: TStepId },\n): Step<TStepId, any, any, any, any, any, EventedEngineType> {\n  return {\n    id: opts.id,\n    description: step.description,\n    inputSchema: step.inputSchema,\n    outputSchema: step.outputSchema,\n    suspendSchema: step.suspendSchema,\n    resumeSchema: step.resumeSchema,\n    stateSchema: step.stateSchema,\n    execute: step.execute,\n    retries: step.retries,\n    scorers: step.scorers,\n    component: step.component,\n  };\n}\n\n// ============================================\n// Type Guards\n// ============================================\n\nfunction isAgent<TStepId extends string>(input: unknown): input is Agent<TStepId, any> {\n  return input instanceof Agent;\n}\n\nfunction isToolStep(input: unknown): input is ToolStep<any, any, any, any, any> {\n  return input instanceof Tool;\n}\n\nfunction isStepParams(input: unknown): input is StepParams<any, any, any, any, any, any> {\n  return (\n    input !== null &&\n    typeof input === 'object' &&\n    'id' in input &&\n    'execute' in input &&\n    !(input instanceof Agent) &&\n    !(input instanceof Tool)\n  );\n}\n\n/**\n * Type guard to check if an object is a Processor.\n * A Processor must have an 'id' property and at least one processor method.\n */\nfunction isProcessor(obj: unknown): obj is Processor {\n  return (\n    obj !== null &&\n    typeof obj === 'object' &&\n    'id' in obj &&\n    typeof (obj as any).id === 'string' &&\n    !(obj instanceof Agent) &&\n    !(obj instanceof Tool) &&\n    (typeof (obj as any).processInput === 'function' ||\n      typeof (obj as any).processInputStep === 'function' ||\n      typeof (obj as any).processOutputStream === 'function' ||\n      typeof (obj as any).processOutputResult === 'function' ||\n      typeof (obj as any).processOutputStep === 'function')\n  );\n}\n\n// ============================================\n// Overloads (Public API - clean types for consumers)\n// ============================================\n\n/**\n * Creates a step from explicit params (FIRST overload for best error messages)\n * @param params Configuration parameters for the step\n * @param params.id Unique identifier for the step\n * @param params.description Optional description of what the step does\n * @param params.inputSchema Zod schema defining the input structure\n * @param params.outputSchema Zod schema defining the output structure\n * @param params.execute Function that performs the step's operations\n * @returns A Step object that can be added to the workflow\n */\nexport function createStep<\n  TStepId extends string,\n  TStateSchema extends z.ZodTypeAny | undefined,\n  TInputSchema extends z.ZodTypeAny,\n  TOutputSchema extends z.ZodTypeAny,\n  TResumeSchema extends z.ZodTypeAny | undefined = undefined,\n  TSuspendSchema extends z.ZodTypeAny | undefined = undefined,\n>(\n  params: StepParams<TStepId, TStateSchema, TInputSchema, TOutputSchema, TResumeSchema, TSuspendSchema>,\n): Step<\n  TStepId,\n  TStateSchema extends z.ZodTypeAny ? z.infer<TStateSchema> : unknown,\n  z.infer<TInputSchema>,\n  z.infer<TOutputSchema>,\n  TResumeSchema extends z.ZodTypeAny ? z.infer<TResumeSchema> : unknown,\n  TSuspendSchema extends z.ZodTypeAny ? z.infer<TSuspendSchema> : unknown,\n  DefaultEngineType\n>;\n\n/**\n * Creates a step from an agent with structured output\n */\nexport function createStep<TStepId extends string, TStepOutput>(\n  agent: Agent<TStepId, any>,\n  agentOptions: AgentStepOptions<TStepOutput> & {\n    structuredOutput: { schema: TStepOutput };\n    retries?: number;\n    scorers?: DynamicArgument<MastraScorers>;\n  },\n): Step<TStepId, unknown, { prompt: string }, TStepOutput, unknown, unknown, DefaultEngineType>;\n\n/**\n * Creates a step from an agent (defaults to { text: string } output)\n */\nexport function createStep<\n  TStepId extends string,\n  TStepInput extends { prompt: string },\n  TStepOutput extends { text: string },\n  TResume,\n  TSuspend,\n>(agent: Agent<TStepId, any>): Step<TStepId, any, TStepInput, TStepOutput, TResume, TSuspend, DefaultEngineType>;\n\n/**\n * Creates a step from a tool\n */\nexport function createStep<\n  TSchemaIn,\n  TSuspend,\n  TResume,\n  TSchemaOut,\n  TContext extends ToolExecutionContext<TSuspend, TResume>,\n  TId extends string,\n>(\n  tool: Tool<TSchemaIn, TSchemaOut, TSuspend, TResume, TContext, TId>,\n  toolOptions?: { retries?: number; scorers?: DynamicArgument<MastraScorers> },\n): Step<TId, any, TSchemaIn, TSchemaOut, TSuspend, TResume, DefaultEngineType>;\n\n/**\n * Creates a step from a Processor - wraps a Processor as a workflow step\n * Note: We require at least one processor method to distinguish from StepParams\n */\nexport function createStep<TProcessorId extends string>(\n  processor:\n    | (Processor<TProcessorId> & { processInput: Function })\n    | (Processor<TProcessorId> & { processInputStream: Function })\n    | (Processor<TProcessorId> & { processInputStep: Function })\n    | (Processor<TProcessorId> & { processOutputStream: Function })\n    | (Processor<TProcessorId> & { processOutputResult: Function })\n    | (Processor<TProcessorId> & { processOutputStep: Function }),\n): Step<\n  `processor:${TProcessorId}`,\n  unknown,\n  InferSchemaOutput<typeof ProcessorStepSchema>,\n  InferSchemaOutput<typeof ProcessorStepOutputSchema>,\n  unknown,\n  unknown,\n  DefaultEngineType\n>;\n\n/**\n * IMPORTANT: Fallback overload - provides better error messages when StepParams doesn't match\n * This should be LAST and will show clearer errors about what's wrong\n * This is a copy of first one, KEEP THIS IN SYNC!\n */\nexport function createStep<\n  TStepId extends string,\n  TStateSchema extends z.ZodTypeAny | undefined,\n  TInputSchema extends z.ZodTypeAny,\n  TOutputSchema extends z.ZodTypeAny,\n  TResumeSchema extends z.ZodTypeAny | undefined = undefined,\n  TSuspendSchema extends z.ZodTypeAny | undefined = undefined,\n>(\n  params: StepParams<TStepId, TStateSchema, TInputSchema, TOutputSchema, TResumeSchema, TSuspendSchema>,\n): Step<\n  TStepId,\n  TStateSchema extends z.ZodTypeAny ? z.infer<TStateSchema> : unknown,\n  z.infer<TInputSchema>,\n  z.infer<TOutputSchema>,\n  TResumeSchema extends z.ZodTypeAny ? z.infer<TResumeSchema> : unknown,\n  TSuspendSchema extends z.ZodTypeAny ? z.infer<TSuspendSchema> : unknown,\n  DefaultEngineType\n>;\n\n// ============================================\n// Implementation (uses type guards for clean logic)\n// ============================================\n\nexport function createStep(params: any, agentOrToolOptions?: any): Step<any, any, any, any, any, any, any> {\n  // Type guards determine the correct factory function\n  // Overloads ensure type safety for consumers\n  if (isAgent(params)) {\n    return createStepFromAgent(params, agentOrToolOptions);\n  }\n\n  if (isToolStep(params)) {\n    return createStepFromTool(params, agentOrToolOptions);\n  }\n\n  if (isProcessor(params)) {\n    return createStepFromProcessor(params);\n  }\n\n  if (isStepParams(params)) {\n    return createStepFromParams(params);\n  }\n\n  throw new Error('Invalid input: expected StepParams, Agent, ToolStep, or Processor');\n}\n\n// ============================================\n// Internal Implementations\n// ============================================\n\nfunction createStepFromParams(\n  params: StepParams<any, any, any, any, any, any>,\n): Step<any, any, any, any, any, any, DefaultEngineType> {\n  return {\n    id: params.id,\n    description: params.description,\n    inputSchema: params.inputSchema,\n    stateSchema: params.stateSchema,\n    outputSchema: params.outputSchema,\n    resumeSchema: params.resumeSchema,\n    suspendSchema: params.suspendSchema,\n    scorers: params.scorers,\n    retries: params.retries,\n    execute: params.execute.bind(params),\n  };\n}\n\nfunction createStepFromAgent<TStepId extends string, TStepOutput>(\n  params: Agent<TStepId, any>,\n  agentOrToolOptions?: Record<string, unknown>,\n): Step<TStepId, any, any, TStepOutput, unknown, unknown, DefaultEngineType> {\n  const options = (agentOrToolOptions ?? {}) as\n    | (AgentStepOptions<TStepOutput> & { retries?: number; scorers?: DynamicArgument<MastraScorers> })\n    | undefined;\n  // Determine output schema based on structuredOutput option\n  const outputSchema = (options?.structuredOutput?.schema ??\n    z.object({ text: z.string() })) as unknown as SchemaWithValidation<TStepOutput>;\n  const { retries, scorers, ...agentOptions } = options ?? {};\n\n  return {\n    id: params.id,\n    description: params.getDescription(),\n    inputSchema: z.object({\n      prompt: z.string(),\n    }),\n    outputSchema,\n    retries,\n    scorers,\n    execute: async ({\n      inputData,\n      runId,\n      [PUBSUB_SYMBOL]: pubsub,\n      requestContext,\n      tracingContext,\n      abortSignal,\n      abort,\n    }) => {\n      // TODO: support stream\n      let streamPromise = {} as {\n        promise: Promise<string>;\n        resolve: (value: string) => void;\n        reject: (reason?: any) => void;\n      };\n\n      streamPromise.promise = new Promise((resolve, reject) => {\n        streamPromise.resolve = resolve;\n        streamPromise.reject = reject;\n      });\n      // TODO: should use regular .stream()\n      const { fullStream } = await params.streamLegacy((inputData as { prompt: string }).prompt, {\n        ...(agentOptions ?? {}),\n        tracingContext,\n        requestContext,\n        onFinish: result => {\n          streamPromise.resolve(result.text);\n        },\n        abortSignal,\n      });\n\n      if (abortSignal.aborted) {\n        return abort() as TStepOutput;\n      }\n\n      const toolData = {\n        name: params.name,\n        args: inputData,\n      };\n\n      await pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: { type: 'tool-call-streaming-start', ...(toolData ?? {}) },\n      });\n      for await (const chunk of fullStream) {\n        if (chunk.type === 'text-delta') {\n          await pubsub.publish(`workflow.events.v2.${runId}`, {\n            type: 'watch',\n            runId,\n            data: { type: 'tool-call-delta', ...(toolData ?? {}), argsTextDelta: chunk.textDelta },\n          });\n        }\n      }\n      await pubsub.publish(`workflow.events.v2.${runId}`, {\n        type: 'watch',\n        runId,\n        data: { type: 'tool-call-streaming-finish', ...(toolData ?? {}) },\n      });\n\n      return {\n        text: await streamPromise.promise,\n      } as TStepOutput;\n    },\n    component: params.component,\n  };\n}\n\nfunction createStepFromTool<TStepInput, TSuspend, TResume, TStepOutput>(\n  params: ToolStep<TStepInput, TSuspend, TResume, TStepOutput, any>,\n  agentOrToolOptions?: Record<string, unknown>,\n): Step<string, any, TStepInput, TStepOutput, TResume, TSuspend, DefaultEngineType> {\n  const toolOpts = agentOrToolOptions as { retries?: number; scorers?: DynamicArgument<MastraScorers> } | undefined;\n  if (!params.inputSchema || !params.outputSchema) {\n    throw new Error('Tool must have input and output schemas defined');\n  }\n\n  return {\n    id: params.id,\n    description: params.description,\n    inputSchema: params.inputSchema,\n    outputSchema: params.outputSchema,\n    resumeSchema: params.resumeSchema,\n    suspendSchema: params.suspendSchema,\n    retries: toolOpts?.retries,\n    scorers: toolOpts?.scorers,\n    execute: async ({ inputData, mastra, requestContext, suspend, resumeData, runId, workflowId, state, setState }) => {\n      // Tools receive (input, context) - just call the tool's execute\n      if (!params.execute) {\n        throw new Error(`Tool ${params.id} does not have an execute function`);\n      }\n\n      // Build context matching ToolExecutionContext structure\n      const context = {\n        mastra,\n        requestContext,\n        tracingContext: { currentSpan: undefined }, // TODO: Pass proper tracing context when evented workflows support tracing\n        workflow: {\n          runId,\n          workflowId,\n          state,\n          setState,\n          suspend,\n          resumeData,\n        },\n      };\n\n      // Tool.execute already handles the v1.0 signature properly\n      return params.execute(inputData, context) as TStepOutput;\n    },\n    component: 'TOOL',\n  };\n}\n\nfunction createStepFromProcessor<TProcessorId extends string>(\n  processor: Processor<TProcessorId>,\n): Step<\n  `processor:${TProcessorId}`,\n  unknown,\n  InferSchemaOutput<typeof ProcessorStepSchema>,\n  InferSchemaOutput<typeof ProcessorStepOutputSchema>,\n  unknown,\n  unknown,\n  DefaultEngineType\n> {\n  // Helper to map phase to entity type\n  const getProcessorEntityType = (phase: string): EntityType => {\n    switch (phase) {\n      case 'input':\n        return EntityType.INPUT_PROCESSOR;\n      case 'inputStep':\n        return EntityType.INPUT_STEP_PROCESSOR;\n      case 'outputStream':\n      case 'outputResult':\n        return EntityType.OUTPUT_PROCESSOR;\n      case 'outputStep':\n        return EntityType.OUTPUT_STEP_PROCESSOR;\n      default:\n        return EntityType.OUTPUT_PROCESSOR;\n    }\n  };\n\n  // Helper to get span name prefix\n  const getSpanNamePrefix = (phase: string): string => {\n    switch (phase) {\n      case 'input':\n        return 'input processor';\n      case 'inputStep':\n        return 'input step processor';\n      case 'outputStream':\n        return 'output stream processor';\n      case 'outputResult':\n        return 'output processor';\n      case 'outputStep':\n        return 'output step processor';\n      default:\n        return 'processor';\n    }\n  };\n\n  // Helper to check if processor implements a phase\n  const hasPhaseMethod = (phase: string): boolean => {\n    switch (phase) {\n      case 'input':\n        return !!processor.processInput;\n      case 'inputStep':\n        return !!processor.processInputStep;\n      case 'outputStream':\n        return !!processor.processOutputStream;\n      case 'outputResult':\n        return !!processor.processOutputResult;\n      case 'outputStep':\n        return !!processor.processOutputStep;\n      default:\n        return false;\n    }\n  };\n\n  return {\n    id: `processor:${processor.id}`,\n    description: processor.name ?? `Processor ${processor.id}`,\n    inputSchema: ProcessorStepSchema,\n    outputSchema: ProcessorStepOutputSchema,\n    execute: async ({ inputData, requestContext, tracingContext }) => {\n      // Cast to output type for easier property access - the discriminated union\n      // ensures type safety at the schema level, but inside the execute function\n      // we need access to all possible properties\n      const input = inputData as ProcessorStepOutput;\n      const {\n        phase,\n        messages,\n        messageList,\n        stepNumber,\n        systemMessages,\n        part,\n        streamParts,\n        state,\n        finishReason,\n        toolCalls,\n        text,\n        retryCount,\n        // inputStep phase fields for model/tools configuration\n        model,\n        tools,\n        toolChoice,\n        activeTools,\n        providerOptions,\n        modelSettings,\n        structuredOutput,\n        steps,\n      } = input;\n\n      // Create a minimal abort function that throws TripWire\n      const abort = (reason?: string, options?: { retry?: boolean; metadata?: unknown }): never => {\n        throw new TripWire(reason || `Tripwire triggered by ${processor.id}`, options, processor.id);\n      };\n\n      // Early return if processor doesn't implement this phase - no span created\n      // This prevents empty spans for phases the processor doesn't handle\n      if (!hasPhaseMethod(phase)) {\n        return input;\n      }\n\n      // Create processor span for non-stream phases\n      // outputStream phase doesn't need its own span (stream chunks are already tracked)\n      const currentSpan = tracingContext?.currentSpan;\n\n      // Find appropriate parent span:\n      // - For input/outputResult: find AGENT_RUN (processor runs once at start/end)\n      // - For inputStep/outputStep: find MODEL_STEP (processor runs per LLM call)\n      // When workflow is executed, currentSpan is WORKFLOW_STEP, so we walk up the parent chain\n      const parentSpan =\n        phase === 'inputStep' || phase === 'outputStep'\n          ? currentSpan?.findParent(SpanType.MODEL_STEP) || currentSpan\n          : currentSpan?.findParent(SpanType.AGENT_RUN) || currentSpan;\n\n      const processorSpan =\n        phase !== 'outputStream'\n          ? parentSpan?.createChildSpan({\n              type: SpanType.PROCESSOR_RUN,\n              name: `${getSpanNamePrefix(phase)}: ${processor.id}`,\n              entityType: getProcessorEntityType(phase),\n              entityId: processor.id,\n              entityName: processor.name ?? processor.id,\n              input: { phase, messageCount: messages?.length },\n              attributes: {\n                processorExecutor: 'workflow',\n                // Read processorIndex from processor (set in combineProcessorsIntoWorkflow)\n                processorIndex: processor.processorIndex,\n              },\n            })\n          : undefined;\n\n      // Create tracing context with processor span so internal agent calls nest correctly\n      const processorTracingContext: TracingContext | undefined = processorSpan\n        ? { currentSpan: processorSpan }\n        : tracingContext;\n\n      // Base context for all processor methods - includes requestContext for memory processors\n      // and tracingContext for proper span nesting when processors call internal agents\n      const baseContext = {\n        abort,\n        retryCount: retryCount ?? 0,\n        requestContext,\n        tracingContext: processorTracingContext,\n      };\n\n      // Pass-through data that should flow to the next processor in a chain\n      // This enables processor workflows to use .then(), .parallel(), .branch(), etc.\n      const passThrough = {\n        phase,\n        // Auto-create MessageList from messages if not provided\n        // This enables running processor workflows from the UI where messageList can't be serialized\n        messageList:\n          messageList ??\n          (Array.isArray(messages)\n            ? new MessageList()\n                .add(messages as MastraDBMessage[], 'input')\n                .addSystem((systemMessages ?? []) as CoreMessage[])\n            : undefined),\n        stepNumber,\n        systemMessages,\n        streamParts,\n        state,\n        finishReason,\n        toolCalls,\n        text,\n        retryCount,\n        // inputStep phase fields for model/tools configuration\n        model,\n        tools,\n        toolChoice,\n        activeTools,\n        providerOptions,\n        modelSettings,\n        structuredOutput,\n        steps,\n      };\n\n      // Helper to execute phase with proper span lifecycle management\n      const executePhaseWithSpan = async <T>(fn: () => Promise<T>): Promise<T> => {\n        try {\n          const result = await fn();\n          processorSpan?.end({ output: result });\n          return result;\n        } catch (error) {\n          // TripWire errors should end span but bubble up to halt the workflow\n          if (error instanceof TripWire) {\n            processorSpan?.end({ output: { tripwire: error.message } });\n          } else {\n            processorSpan?.error({ error: error as Error, endSpan: true });\n          }\n          throw error;\n        }\n      };\n\n      // Execute the phase with span lifecycle management\n      return executePhaseWithSpan(async () => {\n        switch (phase) {\n          case 'input': {\n            if (processor.processInput) {\n              if (!passThrough.messageList) {\n                throw new MastraError({\n                  category: ErrorCategory.USER,\n                  domain: ErrorDomain.MASTRA_WORKFLOW,\n                  id: 'PROCESSOR_MISSING_MESSAGE_LIST',\n                  text: `Processor ${processor.id} requires messageList or messages for processInput phase`,\n                });\n              }\n\n              // Create source checker before processing to preserve message sources\n              const idsBeforeProcessing = (messages as MastraDBMessage[]).map(m => m.id);\n              const check = passThrough.messageList.makeMessageSourceChecker();\n\n              const result = await processor.processInput({\n                ...baseContext,\n                messages: messages as MastraDBMessage[],\n                messageList: passThrough.messageList,\n                systemMessages: (systemMessages ?? []) as CoreMessage[],\n              });\n\n              if (result instanceof MessageList) {\n                // Validate same instance\n                if (result !== passThrough.messageList) {\n                  throw new MastraError({\n                    category: ErrorCategory.USER,\n                    domain: ErrorDomain.MASTRA_WORKFLOW,\n                    id: 'PROCESSOR_RETURNED_EXTERNAL_MESSAGE_LIST',\n                    text: `Processor ${processor.id} returned a MessageList instance other than the one passed in. Use the messageList argument instead.`,\n                  });\n                }\n                return {\n                  ...passThrough,\n                  messages: result.get.all.db(),\n                  systemMessages: result.getAllSystemMessages(),\n                };\n              } else if (Array.isArray(result)) {\n                // Processor returned an array of messages\n                ProcessorRunner.applyMessagesToMessageList(\n                  result as MastraDBMessage[],\n                  passThrough.messageList,\n                  idsBeforeProcessing,\n                  check,\n                  'input',\n                );\n                return { ...passThrough, messages: result };\n              } else if (result && 'messages' in result && 'systemMessages' in result) {\n                // Processor returned { messages, systemMessages }\n                const typedResult = result as { messages: MastraDBMessage[]; systemMessages: CoreMessage[] };\n                ProcessorRunner.applyMessagesToMessageList(\n                  typedResult.messages,\n                  passThrough.messageList,\n                  idsBeforeProcessing,\n                  check,\n                  'input',\n                );\n                passThrough.messageList.replaceAllSystemMessages(typedResult.systemMessages);\n                return {\n                  ...passThrough,\n                  messages: typedResult.messages,\n                  systemMessages: typedResult.systemMessages,\n                };\n              }\n              return { ...passThrough, messages };\n            }\n            return { ...passThrough, messages };\n          }\n\n          case 'inputStep': {\n            if (processor.processInputStep) {\n              if (!passThrough.messageList) {\n                throw new MastraError({\n                  category: ErrorCategory.USER,\n                  domain: ErrorDomain.MASTRA_WORKFLOW,\n                  id: 'PROCESSOR_MISSING_MESSAGE_LIST',\n                  text: `Processor ${processor.id} requires messageList or messages for processInputStep phase`,\n                });\n              }\n\n              // Create source checker before processing to preserve message sources\n              const idsBeforeProcessing = (messages as MastraDBMessage[]).map(m => m.id);\n              const check = passThrough.messageList.makeMessageSourceChecker();\n\n              const result = await processor.processInputStep({\n                ...baseContext,\n                messages: messages as MastraDBMessage[],\n                messageList: passThrough.messageList,\n                stepNumber: stepNumber ?? 0,\n                systemMessages: (systemMessages ?? []) as CoreMessage[],\n                // Pass model/tools configuration fields - types match ProcessInputStepArgs\n                model: model!,\n                tools,\n                toolChoice,\n                activeTools,\n                providerOptions,\n                modelSettings,\n                structuredOutput,\n                steps: steps ?? [],\n              });\n\n              const validatedResult = await ProcessorRunner.validateAndFormatProcessInputStepResult(result, {\n                messageList: passThrough.messageList,\n                processor,\n                stepNumber: stepNumber ?? 0,\n              });\n\n              if (validatedResult.messages) {\n                ProcessorRunner.applyMessagesToMessageList(\n                  validatedResult.messages,\n                  passThrough.messageList,\n                  idsBeforeProcessing,\n                  check,\n                );\n              }\n\n              if (validatedResult.systemMessages) {\n                passThrough.messageList!.replaceAllSystemMessages(validatedResult.systemMessages as CoreMessage[]);\n              }\n\n              // Preserve messages in return - passThrough doesn't include messages,\n              // so we must explicitly include it to avoid losing it for subsequent steps\n              return { ...passThrough, messages, ...validatedResult };\n            }\n            return { ...passThrough, messages };\n          }\n\n          case 'outputStream': {\n            if (processor.processOutputStream) {\n              // Manage per-processor span lifecycle across stream chunks\n              // Use unique key to store span on shared state object\n              const spanKey = `__outputStreamSpan_${processor.id}`;\n              const mutableState = (state ?? {}) as Record<string, unknown>;\n              let processorSpan = mutableState[spanKey] as\n                | ReturnType<NonNullable<typeof parentSpan>['createChildSpan']>\n                | undefined;\n\n              if (!processorSpan && parentSpan) {\n                // First chunk - create span for this processor\n                processorSpan = parentSpan.createChildSpan({\n                  type: SpanType.PROCESSOR_RUN,\n                  name: `output stream processor: ${processor.id}`,\n                  entityType: EntityType.OUTPUT_PROCESSOR,\n                  entityId: processor.id,\n                  entityName: processor.name ?? processor.id,\n                  input: { phase, streamParts: [] },\n                  attributes: {\n                    processorExecutor: 'workflow',\n                    processorIndex: processor.processorIndex,\n                  },\n                });\n                mutableState[spanKey] = processorSpan;\n              }\n\n              // Update span with current chunk data\n              if (processorSpan) {\n                processorSpan.input = {\n                  phase,\n                  streamParts: streamParts ?? [],\n                  totalChunks: (streamParts ?? []).length,\n                };\n              }\n\n              // Create tracing context with processor span for internal agent calls\n              const processorTracingContext = processorSpan\n                ? { currentSpan: processorSpan }\n                : baseContext.tracingContext;\n\n              // Handle outputStream span lifecycle explicitly (not via executePhaseWithSpan)\n              // because outputStream uses a per-processor span stored in mutableState\n              let result: ChunkType | null | undefined;\n              try {\n                result = await processor.processOutputStream({\n                  ...baseContext,\n                  tracingContext: processorTracingContext,\n                  part: part as ChunkType,\n                  streamParts: (streamParts ?? []) as ChunkType[],\n                  state: mutableState,\n                  messageList: passThrough.messageList, // Optional for stream processing\n                });\n\n                // End span on finish chunk\n                if (part && (part as ChunkType).type === 'finish') {\n                  processorSpan?.end({ output: result });\n                  delete mutableState[spanKey];\n                }\n              } catch (error) {\n                // End span with error and clean up state\n                if (error instanceof TripWire) {\n                  processorSpan?.end({ output: { tripwire: error.message } });\n                } else {\n                  processorSpan?.error({ error: error as Error, endSpan: true });\n                }\n                delete mutableState[spanKey];\n                throw error;\n              }\n\n              return { ...passThrough, state: mutableState, part: result };\n            }\n            return { ...passThrough, part };\n          }\n\n          case 'outputResult': {\n            if (processor.processOutputResult) {\n              if (!passThrough.messageList) {\n                throw new MastraError({\n                  category: ErrorCategory.USER,\n                  domain: ErrorDomain.MASTRA_WORKFLOW,\n                  id: 'PROCESSOR_MISSING_MESSAGE_LIST',\n                  text: `Processor ${processor.id} requires messageList or messages for processOutputResult phase`,\n                });\n              }\n\n              // Create source checker before processing to preserve message sources\n              const idsBeforeProcessing = (messages as MastraDBMessage[]).map(m => m.id);\n              const check = passThrough.messageList.makeMessageSourceChecker();\n\n              const result = await processor.processOutputResult({\n                ...baseContext,\n                messages: messages as MastraDBMessage[],\n                messageList: passThrough.messageList,\n              });\n\n              if (result instanceof MessageList) {\n                // Validate same instance\n                if (result !== passThrough.messageList) {\n                  throw new MastraError({\n                    category: ErrorCategory.USER,\n                    domain: ErrorDomain.MASTRA_WORKFLOW,\n                    id: 'PROCESSOR_RETURNED_EXTERNAL_MESSAGE_LIST',\n                    text: `Processor ${processor.id} returned a MessageList instance other than the one passed in. Use the messageList argument instead.`,\n                  });\n                }\n                return {\n                  ...passThrough,\n                  messages: result.get.all.db(),\n                  systemMessages: result.getAllSystemMessages(),\n                };\n              } else if (Array.isArray(result)) {\n                // Processor returned an array of messages\n                ProcessorRunner.applyMessagesToMessageList(\n                  result as MastraDBMessage[],\n                  passThrough.messageList,\n                  idsBeforeProcessing,\n                  check,\n                  'response',\n                );\n                return { ...passThrough, messages: result };\n              } else if (result && 'messages' in result && 'systemMessages' in result) {\n                // Processor returned { messages, systemMessages }\n                const typedResult = result as { messages: MastraDBMessage[]; systemMessages: CoreMessage[] };\n                ProcessorRunner.applyMessagesToMessageList(\n                  typedResult.messages,\n                  passThrough.messageList,\n                  idsBeforeProcessing,\n                  check,\n                  'response',\n                );\n                passThrough.messageList.replaceAllSystemMessages(typedResult.systemMessages);\n                return {\n                  ...passThrough,\n                  messages: typedResult.messages,\n                  systemMessages: typedResult.systemMessages,\n                };\n              }\n              return { ...passThrough, messages };\n            }\n            return { ...passThrough, messages };\n          }\n\n          case 'outputStep': {\n            if (processor.processOutputStep) {\n              if (!passThrough.messageList) {\n                throw new MastraError({\n                  category: ErrorCategory.USER,\n                  domain: ErrorDomain.MASTRA_WORKFLOW,\n                  id: 'PROCESSOR_MISSING_MESSAGE_LIST',\n                  text: `Processor ${processor.id} requires messageList or messages for processOutputStep phase`,\n                });\n              }\n\n              // Create source checker before processing to preserve message sources\n              const idsBeforeProcessing = (messages as MastraDBMessage[]).map(m => m.id);\n              const check = passThrough.messageList.makeMessageSourceChecker();\n\n              const result = await processor.processOutputStep({\n                ...baseContext,\n                messages: messages as MastraDBMessage[],\n                messageList: passThrough.messageList,\n                stepNumber: stepNumber ?? 0,\n                finishReason,\n                toolCalls: toolCalls as any,\n                text,\n                systemMessages: (systemMessages ?? []) as CoreMessage[],\n                steps: steps ?? [],\n              });\n\n              if (result instanceof MessageList) {\n                // Validate same instance\n                if (result !== passThrough.messageList) {\n                  throw new MastraError({\n                    category: ErrorCategory.USER,\n                    domain: ErrorDomain.MASTRA_WORKFLOW,\n                    id: 'PROCESSOR_RETURNED_EXTERNAL_MESSAGE_LIST',\n                    text: `Processor ${processor.id} returned a MessageList instance other than the one passed in. Use the messageList argument instead.`,\n                  });\n                }\n                return {\n                  ...passThrough,\n                  messages: result.get.all.db(),\n                  systemMessages: result.getAllSystemMessages(),\n                };\n              } else if (Array.isArray(result)) {\n                // Processor returned an array of messages\n                ProcessorRunner.applyMessagesToMessageList(\n                  result as MastraDBMessage[],\n                  passThrough.messageList,\n                  idsBeforeProcessing,\n                  check,\n                  'response',\n                );\n                return { ...passThrough, messages: result };\n              } else if (result && 'messages' in result && 'systemMessages' in result) {\n                // Processor returned { messages, systemMessages }\n                const typedResult = result as { messages: MastraDBMessage[]; systemMessages: CoreMessage[] };\n                ProcessorRunner.applyMessagesToMessageList(\n                  typedResult.messages,\n                  passThrough.messageList,\n                  idsBeforeProcessing,\n                  check,\n                  'response',\n                );\n                passThrough.messageList.replaceAllSystemMessages(typedResult.systemMessages);\n                return {\n                  ...passThrough,\n                  messages: typedResult.messages,\n                  systemMessages: typedResult.systemMessages,\n                };\n              }\n              return { ...passThrough, messages };\n            }\n            return { ...passThrough, messages };\n          }\n\n          default:\n            return { ...passThrough, messages };\n        }\n      });\n    },\n    component: 'PROCESSOR',\n  };\n}\n\nexport function createWorkflow<\n  TWorkflowId extends string = string,\n  TState = unknown,\n  TInput = unknown,\n  TOutput = unknown,\n  TSteps extends Step<string, any, any, any, any, any, EventedEngineType>[] = Step<\n    string,\n    any,\n    any,\n    any,\n    any,\n    any,\n    EventedEngineType\n  >[],\n>(params: WorkflowConfig<TWorkflowId, TState, TInput, TOutput, TSteps>) {\n  const eventProcessor = new WorkflowEventProcessor({ mastra: params.mastra! });\n  const executionEngine = new EventedExecutionEngine({\n    mastra: params.mastra!,\n    eventProcessor,\n    options: {\n      validateInputs: params.options?.validateInputs ?? true,\n      shouldPersistSnapshot: params.options?.shouldPersistSnapshot ?? (() => true),\n      tracingPolicy: params.options?.tracingPolicy,\n      onFinish: params.options?.onFinish,\n      onError: params.options?.onError,\n    },\n  });\n  return new EventedWorkflow<EventedEngineType, TSteps, TWorkflowId, TState, TInput, TOutput, TInput>({\n    ...params,\n    executionEngine,\n  });\n}\n\nexport class EventedWorkflow<\n  TEngineType = EventedEngineType,\n  TSteps extends Step<string, any, any>[] = Step<string, any, any>[],\n  TWorkflowId extends string = string,\n  TState = unknown,\n  TInput = unknown,\n  TOutput = unknown,\n  TPrevSchema = TInput,\n> extends Workflow<TEngineType, TSteps, TWorkflowId, TState, TInput, TOutput, TPrevSchema> {\n  constructor(params: WorkflowConfig<TWorkflowId, TState, TInput, TOutput, TSteps>) {\n    super(params);\n    this.engineType = 'evented';\n  }\n\n  __registerMastra(mastra: Mastra) {\n    super.__registerMastra(mastra);\n    this.executionEngine.__registerMastra(mastra);\n  }\n\n  async createRun(options?: {\n    runId?: string;\n    resourceId?: string;\n    disableScorers?: boolean;\n  }): Promise<Run<TEngineType, TSteps, TState, TInput, TOutput>> {\n    const runIdToUse = options?.runId || randomUUID();\n\n    // Return a new Run instance with object parameters\n    const run: Run<TEngineType, TSteps, TState, TInput, TOutput> =\n      this.runs.get(runIdToUse) ??\n      new EventedRun({\n        workflowId: this.id,\n        runId: runIdToUse,\n        resourceId: options?.resourceId,\n        executionEngine: this.executionEngine,\n        executionGraph: this.executionGraph,\n        serializedStepGraph: this.serializedStepGraph,\n        mastra: this.mastra,\n        retryConfig: this.retryConfig,\n        cleanup: () => this.runs.delete(runIdToUse),\n        workflowSteps: this.steps,\n        validateInputs: this.options?.validateInputs,\n        workflowEngineType: this.engineType,\n      });\n\n    this.runs.set(runIdToUse, run);\n\n    const shouldPersistSnapshot = this.options?.shouldPersistSnapshot?.({\n      workflowStatus: run.workflowRunStatus,\n      stepResults: {},\n    });\n\n    const existingRun = await this.getWorkflowRunById(runIdToUse, {\n      withNestedWorkflows: false,\n    });\n\n    // Check if run exists in persistent storage (not just in-memory)\n    const existsInStorage = existingRun && !existingRun.isFromInMemory;\n\n    if (!existsInStorage && shouldPersistSnapshot) {\n      const workflowsStore = await this.mastra?.getStorage()?.getStore('workflows');\n      await workflowsStore?.persistWorkflowSnapshot({\n        workflowName: this.id,\n        runId: runIdToUse,\n        resourceId: options?.resourceId,\n        snapshot: {\n          runId: runIdToUse,\n          status: 'pending',\n          value: {},\n          context: {},\n          activePaths: [],\n          serializedStepGraph: this.serializedStepGraph,\n          activeStepsPath: {},\n          suspendedPaths: {},\n          resumeLabels: {},\n          waitingPaths: {},\n          result: undefined,\n          error: undefined,\n          // @ts-ignore\n          timestamp: Date.now(),\n        },\n      });\n    }\n\n    return run;\n  }\n}\n\nexport class EventedRun<\n  TEngineType = EventedEngineType,\n  TSteps extends Step<string, any, any>[] = Step<string, any, any>[],\n  TState = unknown,\n  TInput = unknown,\n  TOutput = unknown,\n> extends Run<TEngineType, TSteps, TState, TInput, TOutput> {\n  constructor(params: {\n    workflowId: string;\n    runId: string;\n    resourceId?: string;\n    executionEngine: ExecutionEngine;\n    executionGraph: ExecutionGraph;\n    serializedStepGraph: SerializedStepFlowEntry[];\n    mastra?: Mastra;\n    retryConfig?: {\n      attempts?: number;\n      delay?: number;\n    };\n    cleanup?: () => void;\n    workflowSteps: Record<string, StepWithComponent>;\n    validateInputs?: boolean;\n    workflowEngineType: WorkflowEngineType;\n  }) {\n    super(params);\n    this.serializedStepGraph = params.serializedStepGraph;\n  }\n\n  /**\n   * Set up abort signal handler to publish workflow.cancel event when abortController.abort() is called.\n   * This ensures consistent cancellation behavior whether abort() is called directly or via cancel().\n   */\n  private setupAbortHandler(): void {\n    const abortHandler = () => {\n      this.mastra?.pubsub\n        .publish('workflows', {\n          type: 'workflow.cancel',\n          runId: this.runId,\n          data: {\n            workflowId: this.workflowId,\n            runId: this.runId,\n          },\n        })\n        .catch(err => {\n          this.mastra?.getLogger()?.error(`Failed to publish workflow.cancel for runId ${this.runId}:`, err);\n        });\n    };\n    this.abortController.signal.addEventListener('abort', abortHandler, { once: true });\n  }\n\n  async start({\n    inputData,\n    initialState,\n    requestContext,\n    perStep,\n  }: {\n    inputData?: TInput;\n    requestContext?: RequestContext;\n    initialState?: TState;\n    perStep?: boolean;\n  }): Promise<WorkflowResult<TState, TInput, TOutput, TSteps>> {\n    // Add validation checks\n    if (this.serializedStepGraph.length === 0) {\n      throw new Error(\n        'Execution flow of workflow is not defined. Add steps to the workflow via .then(), .branch(), etc.',\n      );\n    }\n    if (!this.executionGraph.steps) {\n      throw new Error('Uncommitted step flow changes detected. Call .commit() to register the steps.');\n    }\n\n    requestContext = requestContext ?? new RequestContext();\n\n    const workflowsStore = await this.mastra?.getStorage()?.getStore('workflows');\n    await workflowsStore?.persistWorkflowSnapshot({\n      workflowName: this.workflowId,\n      runId: this.runId,\n      resourceId: this.resourceId,\n      snapshot: {\n        runId: this.runId,\n        serializedStepGraph: this.serializedStepGraph,\n        status: 'running',\n        value: {},\n        context: {} as any,\n        requestContext: Object.fromEntries(requestContext.entries()),\n        activePaths: [],\n        activeStepsPath: {},\n        suspendedPaths: {},\n        resumeLabels: {},\n        waitingPaths: {},\n        timestamp: Date.now(),\n      },\n    });\n\n    const inputDataToUse = await this._validateInput(inputData ?? ({} as TInput));\n    const initialStateToUse = await this._validateInitialState(initialState ?? ({} as TState));\n\n    if (!this.mastra?.pubsub) {\n      throw new Error('Mastra instance with pubsub is required for workflow execution');\n    }\n\n    this.setupAbortHandler();\n\n    const result = await this.executionEngine.execute<TState, TInput, WorkflowResult<TState, TInput, TOutput, TSteps>>({\n      workflowId: this.workflowId,\n      runId: this.runId,\n      graph: this.executionGraph,\n      serializedStepGraph: this.serializedStepGraph,\n      input: inputDataToUse,\n      initialState: initialStateToUse,\n      pubsub: this.mastra.pubsub,\n      retryConfig: this.retryConfig,\n      requestContext,\n      abortController: this.abortController,\n      perStep,\n    });\n\n    // console.dir({ startResult: result }, { depth: null });\n\n    if (result.status !== 'suspended') {\n      this.cleanup?.();\n    }\n\n    return result;\n  }\n\n  /**\n   * Starts the workflow execution without waiting for completion (fire-and-forget).\n   * Returns immediately with the runId. The workflow executes in the background via pubsub.\n   * Use this when you don't need to wait for the result or want to avoid polling failures.\n   */\n  async startAsync({\n    inputData,\n    initialState,\n    requestContext,\n    perStep,\n  }: {\n    inputData?: TInput;\n    requestContext?: RequestContext;\n    initialState?: TState;\n    perStep?: boolean;\n  }): Promise<{ runId: string }> {\n    // Add validation checks\n    if (this.serializedStepGraph.length === 0) {\n      throw new Error(\n        'Execution flow of workflow is not defined. Add steps to the workflow via .then(), .branch(), etc.',\n      );\n    }\n    if (!this.executionGraph.steps) {\n      throw new Error('Uncommitted step flow changes detected. Call .commit() to register the steps.');\n    }\n\n    requestContext = requestContext ?? new RequestContext();\n\n    const workflowsStore = await this.mastra?.getStorage()?.getStore('workflows');\n    await workflowsStore?.persistWorkflowSnapshot({\n      workflowName: this.workflowId,\n      runId: this.runId,\n      resourceId: this.resourceId,\n      snapshot: {\n        runId: this.runId,\n        serializedStepGraph: this.serializedStepGraph,\n        status: 'running',\n        value: {},\n        context: {} as any,\n        requestContext: Object.fromEntries(requestContext.entries()),\n        activePaths: [],\n        activeStepsPath: {},\n        suspendedPaths: {},\n        resumeLabels: {},\n        waitingPaths: {},\n        timestamp: Date.now(),\n      },\n    });\n\n    const inputDataToUse = await this._validateInput(inputData ?? ({} as TInput));\n    const initialStateToUse = await this._validateInitialState(initialState ?? ({} as TState));\n\n    if (!this.mastra?.pubsub) {\n      throw new Error('Mastra instance with pubsub is required for workflow execution');\n    }\n\n    // Fire-and-forget: publish the workflow start event without subscribing for completion\n    await this.mastra.pubsub.publish('workflows', {\n      type: 'workflow.start',\n      runId: this.runId,\n      data: {\n        workflowId: this.workflowId,\n        runId: this.runId,\n        prevResult: { status: 'success', output: inputDataToUse },\n        requestContext: Object.fromEntries(requestContext.entries()),\n        initialState: initialStateToUse,\n        perStep,\n      },\n    });\n\n    // Return immediately without waiting for completion\n    return { runId: this.runId };\n  }\n\n  // TODO: stream\n\n  async resume<TResumeSchema>(params: {\n    resumeData?: TResumeSchema;\n    step:\n      | Step<string, any, any, TResumeSchema, any, any, TEngineType>\n      | [\n          ...Step<string, any, any, any, any, any, TEngineType>[],\n          Step<string, any, any, TResumeSchema, any, any, TEngineType>,\n        ]\n      | string\n      | string[];\n    requestContext?: RequestContext;\n    perStep?: boolean;\n  }): Promise<WorkflowResult<TState, TInput, TOutput, TSteps>> {\n    let steps: string[] = [];\n    if (typeof params.step === 'string') {\n      steps = params.step.split('.');\n    } else {\n      steps = (Array.isArray(params.step) ? params.step : [params.step]).map(step =>\n        typeof step === 'string' ? step : step?.id,\n      );\n    }\n\n    if (steps.length === 0) {\n      throw new Error('No steps provided to resume');\n    }\n\n    const workflowsStore = await this.mastra?.getStorage()?.getStore('workflows');\n    if (!workflowsStore) {\n      throw new Error('Cannot resume workflow: workflows store is required');\n    }\n    const snapshot = await workflowsStore.loadWorkflowSnapshot({\n      workflowName: this.workflowId,\n      runId: this.runId,\n    });\n    if (!snapshot) {\n      throw new Error(`Cannot resume workflow: no snapshot found for runId ${this.runId}`);\n    }\n\n    const resumePath = snapshot.suspendedPaths?.[steps[0]!] as any;\n    if (!resumePath) {\n      throw new Error(\n        `No resume path found for step ${JSON.stringify(steps)}, currently suspended paths are ${JSON.stringify(snapshot.suspendedPaths)}`,\n      );\n    }\n\n    console.dir(\n      { resume: { requestContextObj: snapshot.requestContext, requestContext: params.requestContext } },\n      { depth: null },\n    );\n    // Start with the snapshot's request context (old values)\n    const requestContextObj = snapshot.requestContext ?? {};\n    const requestContext = new RequestContext();\n\n    // First, set values from the snapshot\n    for (const [key, value] of Object.entries(requestContextObj)) {\n      requestContext.set(key, value);\n    }\n\n    // Then, override with any values from the passed request context (new values take precedence)\n    if (params.requestContext) {\n      for (const [key, value] of params.requestContext.entries()) {\n        requestContext.set(key, value);\n      }\n    }\n\n    const suspendedStep = this.workflowSteps[steps?.[0] ?? ''];\n\n    const resumeDataToUse = await this._validateResumeData(params.resumeData, suspendedStep);\n\n    if (!this.mastra?.pubsub) {\n      throw new Error('Mastra instance with pubsub is required for workflow execution');\n    }\n\n    this.setupAbortHandler();\n\n    const executionResultPromise = this.executionEngine\n      .execute<TState, TInput, WorkflowResult<TState, TInput, TOutput, TSteps>>({\n        workflowId: this.workflowId,\n        runId: this.runId,\n        graph: this.executionGraph,\n        serializedStepGraph: this.serializedStepGraph,\n        input: snapshot?.context?.input as TInput,\n        resume: {\n          steps,\n          stepResults: snapshot?.context as any,\n          resumePayload: resumeDataToUse,\n          resumePath,\n        },\n        pubsub: this.mastra.pubsub,\n        requestContext,\n        abortController: this.abortController,\n        perStep: params.perStep,\n      })\n      .then(result => {\n        if (result.status !== 'suspended') {\n          this.closeStreamAction?.().catch(() => {});\n        }\n\n        return result;\n      });\n\n    this.executionResults = executionResultPromise;\n\n    return executionResultPromise;\n  }\n\n  watch(cb: (event: WorkflowStreamEvent) => void): () => void {\n    const watchCb = async (event: Event, ack?: () => Promise<void>) => {\n      if (event.runId !== this.runId) {\n        return;\n      }\n\n      cb(event.data);\n      await ack?.();\n    };\n\n    this.mastra?.pubsub.subscribe(`workflow.events.v2.${this.runId}`, watchCb).catch(() => {});\n\n    return () => {\n      this.mastra?.pubsub.unsubscribe(`workflow.events.v2.${this.runId}`, watchCb).catch(() => {});\n    };\n  }\n\n  async watchAsync(cb: (event: WorkflowStreamEvent) => void): Promise<() => void> {\n    const watchCb = async (event: Event, ack?: () => Promise<void>) => {\n      if (event.runId !== this.runId) {\n        return;\n      }\n\n      cb(event.data);\n      await ack?.();\n    };\n\n    await this.mastra?.pubsub.subscribe(`workflow.events.v2.${this.runId}`, watchCb).catch(() => {});\n\n    return async () => {\n      await this.mastra?.pubsub.unsubscribe(`workflow.events.v2.${this.runId}`, watchCb).catch(() => {});\n    };\n  }\n\n  async cancel() {\n    // Update storage directly for immediate status update (same pattern as Inngest)\n    const workflowsStore = await this.mastra?.getStorage()?.getStore('workflows');\n    await workflowsStore?.updateWorkflowState({\n      workflowName: this.workflowId,\n      runId: this.runId,\n      opts: {\n        status: 'canceled',\n      },\n    });\n\n    // Trigger abort signal - the abort handler will publish the workflow.cancel event\n    // This ensures consistent behavior whether cancel() or abort() is called\n    this.abortController.abort();\n  }\n}\n","import type { Step, StepFlowEntry, Workflow } from '../..';\nimport type { Mastra } from '../../../mastra';\nimport { EventedWorkflow } from '../workflow';\nimport type { ParentWorkflow } from '.';\n\nexport function getNestedWorkflow(\n  mastra: Mastra,\n  { workflowId, executionPath, parentWorkflow }: ParentWorkflow,\n): Workflow | null {\n  let workflow: Workflow | null = null;\n\n  if (parentWorkflow) {\n    const nestedWorkflow = getNestedWorkflow(mastra, parentWorkflow);\n    if (!nestedWorkflow) {\n      return null;\n    }\n\n    workflow = nestedWorkflow;\n  }\n\n  workflow = workflow ?? mastra.getWorkflow(workflowId);\n  const stepGraph = workflow.stepGraph;\n  let parentStep = stepGraph[executionPath[0]!];\n  if (parentStep?.type === 'parallel' || parentStep?.type === 'conditional') {\n    parentStep = parentStep.steps[executionPath[1]!];\n  }\n\n  if (parentStep?.type === 'step' || parentStep?.type === 'loop') {\n    return parentStep.step as Workflow;\n  }\n\n  return null;\n}\n\nexport function getStep(workflow: Workflow, executionPath: number[]): Step<string, any, any, any, any, any> | null {\n  let idx = 0;\n  const stepGraph = workflow.stepGraph;\n  let parentStep = stepGraph[executionPath[0]!];\n  if (parentStep?.type === 'parallel' || parentStep?.type === 'conditional') {\n    parentStep = parentStep.steps[executionPath[1]!];\n    idx++;\n  } else if (parentStep?.type === 'foreach') {\n    return parentStep.step;\n  }\n\n  if (!(parentStep?.type === 'step' || parentStep?.type === 'loop')) {\n    return null;\n  }\n\n  if (parentStep instanceof EventedWorkflow) {\n    return getStep(parentStep, executionPath.slice(idx + 1));\n  }\n\n  return parentStep.step;\n}\n\nexport function isExecutableStep(step: StepFlowEntry<any>) {\n  return step.type === 'step' || step.type === 'loop' || step.type === 'foreach';\n}\n","import type { RequestContext } from '../../di';\nimport type { PubSub } from '../../events/pubsub';\nimport type { Event } from '../../events/types';\nimport type { Mastra } from '../../mastra';\nimport { ExecutionEngine } from '../../workflows/execution-engine';\nimport type { ExecutionEngineOptions, ExecutionGraph } from '../../workflows/execution-engine';\nimport type {\n  SerializedStepFlowEntry,\n  StepResult,\n  RestartExecutionParams,\n  TimeTravelExecutionParams,\n  WorkflowRunStatus,\n} from '../types';\nimport { hydrateSerializedStepErrors } from '../utils';\nimport type { WorkflowEventProcessor } from './workflow-event-processor';\nimport { getStep } from './workflow-event-processor/utils';\n\nexport class EventedExecutionEngine extends ExecutionEngine {\n  protected eventProcessor: WorkflowEventProcessor;\n\n  constructor({\n    mastra,\n    eventProcessor,\n    options,\n  }: {\n    mastra?: Mastra;\n    eventProcessor: WorkflowEventProcessor;\n    options: ExecutionEngineOptions;\n  }) {\n    super({ mastra, options });\n    this.eventProcessor = eventProcessor;\n  }\n\n  __registerMastra(mastra: Mastra) {\n    this.mastra = mastra;\n    this.eventProcessor.__registerMastra(mastra);\n  }\n\n  /**\n   * Executes a workflow run with the provided execution graph and input\n   * @param graph The execution graph to execute\n   * @param input The input data for the workflow\n   * @returns A promise that resolves to the workflow output\n   */\n  async execute<TInput, TOutput>(params: {\n    workflowId: string;\n    runId: string;\n    graph: ExecutionGraph;\n    serializedStepGraph: SerializedStepFlowEntry[];\n    input?: TInput;\n    restart?: RestartExecutionParams;\n    timeTravel?: TimeTravelExecutionParams;\n    resume?: {\n      steps: string[];\n      stepResults: Record<string, StepResult<any, any, any, any>>;\n      resumePayload: any;\n      resumePath: number[];\n    };\n    pubsub?: PubSub; // Not used - evented engine uses this.mastra.pubsub directly\n    requestContext: RequestContext;\n    retryConfig?: {\n      attempts?: number;\n      delay?: number;\n    };\n    abortController: AbortController;\n    format?: 'legacy' | 'vnext' | undefined;\n    perStep?: boolean;\n  }): Promise<TOutput> {\n    const pubsub = this.mastra?.pubsub;\n    if (!pubsub) {\n      throw new Error('No Pubsub adapter configured on the Mastra instance');\n    }\n\n    if (params.resume) {\n      const prevStep = getStep(this.mastra!.getWorkflow(params.workflowId), params.resume.resumePath);\n      const prevResult = params.resume.stepResults[prevStep?.id ?? 'input'];\n\n      await pubsub.publish('workflows', {\n        type: 'workflow.resume',\n        runId: params.runId,\n        data: {\n          workflowId: params.workflowId,\n          runId: params.runId,\n          executionPath: params.resume.resumePath,\n          stepResults: params.resume.stepResults,\n          resumeSteps: params.resume.steps,\n          prevResult: { status: 'success', output: prevResult?.payload },\n          resumeData: params.resume.resumePayload,\n          requestContext: Object.fromEntries(params.requestContext.entries()),\n          format: params.format,\n          perStep: params.perStep,\n        },\n      });\n    } else if (params.timeTravel) {\n      const prevStep = getStep(this.mastra!.getWorkflow(params.workflowId), params.timeTravel.executionPath);\n      const prevResult = params.timeTravel.stepResults[prevStep?.id ?? 'input'];\n      await pubsub.publish('workflows', {\n        type: 'workflow.start',\n        runId: params.runId,\n        data: {\n          workflowId: params.workflowId,\n          runId: params.runId,\n          executionPath: params.timeTravel.executionPath,\n          stepResults: params.timeTravel.stepResults,\n          timeTravel: params.timeTravel,\n          prevResult: { status: 'success', output: prevResult?.payload },\n          requestContext: Object.fromEntries(params.requestContext.entries()),\n          format: params.format,\n          perStep: params.perStep,\n        },\n      });\n    } else {\n      await pubsub.publish('workflows', {\n        type: 'workflow.start',\n        runId: params.runId,\n        data: {\n          workflowId: params.workflowId,\n          runId: params.runId,\n          prevResult: { status: 'success', output: params.input },\n          requestContext: Object.fromEntries(params.requestContext.entries()),\n          format: params.format,\n          perStep: params.perStep,\n        },\n      });\n    }\n\n    const resultData: any = await new Promise((resolve, reject) => {\n      const finishCb = async (event: Event, ack?: () => Promise<void>) => {\n        if (event.runId !== params.runId) {\n          await ack?.();\n          return;\n        }\n\n        if (['workflow.end', 'workflow.fail', 'workflow.suspend'].includes(event.type)) {\n          await ack?.();\n          await pubsub.unsubscribe('workflows-finish', finishCb);\n          // Re-hydrate serialized errors back to Error instances when workflow fails\n          if (event.type === 'workflow.fail' && event.data.stepResults) {\n            event.data.stepResults = hydrateSerializedStepErrors(event.data.stepResults);\n          }\n          resolve(event.data);\n          return;\n        }\n\n        await ack?.();\n      };\n\n      pubsub.subscribe('workflows-finish', finishCb).catch(err => {\n        this.mastra?.getLogger()?.error('Failed to subscribe to workflows-finish:', err);\n        reject(err);\n      });\n    });\n\n    // Build the callback argument with proper typing for invokeLifecycleCallbacks\n    let callbackArg: {\n      status: WorkflowRunStatus;\n      result?: any;\n      error?: any;\n      steps: Record<string, StepResult<any, any, any, any>>;\n    };\n\n    if (resultData.prevResult.status === 'failed') {\n      callbackArg = {\n        status: 'failed',\n        error: resultData.prevResult.error,\n        steps: resultData.stepResults,\n      };\n    } else if (resultData.prevResult.status === 'suspended') {\n      callbackArg = {\n        status: 'suspended',\n        steps: resultData.stepResults,\n      };\n    } else if (resultData.prevResult.status === 'paused' || params.perStep) {\n      callbackArg = {\n        status: 'paused',\n        steps: resultData.stepResults,\n      };\n    } else {\n      callbackArg = {\n        status: resultData.prevResult.status,\n        result: resultData.prevResult?.output,\n        steps: resultData.stepResults,\n      };\n    }\n\n    if (callbackArg.status !== 'paused') {\n      // Invoke lifecycle callbacks before returning\n      await this.invokeLifecycleCallbacks({\n        status: callbackArg.status,\n        result: callbackArg.result,\n        error: callbackArg.error,\n        steps: callbackArg.steps,\n        tripwire: undefined,\n        runId: params.runId,\n        workflowId: params.workflowId,\n        resourceId: undefined,\n        input: params.input,\n        requestContext: params.requestContext,\n        state: {},\n      });\n    }\n\n    // Build the final result with any additional fields needed for the return type\n    let result: TOutput;\n    if (resultData.prevResult.status === 'suspended') {\n      const suspendedSteps = Object.entries(resultData.stepResults)\n        .map(([_stepId, stepResult]: [string, any]) => {\n          if (stepResult.status === 'suspended') {\n            return stepResult.suspendPayload?.__workflow_meta?.path ?? [];\n          }\n          return null;\n        })\n        .filter(Boolean);\n      result = {\n        ...callbackArg,\n        suspended: suspendedSteps,\n      } as TOutput;\n    } else {\n      result = callbackArg as TOutput;\n    }\n\n    return result;\n  }\n}\n"]}