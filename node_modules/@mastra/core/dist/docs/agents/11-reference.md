# Agents API Reference

> API reference for agents - 18 entries


---

## Reference: Agent Class

> Documentation for the `Agent` class in Mastra, which provides the foundation for creating AI agents with various capabilities.

The `Agent` class is the foundation for creating AI agents in Mastra. It provides methods for generating responses, streaming interactions, and handling voice capabilities.

## Usage examples

### Basic string instructions

```typescript title="src/mastra/agents/string-agent.ts"
import { Agent } from "@mastra/core/agent";

// String instructions
export const agent = new Agent({
  id: "test-agent",
  name: "Test Agent",
  instructions: "You are a helpful assistant that provides concise answers.",
  model: "openai/gpt-5.1",
});

// System message object
export const agent2 = new Agent({
  id: "test-agent-2",
  name: "Test Agent 2",
  instructions: {
    role: "system",
    content: "You are an expert programmer",
  },
  model: "openai/gpt-5.1",
});

// Array of system messages
export const agent3 = new Agent({
  id: "test-agent-3",
  name: "Test Agent 3",
  instructions: [
    { role: "system", content: "You are a helpful assistant" },
    { role: "system", content: "You have expertise in TypeScript" },
  ],
  model: "openai/gpt-5.1",
});
```

### Single CoreSystemMessage

Use CoreSystemMessage format to access additional properties like `providerOptions` for provider-specific configurations:

```typescript title="src/mastra/agents/core-message-agent.ts"
import { Agent } from "@mastra/core/agent";

export const agent = new Agent({
  id: "core-message-agent",
  name: "Core Message Agent",
  instructions: {
    role: "system",
    content:
      "You are a helpful assistant specialized in technical documentation.",
    providerOptions: {
      openai: {
        reasoningEffort: "low",
      },
    },
  },
  model: "openai/gpt-5.1",
});
```

### Multiple CoreSystemMessages

```typescript title="src/mastra/agents/multi-message-agent.ts"
import { Agent } from "@mastra/core/agent";

// This could be customizable based on the user
const preferredTone = {
  role: "system",
  content: "Always maintain a professional and empathetic tone.",
};

export const agent = new Agent({
  id: "multi-message-agent",
  name: "Multi Message Agent",
  instructions: [
    { role: "system", content: "You are a customer service representative." },
    preferredTone,
    {
      role: "system",
      content: "Escalate complex issues to human agents when needed.",
      providerOptions: {
        anthropic: { cacheControl: { type: "ephemeral" } },
      },
    },
  ],
  model: "anthropic/claude-sonnet-4-20250514",
});
```

## Constructor parameters

## Returns

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)

---

## Reference: Agent.generate()

> Documentation for the `Agent.generate()` method in Mastra agents, which enables non-streaming generation of responses with enhanced capabilities.

The `.generate()` method enables non-streaming response generation from an agent with enhanced capabilities. It accepts messages and optional generation options.

## Usage example

```typescript
// Basic usage
const result = await agent.generate("message for agent");

// With model settings (e.g., limiting output tokens)
const limitedResult = await agent.generate("Write a short poem about coding", {
  modelSettings: {
    maxOutputTokens: 50,
    temperature: 0.7,
  },
});

// With structured output
const structuredResult = await agent.generate("Extract the user's name and age", {
  structuredOutput: {
    schema: z.object({
      name: z.string(),
      age: z.number(),
    }),
  },
});

// With memory for conversation persistence
const memoryResult = await agent.generate("Remember my favorite color is blue", {
  memory: {
    thread: "user-123-thread",
    resource: "user-123",
  },
});
```

> **Note:**

**Model Compatibility**: This method requires AI SDK v5+ models. If you're using AI SDK v4 models, use the [`.generateLegacy()`](./generateLegacy) method instead. The framework automatically detects your model version and will throw an error if there's a mismatch.

## Parameters

### Options

## Returns

---

## Reference: Agent.generateLegacy() (Legacy)

> Documentation for the legacy `Agent.generateLegacy()` method in Mastra agents. This method is deprecated and will be removed in a future version.

> **Note:**

**Deprecated**: This method is deprecated and only works with V1 models. For V2 models, use the new [`.generate()`](./generate) method instead.

The `.generateLegacy()` method is the legacy version of the agent generation API, used to interact with V1 model agents to produce text or structured responses. This method accepts messages and optional generation options.

## Usage example

```typescript
await agent.generateLegacy("message for agent");
```

## Parameters

### Options parameters

## Returns

## Migration to New API

> **Note:**

The new `.generate()` method offers enhanced capabilities including AI SDK v5+ compatibility, better structured output handling, and improved streaming support. See the [migration guide](https://mastra.ai/guides/v1/migrations/vnext-to-standard-apis) for detailed migration instructions.

### Quick Migration Example

#### Before (Legacy)

```typescript
const result = await agent.generateLegacy("message", {
  temperature: 0.7,
  maxSteps: 3,
});
```

#### After (New API)

```typescript
const result = await agent.generate("message", {
  modelSettings: {
    temperature: 0.7,
  },
  maxSteps: 3,
});
```

## Extended usage example

```typescript
import { z } from "zod";
import {
  ModerationProcessor,
  TokenLimiterProcessor,
} from "@mastra/core/processors";

await agent.generateLegacy(
  [
    { role: "user", content: "message for agent" },
    {
      role: "user",
      content: [
        {
          type: "text",
          text: "message for agent",
        },
        {
          type: "image",
          imageUrl: "https://example.com/image.jpg",
          mimeType: "image/jpeg",
        },
      ],
    },
  ],
  {
    temperature: 0.7,
    maxSteps: 3,
    memory: {
      thread: "user-123",
      resource: "test-app",
    },
    toolChoice: "auto",
    providerOptions: {
      openai: {
        reasoningEffort: "high",
      },
    },
    // Structured output with better DX
    structuredOutput: {
      schema: z.object({
        sentiment: z.enum(["positive", "negative", "neutral"]),
        confidence: z.number(),
      }),
      model: "openai/gpt-5.1",
      errorStrategy: "warn",
    },
    // Output processors for response validation
    outputProcessors: [
      new ModerationProcessor({ model: "openai/gpt-4.1-nano" }),
      new TokenLimiterProcessor({ maxTokens: 1000 }),
    ],
  },
);
```

## Related

- [Migration Guide](https://mastra.ai/guides/v1/migrations/vnext-to-standard-apis)
- [New .generate() method](./generate)
- [Generating responses](https://mastra.ai/docs/v1/agents/overview#generating-responses)
- [Streaming responses](https://mastra.ai/docs/v1/agents/overview#generating-responses)

---

## Reference: Agent.getDefaultGenerateOptionsLegacy()

> Documentation for the `Agent.getDefaultGenerateOptionsLegacy()` method in Mastra agents, which retrieves the default options used for generateLegacy calls.

> **Note:**

**Deprecated**: This method is deprecated and only works with V1 models. For V2 models, use the new [`.getDefaultOptions()`](./getDefaultOptions) method instead.

Agents can be configured with default generation options for controlling model behavior, output formatting and tool and workflow calls. The `.getDefaultGenerateOptionsLegacy()` method retrieves these defaults, resolving them if they are functions. These options apply to all `generateLegacy()` calls unless overridden and are useful for inspecting an agent’s unknown defaults.

## Usage example

```typescript
await agent.getDefaultGenerateOptionsLegacy();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getDefaultGenerateOptionsLegacy({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Agent generation](https://mastra.ai/docs/v1/agents/overview#generating-responses)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.getDefaultOptions()

> Documentation for the `Agent.getDefaultOptions()` method in Mastra agents, which retrieves the default options used for stream and generate calls.

Agents can be configured with default options for memory usage, output format, and iteration steps. The `.getDefaultOptions()` method returns these defaults, resolving them if they are functions. These options apply to all `stream()` and `generate()` calls unless overridden and are useful for inspecting an agent’s unknown defaults.

## Usage example

```typescript
await agent.getDefaultOptions();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getDefaultOptions({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Streaming with agents](https://mastra.ai/docs/v1/streaming/overview#streaming-with-agents)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.getDefaultStreamOptionsLegacy()

> Documentation for the `Agent.getDefaultStreamOptionsLegacy()` method in Mastra agents, which retrieves the default options used for streamLegacy calls.

> **Note:**

**Deprecated**: This method is deprecated and only works with V1 models. For V2 models, use the new [`.getDefaultOptions()`](./getDefaultOptions) method instead.

Agents can be configured with default streaming options for memory usage, output format, and iteration steps. The `.getDefaultStreamOptionsLegacy()` method returns these defaults, resolving them if they are functions. These options apply to all `streamLegacy()` calls unless overridden and are useful for inspecting an agent’s unknown defaults.

## Usage example

```typescript
await agent.getDefaultStreamOptionsLegacy();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getDefaultStreamOptionsLegacy({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Streaming with agents](https://mastra.ai/docs/v1/streaming/overview#streaming-with-agents)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.getDescription()

> Documentation for the `Agent.getDescription()` method in Mastra agents, which retrieves the agent

The `.getDescription()` method retrieves the description configured for an agent. This method returns a simple string description that describes the agent's purpose and capabilities.

## Usage example

```typescript
agent.getDescription();
```

## Parameters

This method takes no parameters.

## Returns

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)

---

## Reference: Agent.getInstructions()

> Documentation for the `Agent.getInstructions()` method in Mastra agents, which retrieves the instructions that guide the agent

The `.getInstructions()` method retrieves the instructions configured for an agent, resolving them if they're a function. These instructions guide the agent's behavior and define its capabilities and constraints.

## Usage example

```typescript
await agent.getInstructions();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getInstructions({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.getLLM()

> Documentation for the `Agent.getLLM()` method in Mastra agents, which retrieves the language model instance.

The `.getLLM()` method retrieves the language model instance configured for an agent, resolving it if it's a function. This method provides access to the underlying LLM that powers the agent's capabilities.

## Usage example

```typescript
await agent.getLLM();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getLLM({
  requestContext: new RequestContext(),
  model: "openai/gpt-5.1",
});
```

### Options parameters

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.getMemory()

> Documentation for the `Agent.getMemory()` method in Mastra agents, which retrieves the memory system associated with the agent.

The `.getMemory()` method retrieves the memory system associated with an agent. This method is used to access the agent's memory capabilities for storing and retrieving information across conversations.

## Usage example

```typescript
await agent.getMemory();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getMemory({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Agent memory](https://mastra.ai/docs/v1/agents/agent-memory)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.getModel()

> Documentation for the `Agent.getModel()` method in Mastra agents, which retrieves the language model that powers the agent.

The `.getModel()` method retrieves the language model configured for an agent, resolving it if it's a function. This method is used to access the underlying model that powers the agent's capabilities.

## Usage example

```typescript
await agent.getModel();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getModel({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.getTools()

> Documentation for the `Agent.getTools()` method in Mastra agents, which retrieves the tools that the agent can use.

The `.getTools()` method retrieves the tools configured for an agent, resolving them if they're a function. These tools extend the agent's capabilities, allowing it to perform specific actions or access external systems.

## Usage example

```typescript
await agent.getTools();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getTools({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Using tools with agents](https://mastra.ai/docs/v1/agents/using-tools)
- [MCP Overview](https://mastra.ai/docs/v1/mcp/overview)

---

## Reference: Agent.getVoice()

> Documentation for the `Agent.getVoice()` method in Mastra agents, which retrieves the voice provider for speech capabilities.

The `.getVoice()` method retrieves the voice provider configured for an agent, resolving it if it's a function. This method is used to access the agent's speech capabilities for text-to-speech and speech-to-text functionality.

## Usage example

```typescript
await agent.getVoice();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.getVoice({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Adding voice to agents](https://mastra.ai/docs/v1/agents/adding-voice)
- [Voice providers](../voice/mastra-voice)

---

## Reference: Agent.listAgents()

> Documentation for the `Agent.listAgents()` method in Mastra agents, which retrieves the sub-agents that the agent can access.

The `.listAgents()` method retrieves the sub-agents configured for an agent, resolving them if they're a function. These sub-agents enable the agent to access other agents and perform complex actions.

## Usage example

```typescript
await agent.listAgents();
```

## Parameters

## Returns

## Extended usage example

```typescript
import { RequestContext } from "@mastra/core/request-context";

await agent.listAgents({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)

---

## Reference: Agent.listScorers()

> Documentation for the `Agent.listScorers()` method in Mastra agents, which retrieves the scoring configuration.

The `.listScorers()` method retrieves the scoring configuration configured for an agent, resolving it if it's a function. This method provides access to the scoring system used for evaluating agent responses and performance.

## Usage example

```typescript
await agent.listScorers();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.listScorers({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)
- [Request Context](https://mastra.ai/docs/v1/server/request-context)

---

## Reference: Agent.listTools()

> Documentation for the `Agent.listTools()` method in Mastra agents, which retrieves the tools that the agent can use.

The `.listTools()` method retrieves the tools configured for an agent, resolving them if they're a function. These tools extend the agent's capabilities, allowing it to perform specific actions or access external systems.

## Usage example

```typescript
await agent.listTools();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.listTools({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Using tools with agents](https://mastra.ai/docs/v1/agents/using-tools)
- [Creating tools](https://mastra.ai/docs/v1/mcp/overview)

---

## Reference: Agent.listWorkflows()

> Documentation for the `Agent.listWorkflows()` method in Mastra agents, which retrieves the workflows that the agent can execute.

The `.listWorkflows()` method retrieves the workflows configured for an agent, resolving them if they're a function. These workflows enable the agent to execute complex, multi-step processes with defined execution paths.

## Usage example

```typescript
await agent.listWorkflows();
```

## Parameters

## Returns

## Extended usage example

```typescript
await agent.listWorkflows({
  requestContext: new RequestContext(),
});
```

### Options parameters

## Related

- [Agents overview](https://mastra.ai/docs/v1/agents/overview)
- [Workflows overview](https://mastra.ai/docs/v1/workflows/overview)

---

## Reference: Agent.network()

> Documentation for the `Agent.network()` method in Mastra agents, which enables multi-agent collaboration and routing.

> **Note:** Experimental Feature
This is an experimental API that may change in future versions. The `network()` method enables multi-agent collaboration and workflow orchestration. Use with caution in production environments.

The `.network()` method enables multi-agent collaboration and routing. This method accepts messages and optional execution options.

## Usage example

```typescript
import { Agent } from "@mastra/core/agent";
import { agent1, agent2 } from "./agents";
import { workflow1 } from "./workflows";
import { tool1, tool2 } from "./tools";

const agent = new Agent({
  id: "network-agent",
  name: "Network Agent",
  instructions:
    "You are a network agent that can help users with a variety of tasks.",
  model: "openai/gpt-5.1",
  agents: {
    agent1,
    agent2,
  },
  workflows: {
    workflow1,
  },
  tools: {
    tool1,
    tool2,
  },
});

await agent.network(`
  Find me the weather in Tokyo.
  Based on the weather, plan an activity for me.
`);
```

## Parameters

### Options

## Returns

## Structured Output

When you need typed, validated results from your network, use the `structuredOutput` option. The network will generate a response matching your schema after task completion.

```typescript
import { z } from "zod";

const resultSchema = z.object({
  summary: z.string().describe("A brief summary of the findings"),
  recommendations: z.array(z.string()).describe("List of recommendations"),
  confidence: z.number().min(0).max(1).describe("Confidence score"),
});

const stream = await agent.network("Research AI trends and summarize", {
  structuredOutput: {
    schema: resultSchema,
  },
});

// Consume the stream
for await (const chunk of stream) {
  // Handle streaming events
}

// Get the typed result
const result = await stream.object;
// result is typed as { summary: string; recommendations: string[]; confidence: number }
console.log(result?.summary);
console.log(result?.recommendations);
```

### Streaming Partial Objects

You can also stream partial objects as they're being generated:

```typescript
const stream = await agent.network("Analyze data", {
  structuredOutput: { schema: resultSchema },
});

// Stream partial objects
for await (const partial of stream.objectStream) {
  console.log("Partial result:", partial);
}

// Get final result
const final = await stream.object;
```

### Chunk Types

When using structured output, additional chunk types are emitted:

- `network-object`: Emitted with partial objects during streaming
- `network-object-result`: Emitted with the final structured object