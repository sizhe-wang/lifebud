import type { PaginationInfo } from '../../types.js';
import type { InMemoryDB } from '../inmemory-db.js';
import { ObservabilityStorage } from './base.js';
import type { BatchCreateSpansArgs, BatchDeleteTracesArgs, BatchUpdateSpansArgs, CreateSpanArgs, GetRootSpanArgs, GetRootSpanResponse, GetSpanArgs, GetSpanResponse, GetTraceArgs, GetTraceResponse, ListTracesArgs, SpanRecord, TracingStorageStrategy, UpdateSpanArgs } from './types.js';
import { TraceStatus } from './types.js';
/**
 * Internal structure for storing a trace with computed properties for efficient filtering
 */
export interface TraceEntry {
    /** All spans in this trace, keyed by spanId */
    spans: Record<string, SpanRecord>;
    /** Root span for this trace (parentSpanId === null) */
    rootSpan: SpanRecord | null;
    /** Computed trace status based on root span state */
    status: TraceStatus;
    /** True if any span in the trace has an error */
    hasChildError: boolean;
}
export declare class ObservabilityInMemory extends ObservabilityStorage {
    private db;
    constructor({ db }: {
        db: InMemoryDB;
    });
    dangerouslyClearAll(): Promise<void>;
    get tracingStrategy(): {
        preferred: TracingStorageStrategy;
        supported: TracingStorageStrategy[];
    };
    createSpan(args: CreateSpanArgs): Promise<void>;
    batchCreateSpans(args: BatchCreateSpansArgs): Promise<void>;
    private validateCreateSpan;
    /**
     * Inserts or updates a span in the trace and recomputes trace-level properties
     */
    private upsertSpanToTrace;
    /**
     * Recomputes derived trace properties from all spans
     */
    private recomputeTraceProperties;
    getSpan(args: GetSpanArgs): Promise<GetSpanResponse | null>;
    getRootSpan(args: GetRootSpanArgs): Promise<GetRootSpanResponse | null>;
    getTrace(args: GetTraceArgs): Promise<GetTraceResponse | null>;
    listTraces(args: ListTracesArgs): Promise<{
        pagination: PaginationInfo;
        spans: SpanRecord[];
    }>;
    /**
     * Check if a trace matches all provided filters
     */
    private traceMatchesFilters;
    /**
     * Deep equality check for JSON values
     */
    private jsonValueEquals;
    updateSpan(args: UpdateSpanArgs): Promise<void>;
    batchUpdateSpans(args: BatchUpdateSpansArgs): Promise<void>;
    batchDeleteTraces(args: BatchDeleteTracesArgs): Promise<void>;
}
//# sourceMappingURL=inmemory.d.ts.map