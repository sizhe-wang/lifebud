# Memory API Reference

> API reference for memory - 1 entries


---

## Reference: Memory Class

> Documentation for the `Memory` class in Mastra, which provides a robust system for managing conversation history and thread-based message storage.

The `Memory` class provides a robust system for managing conversation history and thread-based message storage in Mastra. It enables persistent storage of conversations, semantic search capabilities, and efficient message retrieval. You must configure a storage provider for conversation history, and if you enable semantic recall you will also need to provide a vector store and embedder.

## Usage example

```typescript title="src/mastra/agents/test-agent.ts"
import { Memory } from "@mastra/memory";
import { Agent } from "@mastra/core/agent";

export const agent = new Agent({
  name: "test-agent",
  instructions: "You are an agent with memory.",
  model: "openai/gpt-5.1",
  memory: new Memory({
    options: {
      workingMemory: {
        enabled: true,
      },
    },
  }),
});
```

> To enable `workingMemory` on an agent, youâ€™ll need a storage provider configured on your main Mastra instance. See [Mastra class](../core/mastra-class) for more information.

## Constructor parameters

### Options parameters

## Returns

## Extended usage example

```typescript title="src/mastra/agents/test-agent.ts"
import { Memory } from "@mastra/memory";
import { Agent } from "@mastra/core/agent";
import { LibSQLStore, LibSQLVector } from "@mastra/libsql";

export const agent = new Agent({
  name: "test-agent",
  instructions: "You are an agent with memory.",
  model: "openai/gpt-5.1",
  memory: new Memory({
    storage: new LibSQLStore({
      id: 'test-agent-storage',
      url: "file:./working-memory.db",
    }),
    vector: new LibSQLVector({
      id: 'test-agent-vector',
      url: "file:./vector-memory.db",
    }),
    options: {
      lastMessages: 10,
      semanticRecall: {
        topK: 3,
        messageRange: 2,
        scope: "resource",
      },
      workingMemory: {
        enabled: true,
      },
      generateTitle: true,
    },
  }),
});
```

## PostgreSQL with index configuration

```typescript title="src/mastra/agents/pg-agent.ts"
import { Memory } from "@mastra/memory";
import { Agent } from "@mastra/core/agent";
import { ModelRouterEmbeddingModel } from "@mastra/core/llm";
import { PgStore, PgVector } from "@mastra/pg";

export const agent = new Agent({
  name: "pg-agent",
  instructions: "You are an agent with optimized PostgreSQL memory.",
  model: "openai/gpt-5.1",
  memory: new Memory({
    storage: new PgStore({
      id: 'pg-agent-storage',
      connectionString: process.env.DATABASE_URL,
    }),
    vector: new PgVector({
      id: 'pg-agent-vector',
      connectionString: process.env.DATABASE_URL,
    }),
    embedder: new ModelRouterEmbeddingModel("openai/text-embedding-3-small"),
    options: {
      lastMessages: 20,
      semanticRecall: {
        topK: 5,
        messageRange: 3,
        scope: "resource",
        indexConfig: {
          type: "hnsw", // Use HNSW for better performance
          metric: "dotproduct", // Optimal for OpenAI embeddings
          m: 16, // Number of bi-directional links
          efConstruction: 64, // Construction-time candidate list size
        },
      },
      workingMemory: {
        enabled: true,
      },
    },
  }),
});
```

### Related

- [Getting Started with Memory](https://mastra.ai/docs/v1/memory/overview)
- [Semantic Recall](https://mastra.ai/docs/v1/memory/semantic-recall)
- [Working Memory](https://mastra.ai/docs/v1/memory/working-memory)
- [Memory Processors](https://mastra.ai/docs/v1/memory/memory-processors)
- [createThread](https://mastra.ai/reference/v1/memory/createThread)
- [recall](https://mastra.ai/reference/v1/memory/recall)
- [getThreadById](https://mastra.ai/reference/v1/memory/getThreadById)
- [listThreadsByResourceId](https://mastra.ai/reference/v1/memory/listThreadsByResourceId)
- [deleteMessages](https://mastra.ai/reference/v1/memory/deleteMessages)
- [cloneThread](https://mastra.ai/reference/v1/memory/cloneThread)
- [Clone Utility Methods](https://mastra.ai/reference/v1/memory/clone-utilities)